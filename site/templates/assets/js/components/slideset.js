!function(t){var i;window.UIkit2&&(i=t(UIkit2)),"function"==typeof define&&define.amd&&define("uikit-slideset",["uikit"],function(){return i||t(UIkit2)})}(function(d){"use strict";var r;function n(t,i,e,s){var n,a,o,r,l=d.$.Deferred(),h=!1===this.options.delay?Math.floor(this.options.duration/2):this.options.delay,u=this;if(s=s||1,this.element.css("min-height",this.element.height()),e[0]===i[0])return l.resolve(),l.promise();if("object"==typeof t?(n=t[0],a=t[1]||t[0]):a=n=t,d.$body.css("overflow-x","hidden"),o=function(){if(i&&i.length&&i.hide().removeClass(a+" uk-animation-reverse").css({opacity:"","animation-delay":"",animation:""}),e.length){for(r=0;r<e.length;r++)e.eq(1==s?r:e.length-r-1).css("animation-delay",r*h+"ms");var t=function(){e.removeClass(""+n).css({opacity:"",display:"","animation-delay":"",animation:""}),l.resolve(),d.$body.css("overflow-x",""),u.element.css("min-height",""),t=!1};e.addClass(n)[1==s?"last":"first"]().one(d.support.animation.end,function(){t&&t()}).end().css("display",""),setTimeout(function(){t&&t()},e.length*h*2)}else l.resolve()},e.length&&e.css("animation-duration",this.options.duration+"ms"),i&&i.length)for(i.css("animation-duration",this.options.duration+"ms")[1==s?"last":"first"]().one(d.support.animation.end,function(){o()}),r=0;r<i.length;r++)!function(t,i){setTimeout(function(){i.css("display","none").css("display","").css("opacity",0).on(d.support.animation.end,function(){i.removeClass(a)}).addClass(a+" uk-animation-reverse")}.bind(this),r*h)}(0,i.eq(1==s?r:i.length-r-1));else o();return l.promise()}d.component("slideset",{defaults:{default:1,animation:"fade",duration:200,filter:"",delay:!1,controls:!1,autoplay:!1,autoplayInterval:7e3,pauseOnHover:!0},sets:[],boot:function(){d.ready(function(t){d.$("[data-uk-slideset]",t).each(function(){var t=d.$(this);t.data("slideset")||d.slideset(t,d.Utils.options(t.attr("data-uk-slideset")))})})},init:function(){var e=this;this.activeSet=!1,this.list=this.element.find(".uk-slideset"),this.nav=this.element.find(".uk-slideset-nav"),this.controls=this.options.controls?d.$(this.options.controls):this.element,d.$win.on("resize load",d.Utils.debounce(function(){e.update()},100)),e.list.addClass("uk-grid-width-1-"+e.options.default),["xlarge","large","medium","small"].forEach(function(t){e.options[t]&&e.list.addClass("uk-grid-width-"+t+"-1-"+e.options[t])}),this.on("click.uk.slideset","[data-uk-slideset-item]",function(t){if(t.preventDefault(),!e.animating){var i=d.$(this).attr("data-uk-slideset-item");if(e.activeSet!==i)switch(i){case"next":case"previous":e["next"==i?"next":"previous"]();break;default:e.show(parseInt(i,10))}}}),this.controls.on("click.uk.slideset","[data-uk-filter]",function(t){var i=d.$(this);i.parent().hasClass("uk-slideset")||(t.preventDefault(),e.animating||e.currentFilter==i.attr("data-uk-filter")||(e.updateFilter(i.attr("data-uk-filter")),e._hide().then(function(){e.update(!0,!0)})))}),this.on("swipeRight swipeLeft",function(t){e["swipeLeft"==t.type?"next":"previous"]()}),this.updateFilter(this.options.filter),this.update(),this.element.on({mouseenter:function(){e.options.pauseOnHover&&(e.hovering=!0)},mouseleave:function(){e.hovering=!1}}),this.options.autoplay&&this.start(),d.domObserve(this.list,function(t){e.list.children(":visible:not(.uk-active)").length&&e.update(!1,!0)})},update:function(t,i){var e,s=this.visible;if(this.visible=this.getVisibleOnCurrenBreakpoint(),s!=this.visible||i){for(this.children=this.list.children().hide(),this.items=this.getItems(),this.sets=function(t,i){var e,s=0,n=-1,a=t.length||0,o=[];if(i<1)return null;for(;s<a;)(e=s%i)?o[n][e]=t[s]:o[++n]=[t[s]],s++;s=0,a=o.length;for(;s<a;)o[s]=jQuery(o[s]),s++;return o}(this.items,this.visible),e=0;e<this.sets.length;e++)this.sets[e].css({display:"none"});if(this.nav.length&&this.nav.empty()){for(e=0;e<this.sets.length;e++)this.nav.append('<li data-uk-slideset-item="'+e+'"><a></a></li>');this.nav[1==this.nav.children().length?"addClass":"removeClass"]("uk-invisible")}this.activeSet=!1,this.show(0,!t)}},updateFilter:function(t){var i,e=this;this.currentFilter=t,this.controls.find("[data-uk-filter]").each(function(){(i=d.$(this)).parent().hasClass("uk-slideset")||(i.attr("data-uk-filter")==e.currentFilter?i.addClass("uk-active"):i.removeClass("uk-active"))})},getVisibleOnCurrenBreakpoint:function(){var i=null,e=d.$('<div style="position:absolute;height:1px;top:-1000px;width:100px"><div></div></div>').appendTo("body"),s=e.children().eq(0),n=this.options;return["xlarge","large","medium","small"].forEach(function(t){n[t]&&!i&&(e.attr("class","uk-grid-width-"+t+"-1-2").width(),50==s.width()&&(i=t))}),e.remove(),this.options[i]||this.options.default},getItems:function(){var n,a=[];return this.currentFilter?("string"==typeof(n=this.currentFilter||[])&&(n=n.split(/,/).map(function(t){return t.trim()})),this.children.each(function(t){var i=d.$(this),e=i.attr("data-uk-filter"),s=!n.length;e&&(e=e.split(/,/).map(function(t){return t.trim()}),n.forEach(function(t){-1<e.indexOf(t)&&(s=!0)})),s&&a.push(i[0])}),a=d.$(a)):a=this.list.children(),a},show:function(t,i,e){var s=this;if(this.activeSet!==t&&!this.animating){e=e||(t<this.activeSet?-1:1);var n=this.sets[this.activeSet]||[],a=this.sets[t],o=this._getAnimation();!i&&d.support.animation||(o=r.none),this.animating=!0,this.nav.length&&this.nav.children().removeClass("uk-active").eq(t).addClass("uk-active"),o.apply(s,[n,a,e]).then(function(){d.Utils.checkDisplay(a,!0),s.children.hide().removeClass("uk-active"),a.addClass("uk-active").css({display:"",opacity:""}),s.animating=!1,s.activeSet=t,d.Utils.checkDisplay(a,!0),s.trigger("show.uk.slideset",[a])})}},_getAnimation:function(){var t=r[this.options.animation]||r.none;return d.support.animation||(t=r.none),t},_hide:function(){var t=this,i=this.sets[this.activeSet]||[],e=this._getAnimation();return this.animating=!0,e.apply(t,[i,[],1]).then(function(){t.animating=!1})},next:function(){this.show(this.sets[this.activeSet+1]?this.activeSet+1:0,!1,1)},previous:function(){this.show(this.sets[this.activeSet-1]?this.activeSet-1:this.sets.length-1,!1,-1)},start:function(){this.stop();var t=this;this.interval=setInterval(function(){t.hovering||t.animating||t.next()},this.options.autoplayInterval)},stop:function(){this.interval&&clearInterval(this.interval)}}),r={none:function(){var t=d.$.Deferred();return t.resolve(),t.promise()},fade:function(t,i){return n.apply(this,["uk-animation-fade",t,i])},"slide-bottom":function(t,i){return n.apply(this,["uk-animation-slide-bottom",t,i])},"slide-top":function(t,i){return n.apply(this,["uk-animation-slide-top",t,i])},"slide-vertical":function(t,i,e){var s=["uk-animation-slide-top","uk-animation-slide-bottom"];return-1==e&&s.reverse(),n.apply(this,[s,t,i])},"slide-horizontal":function(t,i,e){var s=["uk-animation-slide-right","uk-animation-slide-left"];return-1==e&&s.reverse(),n.apply(this,[s,t,i,e])},scale:function(t,i){return n.apply(this,["uk-animation-scale-up",t,i])}},d.slideset.animations=r});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvc2xpZGVzZXQuanMiXSwibmFtZXMiOlsiYWRkb24iLCJjb21wb25lbnQiLCJ3aW5kb3ciLCJVSWtpdDIiLCJkZWZpbmUiLCJhbWQiLCJVSSIsIkFuaW1hdGlvbnMiLCJjb3JlQW5pbWF0aW9uIiwiY2xzIiwiY3VycmVudCIsIm5leHQiLCJkaXIiLCJjbHNJbiIsImNsc091dCIsInJlbGVhc2UiLCJpIiwiZCIsIiQiLCJEZWZlcnJlZCIsImRlbGF5IiwidGhpcyIsIm9wdGlvbnMiLCJNYXRoIiwiZmxvb3IiLCJkdXJhdGlvbiIsIiR0aGlzIiwiZWxlbWVudCIsImNzcyIsImhlaWdodCIsInJlc29sdmUiLCJwcm9taXNlIiwiJGJvZHkiLCJsZW5ndGgiLCJoaWRlIiwicmVtb3ZlQ2xhc3MiLCJvcGFjaXR5IiwiYW5pbWF0aW9uLWRlbGF5IiwiYW5pbWF0aW9uIiwiZXEiLCJmaW5pc2giLCJkaXNwbGF5IiwiYWRkQ2xhc3MiLCJvbmUiLCJzdXBwb3J0IiwiZW5kIiwic2V0VGltZW91dCIsImluZGV4IiwiZWxlIiwib24iLCJiaW5kIiwiZGVmYXVsdHMiLCJkZWZhdWx0IiwiZmlsdGVyIiwiY29udHJvbHMiLCJhdXRvcGxheSIsImF1dG9wbGF5SW50ZXJ2YWwiLCJwYXVzZU9uSG92ZXIiLCJzZXRzIiwiYm9vdCIsInJlYWR5IiwiY29udGV4dCIsImVhY2giLCJkYXRhIiwic2xpZGVzZXQiLCJVdGlscyIsImF0dHIiLCJpbml0IiwiYWN0aXZlU2V0IiwibGlzdCIsImZpbmQiLCJuYXYiLCIkd2luIiwiZGVib3VuY2UiLCJ1cGRhdGUiLCJmb3JFYWNoIiwiYnAiLCJlIiwicHJldmVudERlZmF1bHQiLCJhbmltYXRpbmciLCJzZXQiLCJzaG93IiwicGFyc2VJbnQiLCJwYXJlbnQiLCJoYXNDbGFzcyIsImN1cnJlbnRGaWx0ZXIiLCJ1cGRhdGVGaWx0ZXIiLCJfaGlkZSIsInRoZW4iLCJ0eXBlIiwibW91c2VlbnRlciIsImhvdmVyaW5nIiwibW91c2VsZWF2ZSIsInN0YXJ0IiwiZG9tT2JzZXJ2ZSIsImNoaWxkcmVuIiwiYW5pbWF0ZSIsImZvcmNlIiwidmlzaWJsZSIsImdldFZpc2libGVPbkN1cnJlbkJyZWFrcG9pbnQiLCJpdGVtcyIsImdldEl0ZW1zIiwiaW5wdXQiLCJzaXplIiwieCIsImMiLCJsIiwibiIsImpRdWVyeSIsImFycmF5X2NodW5rIiwiZW1wdHkiLCJhcHBlbmQiLCJjdXJyZW50ZmlsdGVyIiwiYnJlYWtwb2ludCIsInRtcCIsImFwcGVuZFRvIiwidGVzdGRpdiIsImJyZWFrcG9pbnRzIiwid2lkdGgiLCJyZW1vdmUiLCJzcGxpdCIsIm1hcCIsIml0ZW0iLCJ0cmltIiwiZiIsImluZmlsdGVyIiwiaW5kZXhPZiIsInB1c2giLCJzZXRJbmRleCIsIm5vYW5pbWF0ZSIsIl9nZXRBbmltYXRpb24iLCJub25lIiwiYXBwbHkiLCJjaGVja0Rpc3BsYXkiLCJ0cmlnZ2VyIiwicHJldmlvdXMiLCJzdG9wIiwiaW50ZXJ2YWwiLCJzZXRJbnRlcnZhbCIsImNsZWFySW50ZXJ2YWwiLCJmYWRlIiwic2xpZGUtYm90dG9tIiwic2xpZGUtdG9wIiwic2xpZGUtdmVydGljYWwiLCJhbmltIiwicmV2ZXJzZSIsInNsaWRlLWhvcml6b250YWwiLCJzY2FsZSIsImFuaW1hdGlvbnMiXSwibWFwcGluZ3MiOiJDQUNBLFNBQVVBLEdBRU4sSUFBSUMsRUFFQUMsT0FBT0MsU0FDUEYsRUFBWUQsRUFBTUcsU0FHRCxtQkFBVkMsUUFBd0JBLE9BQU9DLEtBQ3RDRCxPQUFPLGlCQUFrQixDQUFDLFNBQVUsV0FDaEMsT0FBT0gsR0FBYUQsRUFBTUcsVUFWdEMsQ0FjRyxTQUFTRyxHQUVSLGFBRUEsSUFBSUMsRUErWEosU0FBU0MsRUFBY0MsRUFBS0MsRUFBU0MsRUFBTUMsR0FFdkMsSUFFa0JDLEVBQU9DLEVBQVFDLEVBQVNDLEVBRnRDQyxFQUFRWCxFQUFHWSxFQUFFQyxXQUNiQyxHQUFnQyxJQUF2QkMsS0FBS0MsUUFBUUYsTUFBbUJHLEtBQUtDLE1BQU1I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dCAyLjI3LjIgfCBodHRwOi8vd3d3LmdldHVpa2l0LmNvbSB8IChjKSAyMDE0IFlPT3RoZW1lIHwgTUlUIExpY2Vuc2UgKi9cclxuKGZ1bmN0aW9uKGFkZG9uKSB7XHJcblxyXG4gICAgdmFyIGNvbXBvbmVudDtcclxuXHJcbiAgICBpZiAod2luZG93LlVJa2l0Mikge1xyXG4gICAgICAgIGNvbXBvbmVudCA9IGFkZG9uKFVJa2l0Mik7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHR5cGVvZiBkZWZpbmUgPT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7XHJcbiAgICAgICAgZGVmaW5lKCd1aWtpdC1zbGlkZXNldCcsIFsndWlraXQnXSwgZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgcmV0dXJuIGNvbXBvbmVudCB8fCBhZGRvbihVSWtpdDIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxufSkoZnVuY3Rpb24oVUkpe1xyXG5cclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG5cclxuICAgIHZhciBBbmltYXRpb25zO1xyXG5cclxuICAgIFVJLmNvbXBvbmVudCgnc2xpZGVzZXQnLCB7XHJcblxyXG4gICAgICAgIGRlZmF1bHRzOiB7XHJcbiAgICAgICAgICAgIGRlZmF1bHQgICAgICAgICAgOiAxLFxyXG4gICAgICAgICAgICBhbmltYXRpb24gICAgICAgIDogJ2ZhZGUnLFxyXG4gICAgICAgICAgICBkdXJhdGlvbiAgICAgICAgIDogMjAwLFxyXG4gICAgICAgICAgICBmaWx0ZXIgICAgICAgICAgIDogJycsXHJcbiAgICAgICAgICAgIGRlbGF5ICAgICAgICAgICAgOiBmYWxzZSxcclxuICAgICAgICAgICAgY29udHJvbHMgICAgICAgICA6IGZhbHNlLFxyXG4gICAgICAgICAgICBhdXRvcGxheSAgICAgICAgIDogZmFsc2UsXHJcbiAgICAgICAgICAgIGF1dG9wbGF5SW50ZXJ2YWwgOiA3MDAwLFxyXG4gICAgICAgICAgICBwYXVzZU9uSG92ZXIgICAgIDogdHJ1ZVxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIHNldHM6IFtdLFxyXG5cclxuICAgICAgICBib290OiBmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgICAgIC8vIGF1dG8gaW5pdFxyXG4gICAgICAgICAgICBVSS5yZWFkeShmdW5jdGlvbihjb250ZXh0KSB7XHJcblxyXG4gICAgICAgICAgICAgICAgVUkuJCgnW2RhdGEtdWstc2xpZGVzZXRdJywgY29udGV4dCkuZWFjaChmdW5jdGlvbigpe1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgZWxlID0gVUkuJCh0aGlzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYoIWVsZS5kYXRhKCdzbGlkZXNldCcpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFVJLnNsaWRlc2V0KGVsZSwgVUkuVXRpbHMub3B0aW9ucyhlbGUuYXR0cignZGF0YS11ay1zbGlkZXNldCcpKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICAgICAgdmFyICR0aGlzID0gdGhpcztcclxuXHJcbiAgICAgICAgICAgIHRoaXMuYWN0aXZlU2V0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMubGlzdCAgICAgID0gdGhpcy5lbGVtZW50LmZpbmQoJy51ay1zbGlkZXNldCcpO1xyXG4gICAgICAgICAgICB0aGlzLm5hdiAgICAgICA9IHRoaXMuZWxlbWVudC5maW5kKCcudWstc2xpZGVzZXQtbmF2Jyk7XHJcbiAgICAgICAgICAgIHRoaXMuY29udHJvbHMgID0gdGhpcy5vcHRpb25zLmNvbnRyb2xzID8gVUkuJCh0aGlzLm9wdGlvbnMuY29udHJvbHMpIDogdGhpcy5lbGVtZW50O1xyXG5cclxuICAgICAgICAgICAgVUkuJHdpbi5vbigncmVzaXplIGxvYWQnLCBVSS5VdGlscy5kZWJvdW5jZShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICR0aGlzLnVwZGF0ZSgpO1xyXG4gICAgICAgICAgICB9LCAxMDApKTtcclxuXHJcbiAgICAgICAgICAgICR0aGlzLmxpc3QuYWRkQ2xhc3MoJ3VrLWdyaWQtd2lkdGgtMS0nKyR0aGlzLm9wdGlvbnMuZGVmYXVsdCk7XHJcblxyXG4gICAgICAgICAgICBbJ3hsYXJnZScsICdsYXJnZScsICdtZWRpdW0nLCAnc21hbGwnXS5mb3JFYWNoKGZ1bmN0aW9uKGJwKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCEkdGhpcy5vcHRpb25zW2JwXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAkdGhpcy5saXN0LmFkZENsYXNzKCd1ay1ncmlkLXdpZHRoLScrYnArJy0xLScrJHRoaXMub3B0aW9uc1ticF0pO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMub24oJ2NsaWNrLnVrLnNsaWRlc2V0JywgJ1tkYXRhLXVrLXNsaWRlc2V0LWl0ZW1dJywgZnVuY3Rpb24oZSkge1xyXG5cclxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoJHRoaXMuYW5pbWF0aW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHZhciBzZXQgPSBVSS4kKHRoaXMpLmF0dHIoJ2RhdGEtdWstc2xpZGVzZXQtaXRlbScpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICgkdGhpcy5hY3RpdmVTZXQgPT09IHNldCkgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgICAgIHN3aXRjaChzZXQpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICduZXh0JzpcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdwcmV2aW91cyc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzW3NldD09J25leHQnID8gJ25leHQnOidwcmV2aW91cyddKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLnNob3cocGFyc2VJbnQoc2V0LCAxMCkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmNvbnRyb2xzLm9uKCdjbGljay51ay5zbGlkZXNldCcsICdbZGF0YS11ay1maWx0ZXJdJywgZnVuY3Rpb24oZSkge1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBlbGUgPSBVSS4kKHRoaXMpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChlbGUucGFyZW50KCkuaGFzQ2xhc3MoJ3VrLXNsaWRlc2V0JykpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICgkdGhpcy5hbmltYXRpbmcgfHwgJHRoaXMuY3VycmVudEZpbHRlciA9PSBlbGUuYXR0cignZGF0YS11ay1maWx0ZXInKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAkdGhpcy51cGRhdGVGaWx0ZXIoZWxlLmF0dHIoJ2RhdGEtdWstZmlsdGVyJykpO1xyXG5cclxuICAgICAgICAgICAgICAgICR0aGlzLl9oaWRlKCkudGhlbihmdW5jdGlvbigpe1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkdGhpcy51cGRhdGUodHJ1ZSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLm9uKCdzd2lwZVJpZ2h0IHN3aXBlTGVmdCcsIGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICR0aGlzW2UudHlwZT09J3N3aXBlTGVmdCcgPyAnbmV4dCcgOiAncHJldmlvdXMnXSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlRmlsdGVyKHRoaXMub3B0aW9ucy5maWx0ZXIpO1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZSgpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5lbGVtZW50Lm9uKHtcclxuICAgICAgICAgICAgICAgIG1vdXNlZW50ZXI6IGZ1bmN0aW9uKCkgeyBpZiAoJHRoaXMub3B0aW9ucy5wYXVzZU9uSG92ZXIpICR0aGlzLmhvdmVyaW5nID0gdHJ1ZTsgIH0sXHJcbiAgICAgICAgICAgICAgICBtb3VzZWxlYXZlOiBmdW5jdGlvbigpIHsgJHRoaXMuaG92ZXJpbmcgPSBmYWxzZTsgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIC8vIFNldCBhdXRvcGxheVxyXG4gICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmF1dG9wbGF5KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0KCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIFVJLmRvbU9ic2VydmUodGhpcy5saXN0LCBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoJHRoaXMubGlzdC5jaGlsZHJlbignOnZpc2libGU6bm90KC51ay1hY3RpdmUpJykubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHRoaXMudXBkYXRlKGZhbHNlLHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uKGFuaW1hdGUsIGZvcmNlKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgdmlzaWJsZSA9IHRoaXMudmlzaWJsZSwgaTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMudmlzaWJsZSAgPSB0aGlzLmdldFZpc2libGVPbkN1cnJlbkJyZWFrcG9pbnQoKTtcclxuXHJcbiAgICAgICAgICAgIGlmICh2aXNpYmxlID09IHRoaXMudmlzaWJsZSAmJiAhZm9yY2UpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5jaGlsZHJlbiA9IHRoaXMubGlzdC5jaGlsZHJlbigpLmhpZGUoKTtcclxuICAgICAgICAgICAgdGhpcy5pdGVtcyAgICA9IHRoaXMuZ2V0SXRlbXMoKTtcclxuICAgICAgICAgICAgdGhpcy5zZXRzICAgICA9IGFycmF5X2NodW5rKHRoaXMuaXRlbXMsIHRoaXMudmlzaWJsZSk7XHJcblxyXG4gICAgICAgICAgICBmb3IgKGk9MDtpPHRoaXMuc2V0cy5sZW5ndGg7aSsrKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldHNbaV0uY3NzKHsnZGlzcGxheSc6ICdub25lJ30pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyB1cGRhdGUgbmF2XHJcbiAgICAgICAgICAgIGlmICh0aGlzLm5hdi5sZW5ndGggJiYgdGhpcy5uYXYuZW1wdHkoKSkge1xyXG5cclxuICAgICAgICAgICAgICAgIGZvciAoaT0wO2k8dGhpcy5zZXRzLmxlbmd0aDtpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm5hdi5hcHBlbmQoJzxsaSBkYXRhLXVrLXNsaWRlc2V0LWl0ZW09XCInK2krJ1wiPjxhPjwvYT48L2xpPicpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMubmF2W3RoaXMubmF2LmNoaWxkcmVuKCkubGVuZ3RoPT0xID8gJ2FkZENsYXNzJzoncmVtb3ZlQ2xhc3MnXSgndWstaW52aXNpYmxlJyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuYWN0aXZlU2V0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMuc2hvdygwLCAhYW5pbWF0ZSk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgdXBkYXRlRmlsdGVyOiBmdW5jdGlvbihjdXJyZW50ZmlsdGVyKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgJHRoaXMgPSB0aGlzLCBmaWx0ZXI7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRGaWx0ZXIgPSBjdXJyZW50ZmlsdGVyO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5jb250cm9scy5maW5kKCdbZGF0YS11ay1maWx0ZXJdJykuZWFjaChmdW5jdGlvbigpe1xyXG5cclxuICAgICAgICAgICAgICAgIGZpbHRlciA9IFVJLiQodGhpcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCFmaWx0ZXIucGFyZW50KCkuaGFzQ2xhc3MoJ3VrLXNsaWRlc2V0JykpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbHRlci5hdHRyKCdkYXRhLXVrLWZpbHRlcicpID09ICR0aGlzLmN1cnJlbnRGaWx0ZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyLmFkZENsYXNzKCd1ay1hY3RpdmUnKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXIucmVtb3ZlQ2xhc3MoJ3VrLWFjdGl2ZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgZ2V0VmlzaWJsZU9uQ3VycmVuQnJlYWtwb2ludDogZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgYnJlYWtwb2ludCAgPSBudWxsLFxyXG4gICAgICAgICAgICAgICAgdG1wICAgICAgICAgPSBVSS4kKCc8ZGl2IHN0eWxlPVwicG9zaXRpb246YWJzb2x1dGU7aGVpZ2h0OjFweDt0b3A6LTEwMDBweDt3aWR0aDoxMDBweFwiPjxkaXY+PC9kaXY+PC9kaXY+JykuYXBwZW5kVG8oJ2JvZHknKSxcclxuICAgICAgICAgICAgICAgIHRlc3RkaXYgICAgID0gdG1wLmNoaWxkcmVuKCkuZXEoMCksXHJcbiAgICAgICAgICAgICAgICBicmVha3BvaW50cyA9IHRoaXMub3B0aW9ucztcclxuXHJcbiAgICAgICAgICAgICAgICBbJ3hsYXJnZScsICdsYXJnZScsICdtZWRpdW0nLCAnc21hbGwnXS5mb3JFYWNoKGZ1bmN0aW9uKGJwKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghYnJlYWtwb2ludHNbYnBdIHx8IGJyZWFrcG9pbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdG1wLmF0dHIoJ2NsYXNzJywgJ3VrLWdyaWQtd2lkdGgtJyticCsnLTEtMicpLndpZHRoKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0ZXN0ZGl2LndpZHRoKCkgPT0gNTApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWtwb2ludCA9IGJwO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHRtcC5yZW1vdmUoKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zW2JyZWFrcG9pbnRdIHx8IHRoaXMub3B0aW9uc1snZGVmYXVsdCddO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIGdldEl0ZW1zOiBmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciBpdGVtcyA9IFtdLCBmaWx0ZXI7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50RmlsdGVyKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgZmlsdGVyID0gdGhpcy5jdXJyZW50RmlsdGVyIHx8IFtdO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YoZmlsdGVyKSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgICAgICBmaWx0ZXIgPSBmaWx0ZXIuc3BsaXQoLywvKS5tYXAoZnVuY3Rpb24oaXRlbSl7IHJldHVybiBpdGVtLnRyaW0oKTsgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5jaGlsZHJlbi5lYWNoKGZ1bmN0aW9uKGluZGV4KXtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVsZSA9IFVJLiQodGhpcyksIGYgPSBlbGUuYXR0cignZGF0YS11ay1maWx0ZXInKSwgaW5maWx0ZXIgPSBmaWx0ZXIubGVuZ3RoID8gZmFsc2UgOiB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoZikge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgZiA9IGYuc3BsaXQoLywvKS5tYXAoZnVuY3Rpb24oaXRlbSl7IHJldHVybiBpdGVtLnRyaW0oKTsgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXIuZm9yRWFjaChmdW5jdGlvbihpdGVtKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmLmluZGV4T2YoaXRlbSkgPiAtMSkgaW5maWx0ZXIgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmKGluZmlsdGVyKSBpdGVtcy5wdXNoKGVsZVswXSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBpdGVtcyA9IFVJLiQoaXRlbXMpO1xyXG5cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGl0ZW1zID0gdGhpcy5saXN0LmNoaWxkcmVuKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBpdGVtcztcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBzaG93OiBmdW5jdGlvbihzZXRJbmRleCwgbm9hbmltYXRlLCBkaXIpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciAkdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVTZXQgPT09IHNldEluZGV4IHx8IHRoaXMuYW5pbWF0aW5nKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGRpciA9IGRpciB8fCAoc2V0SW5kZXggPCB0aGlzLmFjdGl2ZVNldCA/IC0xOjEpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGN1cnJlbnQgICA9IHRoaXMuc2V0c1t0aGlzLmFjdGl2ZVNldF0gfHwgW10sXHJcbiAgICAgICAgICAgICAgICBuZXh0ICAgICAgPSB0aGlzLnNldHNbc2V0SW5kZXhdLFxyXG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uID0gdGhpcy5fZ2V0QW5pbWF0aW9uKCk7XHJcblxyXG4gICAgICAgICAgICBpZiAobm9hbmltYXRlIHx8ICFVSS5zdXBwb3J0LmFuaW1hdGlvbikge1xyXG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uID0gQW5pbWF0aW9ucy5ub25lO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmFuaW1hdGluZyA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5uYXYubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm5hdi5jaGlsZHJlbigpLnJlbW92ZUNsYXNzKCd1ay1hY3RpdmUnKS5lcShzZXRJbmRleCkuYWRkQ2xhc3MoJ3VrLWFjdGl2ZScpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBhbmltYXRpb24uYXBwbHkoJHRoaXMsIFtjdXJyZW50LCBuZXh0LCBkaXJdKS50aGVuKGZ1bmN0aW9uKCl7XHJcblxyXG4gICAgICAgICAgICAgICAgVUkuVXRpbHMuY2hlY2tEaXNwbGF5KG5leHQsIHRydWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICR0aGlzLmNoaWxkcmVuLmhpZGUoKS5yZW1vdmVDbGFzcygndWstYWN0aXZlJyk7XHJcbiAgICAgICAgICAgICAgICBuZXh0LmFkZENsYXNzKCd1ay1hY3RpdmUnKS5jc3MoeydkaXNwbGF5JzogJycsICdvcGFjaXR5JzonJ30pO1xyXG5cclxuICAgICAgICAgICAgICAgICR0aGlzLmFuaW1hdGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgJHRoaXMuYWN0aXZlU2V0ID0gc2V0SW5kZXg7XHJcblxyXG4gICAgICAgICAgICAgICAgVUkuVXRpbHMuY2hlY2tEaXNwbGF5KG5leHQsIHRydWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICR0aGlzLnRyaWdnZXIoJ3Nob3cudWsuc2xpZGVzZXQnLCBbbmV4dF0pO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgX2dldEFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgYW5pbWF0aW9uID0gQW5pbWF0aW9uc1t0aGlzLm9wdGlvbnMuYW5pbWF0aW9uXSB8fCBBbmltYXRpb25zLm5vbmU7XHJcblxyXG4gICAgICAgICAgICBpZiAoIVVJLnN1cHBvcnQuYW5pbWF0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBhbmltYXRpb24gPSBBbmltYXRpb25zLm5vbmU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBhbmltYXRpb247XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgX2hpZGU6IGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICAgICAgdmFyICR0aGlzICAgICA9IHRoaXMsXHJcbiAgICAgICAgICAgICAgICBjdXJyZW50ICAgPSB0aGlzLnNldHNbdGhpcy5hY3RpdmVTZXRdIHx8IFtdLFxyXG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uID0gdGhpcy5fZ2V0QW5pbWF0aW9uKCk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmFuaW1hdGluZyA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gYW5pbWF0aW9uLmFwcGx5KCR0aGlzLCBbY3VycmVudCwgW10sIDFdKS50aGVuKGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAkdGhpcy5hbmltYXRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgbmV4dDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2hvdyh0aGlzLnNldHNbdGhpcy5hY3RpdmVTZXQgKyAxXSA/ICh0aGlzLmFjdGl2ZVNldCArIDEpIDogMCwgZmFsc2UsIDEpO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIHByZXZpb3VzOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdGhpcy5zaG93KHRoaXMuc2V0c1t0aGlzLmFjdGl2ZVNldCAtIDFdID8gKHRoaXMuYWN0aXZlU2V0IC0gMSkgOiAodGhpcy5zZXRzLmxlbmd0aCAtIDEpLCBmYWxzZSwgLTEpO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIHN0YXJ0OiBmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuc3RvcCgpO1xyXG5cclxuICAgICAgICAgICAgdmFyICR0aGlzID0gdGhpcztcclxuXHJcbiAgICAgICAgICAgIHRoaXMuaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIGlmICghJHRoaXMuaG92ZXJpbmcgJiYgISR0aGlzLmFuaW1hdGluZykgJHRoaXMubmV4dCgpO1xyXG4gICAgICAgICAgICB9LCB0aGlzLm9wdGlvbnMuYXV0b3BsYXlJbnRlcnZhbCk7XHJcblxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIHN0b3A6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5pbnRlcnZhbCkgY2xlYXJJbnRlcnZhbCh0aGlzLmludGVydmFsKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBBbmltYXRpb25zID0ge1xyXG5cclxuICAgICAgICAnbm9uZSc6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2YXIgZCA9IFVJLiQuRGVmZXJyZWQoKTtcclxuICAgICAgICAgICAgZC5yZXNvbHZlKCk7XHJcbiAgICAgICAgICAgIHJldHVybiBkLnByb21pc2UoKTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICAnZmFkZSc6IGZ1bmN0aW9uKGN1cnJlbnQsIG5leHQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGNvcmVBbmltYXRpb24uYXBwbHkodGhpcywgWyd1ay1hbmltYXRpb24tZmFkZScsIGN1cnJlbnQsIG5leHRdKTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICAnc2xpZGUtYm90dG9tJzogZnVuY3Rpb24oY3VycmVudCwgbmV4dCkge1xyXG4gICAgICAgICAgICByZXR1cm4gY29yZUFuaW1hdGlvbi5hcHBseSh0aGlzLCBbJ3VrLWFuaW1hdGlvbi1zbGlkZS1ib3R0b20nLCBjdXJyZW50LCBuZXh0XSk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgJ3NsaWRlLXRvcCc6IGZ1bmN0aW9uKGN1cnJlbnQsIG5leHQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGNvcmVBbmltYXRpb24uYXBwbHkodGhpcywgWyd1ay1hbmltYXRpb24tc2xpZGUtdG9wJywgY3VycmVudCwgbmV4dF0pO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgICdzbGlkZS12ZXJ0aWNhbCc6IGZ1bmN0aW9uKGN1cnJlbnQsIG5leHQsIGRpcikge1xyXG5cclxuICAgICAgICAgICAgdmFyIGFuaW0gPSBbJ3VrLWFuaW1hdGlvbi1zbGlkZS10b3AnLCAndWstYW5pbWF0aW9uLXNsaWRlLWJvdHRvbSddO1xyXG5cclxuICAgICAgICAgICAgaWYgKGRpciA9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgYW5pbS5yZXZlcnNlKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBjb3JlQW5pbWF0aW9uLmFwcGx5KHRoaXMsIFthbmltLCBjdXJyZW50LCBuZXh0XSk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgJ3NsaWRlLWhvcml6b250YWwnOiBmdW5jdGlvbihjdXJyZW50LCBuZXh0LCBkaXIpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciBhbmltID0gWyd1ay1hbmltYXRpb24tc2xpZGUtcmlnaHQnLCAndWstYW5pbWF0aW9uLXNsaWRlLWxlZnQnXTtcclxuXHJcbiAgICAgICAgICAgIGlmIChkaXIgPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgIGFuaW0ucmV2ZXJzZSgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gY29yZUFuaW1hdGlvbi5hcHBseSh0aGlzLCBbYW5pbSwgY3VycmVudCwgbmV4dCwgZGlyXSk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgJ3NjYWxlJzogZnVuY3Rpb24oY3VycmVudCwgbmV4dCkge1xyXG4gICAgICAgICAgICByZXR1cm4gY29yZUFuaW1hdGlvbi5hcHBseSh0aGlzLCBbJ3VrLWFuaW1hdGlvbi1zY2FsZS11cCcsIGN1cnJlbnQsIG5leHRdKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIFVJLnNsaWRlc2V0LmFuaW1hdGlvbnMgPSBBbmltYXRpb25zO1xyXG5cclxuICAgIC8vIGhlbHBlcnNcclxuXHJcbiAgICBmdW5jdGlvbiBjb3JlQW5pbWF0aW9uKGNscywgY3VycmVudCwgbmV4dCwgZGlyKSB7XHJcblxyXG4gICAgICAgIHZhciBkICAgICA9IFVJLiQuRGVmZXJyZWQoKSxcclxuICAgICAgICAgICAgZGVsYXkgPSAodGhpcy5vcHRpb25zLmRlbGF5ID09PSBmYWxzZSkgPyBNYXRoLmZsb29yKHRoaXMub3B0aW9ucy5kdXJhdGlvbi8yKSA6IHRoaXMub3B0aW9ucy5kZWxheSxcclxuICAgICAgICAgICAgJHRoaXMgPSB0aGlzLCBjbHNJbiwgY2xzT3V0LCByZWxlYXNlLCBpO1xyXG5cclxuICAgICAgICBkaXIgPSBkaXIgfHwgMTtcclxuXHJcbiAgICAgICAgdGhpcy5lbGVtZW50LmNzcygnbWluLWhlaWdodCcsIHRoaXMuZWxlbWVudC5oZWlnaHQoKSk7XHJcblxyXG4gICAgICAgIGlmIChuZXh0WzBdPT09Y3VycmVudFswXSkge1xyXG4gICAgICAgICAgICBkLnJlc29sdmUoKTtcclxuICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHR5cGVvZihjbHMpID09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgICAgIGNsc0luICA9IGNsc1swXTtcclxuICAgICAgICAgICAgY2xzT3V0ID0gY2xzWzFdIHx8IGNsc1swXTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjbHNJbiAgPSBjbHM7XHJcbiAgICAgICAgICAgIGNsc091dCA9IGNsc0luO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgVUkuJGJvZHkuY3NzKCdvdmVyZmxvdy14JywgJ2hpZGRlbicpOyAvLyBwcmV2ZW50IGhvcml6b250YWwgc2Nyb2xsYmFyIG9uIGFuaW1hdGlvblxyXG5cclxuICAgICAgICByZWxlYXNlID0gZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgICAgICBpZiAoY3VycmVudCAmJiBjdXJyZW50Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgY3VycmVudC5oaWRlKCkucmVtb3ZlQ2xhc3MoY2xzT3V0KycgdWstYW5pbWF0aW9uLXJldmVyc2UnKS5jc3MoeydvcGFjaXR5JzonJywgJ2FuaW1hdGlvbi1kZWxheSc6ICcnLCAnYW5pbWF0aW9uJzonJ30pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoIW5leHQubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBkLnJlc29sdmUoKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZm9yIChpPTA7aTxuZXh0Lmxlbmd0aDtpKyspIHtcclxuICAgICAgICAgICAgICAgIG5leHQuZXEoZGlyID09IDEgPyBpOihuZXh0Lmxlbmd0aCAtIGkpLTEpLmNzcygnYW5pbWF0aW9uLWRlbGF5JywgKGkqZGVsYXkpKydtcycpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB2YXIgZmluaXNoID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICBuZXh0LnJlbW92ZUNsYXNzKCcnK2Nsc0luKycnKS5jc3Moe29wYWNpdHk6JycsIGRpc3BsYXk6JycsICdhbmltYXRpb24tZGVsYXknOicnLCAnYW5pbWF0aW9uJzonJ30pO1xyXG4gICAgICAgICAgICAgICAgZC5yZXNvbHZlKCk7XHJcbiAgICAgICAgICAgICAgICBVSS4kYm9keS5jc3MoJ292ZXJmbG93LXgnLCAnJyk7XHJcbiAgICAgICAgICAgICAgICAkdGhpcy5lbGVtZW50LmNzcygnbWluLWhlaWdodCcsICcnKTtcclxuICAgICAgICAgICAgICAgIGZpbmlzaCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgbmV4dC5hZGRDbGFzcyhjbHNJbilbZGlyPT0xID8gJ2xhc3QnOidmaXJzdCddKCkub25lKFVJLnN1cHBvcnQuYW5pbWF0aW9uLmVuZCwgZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgIGlmKGZpbmlzaCkgZmluaXNoKCk7XHJcbiAgICAgICAgICAgIH0pLmVuZCgpLmNzcygnZGlzcGxheScsICcnKTtcclxuXHJcbiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSBldmVyeXRoaW5nIHJlc29sdmVzIHJlYWxseVxyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgaWYoZmluaXNoKSBmaW5pc2goKTtcclxuICAgICAgICAgICAgfSwgIG5leHQubGVuZ3RoICogZGVsYXkgKiAyKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBpZiAobmV4dC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgbmV4dC5jc3MoJ2FuaW1hdGlvbi1kdXJhdGlvbicsIHRoaXMub3B0aW9ucy5kdXJhdGlvbisnbXMnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChjdXJyZW50ICYmIGN1cnJlbnQubGVuZ3RoKSB7XHJcblxyXG4gICAgICAgICAgICBjdXJyZW50LmNzcygnYW5pbWF0aW9uLWR1cmF0aW9uJywgdGhpcy5vcHRpb25zLmR1cmF0aW9uKydtcycpW2Rpcj09MSA/ICdsYXN0JzonZmlyc3QnXSgpLm9uZShVSS5zdXBwb3J0LmFuaW1hdGlvbi5lbmQsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgcmVsZWFzZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGZvciAoaT0wO2k8Y3VycmVudC5sZW5ndGg7aSsrKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgKGZ1bmN0aW9uIChpbmRleCwgZWxlKXtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxlLmNzcygnZGlzcGxheScsICdub25lJykuY3NzKCdkaXNwbGF5JywgJycpLmNzcygnb3BhY2l0eScsIDApLm9uKFVJLnN1cHBvcnQuYW5pbWF0aW9uLmVuZCwgZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZS5yZW1vdmVDbGFzcyhjbHNPdXQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KS5hZGRDbGFzcyhjbHNPdXQrJyB1ay1hbmltYXRpb24tcmV2ZXJzZScpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcyksIGkgKiBkZWxheSk7XHJcblxyXG4gICAgICAgICAgICAgICAgfSkoaSwgY3VycmVudC5lcShkaXIgPT0gMSA/IGk6KGN1cnJlbnQubGVuZ3RoIC0gaSktMSkpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJlbGVhc2UoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBkLnByb21pc2UoKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBhcnJheV9jaHVuayhpbnB1dCwgc2l6ZSkge1xyXG5cclxuICAgICAgICB2YXIgeCwgaSA9IDAsIGMgPSAtMSwgbCA9IGlucHV0Lmxlbmd0aCB8fCAwLCBuID0gW107XHJcblxyXG4gICAgICAgIGlmIChzaXplIDwgMSkgcmV0dXJuIG51bGw7XHJcblxyXG4gICAgICAgIHdoaWxlIChpIDwgbCkge1xyXG5cclxuICAgICAgICAgICAgeCA9IGkgJSBzaXplO1xyXG5cclxuICAgICAgICAgICAgaWYoeCkge1xyXG4gICAgICAgICAgICAgICAgbltjXVt4XSA9IGlucHV0W2ldO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgblsrK2NdID0gW2lucHV0W2ldXTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaSA9IDA7XHJcbiAgICAgICAgbCA9IG4ubGVuZ3RoO1xyXG5cclxuICAgICAgICB3aGlsZSAoaSA8IGwpIHtcclxuICAgICAgICAgICAgbltpXSA9IGpRdWVyeShuW2ldKTtcclxuICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG47XHJcbiAgICB9XHJcblxyXG59KTsiXX0=
