!function(e){var t;window.UIkit2&&(t=e(UIkit2)),"function"==typeof define&&define.amd&&define("uikit-upload",["uikit"],function(){return t||e(UIkit2)})}(function(d){"use strict";var e,t;function f(n,o){if(!d.support.ajaxupload)return this;if(o=d.$.extend({},f.defaults,o),n.length){if("*.*"!==o.allow)for(var e,t=0;e=n[t];t++)if(!p(o.allow,e.name))return void("string"==typeof o.notallowed?alert(o.notallowed):o.notallowed(e,o));var a=o.complete;if(o.single){var r=n.length,i=0,l=!0;o.beforeAll(n),o.complete=function(e,t){i+=1,a(e,t),o.filelimit&&i>=o.filelimit&&(l=!1),l&&i<r?s([n[i]],o):o.allcomplete(e,t)},s([n[0]],o)}else o.complete=function(e,t){a(e,t),o.allcomplete(e,t)},s(n,o)}function s(e,n){var t=new FormData,o=new XMLHttpRequest;if(!1!==n.before(n,e)){for(var a,r=0;a=e[r];r++)t.append(n.param,a);for(var i in n.params)t.append(i,n.params[i]);for(var l in o.upload.addEventListener("progress",function(e){var t=e.loaded/e.total*100;n.progress(t,e)},!1),o.addEventListener("loadstart",function(e){n.loadstart(e)},!1),o.addEventListener("load",function(e){n.load(e)},!1),o.addEventListener("loadend",function(e){n.loadend(e)},!1),o.addEventListener("error",function(e){n.error(e)},!1),o.addEventListener("abort",function(e){n.abort(e)},!1),o.open(n.method,n.action,!0),"json"==n.type&&o.setRequestHeader("Accept","application/json"),n.headers)o.setRequestHeader(l,n.headers[l]);o.onreadystatechange=function(){if(n.readystatechange(o),4==o.readyState){var t=o.responseText;if("json"==n.type)try{t=d.$.parseJSON(t)}catch(e){t=!1}n.complete(t,o)}},n.beforeSend(o),o.send(t)}}}function p(e,t){var n="^"+e.replace(/\//g,"\\/").replace(/\*\*/g,"(\\/[^\\/]+)*").replace(/\*/g,"[^\\/]+").replace(/((?!\\))\?/g,"$1.")+"$";return n="^"+n+"$",null!==t.match(new RegExp(n,"i"))}return d.component("uploadSelect",{init:function(){var t=this;this.on("change",function(){f(t.element[0].files,t.options);var e=t.element.clone(!0).data("uploadSelect",t);t.element.replaceWith(e),t.element=e})}}),d.component("uploadDrop",{defaults:{dragoverClass:"uk-dragover"},init:function(){var t=this,n=!1;this.on("drop",function(e){e.originalEvent.dataTransfer&&e.originalEvent.dataTransfer.files&&(e.stopPropagation(),e.preventDefault(),t.element.removeClass(t.options.dragoverClass),t.element.trigger("dropped.uk.upload",[e.originalEvent.dataTransfer.files]),f(e.originalEvent.dataTransfer.files,t.options))}).on("dragenter",function(e){e.stopPropagation(),e.preventDefault()}).on("dragover",function(e){e.stopPropagation(),e.preventDefault(),n||(t.element.addClass(t.options.dragoverClass),n=!0)}).on("dragleave",function(e){e.stopPropagation(),e.preventDefault(),t.element.removeClass(t.options.dragoverClass),n=!1})}}),d.support.ajaxupload=((t=document.createElement("INPUT")).type="file","files"in t&&!!((e=new XMLHttpRequest)&&"upload"in e&&"onprogress"in e.upload)&&!!window.FormData),f.defaults={action:"",single:!0,method:"POST",param:"files[]",params:{},allow:"*.*",type:"text",filelimit:!1,headers:{},before:function(e){},beforeSend:function(e){},beforeAll:function(){},loadstart:function(){},load:function(){},loadend:function(){},error:function(){},abort:function(){},progress:function(){},complete:function(){},allcomplete:function(){},readystatechange:function(){},notallowed:function(e,t){alert("Only the following file types are allowed: "+t.allow)}},d.Utils.xhrupload=f});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvdXBsb2FkLmpzIl0sIm5hbWVzIjpbImFkZG9uIiwiY29tcG9uZW50Iiwid2luZG93IiwiVUlraXQyIiwiZGVmaW5lIiwiYW1kIiwiVUkiLCJ4aHIiLCJmaSIsInhocnVwbG9hZCIsImZpbGVzIiwic2V0dGluZ3MiLCJzdXBwb3J0IiwiYWpheHVwbG9hZCIsInRoaXMiLCIkIiwiZXh0ZW5kIiwiZGVmYXVsdHMiLCJsZW5ndGgiLCJhbGxvdyIsImZpbGUiLCJpIiwibWF0Y2hOYW1lIiwibmFtZSIsImFsZXJ0Iiwibm90YWxsb3dlZCIsImNvbXBsZXRlIiwic2luZ2xlIiwiY291bnQiLCJ1cGxvYWRlZCIsImJlZm9yZUFsbCIsInJlc3BvbnNlIiwiZmlsZWxpbWl0IiwidXBsb2FkIiwiYWxsY29tcGxldGUiLCJmb3JtRGF0YSIsIkZvcm1EYXRhIiwiWE1MSHR0cFJlcXVlc3QiLCJiZWZvcmUiLCJmIiwiYXBwZW5kIiwicGFyYW0iLCJwIiwicGFyYW1zIiwiaCIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwicGVyY2VudCIsImxvYWRlZCIsInRvdGFsIiwicHJvZ3Jlc3MiLCJsb2Fkc3RhcnQiLCJsb2FkIiwibG9hZGVuZCIsImVycm9yIiwiYWJvcnQiLCJvcGVuIiwibWV0aG9kIiwiYWN0aW9uIiwidHlwZSIsInNldFJlcXVlc3RIZWFkZXIiLCJoZWFkZXJzIiwib25yZWFkeXN0YXRlY2hhbmdlIiwicmVhZHlzdGF0ZWNoYW5nZSIsInJlYWR5U3RhdGUiLCJyZXNwb25zZVRleHQiLCJwYXJzZUpTT04iLCJiZWZvcmVTZW5kIiwic2VuZCIsInBhdHRlcm4iLCJwYXRoIiwicGFyc2VkUGF0dGVybiIsInJlcGxhY2UiLCJtYXRjaCIsIlJlZ0V4cCIsImluaXQiLCIkdGhpcyIsIm9uIiwiZWxlbWVudCIsIm9wdGlvbnMiLCJ0d2luIiwiY2xvbmUiLCJkYXRhIiwicmVwbGFjZVdpdGgiLCJkcmFnb3ZlckNsYXNzIiwiaGFzZHJhZ0NscyIsIm9yaWdpbmFsRXZlbnQiLCJkYXRhVHJhbnNmZXIiLCJzdG9wUHJvcGFnYXRpb24iLCJwcmV2ZW50RGVmYXVsdCIsInJlbW92ZUNsYXNzIiwidHJpZ2dlciIsImFkZENsYXNzIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwibyIsIlV0aWxzIl0sIm1hcHBpbmdzIjoiQ0FDQSxTQUFVQSxHQUVOLElBQUlDLEVBRUFDLE9BQU9DLFNBQ1BGLEVBQVlELEVBQU1HLFNBR0QsbUJBQVZDLFFBQXdCQSxPQUFPQyxLQUN0Q0QsT0FBTyxlQUFnQixDQUFDLFNBQVUsV0FDOUIsT0FBT0gsR0FBYUQsRUFBTUcsVUFWdEMsQ0FjRyxTQUFTRyxHQUVSLGFBNkR3QixJQU9aQyxFQUpBQyxFQWVaLFNBQVNDLEVBQVVDLEVBQU9DLEdBRXRCLElBQUtMLEVBQUdNLFFBQVFDLFdBQ1osT0FBT0MsS0FLWCxHQUZBSCxFQUFXTCxFQUFHUyxFQUFFQyxPQUFPLEdBQUlQLEVBQVVRLFNBQVVOLEdBRTFDRCxFQUFNUSxPQUFYLENBSUEsR0FBdUIsUUFBbkJQLEVBQVNRLE1BRVQsSUFBSSxJQUFRQyxFQUFKQyxFQUFFLEVBQU9ELEVBQUtWLEVBQU1XLEdBQUdBLElBRTNCLElBQUlDLEVBQVVYLEVBQVNRLE1BQU9DLEVBQUtHLE1BTy9CLFlBTGtDLGlCQUF4QlosRUFBbUIsV0FDMUJhLE1BQU1iLEVBQVNjLFlBRWZkLEVBQVNjLFdBQVdMLEVBQU1ULElBT3pDLElBQUllLEVBQVdmLEVBQVNlLFNBRXhCLEdBQUlmLEVBQVNnQixPQUFPLENBRWhCLElBQUlDLEVBQVdsQixFQUFNUSxPQUNqQlcsRUFBVyxFQUNYVixHQUFXLEVBRVhSLEVBQVNtQixVQUFVcEIsR0FFbkJDLEVBQVNlLFNBQVcsU0FBU0ssRUFBVXhCLEdBRW5Dc0IsR0FBc0IsRUFFdEJILEVBQVNLLEVBQVV4QixHQUVmSSxFQUFTcUIsV0FBYUgsR0FBWWxCLEVBQVNxQixZQUMzQ2IsR0FBUSxHQUdSQSxHQUFTVSxFQUFTRCxFQUNsQkssRUFBTyxDQUFDdkIsRUFBTW1CLElBQVls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QWtCLGFBQ2xCUSxZQUFrQixhQUNsQjZCLGlCQUFrQixhQUNsQnRDLFdBQWtCLFNBQVNMLEVBQU1ULEdBQVdhLE1BQU0sOENBQThDYixFQUFTUSxTQWU3R2IsRUFBRzBGLE1BQU12RixVQUFZQSIsImZpbGUiOiJjb21wb25lbnRzL3VwbG9hZC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qISBVSWtpdCAyLjI3LjIgfCBodHRwOi8vd3d3LmdldHVpa2l0LmNvbSB8IChjKSAyMDE0IFlPT3RoZW1lIHwgTUlUIExpY2Vuc2UgKi9cbihmdW5jdGlvbihhZGRvbikge1xuXG4gICAgdmFyIGNvbXBvbmVudDtcblxuICAgIGlmICh3aW5kb3cuVUlraXQyKSB7XG4gICAgICAgIGNvbXBvbmVudCA9IGFkZG9uKFVJa2l0Mik7XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiBkZWZpbmUgPT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7XG4gICAgICAgIGRlZmluZSgndWlraXQtdXBsb2FkJywgWyd1aWtpdCddLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIGNvbXBvbmVudCB8fCBhZGRvbihVSWtpdDIpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbn0pKGZ1bmN0aW9uKFVJKXtcblxuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgVUkuY29tcG9uZW50KCd1cGxvYWRTZWxlY3QnLCB7XG5cbiAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIHZhciAkdGhpcyA9IHRoaXM7XG5cbiAgICAgICAgICAgIHRoaXMub24oJ2NoYW5nZScsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHhocnVwbG9hZCgkdGhpcy5lbGVtZW50WzBdLmZpbGVzLCAkdGhpcy5vcHRpb25zKTtcbiAgICAgICAgICAgICAgICB2YXIgdHdpbiA9ICR0aGlzLmVsZW1lbnQuY2xvbmUodHJ1ZSkuZGF0YSgndXBsb2FkU2VsZWN0JywgJHRoaXMpO1xuICAgICAgICAgICAgICAgICR0aGlzLmVsZW1lbnQucmVwbGFjZVdpdGgodHdpbik7XG4gICAgICAgICAgICAgICAgJHRoaXMuZWxlbWVudCA9IHR3aW47XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgVUkuY29tcG9uZW50KCd1cGxvYWREcm9wJywge1xuXG4gICAgICAgIGRlZmF1bHRzOiB7XG4gICAgICAgICAgICAnZHJhZ292ZXJDbGFzcyc6ICd1ay1kcmFnb3ZlcidcbiAgICAgICAgfSxcblxuICAgICAgICBpbml0OiBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgdmFyICR0aGlzID0gdGhpcywgaGFzZHJhZ0NscyA9IGZhbHNlO1xuXG4gICAgICAgICAgICB0aGlzLm9uKCdkcm9wJywgZnVuY3Rpb24oZSl7XG5cbiAgICAgICAgICAgICAgICBpZiAoZS5vcmlnaW5hbEV2ZW50LmRhdGFUcmFuc2ZlciAmJiBlLm9yaWdpbmFsRXZlbnQuZGF0YVRyYW5zZmVyLmZpbGVzKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAgICAgICAgICR0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoJHRoaXMub3B0aW9ucy5kcmFnb3ZlckNsYXNzKTtcbiAgICAgICAgICAgICAgICAgICAgJHRoaXMuZWxlbWVudC50cmlnZ2VyKCdkcm9wcGVkLnVrLnVwbG9hZCcsIFtlLm9yaWdpbmFsRXZlbnQuZGF0YVRyYW5zZmVyLmZpbGVzXSk7XG5cbiAgICAgICAgICAgICAgICAgICAgeGhydXBsb2FkKGUub3JpZ2luYWxFdmVudC5kYXRhVHJhbnNmZXIuZmlsZXMsICR0aGlzLm9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSkub24oJ2RyYWdlbnRlcicsIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgfSkub24oJ2RyYWdvdmVyJywgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIWhhc2RyYWdDbHMpIHtcbiAgICAgICAgICAgICAgICAgICAgJHRoaXMuZWxlbWVudC5hZGRDbGFzcygkdGhpcy5vcHRpb25zLmRyYWdvdmVyQ2xhc3MpO1xuICAgICAgICAgICAgICAgICAgICBoYXNkcmFnQ2xzID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS5vbignZHJhZ2xlYXZlJywgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgJHRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcygkdGhpcy5vcHRpb25zLmRyYWdvdmVyQ2xhc3MpO1xuICAgICAgICAgICAgICAgIGhhc2RyYWdDbHMgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSk7XG5cblxuICAgIFVJLnN1cHBvcnQuYWpheHVwbG9hZCA9IChmdW5jdGlvbigpIHtcblxuICAgICAgICBmdW5jdGlvbiBzdXBwb3J0RmlsZUFQSSgpIHtcbiAgICAgICAgICAgIHZhciBmaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ0lOUFVUJyk7IGZpLnR5cGUgPSAnZmlsZSc7IHJldHVybiAnZmlsZXMnIGluIGZpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc3VwcG9ydEFqYXhVcGxvYWRQcm9ncmVzc0V2ZW50cygpIHtcbiAgICAgICAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsgcmV0dXJuICEhICh4aHIgJiYgKCd1cGxvYWQnIGluIHhocikgJiYgKCdvbnByb2dyZXNzJyBpbiB4aHIudXBsb2FkKSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBzdXBwb3J0Rm9ybURhdGEoKSB7XG4gICAgICAgICAgICByZXR1cm4gISEgd2luZG93LkZvcm1EYXRhO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHN1cHBvcnRGaWxlQVBJKCkgJiYgc3VwcG9ydEFqYXhVcGxvYWRQcm9ncmVzc0V2ZW50cygpICYmIHN1cHBvcnRGb3JtRGF0YSgpO1xuICAgIH0pKCk7XG5cblxuICAgIGZ1bmN0aW9uIHhocnVwbG9hZChmaWxlcywgc2V0dGluZ3MpIHtcblxuICAgICAgICBpZiAoIVVJLnN1cHBvcnQuYWpheHVwbG9hZCl7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuXG4gICAgICAgIHNldHRpbmdzID0gVUkuJC5leHRlbmQoe30sIHhocnVwbG9hZC5kZWZhdWx0cywgc2V0dGluZ3MpO1xuXG4gICAgICAgIGlmICghZmlsZXMubGVuZ3RoKXtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChzZXR0aW5ncy5hbGxvdyAhPT0gJyouKicpIHtcblxuICAgICAgICAgICAgZm9yKHZhciBpPTAsZmlsZTtmaWxlPWZpbGVzW2ldO2krKykge1xuXG4gICAgICAgICAgICAgICAgaWYoIW1hdGNoTmFtZShzZXR0aW5ncy5hbGxvdywgZmlsZS5uYW1lKSkge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmKHR5cGVvZihzZXR0aW5ncy5ub3RhbGxvd2VkKSA9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgICAgICAgICBhbGVydChzZXR0aW5ncy5ub3RhbGxvd2VkKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3Mubm90YWxsb3dlZChmaWxlLCBzZXR0aW5ncyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBjb21wbGV0ZSA9IHNldHRpbmdzLmNvbXBsZXRlO1xuXG4gICAgICAgIGlmIChzZXR0aW5ncy5zaW5nbGUpe1xuXG4gICAgICAgICAgICB2YXIgY291bnQgICAgPSBmaWxlcy5sZW5ndGgsXG4gICAgICAgICAgICAgICAgdXBsb2FkZWQgPSAwLFxuICAgICAgICAgICAgICAgIGFsbG93ICAgID0gdHJ1ZTtcblxuICAgICAgICAgICAgICAgIHNldHRpbmdzLmJlZm9yZUFsbChmaWxlcyk7XG5cbiAgICAgICAgICAgICAgICBzZXR0aW5ncy5jb21wbGV0ZSA9IGZ1bmN0aW9uKHJlc3BvbnNlLCB4aHIpe1xuXG4gICAgICAgICAgICAgICAgICAgIHVwbG9hZGVkID0gdXBsb2FkZWQgKyAxO1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlKHJlc3BvbnNlLCB4aHIpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChzZXR0aW5ncy5maWxlbGltaXQgJiYgdXBsb2FkZWQgPj0gc2V0dGluZ3MuZmlsZWxpbWl0KXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsbG93ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoYWxsb3cgJiYgdXBsb2FkZWQ8Y291bnQpe1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkKFtmaWxlc1t1cGxvYWRlZF1dLCBzZXR0aW5ncyk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5hbGxjb21wbGV0ZShyZXNwb25zZSwgeGhyKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICB1cGxvYWQoW2ZpbGVzWzBdXSwgc2V0dGluZ3MpO1xuXG4gICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgIHNldHRpbmdzLmNvbXBsZXRlID0gZnVuY3Rpb24ocmVzcG9uc2UsIHhocil7XG4gICAgICAgICAgICAgICAgY29tcGxldGUocmVzcG9uc2UsIHhocik7XG4gICAgICAgICAgICAgICAgc2V0dGluZ3MuYWxsY29tcGxldGUocmVzcG9uc2UsIHhocik7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB1cGxvYWQoZmlsZXMsIHNldHRpbmdzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHVwbG9hZChmaWxlcywgc2V0dGluZ3Mpe1xuXG4gICAgICAgICAgICAvLyB1cGxvYWQgYWxsIGF0IG9uY2VcbiAgICAgICAgICAgIHZhciBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpLCB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcblxuICAgICAgICAgICAgaWYgKHNldHRpbmdzLmJlZm9yZShzZXR0aW5ncywgZmlsZXMpPT09ZmFsc2UpIHJldHVybjtcblxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGY7IGYgPSBmaWxlc1tpXTsgaSsrKSB7IGZvcm1EYXRhLmFwcGVuZChzZXR0aW5ncy5wYXJhbSwgZik7IH1cbiAgICAgICAgICAgIGZvciAodmFyIHAgaW4gc2V0dGluZ3MucGFyYW1zKSB7IGZvcm1EYXRhLmFwcGVuZChwLCBzZXR0aW5ncy5wYXJhbXNbcF0pOyB9XG5cbiAgICAgICAgICAgIC8vIEFkZCBhbnkgZXZlbnQgaGFuZGxlcnMgaGVyZS4uLlxuICAgICAgICAgICAgeGhyLnVwbG9hZC5hZGRFdmVudExpc3RlbmVyKCdwcm9ncmVzcycsIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgIHZhciBwZXJjZW50ID0gKGUubG9hZGVkIC8gZS50b3RhbCkqMTAwO1xuICAgICAgICAgICAgICAgIHNldHRpbmdzLnByb2dyZXNzKHBlcmNlbnQsIGUpO1xuICAgICAgICAgICAgfSwgZmFsc2UpO1xuXG4gICAgICAgICAgICB4aHIuYWRkRXZlbnRMaXN0ZW5lcignbG9hZHN0YXJ0JywgZnVuY3Rpb24oZSl7IHNldHRpbmdzLmxvYWRzdGFydChlKTsgfSwgZmFsc2UpO1xuICAgICAgICAgICAgeGhyLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCAgICAgIGZ1bmN0aW9uKGUpeyBzZXR0aW5ncy5sb2FkKGUpOyAgICAgIH0sIGZhbHNlKTtcbiAgICAgICAgICAgIHhoci5hZGRFdmVudExpc3RlbmVyKCdsb2FkZW5kJywgICBmdW5jdGlvbihlKXsgc2V0dGluZ3MubG9hZGVuZChlKTsgICB9LCBmYWxzZSk7XG4gICAgICAgICAgICB4aHIuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCAgICAgZnVuY3Rpb24oZSl7IHNldHRpbmdzLmVycm9yKGUpOyAgICAgfSwgZmFsc2UpO1xuICAgICAgICAgICAgeGhyLmFkZEV2ZW50TGlzdGVuZXIoJ2Fib3J0JywgICAgIGZ1bmN0aW9uKGUpeyBzZXR0aW5ncy5hYm9ydChlKTsgICAgIH0sIGZhbHNlKTtcblxuICAgICAgICAgICAgeGhyLm9wZW4oc2V0dGluZ3MubWV0aG9kLCBzZXR0aW5ncy5hY3Rpb24sIHRydWUpO1xuXG4gICAgICAgICAgICBpZiAoc2V0dGluZ3MudHlwZT09J2pzb24nKSB7XG4gICAgICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoJ0FjY2VwdCcsICdhcHBsaWNhdGlvbi9qc29uJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZvciAodmFyIGggaW4gc2V0dGluZ3MuaGVhZGVycykge1xuICAgICAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKGgsIHNldHRpbmdzLmhlYWRlcnNbaF0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICBzZXR0aW5ncy5yZWFkeXN0YXRlY2hhbmdlKHhocik7XG5cbiAgICAgICAgICAgICAgICBpZiAoeGhyLnJlYWR5U3RhdGU9PTQpe1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IHhoci5yZXNwb25zZVRleHQ7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHNldHRpbmdzLnR5cGU9PSdqc29uJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IFVJLiQucGFyc2VKU09OKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2goZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5jb21wbGV0ZShyZXNwb25zZSwgeGhyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgc2V0dGluZ3MuYmVmb3JlU2VuZCh4aHIpO1xuICAgICAgICAgICAgeGhyLnNlbmQoZm9ybURhdGEpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgeGhydXBsb2FkLmRlZmF1bHRzID0ge1xuICAgICAgICBhY3Rpb246ICcnLFxuICAgICAgICBzaW5nbGU6IHRydWUsXG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICBwYXJhbSA6ICdmaWxlc1tdJyxcbiAgICAgICAgcGFyYW1zOiB7fSxcbiAgICAgICAgYWxsb3cgOiAnKi4qJyxcbiAgICAgICAgdHlwZSAgOiAndGV4dCcsXG4gICAgICAgIGZpbGVsaW1pdDogZmFsc2UsXG4gICAgICAgIGhlYWRlcnM6IHt9LFxuXG4gICAgICAgIC8vIGV2ZW50c1xuICAgICAgICBiZWZvcmUgICAgICAgICAgOiBmdW5jdGlvbihvKXt9LFxuICAgICAgICBiZWZvcmVTZW5kICAgICAgOiBmdW5jdGlvbih4aHIpe30sXG4gICAgICAgIGJlZm9yZUFsbCAgICAgICA6IGZ1bmN0aW9uKCl7fSxcbiAgICAgICAgbG9hZHN0YXJ0ICAgICAgIDogZnVuY3Rpb24oKXt9LFxuICAgICAgICBsb2FkICAgICAgICAgICAgOiBmdW5jdGlvbigpe30sXG4gICAgICAgIGxvYWRlbmQgICAgICAgICA6IGZ1bmN0aW9uKCl7fSxcbiAgICAgICAgZXJyb3IgICAgICAgICAgIDogZnVuY3Rpb24oKXt9LFxuICAgICAgICBhYm9ydCAgICAgICAgICAgOiBmdW5jdGlvbigpe30sXG4gICAgICAgIHByb2dyZXNzICAgICAgICA6IGZ1bmN0aW9uKCl7fSxcbiAgICAgICAgY29tcGxldGUgICAgICAgIDogZnVuY3Rpb24oKXt9LFxuICAgICAgICBhbGxjb21wbGV0ZSAgICAgOiBmdW5jdGlvbigpe30sXG4gICAgICAgIHJlYWR5c3RhdGVjaGFuZ2U6IGZ1bmN0aW9uKCl7fSxcbiAgICAgICAgbm90YWxsb3dlZCAgICAgIDogZnVuY3Rpb24oZmlsZSwgc2V0dGluZ3MpeyBhbGVydCgnT25seSB0aGUgZm9sbG93aW5nIGZpbGUgdHlwZXMgYXJlIGFsbG93ZWQ6ICcrc2V0dGluZ3MuYWxsb3cpOyB9XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIG1hdGNoTmFtZShwYXR0ZXJuLCBwYXRoKSB7XG5cbiAgICAgICAgdmFyIHBhcnNlZFBhdHRlcm4gPSAnXicgKyBwYXR0ZXJuLnJlcGxhY2UoL1xcLy9nLCAnXFxcXC8nKS5cbiAgICAgICAgICAgIHJlcGxhY2UoL1xcKlxcKi9nLCAnKFxcXFwvW15cXFxcL10rKSonKS5cbiAgICAgICAgICAgIHJlcGxhY2UoL1xcKi9nLCAnW15cXFxcL10rJykuXG4gICAgICAgICAgICByZXBsYWNlKC8oKD8hXFxcXCkpXFw/L2csICckMS4nKSArICckJztcblxuICAgICAgICBwYXJzZWRQYXR0ZXJuID0gJ14nICsgcGFyc2VkUGF0dGVybiArICckJztcblxuICAgICAgICByZXR1cm4gKHBhdGgubWF0Y2gobmV3IFJlZ0V4cChwYXJzZWRQYXR0ZXJuLCAnaScpKSAhPT0gbnVsbCk7XG4gICAgfVxuXG4gICAgVUkuVXRpbHMueGhydXBsb2FkID0geGhydXBsb2FkO1xuXG4gICAgcmV0dXJuIHhocnVwbG9hZDtcbn0pOyJdfQ==
