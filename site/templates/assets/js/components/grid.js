!function(t){var i;window.UIkit2&&(i=t(UIkit2)),"function"==typeof define&&define.amd&&define("uikit-grid",["uikit"],function(){return i||t(UIkit2)})}(function(y){"use strict";y.component("grid",{defaults:{colwidth:"auto",animation:!0,duration:300,gutter:0,controls:!1,filter:!1,origin:y.langdirection},boot:function(){y.ready(function(t){y.$("[data-uk-grid]",t).each(function(){var t=y.$(this);t.data("grid")||y.grid(t,y.Utils.options(t.attr("data-uk-grid")))})})},init:function(){var e=this,t=String(this.options.gutter).trim().split(" ");this.gutterv=parseInt(t[0],10),this.gutterh=parseInt(t[1]||t[0],10),this.element.css({position:"relative"}),this.controls=null,this.origin=this.options.origin,this.options.controls&&(this.controls=y.$(this.options.controls),this.controls.on("click","[data-uk-filter]",function(t){t.preventDefault(),e.filter(y.$(this).attr("data-uk-filter"))}),this.controls.on("click","[data-uk-sort]",function(t){t.preventDefault();var i=y.$(this).attr("data-uk-sort").split(":");e.sort(i[0],i[1])})),y.$win.on("load resize orientationchange",y.Utils.debounce(function(){e.currentfilter?e.filter(e.currentfilter):this.update()}.bind(this),100)),this.on("display.uk.check",function(){e.element.is(":visible")&&e.update()}),y.domObserve(this.element,function(t){e.update()}),!1!==this.options.filter?this.filter(this.options.filter):this.update()},_prepareElements:function(){var t,i=this.element.children(":not([data-grid-prepared])");i.length&&(t={position:"absolute",boxSizing:"border-box",width:"auto"==this.options.colwidth?"":this.options.colwidth},this.options.gutter&&(t["padding-"+this.origin]=this.gutterh,t["padding-bottom"]=this.gutterv,this.element.css("margin-"+this.origin,-1*this.gutterh)),i.attr("data-grid-prepared","true").css(t))},update:function(t){var e=this;this._prepareElements();var n,r,o,s,a,d,i,h,u,l=t=t||this.element.children(":visible"),c=this.element.width()+2*this.gutterh+2,f=0,p=0,g=[];this.trigger("beforeupdate.uk.grid",[l]),l.each(function(t){var i;for(i=this,u=function(){var o="Webkit Moz ms Ms O".split(" "),s=document.documentElement.style;function b(t){var i=parseFloat(t),e=-1===t.indexOf("%")&&!isNaN(i);return e&&i}var y,k,w,a="undefined"==typeof console?function(){}:function(t){console.error(t)},x=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"],d=!1;function W(){if(!d){d=!0;var e,i=window.getComputedStyle;if(e=i?function(t){return i(t,null)}:function(t){return t.currentStyle},y=function(t){var i=e(t);return i||a("Style returned "+i+". Are you running this code in a hidden iframe on Firefox? See http://bit.ly/getsizebug1"),i},k=function(t){if(t){if("string"==typeof s[t])return t;var i;t=t.charAt(0).toUpperCase()+t.slice(1);for(var e=0,n=o.length;e<n;e++)if(i=o[e]+t,"string"==typeof s[i])return i}}("boxSizing")){var t=document.createElement("div");t.style.width="200px",t.style.padding="1px 2px 3px 4px",t.style.borderStyle="solid",t.style.borderWidth="1px 2px 3px 4px",t.style[k]="border-box";var n=document.body||document.documentElement;n.appendChild(t);var r=y(t);w=200===b(r.width),n.removeChild(t)}}}return function(t){if(W(),"string"==typeof t&&(t=document.querySelector(t)),t&&"object"==typeof t&&t.nodeType){var i=y(t);if("none"===i.display)return function(){for(var t={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},i=0,e=x.length;i<e;i++){var n=x[i];t[n]=0}return t}();var e={};e.width=t.offsetWidth,e.height=t.offsetHeight;for(var n=e.isBorderBox=!(!k||!i[k]||"border-box"!==i[k]),r=0,o=x.length;r<o;r++){var s=x[r],a=i[s],d=parseFloat(a);e[s]=isNaN(d)?0:d}var h=e.paddingLeft+e.paddingRight,u=e.paddingTop+e.paddingBottom,l=e.marginLeft+e.marginRight,c=e.marginTop+e.marginBottom,f=e.borderLeftWidth+e.borderRightWidth,p=e.borderTopWidth+e.borderBottomWidth,g=n&&w,m=b(i.width);!1!==m&&(e.width=m+(g?0:h+f));var v=b(i.height);return!1!==v&&(e.height=v+(g?0:u+p)),e.innerWidth=e.width-(h+f),e.innerHeight=e.height-(u+p),e.outerWidth=e.width+l,e.outerHeight=e.height+c,e}}}()(i),n=y.$(this),r=u.outerWidth,o=u.outerHeight,d=p=f=0,h=g.length;d<h;d++)s=g[d],f<=s.aX&&(f=s.aX),c<f+r&&(f=0),p<=s.aY&&(p=s.aY);(a={ele:n,top:p,width:r,height:o,aY:p+o,aX:f+r})[e.origin]=f,g.push(a)});var m,v,b=0;for(d=0,h=g.length;d<h;d++){for(s=g[d],i=p=0;i<d;i++)m=g[i],s[this.origin]<m.aX&&m[this.origin]+1<s.aX&&(p=m.aY);s.top=p,s.aY=p+s.height,b=Math.max(b,s.aY)}b-=this.gutterv,this.options.animation?(this.element.stop().animate({height:b},100),g.forEach(function(t){(v={top:t.top,opacity:1})[e.origin]=t[e.origin],t.ele.stop().animate(v,this.options.duration)}.bind(this))):(this.element.css("height",b),g.forEach(function(t){(v={top:t.top,opacity:1})[e.origin]=t[e.origin],t.ele.css(v)}.bind(this))),setTimeout(function(){y.$doc.trigger("scrolling.uk.document")},2*this.options.duration*(this.options.animation?1:0)),this.trigger("afterupdate.uk.grid",[l])},filter:function(r){"number"==typeof(r=(this.currentfilter=r)||[])&&(r=r.toString()),"string"==typeof r&&(r=r.split(/,/).map(function(t){return t.trim()}));var t=this.element.children(),o={visible:[],hidden:[]};t.each(function(t){var i=y.$(this),e=i.attr("data-uk-filter"),n=!r.length;e&&(e=e.split(/,/).map(function(t){return t.trim()}),r.forEach(function(t){-1<e.indexOf(t)&&(n=!0)})),o[n?"visible":"hidden"].push(i)}),o.hidden=y.$(o.hidden).map(function(){return this[0]}),o.visible=y.$(o.visible).map(function(){return this[0]}),o.hidden.attr("aria-hidden","true").filter(":visible").fadeOut(this.options.duration),o.visible.attr("aria-hidden","false").filter(":hidden").css("opacity",0).show(),this.update(o.visible),this.controls&&this.controls.length&&this.controls.find("[data-uk-filter]").removeClass("uk-active").filter('[data-uk-filter="'+r+'"]').addClass("uk-active")},sort:function(e,n){"string"==typeof(n=n||1)&&(n="desc"==n.toLowerCase()?-1:1);var t=this.element.children();t.sort(function(t,i){return t=y.$(t),((i=y.$(i)).data(e)||"")<(t.data(e)||"")?n:-1*n}).appendTo(this.element),this.update(t.filter(":visible")),this.controls&&this.controls.length&&this.controls.find("[data-uk-sort]").removeClass("uk-active").filter('[data-uk-sort="'+e+":"+(-1==n?"desc":"asc")+'"]').addClass("uk-active")}})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvZ3JpZC5qcyJdLCJuYW1lcyI6WyJhZGRvbiIsImNvbXBvbmVudCIsIndpbmRvdyIsIlVJa2l0MiIsImRlZmluZSIsImFtZCIsIlVJIiwiZGVmYXVsdHMiLCJjb2x3aWR0aCIsImFuaW1hdGlvbiIsImR1cmF0aW9uIiwiZ3V0dGVyIiwiY29udHJvbHMiLCJmaWx0ZXIiLCJvcmlnaW4iLCJsYW5nZGlyZWN0aW9uIiwiYm9vdCIsInJlYWR5IiwiY29udGV4dCIsIiQiLCJlYWNoIiwiZWxlIiwidGhpcyIsImRhdGEiLCJncmlkIiwiVXRpbHMiLCJvcHRpb25zIiwiYXR0ciIsImluaXQiLCIkdGhpcyIsIlN0cmluZyIsInRyaW0iLCJzcGxpdCIsImd1dHRlcnYiLCJwYXJzZUludCIsImd1dHRlcmgiLCJlbGVtZW50IiwiY3NzIiwicG9zaXRpb24iLCJvbiIsImUiLCJwcmV2ZW50RGVmYXVsdCIsImNtZCIsInNvcnQiLCIkd2luIiwiZGVib3VuY2UiLCJjdXJyZW50ZmlsdGVyIiwidXBkYXRlIiwiYmluZCIsImlzIiwiZG9tT2JzZXJ2ZSIsIl9wcmVwYXJlRWxlbWVudHMiLCJjaGlsZHJlbiIsImxlbmd0aCIsImJveFNpemluZyIsIndpZHRoIiwiZWxlbWVudHMiLCJpdGVtIiwiaGVpZ2h0IiwicG9zIiwicG9zaSIsImkiLCJ6IiwibWF4Iiwic2l6ZSIsIm1heHdpZHRoIiwibGVmdCIsInRvcCIsInBvc2l0aW9ucyIsInRyaWdnZXIiLCJpbmRleCIsInByZWZpeGVzIiwiZG9jRWxlbVN0eWxlIiwiZG9jdW1lbnQiLCJkb2N1bWVudEVsZW1lbnQiLCJzdHlsZSIsImdldFN0eWxlU2l6ZSIsInZhbHVlIiwibnVtIiwicGFyc2VGbG9hdCIsImlzVmFsaWQiLCJpbmRleE9mIiwiaXNOYU4iLCJnZXRTdHlsZSIsImJveFNpemluZ1Byb3AiLCJpc0JveFNpemVPdXRlciIsImxvZ0Vycm9yIiwiY29uc29sZSIsIm1lc3NhZ2UiLCJlcnJvciIsIm1lYXN1cmVtZW50cyIsImlzU2V0dXAiLCJzZXR1cCIsImdldFN0eWxlRm4iLCJnZXRDb21wdXRlZFN0eWxlIiwiZWxlbSIsImN1cnJlbnRTdHlsZSIsInByb3BOYW1lIiwicHJlZml4ZWQiLCJjaGFyQXQiLCJ0b1VwcGVyQ2FzZSIsInNsaWNlIiwibGVuIiwiZ2V0U3R5bGVQcm9wZXJ0eSIsImRpdiIsImNyZWF0ZUVsZW1lbnQiLCJwYWRkaW5nIiwiYm9yZGVyU3R5bGUiLCJib3JkZXJXaWR0aCIsImJvZHkiLCJhcHBlbmRDaGlsZCIsInJlbW92ZUNoaWxkIiwicXVlcnlTZWxlY3RvciIsIm5vZGVUeXBlIiwiZGlzcGxheSIsImlubmVyV2lkdGgiLCJpbm5lckhlaWdodCIsIm91dGVyV2lkdGgiLCJvdXRlckhlaWdodCIsIm1lYXN1cmVtZW50IiwiZ2V0WmVyb1NpemUiLCJvZmZzZXRXaWR0aCIsIm9mZnNldEhlaWdodCIsImlzQm9yZGVyQm94IiwicGFkZGluZ1dpZHRoIiwicGFkZGluZ0xlZnQiLCJwYWRkaW5nUmlnaHQiLCJwYWRkaW5nSGVpZ2h0IiwicGFkZGluZ1RvcCIsInBhZGRpbmdCb3R0b20iLCJtYXJnaW5XaWR0aCIsIm1hcmdpbkxlZnQiLCJtYXJnaW5SaWdodCIsIm1hcmdpbkhlaWdodCIsIm1hcmdpblRvcCIsIm1hcmdpbkJvdHRvbSIsImJvcmRlckxlZnRXaWR0aCIsImJvcmRlclJpZ2h0V2lkdGgiLCJib3JkZXJIZWlnaHQiLCJib3JkZXJUb3BXaWR0aCIsImJvcmRlckJvdHRvbVdpZHRoIiwiaXNCb3JkZXJCb3hTaXplT3V0ZXIiLCJzdHlsZVdpZHRoIiwic3R5bGVIZWlnaHQiLCJfZ2V0U2l6ZSIsImFYIiwiYVkiLCJwdXNoIiwicG9zUHJldiIsInBvc2l0aW9udG8iLCJtYXhIZWlnaHQiLCJNYXRoIiwic3RvcCIsImFuaW1hdGUiLCJmb3JFYWNoIiwib3BhY2l0eSIsInNldFRpbWVvdXQiLCIkZG9jIiwidG9TdHJpbmciLCJtYXAiLCJ2aXNpYmxlIiwiaGlkZGVuIiwiZiIsImluZmlsdGVyIiwiZmFkZU91dCIsInNob3ciLCJmaW5kIiwicmVtb3ZlQ2xhc3MiLCJhZGRDbGFzcyIsImJ5Iiwib3JkZXIiLCJ0b0xvd2VyQ2FzZSIsImEiLCJiIiwiYXBwZW5kVG8iXSwibWFwcGluZ3MiOiJDQUNBLFNBQVVBLEdBRU4sSUFBSUMsRUFFQUMsT0FBT0MsU0FDUEYsRUFBWUQsRUFBTUcsU0FHRCxtQkFBVkMsUUFBd0JBLE9BQU9DLEtBQ3RDRCxPQUFPLGFBQWMsQ0FBQyxTQUFVLFdBQzVCLE9BQU9ILEdBQWFELEVBQU1HLFVBVnRDLENBY0csU0FBU0csR0FFUixhQUVBQSxFQUFHTCxVQUFVLE9BQVEsQ0FFakJNLFNBQVUsQ0FDTkMsU0FBWSxPQUNaQyxXQUFZLEVBQ1pDLFNBQVksSUFDWkMsT0FBWSxFQUNaQyxVQUFZLEVBQ1pDLFFBQVksRUFDWkMsT0FBWVIsRUFBR1MsZUFHbkJDLEtBQU8sV0FHSFYsRUFBR1csTUFBTSxTQUFTQyxHQUVkWixFQUFHYSxFQUFFLGlCQUFrQkQsR0FBU0UsS0FBSyxXQUVqQyxJQUFJQyxFQUFNZixFQUFHYSxFQUFFRyxNQUVYRCxFQUFJRSxLQUFLLFNBQ1RqQixFQUFHa0IsS0FBS0gsRUFBS2YsRUFBR21CLE1BQU1DLFFBQVFMLEVBQUlNLEtBQUssdUJBTXZEQyxLQUFNLFdBRUYsSUFBSUMsRUFBUVAsS0FBTVgsRUFBU21CLE9BQU9SLEtBQUtJLFFBQVFmLFFBQVFvQixPQUFPQyxNQUFNLEtBRXBFVixLQUFLVyxRQUFXQyxTQUFTdkIsRUFBTyxHQUFJLElBQ3BDVyxLQUFLYSxRQUFXRCxTQUFVdkIsRUFBTyxJQUFNQSxFQUFPLEdBQUssSUFHbkRXLEtBQUtjLFFBQVFDLElBQUksQ0FBQ0MsU0FBWSxhQUU5QmhCLEtBQUtWLFNBQVcsS0FDaEJVLEtBQUtSLE9BQVdRLEtBQUtJLFFBQVFaLE9BRXpCUSxLQUFLSSxRQUFRZCxXQUViVSxLQUFLVixTQUFXTixFQUFHYSxFQUFFRyxLQUFLSSxRQUFRZCxVQUdsQ1UsS0FBS1YsU0FBUzJCLEdBQUcsUUFBUyxtQkFBb0Is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SyxrQkFBa0JDLFlBQVksYUFBYTFKLE9BQU8sa0JBQWtCNEosRUFBRyxNQUFlLEdBQVZDLEVBQWMsT0FBTyxPQUFPLE1BQU1GLFNBQVMiLCJmaWxlIjoiY29tcG9uZW50cy9ncmlkLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyohIFVJa2l0IDIuMjcuMiB8IGh0dHA6Ly93d3cuZ2V0dWlraXQuY29tIHwgKGMpIDIwMTQgWU9PdGhlbWUgfCBNSVQgTGljZW5zZSAqL1xuKGZ1bmN0aW9uKGFkZG9uKSB7XG5cbiAgICB2YXIgY29tcG9uZW50O1xuXG4gICAgaWYgKHdpbmRvdy5VSWtpdDIpIHtcbiAgICAgICAgY29tcG9uZW50ID0gYWRkb24oVUlraXQyKTtcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIGRlZmluZSA9PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHtcbiAgICAgICAgZGVmaW5lKCd1aWtpdC1ncmlkJywgWyd1aWtpdCddLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIGNvbXBvbmVudCB8fCBhZGRvbihVSWtpdDIpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbn0pKGZ1bmN0aW9uKFVJKXtcblxuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgVUkuY29tcG9uZW50KCdncmlkJywge1xuXG4gICAgICAgIGRlZmF1bHRzOiB7XG4gICAgICAgICAgICBjb2x3aWR0aCAgOiAnYXV0bycsXG4gICAgICAgICAgICBhbmltYXRpb24gOiB0cnVlLFxuICAgICAgICAgICAgZHVyYXRpb24gIDogMzAwLFxuICAgICAgICAgICAgZ3V0dGVyICAgIDogMCxcbiAgICAgICAgICAgIGNvbnRyb2xzICA6IGZhbHNlLFxuICAgICAgICAgICAgZmlsdGVyICAgIDogZmFsc2UsXG4gICAgICAgICAgICBvcmlnaW4gICAgOiBVSS5sYW5nZGlyZWN0aW9uXG4gICAgICAgIH0sXG5cbiAgICAgICAgYm9vdDogIGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAvLyBpbml0IGNvZGVcbiAgICAgICAgICAgIFVJLnJlYWR5KGZ1bmN0aW9uKGNvbnRleHQpIHtcblxuICAgICAgICAgICAgICAgIFVJLiQoJ1tkYXRhLXVrLWdyaWRdJywgY29udGV4dCkuZWFjaChmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBlbGUgPSBVSS4kKHRoaXMpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmKCFlbGUuZGF0YSgnZ3JpZCcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBVSS5ncmlkKGVsZSwgVUkuVXRpbHMub3B0aW9ucyhlbGUuYXR0cignZGF0YS11ay1ncmlkJykpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIHZhciAkdGhpcyA9IHRoaXMsIGd1dHRlciA9IFN0cmluZyh0aGlzLm9wdGlvbnMuZ3V0dGVyKS50cmltKCkuc3BsaXQoJyAnKTtcblxuICAgICAgICAgICAgdGhpcy5ndXR0ZXJ2ICA9IHBhcnNlSW50KGd1dHRlclswXSwgMTApO1xuICAgICAgICAgICAgdGhpcy5ndXR0ZXJoICA9IHBhcnNlSW50KChndXR0ZXJbMV0gfHwgZ3V0dGVyWzBdKSwgMTApO1xuXG4gICAgICAgICAgICAvLyBtYWtlIHN1cmUgcGFyZW50IGVsZW1lbnQgaGFzIHRoZSByaWdodCBwb3NpdGlvbiBwcm9wZXJ0eVxuICAgICAgICAgICAgdGhpcy5lbGVtZW50LmNzcyh7J3Bvc2l0aW9uJzogJ3JlbGF0aXZlJ30pO1xuXG4gICAgICAgICAgICB0aGlzLmNvbnRyb2xzID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMub3JpZ2luICAgPSB0aGlzLm9wdGlvbnMub3JpZ2luO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmNvbnRyb2xzKSB7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xzID0gVUkuJCh0aGlzLm9wdGlvbnMuY29udHJvbHMpO1xuXG4gICAgICAgICAgICAgICAgLy8gZmlsdGVyXG4gICAgICAgICAgICAgICAgdGhpcy5jb250cm9scy5vbignY2xpY2snLCAnW2RhdGEtdWstZmlsdGVyXScsIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICR0aGlzLmZpbHRlcihVSS4kKHRoaXMpLmF0dHIoJ2RhdGEtdWstZmlsdGVyJykpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy8gc29ydFxuICAgICAgICAgICAgICAgIHRoaXMuY29udHJvbHMub24oJ2NsaWNrJywgJ1tkYXRhLXVrLXNvcnRdJywgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNtZCA9IFVJLiQodGhpcykuYXR0cignZGF0YS11ay1zb3J0Jykuc3BsaXQoJzonKTtcbiAgICAgICAgICAgICAgICAgICAgJHRoaXMuc29ydChjbWRbMF0sIGNtZFsxXSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIFVJLiR3aW4ub24oJ2xvYWQgcmVzaXplIG9yaWVudGF0aW9uY2hhbmdlJywgVUkuVXRpbHMuZGVib3VuY2UoZnVuY3Rpb24oKXtcblxuICAgICAgICAgICAgICAgIGlmICgkdGhpcy5jdXJyZW50ZmlsdGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICR0aGlzLmZpbHRlcigkdGhpcy5jdXJyZW50ZmlsdGVyKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZSgpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfS5iaW5kKHRoaXMpLCAxMDApKTtcblxuICAgICAgICAgICAgdGhpcy5vbignZGlzcGxheS51ay5jaGVjaycsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgaWYgKCR0aGlzLmVsZW1lbnQuaXMoJzp2aXNpYmxlJykpICAkdGhpcy51cGRhdGUoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBVSS5kb21PYnNlcnZlKHRoaXMuZWxlbWVudCwgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICR0aGlzLnVwZGF0ZSgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZmlsdGVyICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVyKHRoaXMub3B0aW9ucy5maWx0ZXIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIF9wcmVwYXJlRWxlbWVudHM6IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICB2YXIgY2hpbGRyZW4gPSB0aGlzLmVsZW1lbnQuY2hpbGRyZW4oJzpub3QoW2RhdGEtZ3JpZC1wcmVwYXJlZF0pJyksIGNzcztcblxuICAgICAgICAgICAgLy8gZXhpdCBpZiBubyBhbHJlYWR5IHByZXBhcmVkIGVsZW1lbnRzIGZvdW5kXG4gICAgICAgICAgICBpZiAoIWNoaWxkcmVuLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY3NzID0ge1xuICAgICAgICAgICAgICAgIHBvc2l0aW9uICA6ICdhYnNvbHV0ZScsXG4gICAgICAgICAgICAgICAgYm94U2l6aW5nIDogJ2JvcmRlci1ib3gnLFxuICAgICAgICAgICAgICAgIHdpZHRoICAgICA6IHRoaXMub3B0aW9ucy5jb2x3aWR0aCA9PSAnYXV0bycgPyAnJyA6IHRoaXMub3B0aW9ucy5jb2x3aWR0aFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5ndXR0ZXIpIHtcblxuICAgICAgICAgICAgICAgIGNzc1sncGFkZGluZy0nK3RoaXMub3JpZ2luXSA9IHRoaXMuZ3V0dGVyaDtcbiAgICAgICAgICAgICAgICBjc3NbJ3BhZGRpbmctYm90dG9tJ10gPSB0aGlzLmd1dHRlcnY7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQuY3NzKCdtYXJnaW4tJyt0aGlzLm9yaWdpbiwgdGhpcy5ndXR0ZXJoICogLTEpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjaGlsZHJlbi5hdHRyKCdkYXRhLWdyaWQtcHJlcGFyZWQnLCAndHJ1ZScpLmNzcyhjc3MpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHVwZGF0ZTogZnVuY3Rpb24oZWxlbWVudHMpIHtcblxuICAgICAgICAgICAgdmFyICR0aGlzID0gdGhpcztcblxuICAgICAgICAgICAgdGhpcy5fcHJlcGFyZUVsZW1lbnRzKCk7XG5cbiAgICAgICAgICAgIGVsZW1lbnRzID0gZWxlbWVudHMgfHwgdGhpcy5lbGVtZW50LmNoaWxkcmVuKCc6dmlzaWJsZScpO1xuXG4gICAgICAgICAgICB2YXIgY2hpbGRyZW4gID0gZWxlbWVudHMsXG4gICAgICAgICAgICAgICAgbWF4d2lkdGggID0gdGhpcy5lbGVtZW50LndpZHRoKCkgKyAoMip0aGlzLmd1dHRlcmgpICsgMixcbiAgICAgICAgICAgICAgICBsZWZ0ICAgICAgPSAwLFxuICAgICAgICAgICAgICAgIHRvcCAgICAgICA9IDAsXG4gICAgICAgICAgICAgICAgcG9zaXRpb25zID0gW10sXG5cbiAgICAgICAgICAgICAgICBpdGVtLCB3aWR0aCwgaGVpZ2h0LCBwb3MsIHBvc2ksIGksIHosIG1heCwgc2l6ZTtcblxuICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCdiZWZvcmV1cGRhdGUudWsuZ3JpZCcsIFtjaGlsZHJlbl0pO1xuXG4gICAgICAgICAgICBjaGlsZHJlbi5lYWNoKGZ1bmN0aW9uKGluZGV4KXtcblxuICAgICAgICAgICAgICAgIHNpemUgICA9IGdldEVsZW1lbnRTaXplKHRoaXMpO1xuXG4gICAgICAgICAgICAgICAgaXRlbSAgID0gVUkuJCh0aGlzKTtcbiAgICAgICAgICAgICAgICB3aWR0aCAgPSBzaXplLm91dGVyV2lkdGg7XG4gICAgICAgICAgICAgICAgaGVpZ2h0ID0gc2l6ZS5vdXRlckhlaWdodDtcbiAgICAgICAgICAgICAgICBsZWZ0ICAgPSAwO1xuICAgICAgICAgICAgICAgIHRvcCAgICA9IDA7XG5cbiAgICAgICAgICAgICAgICBmb3IgKGk9MCxtYXg9cG9zaXRpb25zLmxlbmd0aDtpPG1heDtpKyspIHtcblxuICAgICAgICAgICAgICAgICAgICBwb3MgPSBwb3NpdGlvbnNbaV07XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGxlZnQgPD0gcG9zLmFYKSB7IGxlZnQgPSBwb3MuYVg7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG1heHdpZHRoIDwgKGxlZnQgKyB3aWR0aCkpIHsgbGVmdCA9IDA7IH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRvcCA8PSBwb3MuYVkpIHsgdG9wID0gcG9zLmFZOyB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcG9zaSA9IHtcbiAgICAgICAgICAgICAgICAgICAgZWxlICAgIDogaXRlbSxcbiAgICAgICAgICAgICAgICAgICAgdG9wICAgIDogdG9wLFxuICAgICAgICAgICAgICAgICAgICB3aWR0aCAgOiB3aWR0aCxcbiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0IDogaGVpZ2h0LFxuICAgICAgICAgICAgICAgICAgICBhWSAgICAgOiAodG9wICArIGhlaWdodCksXG4gICAgICAgICAgICAgICAgICAgIGFYICAgICA6IChsZWZ0ICsgd2lkdGgpXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHBvc2lbJHRoaXMub3JpZ2luXSA9IGxlZnQ7XG5cbiAgICAgICAgICAgICAgICBwb3NpdGlvbnMucHVzaChwb3NpKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB2YXIgcG9zUHJldiwgbWF4SGVpZ2h0ID0gMCwgcG9zaXRpb250bztcblxuICAgICAgICAgICAgLy8gZml4IHRvcFxuICAgICAgICAgICAgZm9yIChpPTAsbWF4PXBvc2l0aW9ucy5sZW5ndGg7aTxtYXg7aSsrKSB7XG5cbiAgICAgICAgICAgICAgICBwb3MgPSBwb3NpdGlvbnNbaV07XG4gICAgICAgICAgICAgICAgdG9wID0gMDtcblxuICAgICAgICAgICAgICAgIGZvciAoej0wO3o8aTt6KyspIHtcblxuICAgICAgICAgICAgICAgICAgICBwb3NQcmV2ID0gcG9zaXRpb25zW3pdO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIChwb3NQcmV2LmxlZnQgKyAxKSBmaXhleCAxcHggYnVnIHdoZW4gdXNpbmcgJSBiYXNlZCB3aWR0aHNcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBvc1t0aGlzLm9yaWdpbl0gPCBwb3NQcmV2LmFYICYmIChwb3NQcmV2W3RoaXMub3JpZ2luXSArMSkgPCBwb3MuYVgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvcCA9IHBvc1ByZXYuYVk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBwb3MudG9wID0gdG9wO1xuICAgICAgICAgICAgICAgIHBvcy5hWSAgPSB0b3AgKyBwb3MuaGVpZ2h0O1xuXG4gICAgICAgICAgICAgICAgbWF4SGVpZ2h0ID0gTWF0aC5tYXgobWF4SGVpZ2h0LCBwb3MuYVkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBtYXhIZWlnaHQgPSBtYXhIZWlnaHQgLSB0aGlzLmd1dHRlcnY7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuYW5pbWF0aW9uKSB7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQuc3RvcCgpLmFuaW1hdGUoeydoZWlnaHQnOiBtYXhIZWlnaHR9LCAxMDApO1xuXG4gICAgICAgICAgICAgICAgcG9zaXRpb25zLmZvckVhY2goZnVuY3Rpb24ocG9zKXtcblxuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbnRvID0ge1widG9wXCI6IHBvcy50b3AsIG9wYWNpdHk6IDF9O1xuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbnRvWyR0aGlzLm9yaWdpbl0gPSBwb3NbJHRoaXMub3JpZ2luXTtcblxuICAgICAgICAgICAgICAgICAgICBwb3MuZWxlLnN0b3AoKS5hbmltYXRlKHBvc2l0aW9udG8sIHRoaXMub3B0aW9ucy5kdXJhdGlvbik7XG4gICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcblxuICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5jc3MoJ2hlaWdodCcsIG1heEhlaWdodCk7XG5cbiAgICAgICAgICAgICAgICBwb3NpdGlvbnMuZm9yRWFjaChmdW5jdGlvbihwb3Mpe1xuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbnRvID0ge1widG9wXCI6IHBvcy50b3AsIG9wYWNpdHk6IDF9O1xuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbnRvWyR0aGlzLm9yaWdpbl0gPSBwb3NbJHRoaXMub3JpZ2luXTtcbiAgICAgICAgICAgICAgICAgICAgcG9zLmVsZS5jc3MocG9zaXRpb250byk7XG4gICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gbWFrZSBzdXJlIHRvIHRyaWdnZXIgcG9zc2libGUgc2Nyb2xscGllcyBldGMuXG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIFVJLiRkb2MudHJpZ2dlcignc2Nyb2xsaW5nLnVrLmRvY3VtZW50Jyk7XG4gICAgICAgICAgICB9LCAyICogdGhpcy5vcHRpb25zLmR1cmF0aW9uICogKHRoaXMub3B0aW9ucy5hbmltYXRpb24gPyAxOjApKTtcblxuICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCdhZnRlcnVwZGF0ZS51ay5ncmlkJywgW2NoaWxkcmVuXSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZmlsdGVyOiBmdW5jdGlvbihmaWx0ZXIpIHtcblxuICAgICAgICAgICAgdGhpcy5jdXJyZW50ZmlsdGVyID0gZmlsdGVyO1xuXG4gICAgICAgICAgICBmaWx0ZXIgPSBmaWx0ZXIgfHwgW107XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2YoZmlsdGVyKSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgICAgICBmaWx0ZXIgPSBmaWx0ZXIudG9TdHJpbmcoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHR5cGVvZihmaWx0ZXIpID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIGZpbHRlciA9IGZpbHRlci5zcGxpdCgvLC8pLm1hcChmdW5jdGlvbihpdGVtKXsgcmV0dXJuIGl0ZW0udHJpbSgpOyB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyICR0aGlzID0gdGhpcywgY2hpbGRyZW4gPSB0aGlzLmVsZW1lbnQuY2hpbGRyZW4oKSwgZWxlbWVudHMgPSB7XCJ2aXNpYmxlXCI6IFtdLCBcImhpZGRlblwiOiBbXX0sIHZpc2libGUsIGhpZGRlbjtcblxuICAgICAgICAgICAgY2hpbGRyZW4uZWFjaChmdW5jdGlvbihpbmRleCl7XG5cbiAgICAgICAgICAgICAgICB2YXIgZWxlID0gVUkuJCh0aGlzKSwgZiA9IGVsZS5hdHRyKCdkYXRhLXVrLWZpbHRlcicpLCBpbmZpbHRlciA9IGZpbHRlci5sZW5ndGggPyBmYWxzZSA6IHRydWU7XG5cbiAgICAgICAgICAgICAgICBpZiAoZikge1xuXG4gICAgICAgICAgICAgICAgICAgIGYgPSBmLnNwbGl0KC8sLykubWFwKGZ1bmN0aW9uKGl0ZW0peyByZXR1cm4gaXRlbS50cmltKCk7IH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGZpbHRlci5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pe1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGYuaW5kZXhPZihpdGVtKSA+IC0xKSBpbmZpbHRlciA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGVsZW1lbnRzW2luZmlsdGVyID8gXCJ2aXNpYmxlXCI6XCJoaWRkZW5cIl0ucHVzaChlbGUpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIGNvbnZlcnQgdG8galF1ZXJ5IGNvbGxlY3Rpb25zXG4gICAgICAgICAgICBlbGVtZW50cy5oaWRkZW4gID0gVUkuJChlbGVtZW50cy5oaWRkZW4pLm1hcChmdW5jdGlvbiAoKSB7cmV0dXJuIHRoaXNbMF07fSk7XG4gICAgICAgICAgICBlbGVtZW50cy52aXNpYmxlID0gVUkuJChlbGVtZW50cy52aXNpYmxlKS5tYXAoZnVuY3Rpb24gKCkge3JldHVybiB0aGlzWzBdO30pO1xuXG4gICAgICAgICAgICBlbGVtZW50cy5oaWRkZW4uYXR0cignYXJpYS1oaWRkZW4nLCAndHJ1ZScpLmZpbHRlcignOnZpc2libGUnKS5mYWRlT3V0KHRoaXMub3B0aW9ucy5kdXJhdGlvbik7XG4gICAgICAgICAgICBlbGVtZW50cy52aXNpYmxlLmF0dHIoJ2FyaWEtaGlkZGVuJywgJ2ZhbHNlJykuZmlsdGVyKCc6aGlkZGVuJykuY3NzKCdvcGFjaXR5JywgMCkuc2hvdygpO1xuXG4gICAgICAgICAgICAkdGhpcy51cGRhdGUoZWxlbWVudHMudmlzaWJsZSk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmNvbnRyb2xzICYmIHRoaXMuY29udHJvbHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jb250cm9scy5maW5kKCdbZGF0YS11ay1maWx0ZXJdJykucmVtb3ZlQ2xhc3MoJ3VrLWFjdGl2ZScpLmZpbHRlcignW2RhdGEtdWstZmlsdGVyPVwiJytmaWx0ZXIrJ1wiXScpLmFkZENsYXNzKCd1ay1hY3RpdmUnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBzb3J0OiBmdW5jdGlvbihieSwgb3JkZXIpe1xuXG4gICAgICAgICAgICBvcmRlciA9IG9yZGVyIHx8IDE7XG5cbiAgICAgICAgICAgIC8vIGNvdmVydCBmcm9tIHN0cmluZyAoYXNjfGRlc2MpIHRvIG51bWJlclxuICAgICAgICAgICAgaWYgKHR5cGVvZihvcmRlcikgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgb3JkZXIgPSBvcmRlci50b0xvd2VyQ2FzZSgpID09ICdkZXNjJyA/IC0xIDogMTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIGVsZW1lbnRzID0gdGhpcy5lbGVtZW50LmNoaWxkcmVuKCk7XG5cbiAgICAgICAgICAgIGVsZW1lbnRzLnNvcnQoZnVuY3Rpb24oYSwgYil7XG5cbiAgICAgICAgICAgICAgICBhID0gVUkuJChhKTtcbiAgICAgICAgICAgICAgICBiID0gVUkuJChiKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiAoYi5kYXRhKGJ5KSB8fCAnJykgPCAoYS5kYXRhKGJ5KSB8fCAnJykgPyBvcmRlciA6IChvcmRlciotMSk7XG5cbiAgICAgICAgICAgIH0pLmFwcGVuZFRvKHRoaXMuZWxlbWVudCk7XG5cbiAgICAgICAgICAgIHRoaXMudXBkYXRlKGVsZW1lbnRzLmZpbHRlcignOnZpc2libGUnKSk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmNvbnRyb2xzICYmIHRoaXMuY29udHJvbHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jb250cm9scy5maW5kKCdbZGF0YS11ay1zb3J0XScpLnJlbW92ZUNsYXNzKCd1ay1hY3RpdmUnKS5maWx0ZXIoJ1tkYXRhLXVrLXNvcnQ9XCInK2J5Kyc6Jysob3JkZXIgPT0gLTEgPyAnZGVzYyc6J2FzYycpKydcIl0nKS5hZGRDbGFzcygndWstYWN0aXZlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcblxuXG4gICAgLyohXG4gICAgKiBnZXRTaXplIHYxLjIuMlxuICAgICogbWVhc3VyZSBzaXplIG9mIGVsZW1lbnRzXG4gICAgKiBNSVQgbGljZW5zZVxuICAgICogaHR0cHM6Ly9naXRodWIuY29tL2Rlc2FuZHJvL2dldC1zaXplXG4gICAgKi9cbiAgICBmdW5jdGlvbiBfZ2V0U2l6ZSgpIHtcblxuICAgICAgICB2YXIgcHJlZml4ZXMgPSAnV2Via2l0IE1veiBtcyBNcyBPJy5zcGxpdCgnICcpO1xuICAgICAgICB2YXIgZG9jRWxlbVN0eWxlID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlO1xuXG4gICAgICAgIGZ1bmN0aW9uIGdldFN0eWxlUHJvcGVydHkoIHByb3BOYW1lICkge1xuICAgICAgICAgICAgaWYgKCAhcHJvcE5hbWUgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyB0ZXN0IHN0YW5kYXJkIHByb3BlcnR5IGZpcnN0XG4gICAgICAgICAgICBpZiAoIHR5cGVvZiBkb2NFbGVtU3R5bGVbIHByb3BOYW1lIF0gPT09ICdzdHJpbmcnICkge1xuICAgICAgICAgICAgICAgIHJldHVybiBwcm9wTmFtZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gY2FwaXRhbGl6ZVxuICAgICAgICAgICAgcHJvcE5hbWUgPSBwcm9wTmFtZS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHByb3BOYW1lLnNsaWNlKDEpO1xuXG4gICAgICAgICAgICAvLyB0ZXN0IHZlbmRvciBzcGVjaWZpYyBwcm9wZXJ0aWVzXG4gICAgICAgICAgICB2YXIgcHJlZml4ZWQ7XG4gICAgICAgICAgICBmb3IgKCB2YXIgaT0wLCBsZW4gPSBwcmVmaXhlcy5sZW5ndGg7IGkgPCBsZW47IGkrKyApIHtcbiAgICAgICAgICAgICAgICBwcmVmaXhlZCA9IHByZWZpeGVzW2ldICsgcHJvcE5hbWU7XG4gICAgICAgICAgICAgICAgaWYgKCB0eXBlb2YgZG9jRWxlbVN0eWxlWyBwcmVmaXhlZCBdID09PSAnc3RyaW5nJyApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHByZWZpeGVkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIGhlbHBlcnMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gLy9cblxuICAgICAgICAvLyBnZXQgYSBudW1iZXIgZnJvbSBhIHN0cmluZywgbm90IGEgcGVyY2VudGFnZVxuICAgICAgICBmdW5jdGlvbiBnZXRTdHlsZVNpemUoIHZhbHVlICkge1xuICAgICAgICAgICAgdmFyIG51bSA9IHBhcnNlRmxvYXQoIHZhbHVlICk7XG4gICAgICAgICAgICAvLyBub3QgYSBwZXJjZW50IGxpa2UgJzEwMCUnLCBhbmQgYSBudW1iZXJcbiAgICAgICAgICAgIHZhciBpc1ZhbGlkID0gdmFsdWUuaW5kZXhPZignJScpID09PSAtMSAmJiAhaXNOYU4oIG51bSApO1xuICAgICAgICAgICAgcmV0dXJuIGlzVmFsaWQgJiYgbnVtO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gbm9vcCgpIHt9XG5cbiAgICAgICAgdmFyIGxvZ0Vycm9yID0gdHlwZW9mIGNvbnNvbGUgPT09ICd1bmRlZmluZWQnID8gbm9vcCA6IGZ1bmN0aW9uKCBtZXNzYWdlICkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvciggbWVzc2FnZSApO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIG1lYXN1cmVtZW50cyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAvL1xuXG4gICAgICAgIHZhciBtZWFzdXJlbWVudHMgPSBbXG4gICAgICAgICAgICAncGFkZGluZ0xlZnQnLFxuICAgICAgICAgICAgJ3BhZGRpbmdSaWdodCcsXG4gICAgICAgICAgICAncGFkZGluZ1RvcCcsXG4gICAgICAgICAgICAncGFkZGluZ0JvdHRvbScsXG4gICAgICAgICAgICAnbWFyZ2luTGVmdCcsXG4gICAgICAgICAgICAnbWFyZ2luUmlnaHQnLFxuICAgICAgICAgICAgJ21hcmdpblRvcCcsXG4gICAgICAgICAgICAnbWFyZ2luQm90dG9tJyxcbiAgICAgICAgICAgICdib3JkZXJMZWZ0V2lkdGgnLFxuICAgICAgICAgICAgJ2JvcmRlclJpZ2h0V2lkdGgnLFxuICAgICAgICAgICAgJ2JvcmRlclRvcFdpZHRoJyxcbiAgICAgICAgICAgICdib3JkZXJCb3R0b21XaWR0aCdcbiAgICAgICAgXTtcblxuICAgICAgICBmdW5jdGlvbiBnZXRaZXJvU2l6ZSgpIHtcbiAgICAgICAgICAgIHZhciBzaXplID0ge1xuICAgICAgICAgICAgICAgIHdpZHRoOiAwLFxuICAgICAgICAgICAgICAgIGhlaWdodDogMCxcbiAgICAgICAgICAgICAgICBpbm5lcldpZHRoOiAwLFxuICAgICAgICAgICAgICAgIGlubmVySGVpZ2h0OiAwLFxuICAgICAgICAgICAgICAgIG91dGVyV2lkdGg6IDAsXG4gICAgICAgICAgICAgICAgb3V0ZXJIZWlnaHQ6IDBcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBmb3IgKCB2YXIgaT0wLCBsZW4gPSBtZWFzdXJlbWVudHMubGVuZ3RoOyBpIDwgbGVuOyBpKysgKSB7XG4gICAgICAgICAgICAgICAgdmFyIG1lYXN1cmVtZW50ID0gbWVhc3VyZW1lbnRzW2ldO1xuICAgICAgICAgICAgICAgIHNpemVbIG1lYXN1cmVtZW50IF0gPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHNpemU7XG4gICAgICAgIH1cblxuXG4gICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIHNldHVwIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIC8vXG5cbiAgICAgICAgdmFyIGlzU2V0dXAgPSBmYWxzZTtcbiAgICAgICAgdmFyIGdldFN0eWxlLCBib3hTaXppbmdQcm9wLCBpc0JveFNpemVPdXRlcjtcblxuICAgICAgICAvKipcbiAgICAgICAgKiBzZXR1cCB2YXJzIGFuZCBmdW5jdGlvbnNcbiAgICAgICAgKiBkbyBpdCBvbiBpbml0aWFsIGdldFNpemUoKSwgcmF0aGVyIHRoYW4gb24gc2NyaXB0IGxvYWRcbiAgICAgICAgKiBGb3IgRmlyZWZveCBidWcgaHR0cHM6Ly9idWd6aWxsYS5tb3ppbGxhLm9yZy9zaG93X2J1Zy5jZ2k/aWQ9NTQ4Mzk3XG4gICAgICAgICovXG4gICAgICAgIGZ1bmN0aW9uIHNldHVwKCkge1xuICAgICAgICAgICAgLy8gc2V0dXAgb25jZVxuICAgICAgICAgICAgaWYgKCBpc1NldHVwICkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlzU2V0dXAgPSB0cnVlO1xuXG4gICAgICAgICAgICB2YXIgZ2V0Q29tcHV0ZWRTdHlsZSA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlO1xuICAgICAgICAgICAgZ2V0U3R5bGUgPSAoIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBnZXRTdHlsZUZuID0gZ2V0Q29tcHV0ZWRTdHlsZSA/XG4gICAgICAgICAgICAgICAgZnVuY3Rpb24oIGVsZW0gKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDb21wdXRlZFN0eWxlKCBlbGVtLCBudWxsICk7XG4gICAgICAgICAgICAgICAgfSA6XG4gICAgICAgICAgICAgICAgZnVuY3Rpb24oIGVsZW0gKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtLmN1cnJlbnRTdHlsZTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIGdldFN0eWxlKCBlbGVtICkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgc3R5bGUgPSBnZXRTdHlsZUZuKCBlbGVtICk7XG4gICAgICAgICAgICAgICAgICAgIGlmICggIXN0eWxlICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9nRXJyb3IoICdTdHlsZSByZXR1cm5lZCAnICsgc3R5bGUgK1xuICAgICAgICAgICAgICAgICAgICAgICAgJy4gQXJlIHlvdSBydW5uaW5nIHRoaXMgY29kZSBpbiBhIGhpZGRlbiBpZnJhbWUgb24gRmlyZWZveD8gJyArXG4gICAgICAgICAgICAgICAgICAgICAgICAnU2VlIGh0dHA6Ly9iaXQubHkvZ2V0c2l6ZWJ1ZzEnICk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN0eWxlO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9KSgpO1xuXG4gICAgICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBib3ggc2l6aW5nIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIC8vXG5cbiAgICAgICAgICAgIGJveFNpemluZ1Byb3AgPSBnZXRTdHlsZVByb3BlcnR5KCdib3hTaXppbmcnKTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAqIFdlYktpdCBtZWFzdXJlcyB0aGUgb3V0ZXItd2lkdGggb24gc3R5bGUud2lkdGggb24gYm9yZGVyLWJveCBlbGVtc1xuICAgICAgICAgICAgKiBJRSAmIEZpcmVmb3ggbWVhc3VyZXMgdGhlIGlubmVyLXdpZHRoXG4gICAgICAgICAgICAqL1xuICAgICAgICAgICAgaWYgKCBib3hTaXppbmdQcm9wICkge1xuICAgICAgICAgICAgICAgIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgICAgICBkaXYuc3R5bGUud2lkdGggPSAnMjAwcHgnO1xuICAgICAgICAgICAgICAgIGRpdi5zdHlsZS5wYWRkaW5nID0gJzFweCAycHggM3B4IDRweCc7XG4gICAgICAgICAgICAgICAgZGl2LnN0eWxlLmJvcmRlclN0eWxlID0gJ3NvbGlkJztcbiAgICAgICAgICAgICAgICBkaXYuc3R5bGUuYm9yZGVyV2lkdGggPSAnMXB4IDJweCAzcHggNHB4JztcbiAgICAgICAgICAgICAgICBkaXYuc3R5bGVbIGJveFNpemluZ1Byb3AgXSA9ICdib3JkZXItYm94JztcblxuICAgICAgICAgICAgICAgIHZhciBib2R5ID0gZG9jdW1lbnQuYm9keSB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7XG4gICAgICAgICAgICAgICAgYm9keS5hcHBlbmRDaGlsZCggZGl2ICk7XG4gICAgICAgICAgICAgICAgdmFyIHN0eWxlID0gZ2V0U3R5bGUoIGRpdiApO1xuXG4gICAgICAgICAgICAgICAgaXNCb3hTaXplT3V0ZXIgPSBnZXRTdHlsZVNpemUoIHN0eWxlLndpZHRoICkgPT09IDIwMDtcbiAgICAgICAgICAgICAgICBib2R5LnJlbW92ZUNoaWxkKCBkaXYgKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG5cbiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gZ2V0U2l6ZSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAvL1xuXG4gICAgICAgIGZ1bmN0aW9uIGdldFNpemUoIGVsZW0gKSB7XG4gICAgICAgICAgICBzZXR1cCgpO1xuXG4gICAgICAgICAgICAvLyB1c2UgcXVlcnlTZWxldG9yIGlmIGVsZW0gaXMgc3RyaW5nXG4gICAgICAgICAgICBpZiAoIHR5cGVvZiBlbGVtID09PSAnc3RyaW5nJyApIHtcbiAgICAgICAgICAgICAgICBlbGVtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvciggZWxlbSApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBkbyBub3QgcHJvY2VlZCBvbiBub24tb2JqZWN0c1xuICAgICAgICAgICAgaWYgKCAhZWxlbSB8fCB0eXBlb2YgZWxlbSAhPT0gJ29iamVjdCcgfHwgIWVsZW0ubm9kZVR5cGUgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgc3R5bGUgPSBnZXRTdHlsZSggZWxlbSApO1xuXG4gICAgICAgICAgICAvLyBpZiBoaWRkZW4sIGV2ZXJ5dGhpbmcgaXMgMFxuICAgICAgICAgICAgaWYgKCBzdHlsZS5kaXNwbGF5ID09PSAnbm9uZScgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldFplcm9TaXplKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBzaXplID0ge307XG4gICAgICAgICAgICBzaXplLndpZHRoID0gZWxlbS5vZmZzZXRXaWR0aDtcbiAgICAgICAgICAgIHNpemUuaGVpZ2h0ID0gZWxlbS5vZmZzZXRIZWlnaHQ7XG5cbiAgICAgICAgICAgIHZhciBpc0JvcmRlckJveCA9IHNpemUuaXNCb3JkZXJCb3ggPSAhISggYm94U2l6aW5nUHJvcCAmJlxuICAgICAgICAgICAgICAgIHN0eWxlWyBib3hTaXppbmdQcm9wIF0gJiYgc3R5bGVbIGJveFNpemluZ1Byb3AgXSA9PT0gJ2JvcmRlci1ib3gnICk7XG5cbiAgICAgICAgICAgIC8vIGdldCBhbGwgbWVhc3VyZW1lbnRzXG4gICAgICAgICAgICBmb3IgKCB2YXIgaT0wLCBsZW4gPSBtZWFzdXJlbWVudHMubGVuZ3RoOyBpIDwgbGVuOyBpKysgKSB7XG4gICAgICAgICAgICAgICAgdmFyIG1lYXN1cmVtZW50ID0gbWVhc3VyZW1lbnRzW2ldO1xuICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IHN0eWxlWyBtZWFzdXJlbWVudCBdO1xuXG4gICAgICAgICAgICAgICAgdmFyIG51bSA9IHBhcnNlRmxvYXQoIHZhbHVlICk7XG4gICAgICAgICAgICAgICAgLy8gYW55ICdhdXRvJywgJ21lZGl1bScgdmFsdWUgd2lsbCBiZSAwXG4gICAgICAgICAgICAgICAgc2l6ZVsgbWVhc3VyZW1lbnQgXSA9ICFpc05hTiggbnVtICkgPyBudW0gOiAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgcGFkZGluZ1dpZHRoID0gc2l6ZS5wYWRkaW5nTGVmdCArIHNpemUucGFkZGluZ1JpZ2h0O1xuICAgICAgICAgICAgdmFyIHBhZGRpbmdIZWlnaHQgPSBzaXplLnBhZGRpbmdUb3AgKyBzaXplLnBhZGRpbmdCb3R0b207XG4gICAgICAgICAgICB2YXIgbWFyZ2luV2lkdGggPSBzaXplLm1hcmdpbkxlZnQgKyBzaXplLm1hcmdpblJpZ2h0O1xuICAgICAgICAgICAgdmFyIG1hcmdpbkhlaWdodCA9IHNpemUubWFyZ2luVG9wICsgc2l6ZS5tYXJnaW5Cb3R0b207XG4gICAgICAgICAgICB2YXIgYm9yZGVyV2lkdGggPSBzaXplLmJvcmRlckxlZnRXaWR0aCArIHNpemUuYm9yZGVyUmlnaHRXaWR0aDtcbiAgICAgICAgICAgIHZhciBib3JkZXJIZWlnaHQgPSBzaXplLmJvcmRlclRvcFdpZHRoICsgc2l6ZS5ib3JkZXJCb3R0b21XaWR0aDtcblxuICAgICAgICAgICAgdmFyIGlzQm9yZGVyQm94U2l6ZU91dGVyID0gaXNCb3JkZXJCb3ggJiYgaXNCb3hTaXplT3V0ZXI7XG5cbiAgICAgICAgICAgIC8vIG92ZXJ3cml0ZSB3aWR0aCBhbmQgaGVpZ2h0IGlmIHdlIGNhbiBnZXQgaXQgZnJvbSBzdHlsZVxuICAgICAgICAgICAgdmFyIHN0eWxlV2lkdGggPSBnZXRTdHlsZVNpemUoIHN0eWxlLndpZHRoICk7XG4gICAgICAgICAgICBpZiAoIHN0eWxlV2lkdGggIT09IGZhbHNlICkge1xuICAgICAgICAgICAgICAgIHNpemUud2lkdGggPSBzdHlsZVdpZHRoICtcbiAgICAgICAgICAgICAgICAvLyBhZGQgcGFkZGluZyBhbmQgYm9yZGVyIHVubGVzcyBpdCdzIGFscmVhZHkgaW5jbHVkaW5nIGl0XG4gICAgICAgICAgICAgICAgKCBpc0JvcmRlckJveFNpemVPdXRlciA/IDAgOiBwYWRkaW5nV2lkdGggKyBib3JkZXJXaWR0aCApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgc3R5bGVIZWlnaHQgPSBnZXRTdHlsZVNpemUoIHN0eWxlLmhlaWdodCApO1xuICAgICAgICAgICAgaWYgKCBzdHlsZUhlaWdodCAhPT0gZmFsc2UgKSB7XG4gICAgICAgICAgICAgICAgc2l6ZS5oZWlnaHQgPSBzdHlsZUhlaWdodCArXG4gICAgICAgICAgICAgICAgLy8gYWRkIHBhZGRpbmcgYW5kIGJvcmRlciB1bmxlc3MgaXQncyBhbHJlYWR5IGluY2x1ZGluZyBpdFxuICAgICAgICAgICAgICAgICggaXNCb3JkZXJCb3hTaXplT3V0ZXIgPyAwIDogcGFkZGluZ0hlaWdodCArIGJvcmRlckhlaWdodCApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzaXplLmlubmVyV2lkdGggPSBzaXplLndpZHRoIC0gKCBwYWRkaW5nV2lkdGggKyBib3JkZXJXaWR0aCApO1xuICAgICAgICAgICAgc2l6ZS5pbm5lckhlaWdodCA9IHNpemUuaGVpZ2h0IC0gKCBwYWRkaW5nSGVpZ2h0ICsgYm9yZGVySGVpZ2h0ICk7XG5cbiAgICAgICAgICAgIHNpemUub3V0ZXJXaWR0aCA9IHNpemUud2lkdGggKyBtYXJnaW5XaWR0aDtcbiAgICAgICAgICAgIHNpemUub3V0ZXJIZWlnaHQgPSBzaXplLmhlaWdodCArIG1hcmdpbkhlaWdodDtcblxuICAgICAgICAgICAgcmV0dXJuIHNpemU7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZ2V0U2l6ZTtcblxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldEVsZW1lbnRTaXplKGVsZSkge1xuICAgICAgICByZXR1cm4gX2dldFNpemUoKShlbGUpO1xuICAgIH1cbn0pOyJdfQ==
