!function(t){var s;window.UIkit2&&(s=t(UIkit2)),"function"==typeof define&&define.amd&&define("uikit-nestable",["uikit"],function(){return s||t(UIkit2)})}(function(v){"use strict";var o,a="ontouchstart"in window,h=v.$html,E=[],i=v.$win,n=a?"touchstart":"mousedown",r=a?"touchmove":"mousemove",d=a?"touchend":"mouseup",p=a?"touchcancel":"mouseup";return v.component("nestable",{defaults:{listBaseClass:"uk-nestable",listClass:"uk-nestable-list",listItemClass:"uk-nestable-item",dragClass:"uk-nestable-dragged",movingClass:"uk-nestable-moving",noChildrenClass:"uk-nestable-nochildren",emptyClass:"uk-nestable-empty",handleClass:"",collapsedClass:"uk-collapsed",placeholderClass:"uk-nestable-placeholder",noDragClass:"uk-nestable-nodrag",group:!1,maxDepth:10,threshold:20,idlethreshold:10},boot:function(){v.$html.on("mousemove touchmove",function(t){if(o){var s=o.offset().top;s<v.$win.scrollTop()?v.$win.scrollTop(v.$win.scrollTop()-Math.ceil(o.height()/2)):s+o.height()>window.innerHeight+v.$win.scrollTop()&&v.$win.scrollTop(v.$win.scrollTop()+Math.ceil(o.height()/2))}}),v.ready(function(t){v.$("[data-uk-nestable]",t).each(function(){var t=v.$(this);t.data("nestable")||v.nestable(t,v.Utils.options(t.attr("data-uk-nestable")))})})},init:function(){var l=this;Object.keys(this.options).forEach(function(t){-1!=String(t).indexOf("Class")&&(l.options["_"+t]="."+l.options[t])}),this.find(this.options._listItemClass).find(">ul").addClass(this.options.listClass),this.checkEmptyList(),this.reset(),this.element.data("nestable-group",this.options.group||v.Utils.uid("nestable-group")),this.find(this.options._listItemClass).each(function(){l.setParent(v.$(this))}),this.on("click","[data-nestable-action]",function(t){if(!l.dragEl&&(a||0===t.button)){t.preventDefault();var s=v.$(t.currentTarget),e=s.data("nestableAction"),i=s.closest(l.options._listItemClass);"collapse"===e&&l.collapseItem(i),"expand"===e&&l.expandItem(i),"toggle"===e&&l.toggleItem(i)}});var t=function(s){var t=v.$(s.target),e=t.is("a[href]")?t:t.parents("a[href]");s.target!==l.element[0]&&(t.is(l.options._noDragClass)||t.closest(l.options._noDragClass).length||t.is("[data-nestable-action]")||t.closest("[data-nestable-action]").length||(l.options.handleClass&&!t.hasClass(l.options.handleClass)&&l.options.handleClass&&(t=t.closest(l.options._handleClass)),!t.length||l.dragEl||!a&&0!==s.button||a&&1!==s.touches.length||(s.originalEvent&&s.originalEvent.touches&&(s=evt.originalEvent.touches[0]),l.delayMove=function(t){e=!1,t.preventDefault(),l.dragStart(s),l.trigger("start.uk.nestable",[l]),l.delayMove=!1},l.delayMove.x=parseInt(s.pageX,10),l.delayMove.y=parseInt(s.pageY,10),l.delayMove.threshold=l.options.idlethreshold,e.length&&"touchend"==d&&l.one(d,function(){e&&e.attr("href").trim()&&(location.href=e.attr("href"))}),s.preventDefault())))},s=function(t){t.originalEvent&&t.originalEvent.touches&&(t=t.originalEvent.touches[0]),l.delayMove&&(Math.abs(t.pageX-l.delayMove.x)>l.delayMove.threshold||Math.abs(t.pageY-l.delayMove.y)>l.delayMove.threshold)&&(window.getSelection().toString()?l.delayMove=!1:l.delayMove(t)),l.dragEl&&(t.preventDefault(),l.dragMove(t),l.trigger("move.uk.nestable",[l]))},e=function(t){l.dragEl&&(t.preventDefault(),l.dragStop(a?t.touches[0]:t)),o=!1,l.delayMove=!1};a?(this.element[0].addEventListener(n,t,!1),window.addEventListener(r,s,!1),window.addEventListener(d,e,!1),window.addEventListener(p,e,!1)):(this.on(n,t),i.on(r,s),i.on(d,e))},serialize:function(){var r=this,d=function(t,o){var h=[];return t.children(r.options._listItemClass).each(function(){for(var t,s,e,i=v.$(this),l={},a=i.children(r.options._listClass),n=0;n<i[0].attributes.length;n++)0===(t=i[0].attributes[n]).name.indexOf("data-")&&(s=t.name.substr(5),e=v.Utils.str2json(t.value),l[s]=e||"false"==t.value||"0"==t.value?e:t.value);a.length&&(l.children=d(a,o+1)),h.push(l)}),h};return d(r.element,0)},list:function(n){var o=[],h=function(t,l,a){t.children(n._listItemClass).each(function(t){var s=v.$(this),e=v.$.extend({parent_id:a||null,depth:l,order:t},s.data()),i=s.children(n._listClass);o.push(e),i.length&&h(i,l+1,s.data(n.idProperty||"id"))})};return n=v.$.extend({},this.options,n),h(this.element,0),o},reset:function(){this.mouse={offsetX:0,offsetY:0,startX:0,startY:0,lastX:0,lastY:0,nowX:0,nowY:0,distX:0,distY:0,dirAx:0,dirX:0,dirY:0,lastDirX:0,lastDirY:0,distAxX:0,distAxY:0},this.moving=!1,this.dragEl=null,this.dragRootEl=null,this.dragDepth=0,this.hasNewRoot=!1,this.pointEl=null;for(var t=0;t<E.length;t++)this.checkEmptyList(E[t]);E=[]},toggleItem:function(t){this[t.hasClass(this.options.collapsedClass)?"expandItem":"collapseItem"](t)},expandItem:function(t){t.removeClass(this.options.collapsedClass)},collapseItem:function(t){t.children(this.options._listClass).length&&t.addClass(this.options.collapsedClass)},expandAll:function(){var t=this;this.find(t.options._listItemClass).each(function(){t.expandItem(v.$(this))})},collapseAll:function(){var t=this;this.find(t.options._listItemClass).each(function(){t.collapseItem(v.$(this))})},setParent:function(t){t.children(this.options._listClass).length&&t.addClass("uk-parent")},unsetParent:function(t){t.removeClass("uk-parent "+this.options.collapsedClass),t.children(this.options._listClass).remove()},dragStart:function(t){var s=this.mouse,e=v.$(t.target).closest(this.options._listItemClass),i=e.offset();this.placeEl=e,s.offsetX=t.pageX-i.left,s.offsetY=t.pageY-i.top,s.startX=s.lastX=i.left,s.startY=s.lastY=i.top,this.dragRootEl=this.element,this.dragEl=v.$("<ul></ul>").addClass(this.options.listClass+" "+this.options.dragClass).append(e.clone()),this.dragEl.css("width",e.width()),this.placeEl.addClass(this.options.placeholderClass),o=this.dragEl,this.tmpDragOnSiblings=[e[0].previousSibling,e[0].nextSibling],v.$body.append(this.dragEl),this.dragEl.css({left:i.left,top:i.top});var l,a,n=this.dragEl.find(this.options._listItemClass);for(l=0;l<n.length;l++)(a=v.$(n[l]).parents(this.options._listClass+","+this.options._listBaseClass).length)>this.dragDepth&&(this.dragDepth=a);h.addClass(this.options.movingClass)},dragStop:function(t){var s=v.$(this.placeEl),e=this.placeEl.parents(this.options._listBaseClass+":first");this.placeEl.removeClass(this.options.placeholderClass),this.dragEl.remove(),this.element[0]!==e[0]?(e.trigger("change.uk.nestable",[e.data("nestable"),s,"added"]),this.element.trigger("change.uk.nestable",[this,s,"removed"])):this.element.trigger("change.uk.nestable",[this,s,"moved"]),this.trigger("stop.uk.nestable",[this,s]),this.reset(),h.removeClass(this.options.movingClass)},dragMove:function(t){var s,e,i,l=this.options,a=this.mouse,n=this.dragRootEl?this.dragRootEl.data("nestable").options.maxDepth:l.maxDepth;this.dragEl.css({left:t.pageX-a.offsetX,top:t.pageY-a.offsetY}),a.lastX=a.nowX,a.lastY=a.nowY,a.nowX=t.pageX,a.nowY=t.pageY,a.distX=a.nowX-a.lastX,a.distY=a.nowY-a.lastY,a.lastDirX=a.dirX,a.lastDirY=a.dirY,a.dirX=0===a.distX?0:0<a.distX?1:-1,a.dirY=0===a.distY?0:0<a.distY?1:-1;var o=Math.abs(a.distX)>Math.abs(a.distY)?1:0;if(!a.moving)return a.dirAx=o,void(a.moving=!0);if(a.dirAx!==o?(a.distAxX=0,a.distAxY=0):(a.distAxX+=Math.abs(a.distX),0!==a.dirX&&a.dirX!==a.lastDirX&&(a.distAxX=0),a.distAxY+=Math.abs(a.distY),0!==a.dirY&&a.dirY!==a.lastDirY&&(a.distAxY=0)),a.dirAx=o,a.dirAx&&a.distAxX>=l.threshold&&(a.distAxX=0,i=this.placeEl.prev("li"),0<a.distX&&i.length&&!i.hasClass(l.collapsedClass)&&!i.hasClass(l.noChildrenClass)&&(s=i.find(l._listClass).last(),this.placeEl.parents(l._listClass+","+l._listBaseClass).length+this.dragDepth<=n&&(s.length?(s=i.children(l._listClass).last()).append(this.placeEl):((s=v.$("<ul/>").addClass(l.listClass)).append(this.placeEl),i.append(s),this.setParent(i)))),a.distX<0&&!this.placeEl.next(l._listItemClass).length)){var h=this.placeEl.closest([l._listBaseClass,l._listClass].join(",")),r=h.closest(l._listItemClass);r.length&&(r.after(this.placeEl),h.children().length||this.unsetParent(r))}var d=!1,p=t.pageX-(window.pageXOffset||document.scrollLeft||0),c=t.pageY-(window.pageYOffset||document.documentElement.scrollTop);if(this.pointEl=v.$(document.elementFromPoint(p,c)),l.handleClass&&this.pointEl.hasClass(l.handleClass))this.pointEl=this.pointEl.closest(l._listItemClass);else{var g=this.pointEl.closest(l._listItemClass);g.length&&(this.pointEl=g)}if(!this.placeEl.find(this.pointEl).length){if(this.pointEl.data("nestable")&&!this.pointEl.children().length)d=!0,this.checkEmptyList(this.pointEl);else if(!this.pointEl.length||!this.pointEl.hasClass(l.listItemClass))return;var u=this.element,f=this.pointEl.closest(this.options._listBaseClass),m=u[0]!=f[0];if(!a.dirAx||m||d){if(m&&l.group!==f.data("nestable-group"))return;if(E.push(u),n<this.dragDepth-1+this.pointEl.parents(l._listClass+","+l._listBaseClass).length)return;var C=t.pageY<this.pointEl.offset().top+this.pointEl.height()/2;e=this.placeEl.parent(),d?this.pointEl.append(this.placeEl):C?this.pointEl.before(this.placeEl):this.pointEl.after(this.placeEl),e.children().length||e.data("nestable")||this.unsetParent(e.parent()),this.checkEmptyList(this.dragRootEl),this.checkEmptyList(u),m&&(this.dragRootEl=f,this.hasNewRoot=this.element[0]!==this.dragRootEl[0])}}},checkEmptyList:function(t){t=t?v.$(t):this.element,this.options.emptyClass&&t[t.children().length?"removeClass":"addClass"](this.options.emptyClass)}}),v.nestable});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvbmVzdGFibGUuanMiXSwibmFtZXMiOlsiYWRkb24iLCJjb21wb25lbnQiLCJ3aW5kb3ciLCJVSWtpdDIiLCJkZWZpbmUiLCJhbWQiLCJVSSIsImRyYWdnaW5nRWxlbWVudCIsImhhc1RvdWNoIiwiaHRtbCIsIiRodG1sIiwidG91Y2hlZGxpc3RzIiwiJHdpbiIsImVTdGFydCIsImVNb3ZlIiwiZUVuZCIsImVDYW5jZWwiLCJkZWZhdWx0cyIsImxpc3RCYXNlQ2xhc3MiLCJsaXN0Q2xhc3MiLCJsaXN0SXRlbUNsYXNzIiwiZHJhZ0NsYXNzIiwibW92aW5nQ2xhc3MiLCJub0NoaWxkcmVuQ2xhc3MiLCJlbXB0eUNsYXNzIiwiaGFuZGxlQ2xhc3MiLCJjb2xsYXBzZWRDbGFzcyIsInBsYWNlaG9sZGVyQ2xhc3MiLCJub0RyYWdDbGFzcyIsImdyb3VwIiwibWF4RGVwdGgiLCJ0aHJlc2hvbGQiLCJpZGxldGhyZXNob2xkIiwiYm9vdCIsIm9uIiwiZSIsInRvcCIsIm9mZnNldCIsInNjcm9sbFRvcCIsIk1hdGgiLCJjZWlsIiwiaGVpZ2h0IiwiaW5uZXJIZWlnaHQiLCJyZWFkeSIsImNvbnRleHQiLCIkIiwiZWFjaCIsImVsZSIsInRoaXMiLCJkYXRhIiwibmVzdGFibGUiLCJVdGlscyIsIm9wdGlvbnMiLCJhdHRyIiwiaW5pdCIsIiR0aGlzIiwiT2JqZWN0Iiwia2V5cyIsImZvckVhY2giLCJrZXkiLCJTdHJpbmciLCJpbmRleE9mIiwiZmluZCIsIl9saXN0SXRlbUNsYXNzIiwiYWRkQ2xhc3MiLCJjaGVja0VtcHR5TGlzdCIsInJlc2V0IiwiZWxlbWVudCIsInVpZCIsInNldFBhcmVudCIsImRyYWdFbCIsImJ1dHRvbiIsInByZXZlbnREZWZhdWx0IiwidGFyZ2V0IiwiY3VycmVudFRhcmdldCIsImFjdGlvbiIsIml0ZW0iLCJjbG9zZXN0IiwiY29sbGFwc2VJdGVtIiwiZXhwYW5kSXRlbSIsInRvZ2dsZUl0ZW0iLCJvblN0YXJ0RXZlbnQiLCJoYW5kbGUiLCJsaW5rIiwiaXMiLCJwYXJlbnRzIiwiX25vRHJhZ0NsYXNzIiwibGVuZ3RoIiwiaGFzQ2xhc3MiLCJfaGFuZGxlQ2xhc3MiLCJ0b3VjaGVzIiwib3JpZ2luYWxFdmVudCIsImV2dCIsImRlbGF5TW92ZSIsImRyYWdTdGFydCIsInRyaWdnZXIiLCJ4IiwicGFyc2VJbnQiLCJwYWdlWCIsInkiLCJwYWdlWSIsIm9uZSIsInRyaW0iLCJsb2NhdGlvbiIsImhyZWYiLCJvbk1vdmVFdmVudCIsImFicyIsImdldFNlbGVjdGlvbiIsInRvU3RyaW5nIiwiZHJhZ01vdmUiLCJvbkVuZEV2ZW50IiwiZHJhZ1N0b3AiLCJhZGRFdmVudExpc3RlbmVyIiwic2VyaWFsaXplIiwibGlzdCIsInN0ZXAiLCJsZXZlbCIsImRlcHRoIiwiYXJyYXkiLCJjaGlsZHJlbiIsImF0dHJpYnV0ZSIsInZhbCIsImxpIiwic3ViIiwiX2xpc3RDbGFzcyIsImkiLCJhdHRyaWJ1dGVzIiwibmFtZSIsInN1YnN0ciIsInN0cjJqc29uIiwidmFsdWUiLCJwdXNoIiwicGFyZW50IiwiaW5kZXgiLCJleHRlbmQiLCJwYXJlbnRfaWQiLCJvcmRlciIsImlkUHJvcGVydHkiLCJtb3VzZSIsIm9mZnNldFgiLCJvZmZzZXRZIiwic3RhcnRYIiwic3RhcnRZIiwibGFzdFgiLCJsYXN0WSIsIm5vd1giLCJub3dZIiwiZGlzdFgiLCJkaXN0WSIsImRpckF4IiwiZGlyWCIsImRpclkiLCJsYXN0RGlyWCIsImxhc3REaXJZIiwiZGlzdEF4WCIsImRpc3RBeFkiLCJtb3ZpbmciLCJkcmFnUm9vdEVsIiwiZHJhZ0RlcHRoIiwiaGFzTmV3Um9vdCIsInBvaW50RWwiLCJyZW1vdmVDbGFzcyIsImV4cGFuZEFsbCIsImNvbGxhcHNlQWxsIiwidW5zZXRQYXJlbnQiLCJyZW1vdmUiLCJkcmFnSXRlbSIsInBsYWNlRWwiLCJsZWZ0IiwiYXBwZW5kIiwiY2xvbmUiLCJjc3MiLCJ3aWR0aCIsInRtcERyYWdPblNpYmxpbmdzIiwicHJldmlvdXNTaWJsaW5nIiwibmV4dFNpYmxpbmciLCIkYm9keSIsIml0ZW1zIiwiX2xpc3RCYXNlQ2xhc3MiLCJlbCIsInJvb3QiLCJwcmV2Iiwib3B0IiwibmV3QXgiLCJsYXN0IiwibmV4dCIsInBhcmVudFVsIiwiam9pbiIsInN1cnJvdW5kaW5nTGkiLCJhZnRlciIsImlzRW1wdHkiLCJwb2ludFgiLCJwYWdlWE9mZnNldCIsImRvY3VtZW50Iiwic2Nyb2xsTGVmdCIsInBvaW50WSIsInBhZ2VZT2Zmc2V0IiwiZG9jdW1lbnRFbGVtZW50IiwiZWxlbWVudEZyb21Qb2ludCIsIm5lc3RhYmxlaXRlbSIsInBvaW50RWxSb290IiwidG1wUm9vdCIsImlzTmV3Um9vdCIsImJlZm9yZSJdLCJtYXBwaW5ncyI6IkNBSUEsU0FBVUEsR0FFTixJQUFJQyxFQUVBQyxPQUFPQyxTQUNQRixFQUFZRCxFQUFNRyxTQUdELG1CQUFWQyxRQUF3QkEsT0FBT0MsS0FDdENELE9BQU8saUJBQWtCLENBQUMsU0FBVSxXQUNoQyxPQUFPSCxHQUFhRCxFQUFNRyxVQVZ0QyxDQWNHLFNBQVNHLEdBRVIsYUFFQSxJQUlJQyxFQUpBQyxFQUFlLGlCQUFrQk4sT0FDakNPLEVBQWVILEVBQUdJLE1BQ2xCQyxFQUFlLEdBQ2ZDLEVBQWVOLEVBQUdNLEtBR2xCQyxFQUFVTCxFQUFXLGFBQWdCLFlBQ3JDTSxFQUFVTixFQUFXLFlBQWdCLFlBQ3JDTyxFQUFVUCxFQUFXLFdBQWdCLFVBQ3JDUSxFQUFVUixFQUFXLGNBQWdCLFVBNG1CekMsT0F6bUJBRixFQUFHTCxVQUFVLFdBQVksQ0FFckJnQixTQUFVLENBQ05DLGNBQWtCLGNBQ2xCQyxVQUFrQixtQkFDbEJDLGNBQWtCLG1CQUNsQkMsVUFBa0Isc0JBQ2xCQyxZQUFrQixxQkFDbEJDLGdCQUFrQix5QkFDbEJDLFdBQWtCLG9CQUNsQkMsWUFBa0IsR0FDbEJDLGVBQWtCLGVBQ2xCQyxpQkFBa0IsMEJBQ2xCQyxZQUFrQixxQkFDbEJDLE9BQWtCLEVBQ2xCQyxTQUFrQixHQUNsQkMsVUFBa0IsR0FD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LE9BQVNxRCxHQUFhWixFQUFTLENBR3RDLEdBQUlZLEdBQWFwQixFQUFJekosUUFBVTRLLEVBQVF4SixLQUFLLGtCQUN4QyxPQVFKLEdBTkl0QyxFQUFhd0gsS0FBS3FFLEdBTVYxSyxFQUZKa0IsS0FBSzhHLFVBQVksRUFBSTlHLEtBQUtnSCxRQUFRM0UsUUFBUWlHLEVBQUkxRCxXQUFXLElBQUkwRCxFQUFJSixnQkFBZ0IzRixPQUdyRixPQUdKLElBQUlvSCxFQUFTeEssRUFBRWlFLE1BQVNwRCxLQUFLZ0gsUUFBUTNILFNBQVNELElBQU1ZLEtBQUtnSCxRQUFRdkgsU0FBVyxFQUU1RTJGLEVBQVNwRixLQUFLdUgsUUFBUW5DLFNBRWxCMEQsRUFDQTlJLEtBQUtnSCxRQUFRUyxPQUFPekgsS0FBS3VILFNBQ2xCb0MsRUFDUDNKLEtBQUtnSCxRQUFRMkMsT0FBTzNKLEtBQUt1SCxTQUV6QnZILEtBQUtnSCxRQUFRNkIsTUFBTTdJLEtBQUt1SCxTQUd2Qm5DLEVBQU9iLFdBQVdoQyxRQUNkNkMsRUFBT25GLEtBQUssYUFBYUQsS0FBS29ILFlBQVloQyxFQUFPQSxVQUcxRHBGLEtBQUtpQixlQUFlakIsS0FBSzZHLFlBQ3pCN0csS0FBS2lCLGVBQWV1SSxHQUdoQkUsSUFDQTFKLEtBQUs2RyxXQUFhNEMsRUFDbEJ6SixLQUFLK0csV0FBYS9HLEtBQUttQixRQUFRLEtBQU9uQixLQUFLNkcsV0FBVyxPQUtsRTVGLGVBQWdCLFNBQVNpRCxHQUVyQkEsRUFBUUEsRUFBTzVHLEVBQUd1QyxFQUFFcUUsR0FBUWxFLEtBQUttQixRQUU3Qm5CLEtBQUtJLFFBQVE1QixZQUNiMEYsRUFBTUEsRUFBS0ssV0FBV2hDLE9BQW9CLGNBQVgsWUFBMEJ2QyxLQUFLSSxRQUFRNUIsZUFNM0VsQixFQUFHNEMiLCJmaWxlIjoiY29tcG9uZW50cy9uZXN0YWJsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qISBVSWtpdCAyLjI3LjIgfCBodHRwOi8vd3d3LmdldHVpa2l0LmNvbSB8IChjKSAyMDE0IFlPT3RoZW1lIHwgTUlUIExpY2Vuc2UgKi9cbi8qXG4gKiBCYXNlZCBvbiBOZXN0YWJsZSBqUXVlcnkgUGx1Z2luIC0gQ29weXJpZ2h0IChjKSAyMDEyIERhdmlkIEJ1c2hlbGwgLSBodHRwOi8vZGJ1c2hlbGwuY29tL1xuICovXG4oZnVuY3Rpb24oYWRkb24pIHtcblxuICAgIHZhciBjb21wb25lbnQ7XG5cbiAgICBpZiAod2luZG93LlVJa2l0Mikge1xuICAgICAgICBjb21wb25lbnQgPSBhZGRvbihVSWtpdDIpO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgZGVmaW5lID09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xuICAgICAgICBkZWZpbmUoJ3Vpa2l0LW5lc3RhYmxlJywgWyd1aWtpdCddLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIGNvbXBvbmVudCB8fCBhZGRvbihVSWtpdDIpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbn0pKGZ1bmN0aW9uKFVJKSB7XG5cbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIHZhciBoYXNUb3VjaCAgICAgPSAnb250b3VjaHN0YXJ0JyBpbiB3aW5kb3csXG4gICAgICAgIGh0bWwgICAgICAgICA9IFVJLiRodG1sLFxuICAgICAgICB0b3VjaGVkbGlzdHMgPSBbXSxcbiAgICAgICAgJHdpbiAgICAgICAgID0gVUkuJHdpbixcbiAgICAgICAgZHJhZ2dpbmdFbGVtZW50O1xuXG4gICAgdmFyIGVTdGFydCAgPSBoYXNUb3VjaCA/ICd0b3VjaHN0YXJ0JyAgOiAnbW91c2Vkb3duJyxcbiAgICAgICAgZU1vdmUgICA9IGhhc1RvdWNoID8gJ3RvdWNobW92ZScgICA6ICdtb3VzZW1vdmUnLFxuICAgICAgICBlRW5kICAgID0gaGFzVG91Y2ggPyAndG91Y2hlbmQnICAgIDogJ21vdXNldXAnLFxuICAgICAgICBlQ2FuY2VsID0gaGFzVG91Y2ggPyAndG91Y2hjYW5jZWwnIDogJ21vdXNldXAnO1xuXG5cbiAgICBVSS5jb21wb25lbnQoJ25lc3RhYmxlJywge1xuXG4gICAgICAgIGRlZmF1bHRzOiB7XG4gICAgICAgICAgICBsaXN0QmFzZUNsYXNzICAgOiAndWstbmVzdGFibGUnLFxuICAgICAgICAgICAgbGlzdENsYXNzICAgICAgIDogJ3VrLW5lc3RhYmxlLWxpc3QnLFxuICAgICAgICAgICAgbGlzdEl0ZW1DbGFzcyAgIDogJ3VrLW5lc3RhYmxlLWl0ZW0nLFxuICAgICAgICAgICAgZHJhZ0NsYXNzICAgICAgIDogJ3VrLW5lc3RhYmxlLWRyYWdnZWQnLFxuICAgICAgICAgICAgbW92aW5nQ2xhc3MgICAgIDogJ3VrLW5lc3RhYmxlLW1vdmluZycsXG4gICAgICAgICAgICBub0NoaWxkcmVuQ2xhc3MgOiAndWstbmVzdGFibGUtbm9jaGlsZHJlbicsXG4gICAgICAgICAgICBlbXB0eUNsYXNzICAgICAgOiAndWstbmVzdGFibGUtZW1wdHknLFxuICAgICAgICAgICAgaGFuZGxlQ2xhc3MgICAgIDogJycsXG4gICAgICAgICAgICBjb2xsYXBzZWRDbGFzcyAgOiAndWstY29sbGFwc2VkJyxcbiAgICAgICAgICAgIHBsYWNlaG9sZGVyQ2xhc3M6ICd1ay1uZXN0YWJsZS1wbGFjZWhvbGRlcicsXG4gICAgICAgICAgICBub0RyYWdDbGFzcyAgICAgOiAndWstbmVzdGFibGUtbm9kcmFnJyxcbiAgICAgICAgICAgIGdyb3VwICAgICAgICAgICA6IGZhbHNlLFxuICAgICAgICAgICAgbWF4RGVwdGggICAgICAgIDogMTAsXG4gICAgICAgICAgICB0aHJlc2hvbGQgICAgICAgOiAyMCxcbiAgICAgICAgICAgIGlkbGV0aHJlc2hvbGQgICA6IDEwLFxuICAgICAgICB9LFxuXG4gICAgICAgIGJvb3Q6IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAvLyBhZGp1c3QgZG9jdW1lbnQgc2Nyb2xsaW5nXG4gICAgICAgICAgICBVSS4kaHRtbC5vbignbW91c2Vtb3ZlIHRvdWNobW92ZScsIGZ1bmN0aW9uKGUpIHtcblxuICAgICAgICAgICAgICAgIGlmIChkcmFnZ2luZ0VsZW1lbnQpIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgdG9wID0gZHJhZ2dpbmdFbGVtZW50Lm9mZnNldCgpLnRvcDtcblxuICAgICAgICAgICAgICAgICAgICBpZiAodG9wIDwgVUkuJHdpbi5zY3JvbGxUb3AoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgVUkuJHdpbi5zY3JvbGxUb3AoVUkuJHdpbi5zY3JvbGxUb3AoKSAtIE1hdGguY2VpbChkcmFnZ2luZ0VsZW1lbnQuaGVpZ2h0KCkvMikpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCAodG9wICsgZHJhZ2dpbmdFbGVtZW50LmhlaWdodCgpKSA+ICh3aW5kb3cuaW5uZXJIZWlnaHQgKyBVSS4kd2luLnNjcm9sbFRvcCgpKSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFVJLiR3aW4uc2Nyb2xsVG9wKFVJLiR3aW4uc2Nyb2xsVG9wKCkgKyBNYXRoLmNlaWwoZHJhZ2dpbmdFbGVtZW50LmhlaWdodCgpLzIpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBpbml0IGNvZGVcbiAgICAgICAgICAgIFVJLnJlYWR5KGZ1bmN0aW9uKGNvbnRleHQpIHtcblxuICAgICAgICAgICAgICAgIFVJLiQoXCJbZGF0YS11ay1uZXN0YWJsZV1cIiwgY29udGV4dCkuZWFjaChmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBlbGUgPSBVSS4kKHRoaXMpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICghZWxlLmRhdGEoXCJuZXN0YWJsZVwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgVUkubmVzdGFibGUoZWxlLCBVSS5VdGlscy5vcHRpb25zKGVsZS5hdHRyKFwiZGF0YS11ay1uZXN0YWJsZVwiKSkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBpbml0OiBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgdmFyICR0aGlzID0gdGhpcztcblxuICAgICAgICAgICAgT2JqZWN0LmtleXModGhpcy5vcHRpb25zKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSl7XG5cbiAgICAgICAgICAgICAgICBpZihTdHJpbmcoa2V5KS5pbmRleE9mKCdDbGFzcycpIT0tMSkge1xuICAgICAgICAgICAgICAgICAgICAkdGhpcy5vcHRpb25zWydfJytrZXldID0gJy4nICsgJHRoaXMub3B0aW9uc1trZXldO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLmZpbmQodGhpcy5vcHRpb25zLl9saXN0SXRlbUNsYXNzKS5maW5kKFwiPnVsXCIpLmFkZENsYXNzKHRoaXMub3B0aW9ucy5saXN0Q2xhc3MpO1xuXG4gICAgICAgICAgICB0aGlzLmNoZWNrRW1wdHlMaXN0KCk7XG5cbiAgICAgICAgICAgIHRoaXMucmVzZXQoKTtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5kYXRhKCduZXN0YWJsZS1ncm91cCcsIHRoaXMub3B0aW9ucy5ncm91cCB8fCBVSS5VdGlscy51aWQoJ25lc3RhYmxlLWdyb3VwJykpO1xuXG4gICAgICAgICAgICB0aGlzLmZpbmQodGhpcy5vcHRpb25zLl9saXN0SXRlbUNsYXNzKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICR0aGlzLnNldFBhcmVudChVSS4kKHRoaXMpKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLm9uKCdjbGljaycsICdbZGF0YS1uZXN0YWJsZS1hY3Rpb25dJywgZnVuY3Rpb24oZSkge1xuXG4gICAgICAgICAgICAgICAgaWYgKCR0aGlzLmRyYWdFbCB8fCAoIWhhc1RvdWNoICYmIGUuYnV0dG9uICE9PSAwKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAgICAgdmFyIHRhcmdldCA9IFVJLiQoZS5jdXJyZW50VGFyZ2V0KSxcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gdGFyZ2V0LmRhdGEoJ25lc3RhYmxlQWN0aW9uJyksXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0gICA9IHRhcmdldC5jbG9zZXN0KCR0aGlzLm9wdGlvbnMuX2xpc3RJdGVtQ2xhc3MpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGFjdGlvbiA9PT0gJ2NvbGxhcHNlJykge1xuICAgICAgICAgICAgICAgICAgICAkdGhpcy5jb2xsYXBzZUl0ZW0oaXRlbSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChhY3Rpb24gPT09ICdleHBhbmQnKSB7XG4gICAgICAgICAgICAgICAgICAgICR0aGlzLmV4cGFuZEl0ZW0oaXRlbSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChhY3Rpb24gPT09ICd0b2dnbGUnKSB7XG4gICAgICAgICAgICAgICAgICAgICR0aGlzLnRvZ2dsZUl0ZW0oaXRlbSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHZhciBvblN0YXJ0RXZlbnQgPSBmdW5jdGlvbihlKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgaGFuZGxlID0gVUkuJChlLnRhcmdldCksXG4gICAgICAgICAgICAgICAgICAgIGxpbmsgICA9IGhhbmRsZS5pcygnYVtocmVmXScpID8gaGFuZGxlOmhhbmRsZS5wYXJlbnRzKCdhW2hyZWZdJyk7XG5cbiAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXQgPT09ICR0aGlzLmVsZW1lbnRbMF0pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChoYW5kbGUuaXMoJHRoaXMub3B0aW9ucy5fbm9EcmFnQ2xhc3MpIHx8IGhhbmRsZS5jbG9zZXN0KCR0aGlzLm9wdGlvbnMuX25vRHJhZ0NsYXNzKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChoYW5kbGUuaXMoJ1tkYXRhLW5lc3RhYmxlLWFjdGlvbl0nKSB8fCBoYW5kbGUuY2xvc2VzdCgnW2RhdGEtbmVzdGFibGUtYWN0aW9uXScpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKCR0aGlzLm9wdGlvbnMuaGFuZGxlQ2xhc3MgJiYgIWhhbmRsZS5oYXNDbGFzcygkdGhpcy5vcHRpb25zLmhhbmRsZUNsYXNzKSkge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy5vcHRpb25zLmhhbmRsZUNsYXNzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGUgPSBoYW5kbGUuY2xvc2VzdCgkdGhpcy5vcHRpb25zLl9oYW5kbGVDbGFzcyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoIWhhbmRsZS5sZW5ndGggfHwgJHRoaXMuZHJhZ0VsIHx8ICghaGFzVG91Y2ggJiYgZS5idXR0b24gIT09IDApIHx8IChoYXNUb3VjaCAmJiBlLnRvdWNoZXMubGVuZ3RoICE9PSAxKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGUub3JpZ2luYWxFdmVudCAmJiBlLm9yaWdpbmFsRXZlbnQudG91Y2hlcykge1xuICAgICAgICAgICAgICAgICAgICBlID0gZXZ0Lm9yaWdpbmFsRXZlbnQudG91Y2hlc1swXTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAkdGhpcy5kZWxheU1vdmUgPSBmdW5jdGlvbihldnQpIHtcblxuICAgICAgICAgICAgICAgICAgICBsaW5rID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICR0aGlzLmRyYWdTdGFydChlKTtcbiAgICAgICAgICAgICAgICAgICAgJHRoaXMudHJpZ2dlcignc3RhcnQudWsubmVzdGFibGUnLCBbJHRoaXNdKTtcblxuICAgICAgICAgICAgICAgICAgICAkdGhpcy5kZWxheU1vdmUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgJHRoaXMuZGVsYXlNb3ZlLnggICAgICAgICA9IHBhcnNlSW50KGUucGFnZVgsIDEwKTtcbiAgICAgICAgICAgICAgICAkdGhpcy5kZWxheU1vdmUueSAgICAgICAgID0gcGFyc2VJbnQoZS5wYWdlWSwgMTApO1xuICAgICAgICAgICAgICAgICR0aGlzLmRlbGF5TW92ZS50aHJlc2hvbGQgPSAkdGhpcy5vcHRpb25zLmlkbGV0aHJlc2hvbGQ7XG5cbiAgICAgICAgICAgICAgICBpZiAobGluay5sZW5ndGggJiYgZUVuZCA9PSAndG91Y2hlbmQnKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgJHRoaXMub25lKGVFbmQsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobGluayAmJiBsaW5rLmF0dHIoJ2hyZWYnKS50cmltKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbi5ocmVmID0gbGluay5hdHRyKCdocmVmJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvbk1vdmVFdmVudCA9IGZ1bmN0aW9uKGUpIHtcblxuICAgICAgICAgICAgICAgIGlmIChlLm9yaWdpbmFsRXZlbnQgJiYgZS5vcmlnaW5hbEV2ZW50LnRvdWNoZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgZSA9IGUub3JpZ2luYWxFdmVudC50b3VjaGVzWzBdO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICgkdGhpcy5kZWxheU1vdmUgJiYgKE1hdGguYWJzKGUucGFnZVggLSAkdGhpcy5kZWxheU1vdmUueCkgPiAkdGhpcy5kZWxheU1vdmUudGhyZXNob2xkIHx8IE1hdGguYWJzKGUucGFnZVkgLSAkdGhpcy5kZWxheU1vdmUueSkgPiAkdGhpcy5kZWxheU1vdmUudGhyZXNob2xkKSkge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICghd2luZG93LmdldFNlbGVjdGlvbigpLnRvU3RyaW5nKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLmRlbGF5TW92ZShlKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLmRlbGF5TW92ZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKCR0aGlzLmRyYWdFbCkge1xuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICR0aGlzLmRyYWdNb3ZlKGUpO1xuICAgICAgICAgICAgICAgICAgICAkdGhpcy50cmlnZ2VyKCdtb3ZlLnVrLm5lc3RhYmxlJywgWyR0aGlzXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uRW5kRXZlbnQgPSBmdW5jdGlvbihlKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoJHRoaXMuZHJhZ0VsKSB7XG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgJHRoaXMuZHJhZ1N0b3AoaGFzVG91Y2ggPyBlLnRvdWNoZXNbMF0gOiBlKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBkcmFnZ2luZ0VsZW1lbnQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAkdGhpcy5kZWxheU1vdmUgPSBmYWxzZTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmIChoYXNUb3VjaCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudFswXS5hZGRFdmVudExpc3RlbmVyKGVTdGFydCwgb25TdGFydEV2ZW50LCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoZU1vdmUsIG9uTW92ZUV2ZW50LCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoZUVuZCwgb25FbmRFdmVudCwgZmFsc2UpO1xuICAgICAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKGVDYW5jZWwsIG9uRW5kRXZlbnQsIGZhbHNlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vbihlU3RhcnQsIG9uU3RhcnRFdmVudCk7XG4gICAgICAgICAgICAgICAgJHdpbi5vbihlTW92ZSwgb25Nb3ZlRXZlbnQpO1xuICAgICAgICAgICAgICAgICR3aW4ub24oZUVuZCwgb25FbmRFdmVudCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSxcblxuICAgICAgICBzZXJpYWxpemU6IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICB2YXIgZGF0YSxcbiAgICAgICAgICAgICAgICBkZXB0aCA9IDAsXG4gICAgICAgICAgICAgICAgbGlzdCAgPSB0aGlzLFxuICAgICAgICAgICAgICAgIHN0ZXAgID0gZnVuY3Rpb24obGV2ZWwsIGRlcHRoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGFycmF5ID0gWyBdLCBpdGVtcyA9IGxldmVsLmNoaWxkcmVuKGxpc3Qub3B0aW9ucy5fbGlzdEl0ZW1DbGFzcyk7XG5cbiAgICAgICAgICAgICAgICAgICAgaXRlbXMuZWFjaChmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxpICAgID0gVUkuJCh0aGlzKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtICA9IHt9LCBhdHRyaWJ1dGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ViICAgPSBsaS5jaGlsZHJlbihsaXN0Lm9wdGlvbnMuX2xpc3RDbGFzcyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBhdHRyLCB2YWw7IGkgPCBsaVswXS5hdHRyaWJ1dGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlID0gbGlbMF0uYXR0cmlidXRlc1tpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXR0cmlidXRlLm5hbWUuaW5kZXhPZignZGF0YS0nKSA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRyICAgICAgID0gYXR0cmlidXRlLm5hbWUuc3Vic3RyKDUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWwgICAgICAgID0gIFVJLlV0aWxzLnN0cjJqc29uKGF0dHJpYnV0ZS52YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1bYXR0cl0gPSAodmFsIHx8IGF0dHJpYnV0ZS52YWx1ZT09J2ZhbHNlJyB8fCBhdHRyaWJ1dGUudmFsdWU9PScwJykgPyB2YWw6YXR0cmlidXRlLnZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN1Yi5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmNoaWxkcmVuID0gc3RlcChzdWIsIGRlcHRoICsgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGFycmF5LnB1c2goaXRlbSk7XG5cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhcnJheTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBkYXRhID0gc3RlcChsaXN0LmVsZW1lbnQsIGRlcHRoKTtcblxuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgIH0sXG5cbiAgICAgICAgbGlzdDogZnVuY3Rpb24ob3B0aW9ucykge1xuXG4gICAgICAgICAgICB2YXIgZGF0YSAgPSBbXSxcbiAgICAgICAgICAgICAgICBsaXN0ICA9IHRoaXMsXG4gICAgICAgICAgICAgICAgZGVwdGggPSAwLFxuICAgICAgICAgICAgICAgIHN0ZXAgID0gZnVuY3Rpb24obGV2ZWwsIGRlcHRoLCBwYXJlbnQpIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbXMgPSBsZXZlbC5jaGlsZHJlbihvcHRpb25zLl9saXN0SXRlbUNsYXNzKTtcblxuICAgICAgICAgICAgICAgICAgICBpdGVtcy5lYWNoKGZ1bmN0aW9uKGluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbGkgICA9IFVJLiQodGhpcyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbSA9IFVJLiQuZXh0ZW5kKHtwYXJlbnRfaWQ6IChwYXJlbnQgPyBwYXJlbnQgOiBudWxsKSwgZGVwdGg6IGRlcHRoLCBvcmRlcjogaW5kZXh9LCBsaS5kYXRhKCkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YiAgPSBsaS5jaGlsZHJlbihvcHRpb25zLl9saXN0Q2xhc3MpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnB1c2goaXRlbSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdWIubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RlcChzdWIsIGRlcHRoICsgMSwgbGkuZGF0YShvcHRpb25zLmlkUHJvcGVydHkgfHwgJ2lkJykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBvcHRpb25zID0gVUkuJC5leHRlbmQoe30sIGxpc3Qub3B0aW9ucywgb3B0aW9ucyk7XG5cbiAgICAgICAgICAgIHN0ZXAobGlzdC5lbGVtZW50LCBkZXB0aCk7XG5cbiAgICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlc2V0OiBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgdGhpcy5tb3VzZSA9IHtcbiAgICAgICAgICAgICAgICBvZmZzZXRYICAgOiAwLFxuICAgICAgICAgICAgICAgIG9mZnNldFkgICA6IDAsXG4gICAgICAgICAgICAgICAgc3RhcnRYICAgIDogMCxcbiAgICAgICAgICAgICAgICBzdGFydFkgICAgOiAwLFxuICAgICAgICAgICAgICAgIGxhc3RYICAgICA6IDAsXG4gICAgICAgICAgICAgICAgbGFzdFkgICAgIDogMCxcbiAgICAgICAgICAgICAgICBub3dYICAgICAgOiAwLFxuICAgICAgICAgICAgICAgIG5vd1kgICAgICA6IDAsXG4gICAgICAgICAgICAgICAgZGlzdFggICAgIDogMCxcbiAgICAgICAgICAgICAgICBkaXN0WSAgICAgOiAwLFxuICAgICAgICAgICAgICAgIGRpckF4ICAgICA6IDAsXG4gICAgICAgICAgICAgICAgZGlyWCAgICAgIDogMCxcbiAgICAgICAgICAgICAgICBkaXJZICAgICAgOiAwLFxuICAgICAgICAgICAgICAgIGxhc3REaXJYICA6IDAsXG4gICAgICAgICAgICAgICAgbGFzdERpclkgIDogMCxcbiAgICAgICAgICAgICAgICBkaXN0QXhYICAgOiAwLFxuICAgICAgICAgICAgICAgIGRpc3RBeFkgICA6IDBcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB0aGlzLm1vdmluZyAgICAgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuZHJhZ0VsICAgICA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmRyYWdSb290RWwgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5kcmFnRGVwdGggID0gMDtcbiAgICAgICAgICAgIHRoaXMuaGFzTmV3Um9vdCA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5wb2ludEVsICAgID0gbnVsbDtcblxuICAgICAgICAgICAgZm9yICh2YXIgaT0wOyBpPHRvdWNoZWRsaXN0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tFbXB0eUxpc3QodG91Y2hlZGxpc3RzW2ldKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdG91Y2hlZGxpc3RzID0gW107XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9nZ2xlSXRlbTogZnVuY3Rpb24obGkpIHtcbiAgICAgICAgICAgIHRoaXNbbGkuaGFzQ2xhc3ModGhpcy5vcHRpb25zLmNvbGxhcHNlZENsYXNzKSA/ICdleHBhbmRJdGVtJzonY29sbGFwc2VJdGVtJ10obGkpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGV4cGFuZEl0ZW06IGZ1bmN0aW9uKGxpKSB7XG4gICAgICAgICAgICBsaS5yZW1vdmVDbGFzcyh0aGlzLm9wdGlvbnMuY29sbGFwc2VkQ2xhc3MpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNvbGxhcHNlSXRlbTogZnVuY3Rpb24obGkpIHtcbiAgICAgICAgICAgIHZhciBsaXN0cyA9IGxpLmNoaWxkcmVuKHRoaXMub3B0aW9ucy5fbGlzdENsYXNzKTtcbiAgICAgICAgICAgIGlmIChsaXN0cy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBsaS5hZGRDbGFzcyh0aGlzLm9wdGlvbnMuY29sbGFwc2VkQ2xhc3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGV4cGFuZEFsbDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgbGlzdCA9IHRoaXM7XG4gICAgICAgICAgICB0aGlzLmZpbmQobGlzdC5vcHRpb25zLl9saXN0SXRlbUNsYXNzKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGxpc3QuZXhwYW5kSXRlbShVSS4kKHRoaXMpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNvbGxhcHNlQWxsOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBsaXN0ID0gdGhpcztcbiAgICAgICAgICAgIHRoaXMuZmluZChsaXN0Lm9wdGlvbnMuX2xpc3RJdGVtQ2xhc3MpLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgbGlzdC5jb2xsYXBzZUl0ZW0oVUkuJCh0aGlzKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBzZXRQYXJlbnQ6IGZ1bmN0aW9uKGxpKSB7XG5cbiAgICAgICAgICAgIGlmIChsaS5jaGlsZHJlbih0aGlzLm9wdGlvbnMuX2xpc3RDbGFzcykubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgbGkuYWRkQ2xhc3MoJ3VrLXBhcmVudCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHVuc2V0UGFyZW50OiBmdW5jdGlvbihsaSkge1xuICAgICAgICAgICAgbGkucmVtb3ZlQ2xhc3MoJ3VrLXBhcmVudCAnK3RoaXMub3B0aW9ucy5jb2xsYXBzZWRDbGFzcyk7XG4gICAgICAgICAgICBsaS5jaGlsZHJlbih0aGlzLm9wdGlvbnMuX2xpc3RDbGFzcykucmVtb3ZlKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZHJhZ1N0YXJ0OiBmdW5jdGlvbihlKSB7XG5cbiAgICAgICAgICAgIHZhciBtb3VzZSAgICA9IHRoaXMubW91c2UsXG4gICAgICAgICAgICAgICAgdGFyZ2V0ICAgPSBVSS4kKGUudGFyZ2V0KSxcbiAgICAgICAgICAgICAgICBkcmFnSXRlbSA9IHRhcmdldC5jbG9zZXN0KHRoaXMub3B0aW9ucy5fbGlzdEl0ZW1DbGFzcyksXG4gICAgICAgICAgICAgICAgb2Zmc2V0ICAgPSBkcmFnSXRlbS5vZmZzZXQoKTtcblxuICAgICAgICAgICAgdGhpcy5wbGFjZUVsID0gZHJhZ0l0ZW07XG5cbiAgICAgICAgICAgIG1vdXNlLm9mZnNldFggPSBlLnBhZ2VYIC0gb2Zmc2V0LmxlZnQ7XG4gICAgICAgICAgICBtb3VzZS5vZmZzZXRZID0gZS5wYWdlWSAtIG9mZnNldC50b3A7XG5cbiAgICAgICAgICAgIG1vdXNlLnN0YXJ0WCA9IG1vdXNlLmxhc3RYID0gb2Zmc2V0LmxlZnQ7XG4gICAgICAgICAgICBtb3VzZS5zdGFydFkgPSBtb3VzZS5sYXN0WSA9IG9mZnNldC50b3A7XG5cbiAgICAgICAgICAgIHRoaXMuZHJhZ1Jvb3RFbCA9IHRoaXMuZWxlbWVudDtcblxuICAgICAgICAgICAgdGhpcy5kcmFnRWwgPSBVSS4kKCc8dWw+PC91bD4nKS5hZGRDbGFzcyh0aGlzLm9wdGlvbnMubGlzdENsYXNzICsgJyAnICsgdGhpcy5vcHRpb25zLmRyYWdDbGFzcykuYXBwZW5kKGRyYWdJdGVtLmNsb25lKCkpO1xuICAgICAgICAgICAgdGhpcy5kcmFnRWwuY3NzKCd3aWR0aCcsIGRyYWdJdGVtLndpZHRoKCkpO1xuICAgICAgICAgICAgdGhpcy5wbGFjZUVsLmFkZENsYXNzKHRoaXMub3B0aW9ucy5wbGFjZWhvbGRlckNsYXNzKTtcblxuICAgICAgICAgICAgZHJhZ2dpbmdFbGVtZW50ID0gdGhpcy5kcmFnRWw7XG5cbiAgICAgICAgICAgIHRoaXMudG1wRHJhZ09uU2libGluZ3MgPSBbZHJhZ0l0ZW1bMF0ucHJldmlvdXNTaWJsaW5nLCBkcmFnSXRlbVswXS5uZXh0U2libGluZ107XG5cbiAgICAgICAgICAgIFVJLiRib2R5LmFwcGVuZCh0aGlzLmRyYWdFbCk7XG5cbiAgICAgICAgICAgIHRoaXMuZHJhZ0VsLmNzcyh7XG4gICAgICAgICAgICAgICAgbGVmdCA6IG9mZnNldC5sZWZ0LFxuICAgICAgICAgICAgICAgIHRvcCAgOiBvZmZzZXQudG9wXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gdG90YWwgZGVwdGggb2YgZHJhZ2dpbmcgaXRlbVxuICAgICAgICAgICAgdmFyIGksIGRlcHRoLCBpdGVtcyA9IHRoaXMuZHJhZ0VsLmZpbmQodGhpcy5vcHRpb25zLl9saXN0SXRlbUNsYXNzKTtcblxuICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgZGVwdGggPSBVSS4kKGl0ZW1zW2ldKS5wYXJlbnRzKHRoaXMub3B0aW9ucy5fbGlzdENsYXNzKycsJyt0aGlzLm9wdGlvbnMuX2xpc3RCYXNlQ2xhc3MpLmxlbmd0aDtcbiAgICAgICAgICAgICAgICBpZiAoZGVwdGggPiB0aGlzLmRyYWdEZXB0aCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRyYWdEZXB0aCA9IGRlcHRoO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaHRtbC5hZGRDbGFzcyh0aGlzLm9wdGlvbnMubW92aW5nQ2xhc3MpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGRyYWdTdG9wOiBmdW5jdGlvbihlKSB7XG5cbiAgICAgICAgICAgIHZhciBlbCAgICAgICA9IFVJLiQodGhpcy5wbGFjZUVsKSxcbiAgICAgICAgICAgICAgICByb290ICAgICA9IHRoaXMucGxhY2VFbC5wYXJlbnRzKHRoaXMub3B0aW9ucy5fbGlzdEJhc2VDbGFzcysnOmZpcnN0Jyk7XG5cbiAgICAgICAgICAgIHRoaXMucGxhY2VFbC5yZW1vdmVDbGFzcyh0aGlzLm9wdGlvbnMucGxhY2Vob2xkZXJDbGFzcyk7XG4gICAgICAgICAgICB0aGlzLmRyYWdFbC5yZW1vdmUoKTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuZWxlbWVudFswXSAhPT0gcm9vdFswXSkge1xuXG4gICAgICAgICAgICAgICAgcm9vdC50cmlnZ2VyKCdjaGFuZ2UudWsubmVzdGFibGUnLFtyb290LmRhdGEoJ25lc3RhYmxlJyksIGVsLCAnYWRkZWQnXSk7XG4gICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LnRyaWdnZXIoJ2NoYW5nZS51ay5uZXN0YWJsZScsIFt0aGlzLCBlbCwgJ3JlbW92ZWQnXSk7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LnRyaWdnZXIoJ2NoYW5nZS51ay5uZXN0YWJsZScsW3RoaXMsIGVsLCBcIm1vdmVkXCJdKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCdzdG9wLnVrLm5lc3RhYmxlJywgW3RoaXMsIGVsXSk7XG5cbiAgICAgICAgICAgIHRoaXMucmVzZXQoKTtcblxuICAgICAgICAgICAgaHRtbC5yZW1vdmVDbGFzcyh0aGlzLm9wdGlvbnMubW92aW5nQ2xhc3MpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGRyYWdNb3ZlOiBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICB2YXIgbGlzdCwgcGFyZW50LCBwcmV2LCBuZXh0LCBkZXB0aCxcbiAgICAgICAgICAgICAgICBvcHQgICAgICA9IHRoaXMub3B0aW9ucyxcbiAgICAgICAgICAgICAgICBtb3VzZSAgICA9IHRoaXMubW91c2UsXG4gICAgICAgICAgICAgICAgbWF4RGVwdGggPSB0aGlzLmRyYWdSb290RWwgPyB0aGlzLmRyYWdSb290RWwuZGF0YSgnbmVzdGFibGUnKS5vcHRpb25zLm1heERlcHRoIDogb3B0Lm1heERlcHRoO1xuXG4gICAgICAgICAgICB0aGlzLmRyYWdFbC5jc3Moe1xuICAgICAgICAgICAgICAgIGxlZnQgOiBlLnBhZ2VYIC0gbW91c2Uub2Zmc2V0WCxcbiAgICAgICAgICAgICAgICB0b3AgIDogZS5wYWdlWSAtIG1vdXNlLm9mZnNldFlcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBtb3VzZSBwb3NpdGlvbiBsYXN0IGV2ZW50c1xuICAgICAgICAgICAgbW91c2UubGFzdFggPSBtb3VzZS5ub3dYO1xuICAgICAgICAgICAgbW91c2UubGFzdFkgPSBtb3VzZS5ub3dZO1xuICAgICAgICAgICAgLy8gbW91c2UgcG9zaXRpb24gdGhpcyBldmVudHNcbiAgICAgICAgICAgIG1vdXNlLm5vd1ggID0gZS5wYWdlWDtcbiAgICAgICAgICAgIG1vdXNlLm5vd1kgID0gZS5wYWdlWTtcbiAgICAgICAgICAgIC8vIGRpc3RhbmNlIG1vdXNlIG1vdmVkIGJldHdlZW4gZXZlbnRzXG4gICAgICAgICAgICBtb3VzZS5kaXN0WCA9IG1vdXNlLm5vd1ggLSBtb3VzZS5sYXN0WDtcbiAgICAgICAgICAgIG1vdXNlLmRpc3RZID0gbW91c2Uubm93WSAtIG1vdXNlLmxhc3RZO1xuICAgICAgICAgICAgLy8gZGlyZWN0aW9uIG1vdXNlIHdhcyBtb3ZpbmdcbiAgICAgICAgICAgIG1vdXNlLmxhc3REaXJYID0gbW91c2UuZGlyWDtcbiAgICAgICAgICAgIG1vdXNlLmxhc3REaXJZID0gbW91c2UuZGlyWTtcbiAgICAgICAgICAgIC8vIGRpcmVjdGlvbiBtb3VzZSBpcyBub3cgbW92aW5nIChvbiBib3RoIGF4aXMpXG4gICAgICAgICAgICBtb3VzZS5kaXJYID0gbW91c2UuZGlzdFggPT09IDAgPyAwIDogbW91c2UuZGlzdFggPiAwID8gMSA6IC0xO1xuICAgICAgICAgICAgbW91c2UuZGlyWSA9IG1vdXNlLmRpc3RZID09PSAwID8gMCA6IG1vdXNlLmRpc3RZID4gMCA/IDEgOiAtMTtcbiAgICAgICAgICAgIC8vIGF4aXMgbW91c2UgaXMgbm93IG1vdmluZyBvblxuICAgICAgICAgICAgdmFyIG5ld0F4ICAgPSBNYXRoLmFicyhtb3VzZS5kaXN0WCkgPiBNYXRoLmFicyhtb3VzZS5kaXN0WSkgPyAxIDogMDtcblxuICAgICAgICAgICAgLy8gZG8gbm90aGluZyBvbiBmaXJzdCBtb3ZlXG4gICAgICAgICAgICBpZiAoIW1vdXNlLm1vdmluZykge1xuICAgICAgICAgICAgICAgIG1vdXNlLmRpckF4ICA9IG5ld0F4O1xuICAgICAgICAgICAgICAgIG1vdXNlLm1vdmluZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBjYWxjIGRpc3RhbmNlIG1vdmVkIG9uIHRoaXMgYXhpcyAoYW5kIGRpcmVjdGlvbilcbiAgICAgICAgICAgIGlmIChtb3VzZS5kaXJBeCAhPT0gbmV3QXgpIHtcbiAgICAgICAgICAgICAgICBtb3VzZS5kaXN0QXhYID0gMDtcbiAgICAgICAgICAgICAgICBtb3VzZS5kaXN0QXhZID0gMDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbW91c2UuZGlzdEF4WCArPSBNYXRoLmFicyhtb3VzZS5kaXN0WCk7XG4gICAgICAgICAgICAgICAgaWYgKG1vdXNlLmRpclggIT09IDAgJiYgbW91c2UuZGlyWCAhPT0gbW91c2UubGFzdERpclgpIHtcbiAgICAgICAgICAgICAgICAgICAgbW91c2UuZGlzdEF4WCA9IDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG1vdXNlLmRpc3RBeFkgKz0gTWF0aC5hYnMobW91c2UuZGlzdFkpO1xuICAgICAgICAgICAgICAgIGlmIChtb3VzZS5kaXJZICE9PSAwICYmIG1vdXNlLmRpclkgIT09IG1vdXNlLmxhc3REaXJZKSB7XG4gICAgICAgICAgICAgICAgICAgIG1vdXNlLmRpc3RBeFkgPSAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1vdXNlLmRpckF4ID0gbmV3QXg7XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogbW92ZSBob3Jpem9udGFsXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGlmIChtb3VzZS5kaXJBeCAmJiBtb3VzZS5kaXN0QXhYID49IG9wdC50aHJlc2hvbGQpIHtcbiAgICAgICAgICAgICAgICAvLyByZXNldCBtb3ZlIGRpc3RhbmNlIG9uIHgtYXhpcyBmb3IgbmV3IHBoYXNlXG4gICAgICAgICAgICAgICAgbW91c2UuZGlzdEF4WCA9IDA7XG4gICAgICAgICAgICAgICAgcHJldiA9IHRoaXMucGxhY2VFbC5wcmV2KCdsaScpO1xuXG4gICAgICAgICAgICAgICAgLy8gaW5jcmVhc2UgaG9yaXpvbnRhbCBsZXZlbCBpZiBwcmV2aW91cyBzaWJsaW5nIGV4aXN0cywgaXMgbm90IGNvbGxhcHNlZCwgYW5kIGRvZXMgbm90IGhhdmUgYSAnbm8gY2hpbGRyZW4nIGNsYXNzXG4gICAgICAgICAgICAgICAgaWYgKG1vdXNlLmRpc3RYID4gMCAmJiBwcmV2Lmxlbmd0aCAmJiAhcHJldi5oYXNDbGFzcyhvcHQuY29sbGFwc2VkQ2xhc3MpICYmICFwcmV2Lmhhc0NsYXNzKG9wdC5ub0NoaWxkcmVuQ2xhc3MpKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gY2Fubm90IGluY3JlYXNlIGxldmVsIHdoZW4gaXRlbSBhYm92ZSBpcyBjb2xsYXBzZWRcbiAgICAgICAgICAgICAgICAgICAgbGlzdCA9IHByZXYuZmluZChvcHQuX2xpc3RDbGFzcykubGFzdCgpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGNoZWNrIGlmIGRlcHRoIGxpbWl0IGhhcyByZWFjaGVkXG4gICAgICAgICAgICAgICAgICAgIGRlcHRoID0gdGhpcy5wbGFjZUVsLnBhcmVudHMob3B0Ll9saXN0Q2xhc3MrJywnK29wdC5fbGlzdEJhc2VDbGFzcykubGVuZ3RoO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChkZXB0aCArIHRoaXMuZHJhZ0RlcHRoIDw9IG1heERlcHRoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSBuZXcgc3ViLWxldmVsIGlmIG9uZSBkb2Vzbid0IGV4aXN0XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWxpc3QubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdCA9IFVJLiQoJzx1bC8+JykuYWRkQ2xhc3Mob3B0Lmxpc3RDbGFzcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdC5hcHBlbmQodGhpcy5wbGFjZUVsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmV2LmFwcGVuZChsaXN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFBhcmVudChwcmV2KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZWxzZSBhcHBlbmQgdG8gbmV4dCBsZXZlbCB1cFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3QgPSBwcmV2LmNoaWxkcmVuKG9wdC5fbGlzdENsYXNzKS5sYXN0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdC5hcHBlbmQodGhpcy5wbGFjZUVsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIGRlY3JlYXNlIGhvcml6b250YWwgbGV2ZWxcbiAgICAgICAgICAgICAgICBpZiAobW91c2UuZGlzdFggPCAwKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gd2UgY2Fubm90IGRlY3JlYXNlIHRoZSBsZXZlbCBpZiBhbiBpdGVtIHByZWNlZGVzIHRoZSBjdXJyZW50IG9uZVxuICAgICAgICAgICAgICAgICAgICBuZXh0ID0gdGhpcy5wbGFjZUVsLm5leHQob3B0Ll9saXN0SXRlbUNsYXNzKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFuZXh0Lmxlbmd0aCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBnZXQgcGFyZW50IHVsIG9mIHRoZSBsaXN0IGl0ZW1cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXJlbnRVbCA9IHRoaXMucGxhY2VFbC5jbG9zZXN0KFtvcHQuX2xpc3RCYXNlQ2xhc3MsIG9wdC5fbGlzdENsYXNzXS5qb2luKCcsJykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gdHJ5IHRvIGdldCB0aGUgbGkgc3Vycm91bmRpbmcgdGhlIHVsXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3Vycm91bmRpbmdMaSA9IHBhcmVudFVsLmNsb3Nlc3Qob3B0Ll9saXN0SXRlbUNsYXNzKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlIHVsIGlzIGluc2lkZSBvZiBhIGxpIChtZWFuaW5nIGl0IGlzIG5lc3RlZClcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdXJyb3VuZGluZ0xpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdlIGNhbiBkZWNyZWFzZSB0aGUgaG9yaXpvbnRhbCBsZXZlbFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1cnJvdW5kaW5nTGkuYWZ0ZXIodGhpcy5wbGFjZUVsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGUgcHJldmlvdXMgcGFyZW50IHVsIGlzIG5vdyBlbXB0eVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcGFyZW50VWwuY2hpbGRyZW4oKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51bnNldFBhcmVudChzdXJyb3VuZGluZ0xpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBpc0VtcHR5ID0gZmFsc2U7XG5cbiAgICAgICAgICAgIC8vIGZpbmQgbGlzdCBpdGVtIHVuZGVyIGN1cnNvclxuICAgICAgICAgICAgdmFyIHBvaW50WCA9IGUucGFnZVggLSAod2luZG93LnBhZ2VYT2Zmc2V0IHx8IGRvY3VtZW50LnNjcm9sbExlZnQgfHwgMCksXG4gICAgICAgICAgICAgICAgcG9pbnRZID0gZS5wYWdlWSAtICh3aW5kb3cucGFnZVlPZmZzZXQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCk7XG4gICAgICAgICAgICB0aGlzLnBvaW50RWwgPSBVSS4kKGRvY3VtZW50LmVsZW1lbnRGcm9tUG9pbnQocG9pbnRYLCBwb2ludFkpKTtcblxuICAgICAgICAgICAgaWYgKG9wdC5oYW5kbGVDbGFzcyAmJiB0aGlzLnBvaW50RWwuaGFzQ2xhc3Mob3B0LmhhbmRsZUNsYXNzKSkge1xuXG4gICAgICAgICAgICAgICAgdGhpcy5wb2ludEVsID0gdGhpcy5wb2ludEVsLmNsb3Nlc3Qob3B0Ll9saXN0SXRlbUNsYXNzKTtcblxuICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgIHZhciBuZXN0YWJsZWl0ZW0gPSB0aGlzLnBvaW50RWwuY2xvc2VzdChvcHQuX2xpc3RJdGVtQ2xhc3MpO1xuXG4gICAgICAgICAgICAgICAgaWYgKG5lc3RhYmxlaXRlbS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wb2ludEVsID0gbmVzdGFibGVpdGVtO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRoaXMucGxhY2VFbC5maW5kKHRoaXMucG9pbnRFbCkubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy5wb2ludEVsLmRhdGEoJ25lc3RhYmxlJykgJiYgIXRoaXMucG9pbnRFbC5jaGlsZHJlbigpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGlzRW1wdHkgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tFbXB0eUxpc3QodGhpcy5wb2ludEVsKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoIXRoaXMucG9pbnRFbC5sZW5ndGggfHwgIXRoaXMucG9pbnRFbC5oYXNDbGFzcyhvcHQubGlzdEl0ZW1DbGFzcykpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGZpbmQgcGFyZW50IGxpc3Qgb2YgaXRlbSB1bmRlciBjdXJzb3JcbiAgICAgICAgICAgIHZhciBwb2ludEVsUm9vdCA9IHRoaXMuZWxlbWVudCxcbiAgICAgICAgICAgICAgICB0bXBSb290ICAgICA9IHRoaXMucG9pbnRFbC5jbG9zZXN0KHRoaXMub3B0aW9ucy5fbGlzdEJhc2VDbGFzcyksXG4gICAgICAgICAgICAgICAgaXNOZXdSb290ICAgPSBwb2ludEVsUm9vdFswXSAhPSB0bXBSb290WzBdO1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIG1vdmUgdmVydGljYWxcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgaWYgKCFtb3VzZS5kaXJBeCB8fCBpc05ld1Jvb3QgfHwgaXNFbXB0eSkge1xuXG4gICAgICAgICAgICAgICAgLy8gY2hlY2sgaWYgZ3JvdXBzIG1hdGNoIGlmIGRyYWdnaW5nIG92ZXIgbmV3IHJvb3RcbiAgICAgICAgICAgICAgICBpZiAoaXNOZXdSb290ICYmIG9wdC5ncm91cCAhPT0gdG1wUm9vdC5kYXRhKCduZXN0YWJsZS1ncm91cCcpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0b3VjaGVkbGlzdHMucHVzaChwb2ludEVsUm9vdCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gY2hlY2sgZGVwdGggbGltaXRcbiAgICAgICAgICAgICAgICBkZXB0aCA9IHRoaXMuZHJhZ0RlcHRoIC0gMSArIHRoaXMucG9pbnRFbC5wYXJlbnRzKG9wdC5fbGlzdENsYXNzKycsJytvcHQuX2xpc3RCYXNlQ2xhc3MpLmxlbmd0aDtcblxuICAgICAgICAgICAgICAgIGlmIChkZXB0aCA+IG1heERlcHRoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgYmVmb3JlID0gZS5wYWdlWSA8ICh0aGlzLnBvaW50RWwub2Zmc2V0KCkudG9wICsgdGhpcy5wb2ludEVsLmhlaWdodCgpIC8gMik7XG5cbiAgICAgICAgICAgICAgICBwYXJlbnQgPSB0aGlzLnBsYWNlRWwucGFyZW50KCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoaXNFbXB0eSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBvaW50RWwuYXBwZW5kKHRoaXMucGxhY2VFbCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChiZWZvcmUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wb2ludEVsLmJlZm9yZSh0aGlzLnBsYWNlRWwpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucG9pbnRFbC5hZnRlcih0aGlzLnBsYWNlRWwpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICghcGFyZW50LmNoaWxkcmVuKCkubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghcGFyZW50LmRhdGEoJ25lc3RhYmxlJykpIHRoaXMudW5zZXRQYXJlbnQocGFyZW50LnBhcmVudCgpKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0aGlzLmNoZWNrRW1wdHlMaXN0KHRoaXMuZHJhZ1Jvb3RFbCk7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGVja0VtcHR5TGlzdChwb2ludEVsUm9vdCk7XG5cbiAgICAgICAgICAgICAgICAvLyBwYXJlbnQgcm9vdCBsaXN0IGhhcyBjaGFuZ2VkXG4gICAgICAgICAgICAgICAgaWYgKGlzTmV3Um9vdCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRyYWdSb290RWwgPSB0bXBSb290O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhc05ld1Jvb3QgPSB0aGlzLmVsZW1lbnRbMF0gIT09IHRoaXMuZHJhZ1Jvb3RFbFswXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hlY2tFbXB0eUxpc3Q6IGZ1bmN0aW9uKGxpc3QpIHtcblxuICAgICAgICAgICAgbGlzdCAgPSBsaXN0ID8gVUkuJChsaXN0KSA6IHRoaXMuZWxlbWVudDtcblxuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5lbXB0eUNsYXNzKSB7XG4gICAgICAgICAgICAgICAgbGlzdFshbGlzdC5jaGlsZHJlbigpLmxlbmd0aCA/ICdhZGRDbGFzcyc6J3JlbW92ZUNsYXNzJ10odGhpcy5vcHRpb25zLmVtcHR5Q2xhc3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICB9KTtcblxuICAgIHJldHVybiBVSS5uZXN0YWJsZTtcbn0pOyJdfQ==
