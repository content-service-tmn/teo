!function(a){"use strict";var n,i=!1,e=0,o=a.$html;a.$win.on("resize orientationchange",a.Utils.debounce(function(){a.$(".uk-modal.uk-open").each(function(){return a.$(this).data("modal")&&a.$(this).data("modal").resize()})},150)),a.component("modal",{defaults:{keyboard:!0,bgclose:!0,minScrollHeight:150,center:!1,modal:!0},scrollable:!1,transition:!1,hasTransitioned:!0,init:function(){if(n||(n=a.$("body")),this.element.length){var i=this;this.paddingdir="padding-"+("left"==a.langdirection?"right":"left"),this.dialog=this.find(".uk-modal-dialog"),this.active=!1,this.element.attr("aria-hidden",this.element.hasClass("uk-open")),this.on("click",".uk-modal-close",function(t){t.preventDefault(),i.hide()}).on("click",function(t){a.$(t.target)[0]==i.element[0]&&i.options.bgclose&&i.hide()}),a.domObserve(this.element,function(t){i.resize()})}},toggle:function(){return this[this.isActive()?"hide":"show"]()},show:function(){if(this.element.length){var t=this;if(!this.isActive())return this.options.modal&&i&&i.hide(!0),this.element.removeClass("uk-open").show(),this.resize(!0),this.options.modal&&(i=this),this.active=!0,e++,a.support.transition?(this.hasTransitioned=!1,this.element.one(a.support.transition.end,function(){t.hasTransitioned=!0,a.Utils.focus(t.dialog,"a[href]")}).addClass("uk-open")):(this.element.addClass("uk-open"),a.Utils.focus(this.dialog,"a[href]")),o.addClass("uk-modal-page").height(),this.element.attr("aria-hidden","false"),this.element.trigger("show.uk.modal"),a.Utils.checkDisplay(this.dialog,!0),this}},hide:function(t){if(!t&&a.support.transition&&this.hasTransitioned){var i=this;this.one(a.support.transition.end,function(){i._hide()}).removeClass("uk-open")}else this._hide();return this},resize:function(t){if(this.isActive()||t){var i=n.width();if(this.scrollbarwidth=window.innerWidth-i,n.css(this.paddingdir,this.scrollbarwidth),this.element.css("overflow-y",this.scrollbarwidth?"scroll":"auto"),!this.updateScrollable()&&this.options.center){var e=this.dialog.outerHeight(),o=parseInt(this.dialog.css("margin-top"),10)+parseInt(this.dialog.css("margin-bottom"),10);e+o<window.innerHeight?this.dialog.css({top:window.innerHeight/2-e/2-o}):this.dialog.css({top:""})}}},updateScrollable:function(){var t=this.dialog.find(".uk-overflow-container:visible:first");if(t.length){t.css("height",0);var i=Math.abs(parseInt(this.dialog.css("margin-top"),10)),e=this.dialog.outerHeight(),o=window.innerHeight-2*(i<20?20:i)-e;return t.css({maxHeight:o<this.options.minScrollHeight?"":o,height:""}),!0}return!1},_hide:function(){this.active=!1,0<e?e--:e=0,this.element.hide().removeClass("uk-open"),this.element.attr("aria-hidden","true"),e||(o.removeClass("uk-modal-page"),n.css(this.paddingdir,"")),i===this&&(i=!1),this.trigger("hide.uk.modal")},isActive:function(){return this.element.hasClass("uk-open")}}),a.component("modalTrigger",{boot:function(){a.$html.on("click.modal.uikit","[data-uk-modal]",function(t){var i=a.$(this);(i.is("a")&&t.preventDefault(),i.data("modalTrigger"))||a.modalTrigger(i,a.Utils.options(i.attr("data-uk-modal"))).show()}),a.$html.on("keydown.modal.uikit",function(t){i&&27===t.keyCode&&i.options.keyboard&&(t.preventDefault(),i.hide())})},init:function(){var i=this;this.options=a.$.extend({target:!!i.element.is("a")&&i.element.attr("href")},this.options),this.modal=a.modal(this.options.target,this.options),this.on("click",function(t){t.preventDefault(),i.show()}),this.proxy(this.modal,"show hide isActive")}}),a.modal.dialog=function(t,i){var e=a.modal(a.$(a.modal.dialog.template).appendTo("body"),i);return e.on("hide.uk.modal",function(){e.persist&&(e.persist.appendTo(e.persist.data("modalPersistParent")),e.persist=!1),e.element.remove()}),function(t,i){if(!i)return;"object"==typeof t?(t=t instanceof jQuery?t:a.$(t)).parent().length&&(i.persist=t,i.persist.data("modalPersistParent",t.parent())):t="string"==typeof t||"number"==typeof t?a.$("<div></div>").html(t):a.$("<div></div>").html("UIkit2.modal Error: Unsupported data type: "+typeof t);t.appendTo(i.element.find(".uk-modal-dialog"))}(t,e),e},a.modal.dialog.template='<div class="uk-modal"><div class="uk-modal-dialog" style="min-height:0;"></div></div>',a.modal.alert=function(t,i){i=a.$.extend(!0,{bgclose:!1,keyboard:!1,modal:!1,labels:a.modal.labels},i);var e=a.modal.dialog(['<div class="uk-margin uk-modal-content">'+String(t)+"</div>",'<div class="uk-modal-footer uk-text-right"><button class="uk-button uk-button-primary uk-modal-close">'+i.labels.Ok+"</button></div>"].join(""),i);return e.on("show.uk.modal",function(){setTimeout(function(){e.element.find("button:first").focus()},50)}),e.show()},a.modal.confirm=function(t,i,e){var o=1<arguments.length&&arguments[arguments.length-1]?arguments[arguments.length-1]:{};i=a.$.isFunction(i)?i:function(){},e=a.$.isFunction(e)?e:function(){},o=a.$.extend(!0,{bgclose:!1,keyboard:!1,modal:!1,labels:a.modal.labels},a.$.isFunction(o)?{}:o);var n=a.modal.dialog(['<div class="uk-margin uk-modal-content">'+String(t)+"</div>",'<div class="uk-modal-footer uk-text-right"><button class="uk-button js-modal-confirm-cancel">'+o.labels.Cancel+'</button> <button class="uk-button uk-button-primary js-modal-confirm">'+o.labels.Ok+"</button></div>"].join(""),o);return n.element.find(".js-modal-confirm, .js-modal-confirm-cancel").on("click",function(){a.$(this).is(".js-modal-confirm")?i():e(),n.hide()}),n.on("show.uk.modal",function(){setTimeout(function(){n.element.find(".js-modal-confirm").focus()},50)}),n.show()},a.modal.prompt=function(t,i,e,o){e=a.$.isFunction(e)?e:function(t){},o=a.$.extend(!0,{bgclose:!1,keyboard:!1,modal:!1,labels:a.modal.labels},o);var n=a.modal.dialog([t?'<div class="uk-modal-content uk-form">'+String(t)+"</div>":"",'<div class="uk-margin-small-top uk-modal-content uk-form"><p><input type="text" class="uk-width-1-1"></p></div>','<div class="uk-modal-footer uk-text-right"><button class="uk-button uk-modal-close">'+o.labels.Cancel+'</button> <button class="uk-button uk-button-primary js-modal-ok">'+o.labels.Ok+"</button></div>"].join(""),o),s=n.element.find("input[type='text']").val(i||"").on("keyup",function(t){13==t.keyCode&&n.element.find(".js-modal-ok").trigger("click")});return n.element.find(".js-modal-ok").on("click",function(){!1!==e(s.val())&&n.hide()}),n.show()},a.modal.blockUI=function(t,i){var e=a.modal.dialog(['<div class="uk-margin uk-modal-content">'+String(t||'<div class="uk-text-center">...</div>')+"</div>"].join(""),a.$.extend({bgclose:!1,keyboard:!1,modal:!1},i));return e.content=e.element.find(".uk-modal-content:first"),e.show()},a.modal.labels={Ok:"Ok",Cancel:"Cancel"}}(UIkit2);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvcmUvbW9kYWwuanMiXSwibmFtZXMiOlsiVUkiLCJib2R5IiwiYWN0aXZlIiwiYWN0aXZlQ291bnQiLCIkaHRtbCIsIiR3aW4iLCJvbiIsIlV0aWxzIiwiZGVib3VuY2UiLCIkIiwiZWFjaCIsInRoaXMiLCJkYXRhIiwicmVzaXplIiwiY29tcG9uZW50IiwiZGVmYXVsdHMiLCJrZXlib2FyZCIsImJnY2xvc2UiLCJtaW5TY3JvbGxIZWlnaHQiLCJjZW50ZXIiLCJtb2RhbCIsInNjcm9sbGFibGUiLCJ0cmFuc2l0aW9uIiwiaGFzVHJhbnNpdGlvbmVkIiwiaW5pdCIsImVsZW1lbnQiLCJsZW5ndGgiLCIkdGhpcyIsInBhZGRpbmdkaXIiLCJsYW5nZGlyZWN0aW9uIiwiZGlhbG9nIiwiZmluZCIsImF0dHIiLCJoYXNDbGFzcyIsImUiLCJwcmV2ZW50RGVmYXVsdCIsImhpZGUiLCJ0YXJnZXQiLCJvcHRpb25zIiwiZG9tT2JzZXJ2ZSIsInRvZ2dsZSIsImlzQWN0aXZlIiwic2hvdyIsInJlbW92ZUNsYXNzIiwic3VwcG9ydCIsIm9uZSIsImVuZCIsImZvY3VzIiwiYWRkQ2xhc3MiLCJoZWlnaHQiLCJ0cmlnZ2VyIiwiY2hlY2tEaXNwbGF5IiwiZm9yY2UiLCJfaGlkZSIsImJvZHl3aWR0aCIsIndpZHRoIiwic2Nyb2xsYmFyd2lkdGgiLCJ3aW5kb3ciLCJpbm5lcldpZHRoIiwiY3NzIiwidXBkYXRlU2Nyb2xsYWJsZSIsImRoIiwib3V0ZXJIZWlnaHQiLCJwYWQiLCJwYXJzZUludCIsImlubmVySGVpZ2h0IiwidG9wIiwib2Zmc2V0IiwiTWF0aCIsImFicyIsImgiLCJtYXhIZWlnaHQiLCJib290IiwiZWxlIiwiaXMiLCJtb2RhbFRyaWdnZXIiLCJrZXlDb2RlIiwiZXh0ZW5kIiwicHJveHkiLCJjb250ZW50IiwidGVtcGxhdGUiLCJhcHBlbmRUbyIsInBlcnNpc3QiLCJyZW1vdmUiLCJqUXVlcnkiLCJwYXJlbnQiLCJodG1sIiwic2V0Q29udGVudCIsImFsZXJ0IiwibGFiZWxzIiwiU3RyaW5nIiwiT2siLCJqb2luIiwic2V0VGltZW91dCIsImNvbmZpcm0iLCJvbmNvbmZpcm0iLCJvbmNhbmNlbCIsImFyZ3VtZW50cyIsImlzRnVuY3Rpb24iLCJDYW5jZWwiLCJwcm9tcHQiLCJ0ZXh0IiwidmFsdWUiLCJvbnN1Ym1pdCIsImlucHV0IiwidmFsIiwiYmxvY2tVSSIsIlVJa2l0MiJdLCJtYXBwaW5ncyI6IkNBQ0EsU0FBVUEsR0FFTixhQUVBLElBQXVEQyxFQUFuREMsR0FBUyxFQUFPQyxFQUFjLEVBQUdDLEVBQVFKLEVBQUdJLE1BRWhESixFQUFHSyxLQUFLQyxHQUFHLDJCQUE0Qk4sRUFBR08sTUFBTUMsU0FBUyxXQUNyRFIsRUFBR1MsRUFBRSxxQkFBcUJDLEtBQUssV0FDM0IsT0FBT1YsRUFBR1MsRUFBRUUsTUFBTUMsS0FBSyxVQUFZWixFQUFHUyxFQUFFRSxNQUFNQyxLQUFLLFNBQVNDLFlBRWpFLE1BRUhiLEVBQUdjLFVBQVUsUUFBUyxDQUVsQkMsU0FBVSxDQUNOQyxVQUFVLEVBQ1ZDLFNBQVMsRUFDVEMsZ0JBQWlCLElBQ2pCQyxRQUFRLEVBQ1JDLE9BQU8sR0FHWEMsWUFBWSxFQUNaQyxZQUFZLEVBQ1pDLGlCQUFpQixFQUVqQkMsS0FBTSxXQUlGLEdBRkt2QixJQUFNQSxFQUFPRCxFQUFHUyxFQUFFLFNBRWxCRSxLQUFLYyxRQUFRQyxPQUFsQixDQUVBLElBQUlDLEVBQVFoQixLQUVaQSxLQUFLaUIsV0FBYSxZQUFrQyxRQUFwQjVCLEVBQUc2QixjQUEwQixRQUFRLFFBQ3JFbEIsS0FBS21CLE9BQWFuQixLQUFLb0IsS0FBSyxvQkFFNUJwQixLQUFLVCxRQUFhLEVBR2xCUyxLQUFLYyxRQUFRTyxLQUFLLGNBQWVyQixLQUFLYyxRQUFRUSxTQUFTLFlBRXZEdEIsS0FBS0wsR0FBRyxRQUFTLGtCQUFtQixTQUFTNEIsR0FDekNBLEVBQUVDLGlCQUNGUixFQUFNUyxTQUNQOUIsR0FBRyxRQUFTLFNBQVM0QixHQUVQbEMsRUFBR1MsRUFBRXlCLEVB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QyxFQUFHUyxFQUFFb0UsUUFBTyxFQUFNLENBQUM1RCxTQUFRLEVBQU9ELFVBQVMsRUFBT0ksT0FBTSxFQUFPcUUsT0FBT3pGLEVBQUdvQixNQUFNcUUsUUFBU25ELEdBRW5HLElBQUlsQixFQUFRcEIsRUFBR29CLE1BQU1VLE9BQU8sQ0FDeEJ1RSxFQUFPLHlDQUF5Q1gsT0FBT1csR0FBTSxTQUFTLEdBQ3RFLGtIQUNBLHVGQUF1Ri9ELEVBQVFtRCxPQUFPVSxPQUFPLHFFQUFxRTdELEVBQVFtRCxPQUFPRSxHQUFHLG1CQUNyTUMsS0FBSyxJQUFLdEQsR0FFYmtFLEVBQVFwRixFQUFNSyxRQUFRTSxLQUFLLHNCQUFzQjBFLElBQUlILEdBQVMsSUFBSWhHLEdBQUcsUUFBUyxTQUFTNEIsR0FDbEUsSUFBYkEsRUFBRTBDLFNBQ0Z4RCxFQUFNSyxRQUFRTSxLQUFLLGdCQUFnQm1CLFFBQVEsV0FVbkQsT0FOQTlCLEVBQU1LLFFBQVFNLEtBQUssZ0JBQWdCekIsR0FBRyxRQUFTLFlBQ2YsSUFBeEJpRyxFQUFTQyxFQUFNQyxRQUNmckYsRUFBTWdCLFNBSVBoQixFQUFNc0IsUUFHakIxQyxFQUFHb0IsTUFBTXNGLFFBQVUsU0FBUzNCLEVBQVN6QyxHQUVqQyxJQUFJbEIsRUFBUXBCLEVBQUdvQixNQUFNVSxPQUFPLENBQ3hCLDJDQUEyQzRELE9BQU9YLEdBQVcseUNBQXlDLFVBQ3ZHYSxLQUFLLElBQUs1RixFQUFHUyxFQUFFb0UsT0FBTyxDQUFDNUQsU0FBUSxFQUFPRCxVQUFTLEVBQU9JLE9BQU0sR0FBUWtCLElBSXZFLE9BRkFsQixFQUFNMkQsUUFBVTNELEVBQU1LLFFBQVFNLEtBQUssMkJBRTVCWCxFQUFNc0IsUUFHakIxQyxFQUFHb0IsTUFBTXFFLE9BQVMsQ0FDZEUsR0FBSSxLQUNKUSxPQUFRLFVBbldoQixDQWlZR1EiLCJmaWxlIjoiY29yZS9tb2RhbC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qISBVSWtpdCAyLjI3LjIgfCBodHRwOi8vd3d3LmdldHVpa2l0LmNvbSB8IChjKSAyMDE0IFlPT3RoZW1lIHwgTUlUIExpY2Vuc2UgKi9cclxuKGZ1bmN0aW9uKFVJKSB7XHJcblxyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG4gICAgdmFyIGFjdGl2ZSA9IGZhbHNlLCBhY3RpdmVDb3VudCA9IDAsICRodG1sID0gVUkuJGh0bWwsIGJvZHk7XHJcblxyXG4gICAgVUkuJHdpbi5vbigncmVzaXplIG9yaWVudGF0aW9uY2hhbmdlJywgVUkuVXRpbHMuZGVib3VuY2UoZnVuY3Rpb24oKXtcclxuICAgICAgICBVSS4kKCcudWstbW9kYWwudWstb3BlbicpLmVhY2goZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgcmV0dXJuIFVJLiQodGhpcykuZGF0YSgnbW9kYWwnKSAmJiBVSS4kKHRoaXMpLmRhdGEoJ21vZGFsJykucmVzaXplKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9LCAxNTApKTtcclxuXHJcbiAgICBVSS5jb21wb25lbnQoJ21vZGFsJywge1xyXG5cclxuICAgICAgICBkZWZhdWx0czoge1xyXG4gICAgICAgICAgICBrZXlib2FyZDogdHJ1ZSxcclxuICAgICAgICAgICAgYmdjbG9zZTogdHJ1ZSxcclxuICAgICAgICAgICAgbWluU2Nyb2xsSGVpZ2h0OiAxNTAsXHJcbiAgICAgICAgICAgIGNlbnRlcjogZmFsc2UsXHJcbiAgICAgICAgICAgIG1vZGFsOiB0cnVlXHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgc2Nyb2xsYWJsZTogZmFsc2UsXHJcbiAgICAgICAgdHJhbnNpdGlvbjogZmFsc2UsXHJcbiAgICAgICAgaGFzVHJhbnNpdGlvbmVkOiB0cnVlLFxyXG5cclxuICAgICAgICBpbml0OiBmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgICAgIGlmICghYm9keSkgYm9keSA9IFVJLiQoJ2JvZHknKTtcclxuXHJcbiAgICAgICAgICAgIGlmICghdGhpcy5lbGVtZW50Lmxlbmd0aCkgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgdmFyICR0aGlzID0gdGhpcztcclxuXHJcbiAgICAgICAgICAgIHRoaXMucGFkZGluZ2RpciA9ICdwYWRkaW5nLScgKyAoVUkubGFuZ2RpcmVjdGlvbiA9PSAnbGVmdCcgPyAncmlnaHQnOidsZWZ0Jyk7XHJcbiAgICAgICAgICAgIHRoaXMuZGlhbG9nICAgICA9IHRoaXMuZmluZCgnLnVrLW1vZGFsLWRpYWxvZycpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5hY3RpdmUgICAgID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAvLyBVcGRhdGUgQVJJQVxyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuYXR0cignYXJpYS1oaWRkZW4nLCB0aGlzLmVsZW1lbnQuaGFzQ2xhc3MoJ3VrLW9wZW4nKSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLm9uKCdjbGljaycsICcudWstbW9kYWwtY2xvc2UnLCBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICAkdGhpcy5oaWRlKCk7XHJcbiAgICAgICAgICAgIH0pLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0ID0gVUkuJChlLnRhcmdldCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHRhcmdldFswXSA9PSAkdGhpcy5lbGVtZW50WzBdICYmICR0aGlzLm9wdGlvbnMuYmdjbG9zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICR0aGlzLmhpZGUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBVSS5kb21PYnNlcnZlKHRoaXMuZWxlbWVudCwgZnVuY3Rpb24oZSkgeyAkdGhpcy5yZXNpemUoKTsgfSk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgdG9nZ2xlOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXNbdGhpcy5pc0FjdGl2ZSgpID8gJ2hpZGUnIDogJ3Nob3cnXSgpO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIHNob3c6IGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICAgICAgaWYgKCF0aGlzLmVsZW1lbnQubGVuZ3RoKSByZXR1cm47XHJcblxyXG4gICAgICAgICAgICB2YXIgJHRoaXMgPSB0aGlzO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuaXNBY3RpdmUoKSkgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5tb2RhbCAmJiBhY3RpdmUpIHtcclxuICAgICAgICAgICAgICAgIGFjdGl2ZS5oaWRlKHRydWUpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoJ3VrLW9wZW4nKS5zaG93KCk7XHJcbiAgICAgICAgICAgIHRoaXMucmVzaXplKHRydWUpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5tb2RhbCkge1xyXG4gICAgICAgICAgICAgICAgYWN0aXZlID0gdGhpcztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5hY3RpdmUgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgYWN0aXZlQ291bnQrKztcclxuXHJcbiAgICAgICAgICAgIGlmIChVSS5zdXBwb3J0LnRyYW5zaXRpb24pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaGFzVHJhbnNpdGlvbmVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQub25lKFVJLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQsIGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgJHRoaXMuaGFzVHJhbnNpdGlvbmVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBVSS5VdGlscy5mb2N1cygkdGhpcy5kaWFsb2csICdhW2hyZWZdJyk7XHJcbiAgICAgICAgICAgICAgICB9KS5hZGRDbGFzcygndWstb3BlbicpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LmFkZENsYXNzKCd1ay1vcGVuJyk7XHJcbiAgICAgICAgICAgICAgICBVSS5VdGlscy5mb2N1cyh0aGlzLmRpYWxvZywgJ2FbaHJlZl0nKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgJGh0bWwuYWRkQ2xhc3MoJ3VrLW1vZGFsLXBhZ2UnKS5oZWlnaHQoKTsgLy8gZm9yY2UgYnJvd3NlciBlbmdpbmUgcmVkcmF3XHJcblxyXG4gICAgICAgICAgICAvLyBVcGRhdGUgQVJJQVxyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuYXR0cignYXJpYS1oaWRkZW4nLCAnZmFsc2UnKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC50cmlnZ2VyKCdzaG93LnVrLm1vZGFsJyk7XHJcblxyXG4gICAgICAgICAgICBVSS5VdGlscy5jaGVja0Rpc3BsYXkodGhpcy5kaWFsb2csIHRydWUpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgaGlkZTogZnVuY3Rpb24oZm9yY2UpIHtcclxuXHJcbiAgICAgICAgICAgIGlmICghZm9yY2UgJiYgVUkuc3VwcG9ydC50cmFuc2l0aW9uICYmIHRoaXMuaGFzVHJhbnNpdGlvbmVkKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyICR0aGlzID0gdGhpcztcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLm9uZShVSS5zdXBwb3J0LnRyYW5zaXRpb24uZW5kLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAkdGhpcy5faGlkZSgpO1xyXG4gICAgICAgICAgICAgICAgfSkucmVtb3ZlQ2xhc3MoJ3VrLW9wZW4nKTtcclxuXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5faGlkZSgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICByZXNpemU6IGZ1bmN0aW9uKGZvcmNlKSB7XHJcblxyXG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNBY3RpdmUoKSAmJiAhZm9yY2UpIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgIHZhciBib2R5d2lkdGggID0gYm9keS53aWR0aCgpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5zY3JvbGxiYXJ3aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoIC0gYm9keXdpZHRoO1xyXG5cclxuICAgICAgICAgICAgYm9keS5jc3ModGhpcy5wYWRkaW5nZGlyLCB0aGlzLnNjcm9sbGJhcndpZHRoKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5jc3MoJ292ZXJmbG93LXknLCB0aGlzLnNjcm9sbGJhcndpZHRoID8gJ3Njcm9sbCcgOiAnYXV0bycpO1xyXG5cclxuICAgICAgICAgICAgaWYgKCF0aGlzLnVwZGF0ZVNjcm9sbGFibGUoKSAmJiB0aGlzLm9wdGlvbnMuY2VudGVyKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGRoICA9IHRoaXMuZGlhbG9nLm91dGVySGVpZ2h0KCksXHJcbiAgICAgICAgICAgICAgICBwYWQgPSBwYXJzZUludCh0aGlzLmRpYWxvZy5jc3MoJ21hcmdpbi10b3AnKSwgMTApICsgcGFyc2VJbnQodGhpcy5kaWFsb2cuY3NzKCdtYXJnaW4tYm90dG9tJyksIDEwKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoKGRoICsgcGFkKSA8IHdpbmRvdy5pbm5lckhlaWdodCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGlhbG9nLmNzcyh7dG9wOiAod2luZG93LmlubmVySGVpZ2h0LzIgLSBkaC8yKSAtIHBhZCB9KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kaWFsb2cuY3NzKHt0b3A6ICcnfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICB1cGRhdGVTY3JvbGxhYmxlOiBmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgICAgIC8vIGhhcyBzY3JvbGxhYmxlP1xyXG4gICAgICAgICAgICB2YXIgc2Nyb2xsYWJsZSA9IHRoaXMuZGlhbG9nLmZpbmQoJy51ay1vdmVyZmxvdy1jb250YWluZXI6dmlzaWJsZTpmaXJzdCcpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHNjcm9sbGFibGUubGVuZ3RoKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgc2Nyb2xsYWJsZS5jc3MoJ2hlaWdodCcsIDApO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBvZmZzZXQgPSBNYXRoLmFicyhwYXJzZUludCh0aGlzLmRpYWxvZy5jc3MoJ21hcmdpbi10b3AnKSwgMTApKSxcclxuICAgICAgICAgICAgICAgIGRoICAgICA9IHRoaXMuZGlhbG9nLm91dGVySGVpZ2h0KCksXHJcbiAgICAgICAgICAgICAgICB3aCAgICAgPSB3aW5kb3cuaW5uZXJIZWlnaHQsXHJcbiAgICAgICAgICAgICAgICBoICAgICAgPSB3aCAtIDIqKG9mZnNldCA8IDIwID8gMjA6b2Zmc2V0KSAtIGRoO1xyXG5cclxuICAgICAgICAgICAgICAgIHNjcm9sbGFibGUuY3NzKHtcclxuICAgICAgICAgICAgICAgICAgICBtYXhIZWlnaHQ6IChoIDwgdGhpcy5vcHRpb25zLm1pblNjcm9sbEhlaWdodCA/ICcnOmgpLFxyXG4gICAgICAgICAgICAgICAgICAgIGhlaWdodDonJ1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBfaGlkZTogZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmFjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICBpZiAoYWN0aXZlQ291bnQgPiAwKSBhY3RpdmVDb3VudC0tO1xyXG4gICAgICAgICAgICBlbHNlIGFjdGl2ZUNvdW50ID0gMDtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5oaWRlKCkucmVtb3ZlQ2xhc3MoJ3VrLW9wZW4nKTtcclxuXHJcbiAgICAgICAgICAgIC8vIFVwZGF0ZSBBUklBXHJcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5hdHRyKCdhcmlhLWhpZGRlbicsICd0cnVlJyk7XHJcblxyXG4gICAgICAgICAgICBpZiAoIWFjdGl2ZUNvdW50KSB7XHJcbiAgICAgICAgICAgICAgICAkaHRtbC5yZW1vdmVDbGFzcygndWstbW9kYWwtcGFnZScpO1xyXG4gICAgICAgICAgICAgICAgYm9keS5jc3ModGhpcy5wYWRkaW5nZGlyLCBcIlwiKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGFjdGl2ZT09PXRoaXMpIGFjdGl2ZSA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCdoaWRlLnVrLm1vZGFsJyk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgaXNBY3RpdmU6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50Lmhhc0NsYXNzKCd1ay1vcGVuJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH0pO1xyXG5cclxuICAgIFVJLmNvbXBvbmVudCgnbW9kYWxUcmlnZ2VyJywge1xyXG5cclxuICAgICAgICBib290OiBmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgICAgIC8vIGluaXQgY29kZVxyXG4gICAgICAgICAgICBVSS4kaHRtbC5vbignY2xpY2subW9kYWwudWlraXQnLCAnW2RhdGEtdWstbW9kYWxdJywgZnVuY3Rpb24oZSkge1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBlbGUgPSBVSS4kKHRoaXMpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChlbGUuaXMoJ2EnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIWVsZS5kYXRhKCdtb2RhbFRyaWdnZXInKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBtb2RhbCA9IFVJLm1vZGFsVHJpZ2dlcihlbGUsIFVJLlV0aWxzLm9wdGlvbnMoZWxlLmF0dHIoJ2RhdGEtdWstbW9kYWwnKSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIG1vZGFsLnNob3coKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgLy8gY2xvc2UgbW9kYWwgb24gZXNjIGJ1dHRvblxyXG4gICAgICAgICAgICBVSS4kaHRtbC5vbigna2V5ZG93bi5tb2RhbC51aWtpdCcsIGZ1bmN0aW9uIChlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGFjdGl2ZSAmJiBlLmtleUNvZGUgPT09IDI3ICYmIGFjdGl2ZS5vcHRpb25zLmtleWJvYXJkKSB7IC8vIEVTQ1xyXG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgICAgICBhY3RpdmUuaGlkZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBpbml0OiBmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciAkdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMgPSBVSS4kLmV4dGVuZCh7XHJcbiAgICAgICAgICAgICAgICB0YXJnZXQ6ICR0aGlzLmVsZW1lbnQuaXMoJ2EnKSA/ICR0aGlzLmVsZW1lbnQuYXR0cignaHJlZicpIDogZmFsc2VcclxuICAgICAgICAgICAgfSwgdGhpcy5vcHRpb25zKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMubW9kYWwgPSBVSS5tb2RhbCh0aGlzLm9wdGlvbnMudGFyZ2V0LCB0aGlzLm9wdGlvbnMpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5vbihcImNsaWNrXCIsIGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgICR0aGlzLnNob3coKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvL21ldGhvZHNcclxuICAgICAgICAgICAgdGhpcy5wcm94eSh0aGlzLm1vZGFsLCAnc2hvdyBoaWRlIGlzQWN0aXZlJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgVUkubW9kYWwuZGlhbG9nID0gZnVuY3Rpb24oY29udGVudCwgb3B0aW9ucykge1xyXG5cclxuICAgICAgICB2YXIgbW9kYWwgPSBVSS5tb2RhbChVSS4kKFVJLm1vZGFsLmRpYWxvZy50ZW1wbGF0ZSkuYXBwZW5kVG8oJ2JvZHknKSwgb3B0aW9ucyk7XHJcblxyXG4gICAgICAgIG1vZGFsLm9uKCdoaWRlLnVrLm1vZGFsJywgZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgaWYgKG1vZGFsLnBlcnNpc3QpIHtcclxuICAgICAgICAgICAgICAgIG1vZGFsLnBlcnNpc3QuYXBwZW5kVG8obW9kYWwucGVyc2lzdC5kYXRhKCdtb2RhbFBlcnNpc3RQYXJlbnQnKSk7XHJcbiAgICAgICAgICAgICAgICBtb2RhbC5wZXJzaXN0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbW9kYWwuZWxlbWVudC5yZW1vdmUoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgc2V0Q29udGVudChjb250ZW50LCBtb2RhbCk7XHJcblxyXG4gICAgICAgIHJldHVybiBtb2RhbDtcclxuICAgIH07XHJcblxyXG4gICAgVUkubW9kYWwuZGlhbG9nLnRlbXBsYXRlID0gJzxkaXYgY2xhc3M9XCJ1ay1tb2RhbFwiPjxkaXYgY2xhc3M9XCJ1ay1tb2RhbC1kaWFsb2dcIiBzdHlsZT1cIm1pbi1oZWlnaHQ6MDtcIj48L2Rpdj48L2Rpdj4nO1xyXG5cclxuICAgIFVJLm1vZGFsLmFsZXJ0ID0gZnVuY3Rpb24oY29udGVudCwgb3B0aW9ucykge1xyXG5cclxuICAgICAgICBvcHRpb25zID0gVUkuJC5leHRlbmQodHJ1ZSwge2JnY2xvc2U6ZmFsc2UsIGtleWJvYXJkOmZhbHNlLCBtb2RhbDpmYWxzZSwgbGFiZWxzOlVJLm1vZGFsLmxhYmVsc30sIG9wdGlvbnMpO1xyXG5cclxuICAgICAgICB2YXIgbW9kYWwgPSBVSS5tb2RhbC5kaWFsb2coKFtcclxuICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJ1ay1tYXJnaW4gdWstbW9kYWwtY29udGVudFwiPicrU3RyaW5nKGNvbnRlbnQpKyc8L2Rpdj4nLFxyXG4gICAgICAgICAgICAnPGRpdiBjbGFzcz1cInVrLW1vZGFsLWZvb3RlciB1ay10ZXh0LXJpZ2h0XCI+PGJ1dHRvbiBjbGFzcz1cInVrLWJ1dHRvbiB1ay1idXR0b24tcHJpbWFyeSB1ay1tb2RhbC1jbG9zZVwiPicrb3B0aW9ucy5sYWJlbHMuT2srJzwvYnV0dG9uPjwvZGl2PidcclxuICAgICAgICBdKS5qb2luKFwiXCIpLCBvcHRpb25zKTtcclxuXHJcbiAgICAgICAgbW9kYWwub24oJ3Nob3cudWsubW9kYWwnLCBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICBtb2RhbC5lbGVtZW50LmZpbmQoJ2J1dHRvbjpmaXJzdCcpLmZvY3VzKCk7XHJcbiAgICAgICAgICAgIH0sIDUwKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIG1vZGFsLnNob3coKTtcclxuICAgIH07XHJcblxyXG4gICAgVUkubW9kYWwuY29uZmlybSA9IGZ1bmN0aW9uKGNvbnRlbnQsIG9uY29uZmlybSwgb25jYW5jZWwpIHtcclxuXHJcbiAgICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbYXJndW1lbnRzLmxlbmd0aC0xXSA/IGFyZ3VtZW50c1thcmd1bWVudHMubGVuZ3RoLTFdIDoge307XHJcblxyXG4gICAgICAgIG9uY29uZmlybSA9IFVJLiQuaXNGdW5jdGlvbihvbmNvbmZpcm0pID8gb25jb25maXJtIDogZnVuY3Rpb24oKXt9O1xyXG4gICAgICAgIG9uY2FuY2VsICA9IFVJLiQuaXNGdW5jdGlvbihvbmNhbmNlbCkgPyBvbmNhbmNlbCA6IGZ1bmN0aW9uKCl7fTtcclxuICAgICAgICBvcHRpb25zICAgPSBVSS4kLmV4dGVuZCh0cnVlLCB7YmdjbG9zZTpmYWxzZSwga2V5Ym9hcmQ6ZmFsc2UsIG1vZGFsOmZhbHNlLCBsYWJlbHM6VUkubW9kYWwubGFiZWxzfSwgVUkuJC5pc0Z1bmN0aW9uKG9wdGlvbnMpID8ge306b3B0aW9ucyk7XHJcblxyXG4gICAgICAgIHZhciBtb2RhbCA9IFVJLm1vZGFsLmRpYWxvZygoW1xyXG4gICAgICAgICAgICAnPGRpdiBjbGFzcz1cInVrLW1hcmdpbiB1ay1tb2RhbC1jb250ZW50XCI+JytTdHJpbmcoY29udGVudCkrJzwvZGl2PicsXHJcbiAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwidWstbW9kYWwtZm9vdGVyIHVrLXRleHQtcmlnaHRcIj48YnV0dG9uIGNsYXNzPVwidWstYnV0dG9uIGpzLW1vZGFsLWNvbmZpcm0tY2FuY2VsXCI+JytvcHRpb25zLmxhYmVscy5DYW5jZWwrJzwvYnV0dG9uPiA8YnV0dG9uIGNsYXNzPVwidWstYnV0dG9uIHVrLWJ1dHRvbi1wcmltYXJ5IGpzLW1vZGFsLWNvbmZpcm1cIj4nK29wdGlvbnMubGFiZWxzLk9rKyc8L2J1dHRvbj48L2Rpdj4nXHJcbiAgICAgICAgXSkuam9pbihcIlwiKSwgb3B0aW9ucyk7XHJcblxyXG4gICAgICAgIG1vZGFsLmVsZW1lbnQuZmluZChcIi5qcy1tb2RhbC1jb25maXJtLCAuanMtbW9kYWwtY29uZmlybS1jYW5jZWxcIikub24oXCJjbGlja1wiLCBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICBVSS4kKHRoaXMpLmlzKCcuanMtbW9kYWwtY29uZmlybScpID8gb25jb25maXJtKCkgOiBvbmNhbmNlbCgpO1xyXG4gICAgICAgICAgICBtb2RhbC5oaWRlKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIG1vZGFsLm9uKCdzaG93LnVrLm1vZGFsJywgZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgbW9kYWwuZWxlbWVudC5maW5kKCcuanMtbW9kYWwtY29uZmlybScpLmZvY3VzKCk7XHJcbiAgICAgICAgICAgIH0sIDUwKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIG1vZGFsLnNob3coKTtcclxuICAgIH07XHJcblxyXG4gICAgVUkubW9kYWwucHJvbXB0ID0gZnVuY3Rpb24odGV4dCwgdmFsdWUsIG9uc3VibWl0LCBvcHRpb25zKSB7XHJcblxyXG4gICAgICAgIG9uc3VibWl0ID0gVUkuJC5pc0Z1bmN0aW9uKG9uc3VibWl0KSA/IG9uc3VibWl0IDogZnVuY3Rpb24odmFsdWUpe307XHJcbiAgICAgICAgb3B0aW9ucyAgPSBVSS4kLmV4dGVuZCh0cnVlLCB7YmdjbG9zZTpmYWxzZSwga2V5Ym9hcmQ6ZmFsc2UsIG1vZGFsOmZhbHNlLCBsYWJlbHM6VUkubW9kYWwubGFiZWxzfSwgb3B0aW9ucyk7XHJcblxyXG4gICAgICAgIHZhciBtb2RhbCA9IFVJLm1vZGFsLmRpYWxvZygoW1xyXG4gICAgICAgICAgICB0ZXh0ID8gJzxkaXYgY2xhc3M9XCJ1ay1tb2RhbC1jb250ZW50IHVrLWZvcm1cIj4nK1N0cmluZyh0ZXh0KSsnPC9kaXY+JzonJyxcclxuICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJ1ay1tYXJnaW4tc21hbGwtdG9wIHVrLW1vZGFsLWNvbnRlbnQgdWstZm9ybVwiPjxwPjxpbnB1dCB0eXBlPVwidGV4dFwiIGNsYXNzPVwidWstd2lkdGgtMS0xXCI+PC9wPjwvZGl2PicsXHJcbiAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwidWstbW9kYWwtZm9vdGVyIHVrLXRleHQtcmlnaHRcIj48YnV0dG9uIGNsYXNzPVwidWstYnV0dG9uIHVrLW1vZGFsLWNsb3NlXCI+JytvcHRpb25zLmxhYmVscy5DYW5jZWwrJzwvYnV0dG9uPiA8YnV0dG9uIGNsYXNzPVwidWstYnV0dG9uIHVrLWJ1dHRvbi1wcmltYXJ5IGpzLW1vZGFsLW9rXCI+JytvcHRpb25zLmxhYmVscy5PaysnPC9idXR0b24+PC9kaXY+J1xyXG4gICAgICAgIF0pLmpvaW4oXCJcIiksIG9wdGlvbnMpLFxyXG5cclxuICAgICAgICBpbnB1dCA9IG1vZGFsLmVsZW1lbnQuZmluZChcImlucHV0W3R5cGU9J3RleHQnXVwiKS52YWwodmFsdWUgfHwgJycpLm9uKCdrZXl1cCcsIGZ1bmN0aW9uKGUpe1xyXG4gICAgICAgICAgICBpZiAoZS5rZXlDb2RlID09IDEzKSB7XHJcbiAgICAgICAgICAgICAgICBtb2RhbC5lbGVtZW50LmZpbmQoJy5qcy1tb2RhbC1vaycpLnRyaWdnZXIoJ2NsaWNrJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgbW9kYWwuZWxlbWVudC5maW5kKCcuanMtbW9kYWwtb2snKS5vbignY2xpY2snLCBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICBpZiAob25zdWJtaXQoaW5wdXQudmFsKCkpIT09ZmFsc2Upe1xyXG4gICAgICAgICAgICAgICAgbW9kYWwuaGlkZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiBtb2RhbC5zaG93KCk7XHJcbiAgICB9O1xyXG5cclxuICAgIFVJLm1vZGFsLmJsb2NrVUkgPSBmdW5jdGlvbihjb250ZW50LCBvcHRpb25zKSB7XHJcblxyXG4gICAgICAgIHZhciBtb2RhbCA9IFVJLm1vZGFsLmRpYWxvZygoW1xyXG4gICAgICAgICAgICAnPGRpdiBjbGFzcz1cInVrLW1hcmdpbiB1ay1tb2RhbC1jb250ZW50XCI+JytTdHJpbmcoY29udGVudCB8fCAnPGRpdiBjbGFzcz1cInVrLXRleHQtY2VudGVyXCI+Li4uPC9kaXY+JykrJzwvZGl2PidcclxuICAgICAgICBdKS5qb2luKFwiXCIpLCBVSS4kLmV4dGVuZCh7YmdjbG9zZTpmYWxzZSwga2V5Ym9hcmQ6ZmFsc2UsIG1vZGFsOmZhbHNlfSwgb3B0aW9ucykpO1xyXG5cclxuICAgICAgICBtb2RhbC5jb250ZW50ID0gbW9kYWwuZWxlbWVudC5maW5kKCcudWstbW9kYWwtY29udGVudDpmaXJzdCcpO1xyXG5cclxuICAgICAgICByZXR1cm4gbW9kYWwuc2hvdygpO1xyXG4gICAgfTtcclxuXHJcbiAgICBVSS5tb2RhbC5sYWJlbHMgPSB7XHJcbiAgICAgICAgT2s6ICdPaycsXHJcbiAgICAgICAgQ2FuY2VsOiAnQ2FuY2VsJ1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBoZWxwZXIgZnVuY3Rpb25zXHJcbiAgICBmdW5jdGlvbiBzZXRDb250ZW50KGNvbnRlbnQsIG1vZGFsKXtcclxuXHJcbiAgICAgICAgaWYoIW1vZGFsKSByZXR1cm47XHJcblxyXG4gICAgICAgIGlmICh0eXBlb2YgY29udGVudCA9PT0gJ29iamVjdCcpIHtcclxuXHJcbiAgICAgICAgICAgIC8vIGNvbnZlcnQgRE9NIG9iamVjdCB0byBhIGpRdWVyeSBvYmplY3RcclxuICAgICAgICAgICAgY29udGVudCA9IGNvbnRlbnQgaW5zdGFuY2VvZiBqUXVlcnkgPyBjb250ZW50IDogVUkuJChjb250ZW50KTtcclxuXHJcbiAgICAgICAgICAgIGlmKGNvbnRlbnQucGFyZW50KCkubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBtb2RhbC5wZXJzaXN0ID0gY29udGVudDtcclxuICAgICAgICAgICAgICAgIG1vZGFsLnBlcnNpc3QuZGF0YSgnbW9kYWxQZXJzaXN0UGFyZW50JywgY29udGVudC5wYXJlbnQoKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9ZWxzZSBpZiAodHlwZW9mIGNvbnRlbnQgPT09ICdzdHJpbmcnIHx8IHR5cGVvZiBjb250ZW50ID09PSAnbnVtYmVyJykge1xyXG4gICAgICAgICAgICAgICAgLy8ganVzdCBpbnNlcnQgdGhlIGRhdGEgYXMgaW5uZXJIVE1MXHJcbiAgICAgICAgICAgICAgICBjb250ZW50ID0gVUkuJCgnPGRpdj48L2Rpdj4nKS5odG1sKGNvbnRlbnQpO1xyXG4gICAgICAgIH1lbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIHVuc3VwcG9ydGVkIGRhdGEgdHlwZSFcclxuICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBVSS4kKCc8ZGl2PjwvZGl2PicpLmh0bWwoJ1VJa2l0Mi5tb2RhbCBFcnJvcjogVW5zdXBwb3J0ZWQgZGF0YSB0eXBlOiAnICsgdHlwZW9mIGNvbnRlbnQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29udGVudC5hcHBlbmRUbyhtb2RhbC5lbGVtZW50LmZpbmQoJy51ay1tb2RhbC1kaWFsb2cnKSk7XHJcblxyXG4gICAgICAgIHJldHVybiBtb2RhbDtcclxuICAgIH1cclxuXHJcbn0pKFVJa2l0Mik7Il19
