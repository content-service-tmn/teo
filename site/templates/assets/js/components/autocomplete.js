!function(t){var e;window.UIkit2&&(e=t(UIkit2)),"function"==typeof define&&define.amd&&define("uikit-autocomplete",["uikit"],function(){return e||t(UIkit2)})}(function(h){"use strict";var e;return h.component("autocomplete",{defaults:{minLength:3,param:"search",method:"post",delay:300,loadingClass:"uk-loading",flipDropdown:!1,skipClass:"uk-skip",hoverClass:"uk-active",source:null,renderer:null,template:'<ul class="uk-nav uk-nav-autocomplete uk-autocomplete-results">{{~items}}<li data-value="{{$item.value}}"><a>{{$item.value}}</a></li>{{/items}}</ul>'},visible:!1,value:null,selected:null,boot:function(){h.$html.on("focus.autocomplete.uikit","[data-uk-autocomplete]",function(t){var e=h.$(this);e.data("autocomplete")||h.autocomplete(e,h.Utils.options(e.attr("data-uk-autocomplete")))}),h.$html.on("click.autocomplete.uikit",function(t){e&&t.target!=e.input[0]&&e.hide()})},init:function(){var e=this,i=!1,t=h.Utils.debounce(function(t){if(i)return i=!1;e.handle()},this.options.delay);this.dropdown=this.find(".uk-dropdown"),this.template=this.find('script[type="text/autocomplete"]').html(),this.template=h.Utils.template(this.template||this.options.template),this.input=this.find("input:first").attr("autocomplete","off"),this.dropdown.length||(this.dropdown=h.$('<div class="uk-dropdown"></div>').appendTo(this.element)),this.options.flipDropdown&&this.dropdown.addClass("uk-dropdown-flip"),this.dropdown.attr("aria-expanded","false"),this.input.on({keydown:function(t){if(t&&t.which&&!t.shiftKey&&e.visible)switch(t.which){case 13:i=!0,e.selected&&(t.preventDefault(),e.select());break;case 38:t.preventDefault(),e.pick("prev",!0);break;case 40:t.preventDefault(),e.pick("next",!0);break;case 27:case 9:e.hide()}},keyup:t}),this.dropdown.on("click",".uk-autocomplete-results > *",function(){e.select()}),this.dropdown.on("mouseover",".uk-autocomplete-results > *",function(){e.pick(h.$(this))}),this.triggercomplete=t},handle:function(){var t=this.value;return this.value=this.input.val(),this.value.length<this.options.minLength?this.hide():(this.value!=t&&this.request(),this)},pick:function(t,e){var i=this,s=h.$(this.dropdown.find(".uk-autocomplete-results").children(":not(."+this.options.skipClass+")")),o=!1;if("string"==typeof t||t.hasClass(this.options.skipClass)){if("next"==t||"prev"==t){if(this.selected){var n=s.index(this.selected);o="next"==t?s.eq(n+1<s.length?n+1:0):s.eq(n-1<0?s.length-1:n-1)}else o=s["next"==t?"first":"last"]();o=h.$(o)}}else o=t;if(o&&o.length&&(this.selected=o,s.removeClass(this.options.hoverClass),this.selected.addClass(this.options.hoverClass),e)){var a=o.position().top,l=i.dropdown.scrollTop();(i.dropdown.height()<a||a<0)&&i.dropdown.scrollTop(l+a)}},select:function(){if(this.selected){var t=this.selected.data();this.trigger("selectitem.uk.autocomplete",[t,this]),t.value&&this.input.val(t.value).trigger("change"),this.hide()}},show:function(){if(!this.visible)return this.visible=!0,this.element.addClass("uk-open"),e&&e!==this&&e.hide(),(e=this).dropdown.attr("aria-expanded","true"),this},hide:function(){if(this.visible)return this.visible=!1,this.element.removeClass("uk-open"),e===this&&(e=!1),this.dropdown.attr("aria-expanded","false"),this},request:function(){var e=this,i=function(t){t&&e.render(t),e.element.removeClass(e.options.loadingClass)};if(this.element.addClass(this.options.loadingClass),this.options.source){var t=this.options.source;switch(typeof this.options.source){case"function":this.options.source.apply(this,[i]);break;case"object":if(t.length){var s=[];t.forEach(function(t){t.value&&-1!=t.value.toLowerCase().indexOf(e.value.toLowerCase())&&s.push(t)}),i(s)}break;case"string":var o={};o[this.options.param]=this.value,h.$.ajax({url:this.options.source,data:o,type:this.options.method,dataType:"json"}).done(function(t){i(t||[])});break;default:i(null)}}else this.element.removeClass(e.options.loadingClass)},render:function(t){return this.dropdown.empty(),this.selected=!1,this.options.renderer?this.options.renderer.apply(this,[t]):t&&t.length&&(this.dropdown.append(this.template({items:t})),this.show(),this.trigger("show.uk.autocomplete")),this}}),h.autocomplete});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvYXV0b2NvbXBsZXRlLmpzIl0sIm5hbWVzIjpbImFkZG9uIiwiY29tcG9uZW50Iiwid2luZG93IiwiVUlraXQyIiwiZGVmaW5lIiwiYW1kIiwiVUkiLCJhY3RpdmUiLCJkZWZhdWx0cyIsIm1pbkxlbmd0aCIsInBhcmFtIiwibWV0aG9kIiwiZGVsYXkiLCJsb2FkaW5nQ2xhc3MiLCJmbGlwRHJvcGRvd24iLCJza2lwQ2xhc3MiLCJob3ZlckNsYXNzIiwic291cmNlIiwicmVuZGVyZXIiLCJ0ZW1wbGF0ZSIsInZpc2libGUiLCJ2YWx1ZSIsInNlbGVjdGVkIiwiYm9vdCIsIiRodG1sIiwib24iLCJlIiwiZWxlIiwiJCIsInRoaXMiLCJkYXRhIiwiYXV0b2NvbXBsZXRlIiwiVXRpbHMiLCJvcHRpb25zIiwiYXR0ciIsInRhcmdldCIsImlucHV0IiwiaGlkZSIsImluaXQiLCIkdGhpcyIsInNlbGVjdCIsInRyaWdnZXIiLCJkZWJvdW5jZSIsImhhbmRsZSIsImRyb3Bkb3duIiwiZmluZCIsImh0bWwiLCJsZW5ndGgiLCJhcHBlbmRUbyIsImVsZW1lbnQiLCJhZGRDbGFzcyIsImtleWRvd24iLCJ3aGljaCIsInNoaWZ0S2V5IiwicHJldmVudERlZmF1bHQiLCJwaWNrIiwia2V5dXAiLCJ0cmlnZ2VyY29tcGxldGUiLCJvbGQiLCJ2YWwiLCJyZXF1ZXN0IiwiaXRlbSIsInNjcm9sbGludmlldyIsIml0ZW1zIiwiY2hpbGRyZW4iLCJoYXNDbGFzcyIsImluZGV4IiwiZXEiLCJyZW1vdmVDbGFzcyIsInRvcCIsInBvc2l0aW9uIiwic2Nyb2xsVG9wIiwiaGVpZ2h0Iiwic2hvdyIsInJlbGVhc2UiLCJyZW5kZXIiLCJhcHBseSIsImZvckVhY2giLCJ0b0xvd2VyQ2FzZSIsImluZGV4T2YiLCJwdXNoIiwicGFyYW1zIiwiYWpheCIsInVybCIsInR5cGUiLCJkYXRhVHlwZSIsImRvbmUiLCJqc29uIiwiZW1wdHkiLCJhcHBlbmQiXSwibWFwcGluZ3Mi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S0FBS0ksUUFBUXRCLE9BQ25CMEUsU0FBVSxTQUNYQyxLQUFLLFNBQVNDLEdBQ2JiLEVBQVFhLEdBQVEsTUFHcEIsTUFFSixRQUNJYixFQUFRLFlBSWhCN0MsS0FBS29CLFFBQVFtQixZQUFZN0IsRUFBTU4sUUFBUXBCLGVBSS9DOEQsT0FBUSxTQUFTN0MsR0FrQmIsT0FoQkFELEtBQUtlLFNBQVM0QyxRQUVkM0QsS0FBS1AsVUFBVyxFQUVaTyxLQUFLSSxRQUFRZixTQUViVyxLQUFLSSxRQUFRZixTQUFTMEQsTUFBTS9DLEtBQU0sQ0FBQ0MsSUFFN0JBLEdBQVFBLEVBQUtpQixTQUVuQmxCLEtBQUtlLFNBQVM2QyxPQUFPNUQsS0FBS1YsU0FBUyxDQUFDNEMsTUFBTWpDLEtBQzFDRCxLQUFLNEMsT0FFTDVDLEtBQUtZLFFBQVEseUJBR1ZaLFFBSVJ2QixFQUFHeUIiLCJmaWxlIjoiY29tcG9uZW50cy9hdXRvY29tcGxldGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiEgVUlraXQgMi4yNy4yIHwgaHR0cDovL3d3dy5nZXR1aWtpdC5jb20gfCAoYykgMjAxNCBZT090aGVtZSB8IE1JVCBMaWNlbnNlICovXG4oZnVuY3Rpb24oYWRkb24pIHtcblxuICAgIHZhciBjb21wb25lbnQ7XG5cbiAgICBpZiAod2luZG93LlVJa2l0Mikge1xuICAgICAgICBjb21wb25lbnQgPSBhZGRvbihVSWtpdDIpO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgZGVmaW5lID09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xuICAgICAgICBkZWZpbmUoJ3Vpa2l0LWF1dG9jb21wbGV0ZScsIFsndWlraXQnXSwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiBjb21wb25lbnQgfHwgYWRkb24oVUlraXQyKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG59KShmdW5jdGlvbihVSSl7XG5cbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIHZhciBhY3RpdmU7XG5cbiAgICBVSS5jb21wb25lbnQoJ2F1dG9jb21wbGV0ZScsIHtcblxuICAgICAgICBkZWZhdWx0czoge1xuICAgICAgICAgICAgbWluTGVuZ3RoOiAzLFxuICAgICAgICAgICAgcGFyYW06ICdzZWFyY2gnLFxuICAgICAgICAgICAgbWV0aG9kOiAncG9zdCcsXG4gICAgICAgICAgICBkZWxheTogMzAwLFxuICAgICAgICAgICAgbG9hZGluZ0NsYXNzOiAndWstbG9hZGluZycsXG4gICAgICAgICAgICBmbGlwRHJvcGRvd246IGZhbHNlLFxuICAgICAgICAgICAgc2tpcENsYXNzOiAndWstc2tpcCcsXG4gICAgICAgICAgICBob3ZlckNsYXNzOiAndWstYWN0aXZlJyxcbiAgICAgICAgICAgIHNvdXJjZTogbnVsbCxcbiAgICAgICAgICAgIHJlbmRlcmVyOiBudWxsLFxuXG4gICAgICAgICAgICAvLyB0ZW1wbGF0ZVxuXG4gICAgICAgICAgICB0ZW1wbGF0ZTogJzx1bCBjbGFzcz1cInVrLW5hdiB1ay1uYXYtYXV0b2NvbXBsZXRlIHVrLWF1dG9jb21wbGV0ZS1yZXN1bHRzXCI+e3t+aXRlbXN9fTxsaSBkYXRhLXZhbHVlPVwie3skaXRlbS52YWx1ZX19XCI+PGE+e3skaXRlbS52YWx1ZX19PC9hPjwvbGk+e3svaXRlbXN9fTwvdWw+J1xuICAgICAgICB9LFxuXG4gICAgICAgIHZpc2libGUgIDogZmFsc2UsXG4gICAgICAgIHZhbHVlICAgIDogbnVsbCxcbiAgICAgICAgc2VsZWN0ZWQgOiBudWxsLFxuXG4gICAgICAgIGJvb3Q6IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAvLyBpbml0IGNvZGVcbiAgICAgICAgICAgIFVJLiRodG1sLm9uKCdmb2N1cy5hdXRvY29tcGxldGUudWlraXQnLCAnW2RhdGEtdWstYXV0b2NvbXBsZXRlXScsIGZ1bmN0aW9uKGUpIHtcblxuICAgICAgICAgICAgICAgIHZhciBlbGUgPSBVSS4kKHRoaXMpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCFlbGUuZGF0YSgnYXV0b2NvbXBsZXRlJykpIHtcbiAgICAgICAgICAgICAgICAgICAgVUkuYXV0b2NvbXBsZXRlKGVsZSwgVUkuVXRpbHMub3B0aW9ucyhlbGUuYXR0cignZGF0YS11ay1hdXRvY29tcGxldGUnKSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyByZWdpc3RlciBvdXRlciBjbGljayBmb3IgYXV0b2NvbXBsZXRlc1xuICAgICAgICAgICAgVUkuJGh0bWwub24oJ2NsaWNrLmF1dG9jb21wbGV0ZS51aWtpdCcsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWN0aXZlICYmIGUudGFyZ2V0IT1hY3RpdmUuaW5wdXRbMF0pIGFjdGl2ZS5oaWRlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBpbml0OiBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgdmFyICR0aGlzICAgPSB0aGlzLFxuICAgICAgICAgICAgICAgIHNlbGVjdCAgPSBmYWxzZSxcbiAgICAgICAgICAgICAgICB0cmlnZ2VyID0gVUkuVXRpbHMuZGVib3VuY2UoZnVuY3Rpb24oZSkge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChzZWxlY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoc2VsZWN0ID0gZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgJHRoaXMuaGFuZGxlKCk7XG4gICAgICAgICAgICAgICAgfSwgdGhpcy5vcHRpb25zLmRlbGF5KTtcblxuXG4gICAgICAgICAgICB0aGlzLmRyb3Bkb3duID0gdGhpcy5maW5kKCcudWstZHJvcGRvd24nKTtcbiAgICAgICAgICAgIHRoaXMudGVtcGxhdGUgPSB0aGlzLmZpbmQoJ3NjcmlwdFt0eXBlPVwidGV4dC9hdXRvY29tcGxldGVcIl0nKS5odG1sKCk7XG4gICAgICAgICAgICB0aGlzLnRlbXBsYXRlID0gVUkuVXRpbHMudGVtcGxhdGUodGhpcy50ZW1wbGF0ZSB8fCB0aGlzLm9wdGlvbnMudGVtcGxhdGUpO1xuICAgICAgICAgICAgdGhpcy5pbnB1dCAgICA9IHRoaXMuZmluZChcImlucHV0OmZpcnN0XCIpLmF0dHIoXCJhdXRvY29tcGxldGVcIiwgXCJvZmZcIik7XG5cbiAgICAgICAgICAgIGlmICghdGhpcy5kcm9wZG93bi5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24gPSBVSS4kKCc8ZGl2IGNsYXNzPVwidWstZHJvcGRvd25cIj48L2Rpdj4nKS5hcHBlbmRUbyh0aGlzLmVsZW1lbnQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmZsaXBEcm9wZG93bikge1xuICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24uYWRkQ2xhc3MoJ3VrLWRyb3Bkb3duLWZsaXAnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5hdHRyKCdhcmlhLWV4cGFuZGVkJywgJ2ZhbHNlJyk7XG5cbiAgICAgICAgICAgIHRoaXMuaW5wdXQub24oe1xuXG4gICAgICAgICAgICAgICAga2V5ZG93bjogZnVuY3Rpb24oZSkge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChlICYmIGUud2hpY2ggJiYgIWUuc2hpZnRLZXkgJiYgJHRoaXMudmlzaWJsZSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGUud2hpY2gpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDEzOiAvLyBlbnRlclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3QgPSB0cnVlO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy5zZWxlY3RlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMuc2VsZWN0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAzODogLy8gdXBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5waWNrKCdwcmV2JywgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNDA6IC8vIGRvd25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5waWNrKCduZXh0JywgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA5OiAvLyBlc2MsIHRhYlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAga2V5dXA6IHRyaWdnZXJcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLmRyb3Bkb3duLm9uKCdjbGljaycsICcudWstYXV0b2NvbXBsZXRlLXJlc3VsdHMgPiAqJywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAkdGhpcy5zZWxlY3QoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLmRyb3Bkb3duLm9uKCdtb3VzZW92ZXInLCAnLnVrLWF1dG9jb21wbGV0ZS1yZXN1bHRzID4gKicsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgJHRoaXMucGljayhVSS4kKHRoaXMpKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLnRyaWdnZXJjb21wbGV0ZSA9IHRyaWdnZXI7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaGFuZGxlOiBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgdmFyICR0aGlzID0gdGhpcywgb2xkID0gdGhpcy52YWx1ZTtcblxuICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMuaW5wdXQudmFsKCk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnZhbHVlLmxlbmd0aCA8IHRoaXMub3B0aW9ucy5taW5MZW5ndGgpIHJldHVybiB0aGlzLmhpZGUoKTtcblxuICAgICAgICAgICAgaWYgKHRoaXMudmFsdWUgIT0gb2xkKSB7XG4gICAgICAgICAgICAgICAgJHRoaXMucmVxdWVzdCgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICBwaWNrOiBmdW5jdGlvbihpdGVtLCBzY3JvbGxpbnZpZXcpIHtcblxuICAgICAgICAgICAgdmFyICR0aGlzICAgID0gdGhpcyxcbiAgICAgICAgICAgICAgICBpdGVtcyAgICA9IFVJLiQodGhpcy5kcm9wZG93bi5maW5kKCcudWstYXV0b2NvbXBsZXRlLXJlc3VsdHMnKS5jaGlsZHJlbignOm5vdCguJyt0aGlzLm9wdGlvbnMuc2tpcENsYXNzKycpJykpLFxuICAgICAgICAgICAgICAgIHNlbGVjdGVkID0gZmFsc2U7XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2YgaXRlbSAhPT0gXCJzdHJpbmdcIiAmJiAhaXRlbS5oYXNDbGFzcyh0aGlzLm9wdGlvbnMuc2tpcENsYXNzKSkge1xuICAgICAgICAgICAgICAgIHNlbGVjdGVkID0gaXRlbTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbSA9PSAnbmV4dCcgfHwgaXRlbSA9PSAncHJldicpIHtcblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IGl0ZW1zLmluZGV4KHRoaXMuc2VsZWN0ZWQpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtID09ICduZXh0Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWQgPSBpdGVtcy5lcShpbmRleCArIDEgPCBpdGVtcy5sZW5ndGggPyBpbmRleCArIDEgOiAwKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkID0gaXRlbXMuZXEoaW5kZXggLSAxIDwgMCA/IGl0ZW1zLmxlbmd0aCAtIDEgOiBpbmRleCAtIDEpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZCA9IGl0ZW1zWyhpdGVtID09ICduZXh0JykgPyAnZmlyc3QnIDogJ2xhc3QnXSgpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHNlbGVjdGVkID0gVUkuJChzZWxlY3RlZCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChzZWxlY3RlZCAmJiBzZWxlY3RlZC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkID0gc2VsZWN0ZWQ7XG4gICAgICAgICAgICAgICAgaXRlbXMucmVtb3ZlQ2xhc3ModGhpcy5vcHRpb25zLmhvdmVyQ2xhc3MpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQuYWRkQ2xhc3ModGhpcy5vcHRpb25zLmhvdmVyQ2xhc3MpO1xuXG4gICAgICAgICAgICAgICAgLy8ganVtcCB0byBzZWxlY3RlZCBpZiBub3QgaW4gdmlld1xuICAgICAgICAgICAgICAgIGlmIChzY3JvbGxpbnZpZXcpIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgdG9wICAgICAgID0gc2VsZWN0ZWQucG9zaXRpb24oKS50b3AsXG4gICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxUb3AgPSAkdGhpcy5kcm9wZG93bi5zY3JvbGxUb3AoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRwaGVpZ2h0ICA9ICR0aGlzLmRyb3Bkb3duLmhlaWdodCgpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0b3AgPiBkcGhlaWdodCB8fCAgdG9wIDwgMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMuZHJvcGRvd24uc2Nyb2xsVG9wKHNjcm9sbFRvcCArIHRvcCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2VsZWN0OiBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgaWYoIXRoaXMuc2VsZWN0ZWQpIHJldHVybjtcblxuICAgICAgICAgICAgdmFyIGRhdGEgPSB0aGlzLnNlbGVjdGVkLmRhdGEoKTtcblxuICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCdzZWxlY3RpdGVtLnVrLmF1dG9jb21wbGV0ZScsIFtkYXRhLCB0aGlzXSk7XG5cbiAgICAgICAgICAgIGlmIChkYXRhLnZhbHVlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pbnB1dC52YWwoZGF0YS52YWx1ZSkudHJpZ2dlcignY2hhbmdlJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuaGlkZSgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNob3c6IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICBpZiAodGhpcy52aXNpYmxlKSByZXR1cm47XG5cbiAgICAgICAgICAgIHRoaXMudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoJ3VrLW9wZW4nKTtcblxuICAgICAgICAgICAgaWYgKGFjdGl2ZSAmJiBhY3RpdmUhPT10aGlzKSB7XG4gICAgICAgICAgICAgICAgYWN0aXZlLmhpZGUoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYWN0aXZlID0gdGhpcztcblxuICAgICAgICAgICAgLy8gVXBkYXRlIGFyaWFcbiAgICAgICAgICAgIHRoaXMuZHJvcGRvd24uYXR0cignYXJpYS1leHBhbmRlZCcsICd0cnVlJyk7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIGhpZGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLnZpc2libGUpIHJldHVybjtcbiAgICAgICAgICAgIHRoaXMudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKCd1ay1vcGVuJyk7XG5cbiAgICAgICAgICAgIGlmIChhY3RpdmUgPT09IHRoaXMpIHtcbiAgICAgICAgICAgICAgICBhY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gVXBkYXRlIGFyaWFcbiAgICAgICAgICAgIHRoaXMuZHJvcGRvd24uYXR0cignYXJpYS1leHBhbmRlZCcsICdmYWxzZScpO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSxcblxuICAgICAgICByZXF1ZXN0OiBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgdmFyICR0aGlzICAgPSB0aGlzLFxuICAgICAgICAgICAgICAgIHJlbGVhc2UgPSBmdW5jdGlvbihkYXRhKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMucmVuZGVyKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgJHRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcygkdGhpcy5vcHRpb25zLmxvYWRpbmdDbGFzcyk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdGhpcy5lbGVtZW50LmFkZENsYXNzKHRoaXMub3B0aW9ucy5sb2FkaW5nQ2xhc3MpO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLnNvdXJjZSkge1xuXG4gICAgICAgICAgICAgICAgdmFyIHNvdXJjZSA9IHRoaXMub3B0aW9ucy5zb3VyY2U7XG5cbiAgICAgICAgICAgICAgICBzd2l0Y2godHlwZW9mKHRoaXMub3B0aW9ucy5zb3VyY2UpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2Z1bmN0aW9uJzpcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLnNvdXJjZS5hcHBseSh0aGlzLCBbcmVsZWFzZV0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihzb3VyY2UubGVuZ3RoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbXMgPSBbXTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihpdGVtLnZhbHVlICYmIGl0ZW0udmFsdWUudG9Mb3dlckNhc2UoKS5pbmRleE9mKCR0aGlzLnZhbHVlLnRvTG93ZXJDYXNlKCkpIT0tMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXMucHVzaChpdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVsZWFzZShpdGVtcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXJhbXMgPXt9O1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXNbdGhpcy5vcHRpb25zLnBhcmFtXSA9IHRoaXMudmFsdWU7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIFVJLiQuYWpheCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiB0aGlzLm9wdGlvbnMuc291cmNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHBhcmFtcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiB0aGlzLm9wdGlvbnMubWV0aG9kLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbidcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLmRvbmUoZnVuY3Rpb24oanNvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbGVhc2UoanNvbiB8fCBbXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlbGVhc2UobnVsbCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcygkdGhpcy5vcHRpb25zLmxvYWRpbmdDbGFzcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVuZGVyOiBmdW5jdGlvbihkYXRhKSB7XG5cbiAgICAgICAgICAgIHRoaXMuZHJvcGRvd24uZW1wdHkoKTtcblxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZCA9IGZhbHNlO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLnJlbmRlcmVyKSB7XG5cbiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMucmVuZGVyZXIuYXBwbHkodGhpcywgW2RhdGFdKTtcblxuICAgICAgICAgICAgfSBlbHNlIGlmKGRhdGEgJiYgZGF0YS5sZW5ndGgpIHtcblxuICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24uYXBwZW5kKHRoaXMudGVtcGxhdGUoe2l0ZW1zOmRhdGF9KSk7XG4gICAgICAgICAgICAgICAgdGhpcy5zaG93KCk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoJ3Nob3cudWsuYXV0b2NvbXBsZXRlJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gVUkuYXV0b2NvbXBsZXRlO1xufSk7Il19
