!function(t){var e;window.UIkit2&&(e=t(UIkit2)),"function"==typeof define&&define.amd&&define("uikit-autocomplete",["uikit"],function(){return e||t(UIkit2)})}(function(h){"use strict";var e;return h.component("autocomplete",{defaults:{minLength:3,param:"search",method:"post",delay:300,loadingClass:"uk-loading",flipDropdown:!1,skipClass:"uk-skip",hoverClass:"uk-active",source:null,renderer:null,template:'<ul class="uk-nav uk-nav-autocomplete uk-autocomplete-results">{{~items}}<li data-value="{{$item.value}}"><a>{{$item.value}}</a></li>{{/items}}</ul>'},visible:!1,value:null,selected:null,boot:function(){h.$html.on("focus.autocomplete.uikit","[data-uk-autocomplete]",function(t){var e=h.$(this);e.data("autocomplete")||h.autocomplete(e,h.Utils.options(e.attr("data-uk-autocomplete")))}),h.$html.on("click.autocomplete.uikit",function(t){e&&t.target!=e.input[0]&&e.hide()})},init:function(){var e=this,i=!1,t=h.Utils.debounce(function(t){if(i)return i=!1;e.handle()},this.options.delay);this.dropdown=this.find(".uk-dropdown"),this.template=this.find('script[type="text/autocomplete"]').html(),this.template=h.Utils.template(this.template||this.options.template),this.input=this.find("input:first").attr("autocomplete","off"),this.dropdown.length||(this.dropdown=h.$('<div class="uk-dropdown"></div>').appendTo(this.element)),this.options.flipDropdown&&this.dropdown.addClass("uk-dropdown-flip"),this.dropdown.attr("aria-expanded","false"),this.input.on({keydown:function(t){if(t&&t.which&&!t.shiftKey&&e.visible)switch(t.which){case 13:i=!0,e.selected&&(t.preventDefault(),e.select());break;case 38:t.preventDefault(),e.pick("prev",!0);break;case 40:t.preventDefault(),e.pick("next",!0);break;case 27:case 9:e.hide()}},keyup:t}),this.dropdown.on("click",".uk-autocomplete-results > *",function(){e.select()}),this.dropdown.on("mouseover",".uk-autocomplete-results > *",function(){e.pick(h.$(this))}),this.triggercomplete=t},handle:function(){var t=this.value;return this.value=this.input.val(),this.value.length<this.options.minLength?this.hide():(this.value!=t&&this.request(),this)},pick:function(t,e){var i=this,s=h.$(this.dropdown.find(".uk-autocomplete-results").children(":not(."+this.options.skipClass+")")),o=!1;if("string"==typeof t||t.hasClass(this.options.skipClass)){if("next"==t||"prev"==t){if(this.selected){var n=s.index(this.selected);o="next"==t?s.eq(n+1<s.length?n+1:0):s.eq(n-1<0?s.length-1:n-1)}else o=s["next"==t?"first":"last"]();o=h.$(o)}}else o=t;if(o&&o.length&&(this.selected=o,s.removeClass(this.options.hoverClass),this.selected.addClass(this.options.hoverClass),e)){var a=o.position().top,l=i.dropdown.scrollTop();(i.dropdown.height()<a||a<0)&&i.dropdown.scrollTop(l+a)}},select:function(){if(this.selected){var t=this.selected.data();this.trigger("selectitem.uk.autocomplete",[t,this]),t.value&&this.input.val(t.value).trigger("change"),this.hide()}},show:function(){if(!this.visible)return this.visible=!0,this.element.addClass("uk-open"),e&&e!==this&&e.hide(),(e=this).dropdown.attr("aria-expanded","true"),this},hide:function(){if(this.visible)return this.visible=!1,this.element.removeClass("uk-open"),e===this&&(e=!1),this.dropdown.attr("aria-expanded","false"),this},request:function(){var e=this,i=function(t){t&&e.render(t),e.element.removeClass(e.options.loadingClass)};if(this.element.addClass(this.options.loadingClass),this.options.source){var t=this.options.source;switch(typeof this.options.source){case"function":this.options.source.apply(this,[i]);break;case"object":if(t.length){var s=[];t.forEach(function(t){t.value&&-1!=t.value.toLowerCase().indexOf(e.value.toLowerCase())&&s.push(t)}),i(s)}break;case"string":var o={};o[this.options.param]=this.value,h.$.ajax({url:this.options.source,data:o,type:this.options.method,dataType:"json"}).done(function(t){i(t||[])});break;default:i(null)}}else this.element.removeClass(e.options.loadingClass)},render:function(t){return this.dropdown.empty(),this.selected=!1,this.options.renderer?this.options.renderer.apply(this,[t]):t&&t.length&&(this.dropdown.append(this.template({items:t})),this.show(),this.trigger("show.uk.autocomplete")),this}}),h.autocomplete});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvYXV0b2NvbXBsZXRlLmpzIl0sIm5hbWVzIjpbImFkZG9uIiwiY29tcG9uZW50Iiwid2luZG93IiwiVUlraXQyIiwiZGVmaW5lIiwiYW1kIiwiVUkiLCJhY3RpdmUiLCJkZWZhdWx0cyIsIm1pbkxlbmd0aCIsInBhcmFtIiwibWV0aG9kIiwiZGVsYXkiLCJsb2FkaW5nQ2xhc3MiLCJmbGlwRHJvcGRvd24iLCJza2lwQ2xhc3MiLCJob3ZlckNsYXNzIiwic291cmNlIiwicmVuZGVyZXIiLCJ0ZW1wbGF0ZSIsInZpc2libGUiLCJ2YWx1ZSIsInNlbGVjdGVkIiwiYm9vdCIsIiRodG1sIiwib24iLCJlIiwiZWxlIiwiJCIsInRoaXMiLCJkYXRhIiwiYXV0b2NvbXBsZXRlIiwiVXRpbHMiLCJvcHRpb25zIiwiYXR0ciIsInRhcmdldCIsImlucHV0IiwiaGlkZSIsImluaXQiLCIkdGhpcyIsInNlbGVjdCIsInRyaWdnZXIiLCJkZWJvdW5jZSIsImhhbmRsZSIsImRyb3Bkb3duIiwiZmluZCIsImh0bWwiLCJsZW5ndGgiLCJhcHBlbmRUbyIsImVsZW1lbnQiLCJhZGRDbGFzcyIsImtleWRvd24iLCJ3aGljaCIsInNoaWZ0S2V5IiwicHJldmVudERlZmF1bHQiLCJwaWNrIiwia2V5dXAiLCJ0cmlnZ2VyY29tcGxldGUiLCJvbGQiLCJ2YWwiLCJyZXF1ZXN0IiwiaXRlbSIsInNjcm9sbGludmlldyIsIml0ZW1zIiwiY2hpbGRyZW4iLCJoYXNDbGFzcyIsImluZGV4IiwiZXEiLCJyZW1vdmVDbGFzcyIsInRvcCIsInBvc2l0aW9uIiwic2Nyb2xsVG9wIiwiaGVpZ2h0Iiwic2hvdyIsInJlbGVhc2UiLCJyZW5kZXIiLCJhcHBseSIsImZvckVhY2giLCJ0b0xvd2VyQ2FzZSIsImluZGV4T2YiLCJwdXNoIiwicGFyYW1zIiwiYWpheCIsInVybCIsInR5cGUiLCJkYXRhVHlwZSIsImRvbmUiLCJqc29uIiwiZW1wdHkiLCJhcHBlbmQiXSwibWFwcGluZ3MiOiJDQUNBLFNBQVVBLEdBRU4sSUFBSUMsRUFFQUMsT0FBT0MsU0FDUEYsRUFBWUQsRUFBTUcsU0FHRCxtQkFBVkMsUUFBd0JBLE9BQU9DLEtBQ3RDRCxPQUFPLHFCQUFzQixDQUFDLFNBQVUsV0FDcEMsT0FBT0gsR0FBYUQsRUFBTUcsVUFWdEMsQ0FjRyxTQUFTRyxHQUVSLGFBRUEsSUFBSUMsRUErVEosT0E3VEFELEVBQUdMLFVBQVUsZUFBZ0IsQ0FFekJPLFNBQVUsQ0FDTkMsVUFBVyxFQUNYQyxNQUFPLFNBQ1BDLE9BQVEsT0FDUkMsTUFBTyxJQUNQQyxhQUFjLGFBQ2RDLGNBQWMsRUFDZEMsVUFBVyxVQUNYQyxXQUFZLFlBQ1pDLE9BQVEsS0FDUkMsU0FBVSxLQUlWQyxTQUFVLHdKQUdkQyxTQUFXLEVBQ1hDLE1BQVcsS0FDWEMsU0FBVyxLQUVYQyxLQUFNLFdBR0ZqQixFQUFHa0IsTUFBTUMsR0FBRywyQkFBNEIseUJBQTBCLFNBQVNDLEdBRXZFLElBQUlDLEVBQU1yQixFQUFHc0IsRUFBRUMsTUFFVkYsRUFBSUcsS0FBSyxpQkFDVnhCLEVBQUd5QixhQUFhSixFQUFLckIsRUFBRzBCLE1BQU1DLFFBQVFOLEVBQUlPLEtBQUssNEJBS3ZENUIsRUFBR2tCLE1BQU1DLEdBQUcsMkJBQTRCLFNBQVNDLEdBQ3pDbkIsR0FBVW1CLEVBQUVTLFFBQVE1QixFQUFPNkIsTUFBTSxJQUFJN0IsRUFBTzhCLFVBSXhEQyxLQUFNLFdBRUYsSUFBSUMsRUFBVVYsS0FDVlcsR0FBVSxFQUNWQyxFQUFVbkMsRUFBRzBCLE1BQU1VLFNBQVMsU0FBU2hCLEdBRWpDLEdBQUljLEVBQ0EsT0FBUUEsR0FBUyxFQUdyQkQsRUFBTUksVUFDUGQsS0FBS0ksUUFBUXJCLE9BR3BCaUIsS0FBS2UsU0FBV2YsS0FBS2dCLEtBQUssZ0JBQzFCaEIsS0FBS1YsU0FBV1UsS0FBS2dCLEtBQUssb0NBQW9DQyxPQUM5RGpCLEtBQUtWLFNBQVdiLEVBQUcwQixNQUFNYixTQUFTVSxLQUFLVixVQUFZVSxLQUFLSSxRQUFRZCxVQUNoRVUsS0FBS08sTUFBV1AsS0FBS2dCLEtBQUssZUFBZVgsS0FBSyxlQUFnQixPQUV6REwsS0FBS2UsU0FBU0csU0FDaEJsQixLQUFLZSxTQUFXdEMsRUFBR3NCLEVBQUUsbUNBQW1Db0IsU0FBU25CLEtBQUtvQixVQUdyRXBCLEtBQUtJLFFBQVFuQixjQUNiZSxLQUFLZSxTQUFTTSxTQUFTLG9CQUczQnJCLEtBQUtlLFNBQVNWLEtBQUssZ0JBQWlCLFNBRXBDTCxLQUFLTyxNQUFNWCxHQUFHLENBRVYwQixRQUFTLFNBQVN6QixHQUVkLEdBQUlBLEdBQUtBLEVBQUUwQixRQUFVMUIsRUFBRTJCLFVBQVlkLEVBQU1uQixRQUVyQyxPQUFRTSxFQUFFMEIsT0FDTixLQUFLLEdBQ0RaLEdBQVMsRUFFTEQsRUFBTWpCLFdBQ05JLEVBQUU0QixpQkFDRmYsRUFBTUMsVUFFVixNQUNKLEtBQUssR0FDRGQsRUFBRTRCLGlCQUNGZixFQUFNZ0IsS0FBSyxRQUFRLEdBQ25CLE1BQ0osS0FBSyxHQUNEN0IsRUFBRTRCLGlCQUNGZixFQUFNZ0IsS0FBSyxRQUFRLEdBQ25CLE1BQ0osS0FBSyxHQUNMLEtBQUssRUFDRGhCLEVBQU1GLFNBU3RCbUIsTUFBT2YsSUFHWFosS0FBS2UsU0FBU25CLEdBQUcsUUFBUywrQkFBZ0MsV0FDdERjLEVBQU1DLFdBR1ZYLEtBQUtlLFNBQVNuQixHQUFHLFlBQWEsK0JBQWdDLFdBQzFEYyxFQUFNZ0IsS0FBS2pELEVBQUdzQixFQUFFQyxTQUdwQkEsS0FBSzRCLGdCQUFrQmhCLEdBRzNCRSxPQUFRLFdBRUosSUFBa0JlLEVBQU03QixLQUFLUixNQUk3QixPQUZBUSxLQUFLUixNQUFRUSxLQUFLTyxNQUFNdUIsTUFFcEI5QixLQUFLUixNQUFNMEIsT0FBU2xCLEtBQUtJLFFBQVF4QixVQUFrQm9CLEtBQUtRLFFBRXhEUixLQUFLUixPQUFTcUMsR0FOTjdCLEtBT0YrQixVQUdIL0IsT0FHWDBCLEtBQU0sU0FBU00sRUFBTUMsR0FFakIsSUFBSXZCLEVBQVdWLEtBQ1hrQyxFQUFXekQsRUFBR3NCLEVBQUVDLEtBQUtlLFNBQVNDLEtBQUssNEJBQTRCbUIsU0FBUyxTQUFTbkMsS0FBS0ksUUFBUWxCLFVBQVUsTUFDeEdPLEdBQVcsRUFFZixHQUFvQixpQkFBVHVDLEdBQXNCQSxFQUFLSSxTQUFTcEMsS0FBS0ksUUFBUWxCLFlBRXJELEdBQVksUUFBUjhDLEdBQTBCLFFBQVJBLEVBQWdCLENBRXpDLEdBQUloQyxLQUFLUCxTQUFVLENBQ2YsSUFBSTRDLEVBQVFILEVBQU1HLE1BQU1yQyxLQUFLUCxVQUd6QkEsRUFEUSxRQUFSdUMsRUFDV0UsRUFBTUksR0FBR0QsRUFBUSxFQUFJSCxFQUFNaEIsT0FBU21CLEVBQVEsRUFBSSxHQUVoREgsRUFBTUksR0FBR0QsRUFBUSxFQUFJLEVBQUlILEVBQU1oQixPQUFTLEVBQUltQixFQUFRLFFBSW5FNUMsRUFBV3lDLEVBQWUsUUFBUkYsRUFBa0IsUUFBVSxVQUdsRHZDLEVBQVdoQixFQUFHc0IsRUFBRU4sU0FoQmhCQSxFQUFXdUMsRUFtQmYsR0FBSXZDLEdBQVlBLEVBQVN5QixTQUNyQmxCLEtBQUtQLFNBQVdBLEVBQ2hCeUMsRUFBTUssWUFBWXZDLEtBQUtJLFFBQVFqQixZQUMvQmEsS0FBS1AsU0FBUzRCLFNBQVNyQixLQUFLSSxRQUFRakIsWUFHaEM4QyxHQUFjLENBRWQsSUFBSU8sRUFBWS9DLEVBQVNnRCxXQUFXRCxJQUNoQ0UsRUFBWWhDLEVBQU1LLFNBQVMyQixhQUNmaEMsRUFBTUssU0FBUzRCLFNBRTNCSCxHQUFtQkEsRUFBTSxJQUN6QjlCLEVBQU1LLFNBQVMyQixVQUFVQSxFQUFZRixLQU1yRDdCLE9BQVEsV0FFSixHQUFJWCxLQUFLUCxTQUFULENBRUEsSUFBSVEsRUFBT0QsS0FBS1AsU0FBU1EsT0FFekJELEtBQUtZLFFBQVEsNkJBQThCLENBQUNYLEVBQU1ELE9BRTlDQyxFQUFLVCxPQUNMUSxLQUFLTyxNQUFNdUIsSUFBSTdCLEVBQUtULE9BQU9vQixRQUFRLFVBR3ZDWixLQUFLUSxTQUdUb0MsS0FBTSxXQUVGLElBQUk1QyxLQUFLVCxRQWNULE9BWkFTLEtBQUtULFNBQVUsRUFDZlMsS0FBS29CLFFBQVFDLFNBQVMsV0FFbEIzQyxHQUFVQSxJQUFTc0IsTUFDbkJ0QixFQUFPOEIsUUFHWDlCLEVBQVNzQixNQUdKZSxTQUFTVixLQUFLLGdCQUFpQixRQUU3QkwsTUFHWFEsS0FBTSxXQUNGLEdBQUtSLEtBQUtULFFBV1YsT0FWQVMsS0FBS1QsU0FBVSxFQUNmUyxLQUFLb0IsUUFBUW1CLFlBQVksV0FFckI3RCxJQUFXc0IsT0FDWHRCLEdBQVMsR0FJYnNCLEtBQUtlLFNBQVNWLEtBQUssZ0JBQWlCLFNBRTdCTCxNQUdYK0IsUUFBUyxXQUVMLElBQUlyQixFQUFVVixLQUNWNkMsRUFBVSxTQUFTNUMsR0FFWkEsR0FDQ1MsRUFBTW9DLE9BQU83QyxHQUdqQlMsRUFBTVUsUUFBUW1CLFlBQVk3QixFQUFNTixRQUFRcEIsZUFLaEQsR0FGQWdCLEtBQUtvQixRQUFRQyxTQUFTckIsS0FBS0ksUUFBUXBCLGNBRS9CZ0IsS0FBS0ksUUFBUWhCLE9BQVEsQ0FFckIsSUFBSUEsRUFBU1ksS0FBS0ksUUFBUWhCLE9BRTFCLGNBQWNZLEtBQUtJLFFBQWMsUUFDN0IsSUFBSyxXQUVESixLQUFLSSxRQUFRaEIsT0FBTzJELE1BQU0vQyxLQUFNLENBQUM2QyxJQUVqQyxNQUVKLElBQUssU0FFRCxHQUFHekQsRUFBTzhCLE9BQVEsQ0FFZCxJQUFJZ0IsRUFBUSxHQUVaOUMsRUFBTzRELFFBQVEsU0FBU2hCLEdBQ2pCQSxFQUFLeEMsUUFBdUUsR0FBOUR3QyxFQUFLeEMsTUFBTXlELGNBQWNDLFFBQVF4QyxFQUFNbEIsTUFBTXlELGdCQUMxRGYsRUFBTWlCLEtBQUtuQixLQUluQmEsRUFBUVgsR0FHWixNQUVKLElBQUssU0FFRCxJQUFJa0IsRUFBUSxHQUVaQSxFQUFPcEQsS0FBS0ksUUFBUXZCLE9BQVNtQixLQUFLUixNQUVsQ2YsRUFBR3NCLEVBQUVzRCxLQUFLLENBQ05DLElBQUt0RCxLQUFLSSxRQUFRaEIsT0FDbEJhLEtBQU1tRCxFQUNORyxLQUFNdkQsS0FBS0ksUUFBUXRCLE9BQ25CMEUsU0FBVSxTQUNYQyxLQUFLLFNBQVNDLEdBQ2JiLEVBQVFhLEdBQVEsTUFHcEIsTUFFSixRQUNJYixFQUFRLFlBSWhCN0MsS0FBS29CLFFBQVFtQixZQUFZN0IsRUFBTU4sUUFBUXBCLGVBSS9DOEQsT0FBUSxTQUFTN0MsR0FrQmIsT0FoQkFELEtBQUtlLFNBQVM0QyxRQUVkM0QsS0FBS1AsVUFBVyxFQUVaTyxLQUFLSSxRQUFRZixTQUViVyxLQUFLSSxRQUFRZixTQUFTMEQsTUFBTS9DLEtBQU0sQ0FBQ0MsSUFFN0JBLEdBQVFBLEVBQUtpQixTQUVuQmxCLEtBQUtlLFNBQVM2QyxPQUFPNUQsS0FBS1YsU0FBUyxDQUFDNEMsTUFBTWpDLEtBQzFDRCxLQUFLNEMsT0FFTDVDLEtBQUtZLFFBQVEseUJBR1ZaLFFBSVJ2QixFQUFHeUIiLCJmaWxlIjoiY29tcG9uZW50cy9hdXRvY29tcGxldGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiEgVUlraXQgMi4yNy4yIHwgaHR0cDovL3d3dy5nZXR1aWtpdC5jb20gfCAoYykgMjAxNCBZT090aGVtZSB8IE1JVCBMaWNlbnNlICovXHJcbihmdW5jdGlvbihhZGRvbikge1xyXG5cclxuICAgIHZhciBjb21wb25lbnQ7XHJcblxyXG4gICAgaWYgKHdpbmRvdy5VSWtpdDIpIHtcclxuICAgICAgICBjb21wb25lbnQgPSBhZGRvbihVSWtpdDIpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0eXBlb2YgZGVmaW5lID09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xyXG4gICAgICAgIGRlZmluZSgndWlraXQtYXV0b2NvbXBsZXRlJywgWyd1aWtpdCddLCBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICByZXR1cm4gY29tcG9uZW50IHx8IGFkZG9uKFVJa2l0Mik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG59KShmdW5jdGlvbihVSSl7XHJcblxyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG4gICAgdmFyIGFjdGl2ZTtcclxuXHJcbiAgICBVSS5jb21wb25lbnQoJ2F1dG9jb21wbGV0ZScsIHtcclxuXHJcbiAgICAgICAgZGVmYXVsdHM6IHtcclxuICAgICAgICAgICAgbWluTGVuZ3RoOiAzLFxyXG4gICAgICAgICAgICBwYXJhbTogJ3NlYXJjaCcsXHJcbiAgICAgICAgICAgIG1ldGhvZDogJ3Bvc3QnLFxyXG4gICAgICAgICAgICBkZWxheTogMzAwLFxyXG4gICAgICAgICAgICBsb2FkaW5nQ2xhc3M6ICd1ay1sb2FkaW5nJyxcclxuICAgICAgICAgICAgZmxpcERyb3Bkb3duOiBmYWxzZSxcclxuICAgICAgICAgICAgc2tpcENsYXNzOiAndWstc2tpcCcsXHJcbiAgICAgICAgICAgIGhvdmVyQ2xhc3M6ICd1ay1hY3RpdmUnLFxyXG4gICAgICAgICAgICBzb3VyY2U6IG51bGwsXHJcbiAgICAgICAgICAgIHJlbmRlcmVyOiBudWxsLFxyXG5cclxuICAgICAgICAgICAgLy8gdGVtcGxhdGVcclxuXHJcbiAgICAgICAgICAgIHRlbXBsYXRlOiAnPHVsIGNsYXNzPVwidWstbmF2IHVrLW5hdi1hdXRvY29tcGxldGUgdWstYXV0b2NvbXBsZXRlLXJlc3VsdHNcIj57e35pdGVtc319PGxpIGRhdGEtdmFsdWU9XCJ7eyRpdGVtLnZhbHVlfX1cIj48YT57eyRpdGVtLnZhbHVlfX08L2E+PC9saT57ey9pdGVtc319PC91bD4nXHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgdmlzaWJsZSAgOiBmYWxzZSxcclxuICAgICAgICB2YWx1ZSAgICA6IG51bGwsXHJcbiAgICAgICAgc2VsZWN0ZWQgOiBudWxsLFxyXG5cclxuICAgICAgICBib290OiBmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgICAgIC8vIGluaXQgY29kZVxyXG4gICAgICAgICAgICBVSS4kaHRtbC5vbignZm9jdXMuYXV0b2NvbXBsZXRlLnVpa2l0JywgJ1tkYXRhLXVrLWF1dG9jb21wbGV0ZV0nLCBmdW5jdGlvbihlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGVsZSA9IFVJLiQodGhpcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCFlbGUuZGF0YSgnYXV0b2NvbXBsZXRlJykpIHtcclxuICAgICAgICAgICAgICAgICAgICBVSS5hdXRvY29tcGxldGUoZWxlLCBVSS5VdGlscy5vcHRpb25zKGVsZS5hdHRyKCdkYXRhLXVrLWF1dG9jb21wbGV0ZScpKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgLy8gcmVnaXN0ZXIgb3V0ZXIgY2xpY2sgZm9yIGF1dG9jb21wbGV0ZXNcclxuICAgICAgICAgICAgVUkuJGh0bWwub24oJ2NsaWNrLmF1dG9jb21wbGV0ZS51aWtpdCcsIGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChhY3RpdmUgJiYgZS50YXJnZXQhPWFjdGl2ZS5pbnB1dFswXSkgYWN0aXZlLmhpZGUoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgJHRoaXMgICA9IHRoaXMsXHJcbiAgICAgICAgICAgICAgICBzZWxlY3QgID0gZmFsc2UsXHJcbiAgICAgICAgICAgICAgICB0cmlnZ2VyID0gVUkuVXRpbHMuZGVib3VuY2UoZnVuY3Rpb24oZSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoc2VsZWN0ID0gZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgJHRoaXMuaGFuZGxlKCk7XHJcbiAgICAgICAgICAgICAgICB9LCB0aGlzLm9wdGlvbnMuZGVsYXkpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIHRoaXMuZHJvcGRvd24gPSB0aGlzLmZpbmQoJy51ay1kcm9wZG93bicpO1xyXG4gICAgICAgICAgICB0aGlzLnRlbXBsYXRlID0gdGhpcy5maW5kKCdzY3JpcHRbdHlwZT1cInRleHQvYXV0b2NvbXBsZXRlXCJdJykuaHRtbCgpO1xyXG4gICAgICAgICAgICB0aGlzLnRlbXBsYXRlID0gVUkuVXRpbHMudGVtcGxhdGUodGhpcy50ZW1wbGF0ZSB8fCB0aGlzLm9wdGlvbnMudGVtcGxhdGUpO1xyXG4gICAgICAgICAgICB0aGlzLmlucHV0ICAgID0gdGhpcy5maW5kKFwiaW5wdXQ6Zmlyc3RcIikuYXR0cihcImF1dG9jb21wbGV0ZVwiLCBcIm9mZlwiKTtcclxuXHJcbiAgICAgICAgICAgIGlmICghdGhpcy5kcm9wZG93bi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93biA9IFVJLiQoJzxkaXYgY2xhc3M9XCJ1ay1kcm9wZG93blwiPjwvZGl2PicpLmFwcGVuZFRvKHRoaXMuZWxlbWVudCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZmxpcERyb3Bkb3duKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLmFkZENsYXNzKCd1ay1kcm9wZG93bi1mbGlwJyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuZHJvcGRvd24uYXR0cignYXJpYS1leHBhbmRlZCcsICdmYWxzZScpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5pbnB1dC5vbih7XHJcblxyXG4gICAgICAgICAgICAgICAga2V5ZG93bjogZnVuY3Rpb24oZSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoZSAmJiBlLndoaWNoICYmICFlLnNoaWZ0S2V5ICYmICR0aGlzLnZpc2libGUpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoZS53aGljaCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxMzogLy8gZW50ZXJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3QgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMuc2VsZWN0ZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5zZWxlY3QoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDM4OiAvLyB1cFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5waWNrKCdwcmV2JywgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDQwOiAvLyBkb3duXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLnBpY2soJ25leHQnLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDk6IC8vIGVzYywgdGFiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMuaGlkZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB9LFxyXG5cclxuICAgICAgICAgICAgICAgIGtleXVwOiB0cmlnZ2VyXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5vbignY2xpY2snLCAnLnVrLWF1dG9jb21wbGV0ZS1yZXN1bHRzID4gKicsIGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAkdGhpcy5zZWxlY3QoKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmRyb3Bkb3duLm9uKCdtb3VzZW92ZXInLCAnLnVrLWF1dG9jb21wbGV0ZS1yZXN1bHRzID4gKicsIGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAkdGhpcy5waWNrKFVJLiQodGhpcykpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMudHJpZ2dlcmNvbXBsZXRlID0gdHJpZ2dlcjtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBoYW5kbGU6IGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICAgICAgdmFyICR0aGlzID0gdGhpcywgb2xkID0gdGhpcy52YWx1ZTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLmlucHV0LnZhbCgpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMudmFsdWUubGVuZ3RoIDwgdGhpcy5vcHRpb25zLm1pbkxlbmd0aCkgcmV0dXJuIHRoaXMuaGlkZSgpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMudmFsdWUgIT0gb2xkKSB7XHJcbiAgICAgICAgICAgICAgICAkdGhpcy5yZXF1ZXN0KCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIHBpY2s6IGZ1bmN0aW9uKGl0ZW0sIHNjcm9sbGludmlldykge1xyXG5cclxuICAgICAgICAgICAgdmFyICR0aGlzICAgID0gdGhpcyxcclxuICAgICAgICAgICAgICAgIGl0ZW1zICAgID0gVUkuJCh0aGlzLmRyb3Bkb3duLmZpbmQoJy51ay1hdXRvY29tcGxldGUtcmVzdWx0cycpLmNoaWxkcmVuKCc6bm90KC4nK3RoaXMub3B0aW9ucy5za2lwQ2xhc3MrJyknKSksXHJcbiAgICAgICAgICAgICAgICBzZWxlY3RlZCA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBpdGVtICE9PSBcInN0cmluZ1wiICYmICFpdGVtLmhhc0NsYXNzKHRoaXMub3B0aW9ucy5za2lwQ2xhc3MpKSB7XHJcbiAgICAgICAgICAgICAgICBzZWxlY3RlZCA9IGl0ZW07XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbSA9PSAnbmV4dCcgfHwgaXRlbSA9PSAncHJldicpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zZWxlY3RlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IGl0ZW1zLmluZGV4KHRoaXMuc2VsZWN0ZWQpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbSA9PSAnbmV4dCcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWQgPSBpdGVtcy5lcShpbmRleCArIDEgPCBpdGVtcy5sZW5ndGggPyBpbmRleCArIDEgOiAwKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZCA9IGl0ZW1zLmVxKGluZGV4IC0gMSA8IDAgPyBpdGVtcy5sZW5ndGggLSAxIDogaW5kZXggLSAxKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZCA9IGl0ZW1zWyhpdGVtID09ICduZXh0JykgPyAnZmlyc3QnIDogJ2xhc3QnXSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHNlbGVjdGVkID0gVUkuJChzZWxlY3RlZCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChzZWxlY3RlZCAmJiBzZWxlY3RlZC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQgPSBzZWxlY3RlZDtcclxuICAgICAgICAgICAgICAgIGl0ZW1zLnJlbW92ZUNsYXNzKHRoaXMub3B0aW9ucy5ob3ZlckNsYXNzKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQuYWRkQ2xhc3ModGhpcy5vcHRpb25zLmhvdmVyQ2xhc3MpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIGp1bXAgdG8gc2VsZWN0ZWQgaWYgbm90IGluIHZpZXdcclxuICAgICAgICAgICAgICAgIGlmIChzY3JvbGxpbnZpZXcpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRvcCAgICAgICA9IHNlbGVjdGVkLnBvc2l0aW9uKCkudG9wLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxUb3AgPSAkdGhpcy5kcm9wZG93bi5zY3JvbGxUb3AoKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZHBoZWlnaHQgID0gJHRoaXMuZHJvcGRvd24uaGVpZ2h0KCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0b3AgPiBkcGhlaWdodCB8fCAgdG9wIDwgMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5kcm9wZG93bi5zY3JvbGxUb3Aoc2Nyb2xsVG9wICsgdG9wKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBzZWxlY3Q6IGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICAgICAgaWYoIXRoaXMuc2VsZWN0ZWQpIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgIHZhciBkYXRhID0gdGhpcy5zZWxlY3RlZC5kYXRhKCk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnRyaWdnZXIoJ3NlbGVjdGl0ZW0udWsuYXV0b2NvbXBsZXRlJywgW2RhdGEsIHRoaXNdKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChkYXRhLnZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlucHV0LnZhbChkYXRhLnZhbHVlKS50cmlnZ2VyKCdjaGFuZ2UnKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5oaWRlKCk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgc2hvdzogZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy52aXNpYmxlKSByZXR1cm47XHJcblxyXG4gICAgICAgICAgICB0aGlzLnZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoJ3VrLW9wZW4nKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChhY3RpdmUgJiYgYWN0aXZlIT09dGhpcykge1xyXG4gICAgICAgICAgICAgICAgYWN0aXZlLmhpZGUoKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgYWN0aXZlID0gdGhpcztcclxuXHJcbiAgICAgICAgICAgIC8vIFVwZGF0ZSBhcmlhXHJcbiAgICAgICAgICAgIHRoaXMuZHJvcGRvd24uYXR0cignYXJpYS1leHBhbmRlZCcsICd0cnVlJyk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBoaWRlOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLnZpc2libGUpIHJldHVybjtcclxuICAgICAgICAgICAgdGhpcy52aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcygndWstb3BlbicpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGFjdGl2ZSA9PT0gdGhpcykge1xyXG4gICAgICAgICAgICAgICAgYWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFVwZGF0ZSBhcmlhXHJcbiAgICAgICAgICAgIHRoaXMuZHJvcGRvd24uYXR0cignYXJpYS1leHBhbmRlZCcsICdmYWxzZScpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgcmVxdWVzdDogZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgJHRoaXMgICA9IHRoaXMsXHJcbiAgICAgICAgICAgICAgICByZWxlYXNlID0gZnVuY3Rpb24oZGF0YSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLnJlbmRlcihkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICR0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoJHRoaXMub3B0aW9ucy5sb2FkaW5nQ2xhc3MpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5hZGRDbGFzcyh0aGlzLm9wdGlvbnMubG9hZGluZ0NsYXNzKTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuc291cmNlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHNvdXJjZSA9IHRoaXMub3B0aW9ucy5zb3VyY2U7XHJcblxyXG4gICAgICAgICAgICAgICAgc3dpdGNoKHR5cGVvZih0aGlzLm9wdGlvbnMuc291cmNlKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2Z1bmN0aW9uJzpcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5zb3VyY2UuYXBwbHkodGhpcywgW3JlbGVhc2VdKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoc291cmNlLmxlbmd0aCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpdGVtcyA9IFtdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGl0ZW0udmFsdWUgJiYgaXRlbS52YWx1ZS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoJHRoaXMudmFsdWUudG9Mb3dlckNhc2UoKSkhPS0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2goaXRlbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVsZWFzZShpdGVtcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmFtcyA9e307XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXNbdGhpcy5vcHRpb25zLnBhcmFtXSA9IHRoaXMudmFsdWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBVSS4kLmFqYXgoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiB0aGlzLm9wdGlvbnMuc291cmNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogcGFyYW1zLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogdGhpcy5vcHRpb25zLm1ldGhvZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbidcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSkuZG9uZShmdW5jdGlvbihqc29uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWxlYXNlKGpzb24gfHwgW10pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWxlYXNlKG51bGwpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcygkdGhpcy5vcHRpb25zLmxvYWRpbmdDbGFzcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICByZW5kZXI6IGZ1bmN0aW9uKGRhdGEpIHtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuZHJvcGRvd24uZW1wdHkoKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMucmVuZGVyZXIpIHtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMucmVuZGVyZXIuYXBwbHkodGhpcywgW2RhdGFdKTtcclxuXHJcbiAgICAgICAgICAgIH0gZWxzZSBpZihkYXRhICYmIGRhdGEubGVuZ3RoKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5hcHBlbmQodGhpcy50ZW1wbGF0ZSh7aXRlbXM6ZGF0YX0pKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2hvdygpO1xyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlcignc2hvdy51ay5hdXRvY29tcGxldGUnKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIFVJLmF1dG9jb21wbGV0ZTtcclxufSk7Il19
