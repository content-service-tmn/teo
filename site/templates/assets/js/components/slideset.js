!function(t){var i;window.UIkit2&&(i=t(UIkit2)),"function"==typeof define&&define.amd&&define("uikit-slideset",["uikit"],function(){return i||t(UIkit2)})}(function(d){"use strict";var r;function n(t,i,e,s){var n,a,o,r,l=d.$.Deferred(),h=!1===this.options.delay?Math.floor(this.options.duration/2):this.options.delay,u=this;if(s=s||1,this.element.css("min-height",this.element.height()),e[0]===i[0])return l.resolve(),l.promise();if("object"==typeof t?(n=t[0],a=t[1]||t[0]):a=n=t,d.$body.css("overflow-x","hidden"),o=function(){if(i&&i.length&&i.hide().removeClass(a+" uk-animation-reverse").css({opacity:"","animation-delay":"",animation:""}),e.length){for(r=0;r<e.length;r++)e.eq(1==s?r:e.length-r-1).css("animation-delay",r*h+"ms");var t=function(){e.removeClass(""+n).css({opacity:"",display:"","animation-delay":"",animation:""}),l.resolve(),d.$body.css("overflow-x",""),u.element.css("min-height",""),t=!1};e.addClass(n)[1==s?"last":"first"]().one(d.support.animation.end,function(){t&&t()}).end().css("display",""),setTimeout(function(){t&&t()},e.length*h*2)}else l.resolve()},e.length&&e.css("animation-duration",this.options.duration+"ms"),i&&i.length)for(i.css("animation-duration",this.options.duration+"ms")[1==s?"last":"first"]().one(d.support.animation.end,function(){o()}),r=0;r<i.length;r++)!function(t,i){setTimeout(function(){i.css("display","none").css("display","").css("opacity",0).on(d.support.animation.end,function(){i.removeClass(a)}).addClass(a+" uk-animation-reverse")}.bind(this),r*h)}(0,i.eq(1==s?r:i.length-r-1));else o();return l.promise()}d.component("slideset",{defaults:{default:1,animation:"fade",duration:200,filter:"",delay:!1,controls:!1,autoplay:!1,autoplayInterval:7e3,pauseOnHover:!0},sets:[],boot:function(){d.ready(function(t){d.$("[data-uk-slideset]",t).each(function(){var t=d.$(this);t.data("slideset")||d.slideset(t,d.Utils.options(t.attr("data-uk-slideset")))})})},init:function(){var e=this;this.activeSet=!1,this.list=this.element.find(".uk-slideset"),this.nav=this.element.find(".uk-slideset-nav"),this.controls=this.options.controls?d.$(this.options.controls):this.element,d.$win.on("resize load",d.Utils.debounce(function(){e.update()},100)),e.list.addClass("uk-grid-width-1-"+e.options.default),["xlarge","large","medium","small"].forEach(function(t){e.options[t]&&e.list.addClass("uk-grid-width-"+t+"-1-"+e.options[t])}),this.on("click.uk.slideset","[data-uk-slideset-item]",function(t){if(t.preventDefault(),!e.animating){var i=d.$(this).attr("data-uk-slideset-item");if(e.activeSet!==i)switch(i){case"next":case"previous":e["next"==i?"next":"previous"]();break;default:e.show(parseInt(i,10))}}}),this.controls.on("click.uk.slideset","[data-uk-filter]",function(t){var i=d.$(this);i.parent().hasClass("uk-slideset")||(t.preventDefault(),e.animating||e.currentFilter==i.attr("data-uk-filter")||(e.updateFilter(i.attr("data-uk-filter")),e._hide().then(function(){e.update(!0,!0)})))}),this.on("swipeRight swipeLeft",function(t){e["swipeLeft"==t.type?"next":"previous"]()}),this.updateFilter(this.options.filter),this.update(),this.element.on({mouseenter:function(){e.options.pauseOnHover&&(e.hovering=!0)},mouseleave:function(){e.hovering=!1}}),this.options.autoplay&&this.start(),d.domObserve(this.list,function(t){e.list.children(":visible:not(.uk-active)").length&&e.update(!1,!0)})},update:function(t,i){var e,s=this.visible;if(this.visible=this.getVisibleOnCurrenBreakpoint(),s!=this.visible||i){for(this.children=this.list.children().hide(),this.items=this.getItems(),this.sets=function(t,i){var e,s=0,n=-1,a=t.length||0,o=[];if(i<1)return null;for(;s<a;)(e=s%i)?o[n][e]=t[s]:o[++n]=[t[s]],s++;s=0,a=o.length;for(;s<a;)o[s]=jQuery(o[s]),s++;return o}(this.items,this.visible),e=0;e<this.sets.length;e++)this.sets[e].css({display:"none"});if(this.nav.length&&this.nav.empty()){for(e=0;e<this.sets.length;e++)this.nav.append('<li data-uk-slideset-item="'+e+'"><a></a></li>');this.nav[1==this.nav.children().length?"addClass":"removeClass"]("uk-invisible")}this.activeSet=!1,this.show(0,!t)}},updateFilter:function(t){var i,e=this;this.currentFilter=t,this.controls.find("[data-uk-filter]").each(function(){(i=d.$(this)).parent().hasClass("uk-slideset")||(i.attr("data-uk-filter")==e.currentFilter?i.addClass("uk-active"):i.removeClass("uk-active"))})},getVisibleOnCurrenBreakpoint:function(){var i=null,e=d.$('<div style="position:absolute;height:1px;top:-1000px;width:100px"><div></div></div>').appendTo("body"),s=e.children().eq(0),n=this.options;return["xlarge","large","medium","small"].forEach(function(t){n[t]&&!i&&(e.attr("class","uk-grid-width-"+t+"-1-2").width(),50==s.width()&&(i=t))}),e.remove(),this.options[i]||this.options.default},getItems:function(){var n,a=[];return this.currentFilter?("string"==typeof(n=this.currentFilter||[])&&(n=n.split(/,/).map(function(t){return t.trim()})),this.children.each(function(t){var i=d.$(this),e=i.attr("data-uk-filter"),s=!n.length;e&&(e=e.split(/,/).map(function(t){return t.trim()}),n.forEach(function(t){-1<e.indexOf(t)&&(s=!0)})),s&&a.push(i[0])}),a=d.$(a)):a=this.list.children(),a},show:function(t,i,e){var s=this;if(this.activeSet!==t&&!this.animating){e=e||(t<this.activeSet?-1:1);var n=this.sets[this.activeSet]||[],a=this.sets[t],o=this._getAnimation();!i&&d.support.animation||(o=r.none),this.animating=!0,this.nav.length&&this.nav.children().removeClass("uk-active").eq(t).addClass("uk-active"),o.apply(s,[n,a,e]).then(function(){d.Utils.checkDisplay(a,!0),s.children.hide().removeClass("uk-active"),a.addClass("uk-active").css({display:"",opacity:""}),s.animating=!1,s.activeSet=t,d.Utils.checkDisplay(a,!0),s.trigger("show.uk.slideset",[a])})}},_getAnimation:function(){var t=r[this.options.animation]||r.none;return d.support.animation||(t=r.none),t},_hide:function(){var t=this,i=this.sets[this.activeSet]||[],e=this._getAnimation();return this.animating=!0,e.apply(t,[i,[],1]).then(function(){t.animating=!1})},next:function(){this.show(this.sets[this.activeSet+1]?this.activeSet+1:0,!1,1)},previous:function(){this.show(this.sets[this.activeSet-1]?this.activeSet-1:this.sets.length-1,!1,-1)},start:function(){this.stop();var t=this;this.interval=setInterval(function(){t.hovering||t.animating||t.next()},this.options.autoplayInterval)},stop:function(){this.interval&&clearInterval(this.interval)}}),r={none:function(){var t=d.$.Deferred();return t.resolve(),t.promise()},fade:function(t,i){return n.apply(this,["uk-animation-fade",t,i])},"slide-bottom":function(t,i){return n.apply(this,["uk-animation-slide-bottom",t,i])},"slide-top":function(t,i){return n.apply(this,["uk-animation-slide-top",t,i])},"slide-vertical":function(t,i,e){var s=["uk-animation-slide-top","uk-animation-slide-bottom"];return-1==e&&s.reverse(),n.apply(this,[s,t,i])},"slide-horizontal":function(t,i,e){var s=["uk-animation-slide-right","uk-animation-slide-left"];return-1==e&&s.reverse(),n.apply(this,[s,t,i,e])},scale:function(t,i){return n.apply(this,["uk-animation-scale-up",t,i])}},d.slideset.animations=r});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvc2xpZGVzZXQuanMiXSwibmFtZXMiOlsiYWRkb24iLCJjb21wb25lbnQiLCJ3aW5kb3ciLCJVSWtpdDIiLCJkZWZpbmUiLCJhbWQiLCJVSSIsIkFuaW1hdGlvbnMiLCJjb3JlQW5pbWF0aW9uIiwiY2xzIiwiY3VycmVudCIsIm5leHQiLCJkaXIiLCJjbHNJbiIsImNsc091dCIsInJlbGVhc2UiLCJpIiwiZCIsIiQiLCJEZWZlcnJlZCIsImRlbGF5IiwidGhpcyIsIm9wdGlvbnMiLCJNYXRoIiwiZmxvb3IiLCJkdXJhdGlvbiIsIiR0aGlzIiwiZWxlbWVudCIsImNzcyIsImhlaWdodCIsInJlc29sdmUiLCJwcm9taXNlIiwiJGJvZHkiLCJsZW5ndGgiLCJoaWRlIiwicmVtb3ZlQ2xhc3MiLCJvcGFjaXR5IiwiYW5pbWF0aW9uLWRlbGF5IiwiYW5pbWF0aW9uIiwiZXEiLCJmaW5pc2giLCJkaXNwbGF5IiwiYWRkQ2xhc3MiLCJvbmUiLCJzdXBwb3J0IiwiZW5kIiwic2V0VGltZW91dCIsImluZGV4IiwiZWxlIiwib24iLCJiaW5kIiwiZGVmYXVsdHMiLCJkZWZhdWx0IiwiZmlsdGVyIiwiY29udHJvbHMiLCJhdXRvcGxheSIsImF1dG9wbGF5SW50ZXJ2YWwiLCJwYXVzZU9uSG92ZXIiLCJzZXRzIiwiYm9vdCIsInJlYWR5IiwiY29udGV4dCIsImVhY2giLCJkYXRhIiwic2xpZGVzZXQiLCJVdGlscyIsImF0dHIiLCJpbml0IiwiYWN0aXZlU2V0IiwibGlzdCIsImZpbmQiLCJuYXYiLCIkd2luIiwiZGVib3VuY2UiLCJ1cGRhdGUiLCJmb3JFYWNoIiwiYnAiLCJlIiwicHJldmVudERlZmF1bHQiLCJhbmltYXRpbmciLCJzZXQiLCJzaG93IiwicGFyc2VJbnQiLCJwYXJlbnQiLCJoYXNDbGFzcyIsImN1cnJlbnRGaWx0ZXIiLCJ1cGRhdGVGaWx0ZXIiLCJfaGlkZSIsInRoZW4iLCJ0eXBlIiwibW91c2VlbnRlciIsImhvdmVyaW5nIiwibW91c2VsZWF2ZSIsInN0YXJ0IiwiZG9tT2JzZXJ2ZSIsImNoaWxkcmVuIiwiYW5pbWF0ZSIsImZvcmNlIiwidmlzaWJsZSIsImdldFZpc2libGVPbkN1cnJlbkJyZWFrcG9pbnQiLCJpdGVtcyIsImdldEl0ZW1zIiwiaW5wdXQiLCJzaXplIiwieCIsImMiLCJsIiwibiIsImpRdWVyeSIsImFycmF5X2NodW5rIiwiZW1wdHkiLCJhcHBlbmQiLCJjdXJyZW50ZmlsdGVyIiwiYnJlYWtwb2ludCIsInRtcCIsImFwcGVuZFRvIiwidGVzdGRpdiIsImJyZWFrcG9pbnRzIiwid2lkdGgiLCJyZW1vdmUiLCJzcGxpdCIsIm1hcCIsIml0ZW0iLCJ0cmltIiwiZiIsImluZmlsdGVyIiwiaW5kZXhPZiIsInB1c2giLCJzZXRJbmRleCIsIm5vYW5pbWF0ZSIsIl9nZXRBbmltYXRpb24iLCJub25lIiwiYXBwbHkiLCJjaGVja0Rpc3BsYXkiLCJ0cmlnZ2VyIiwicHJldmlvdXMiLCJzdG9wIiwiaW50ZXJ2YWwiLCJzZXRJbnRlcnZhbCIsImNsZWFySW50ZXJ2YWwiLCJmYWRlIiwic2xpZGUtYm90dG9tIiwic2xpZGUtdG9wIiwic2xpZGUtdmVydGljYWwiLCJhbmltIiwicmV2ZXJzZSIsInNsaWRlLWhvcml6b250YWwiLCJzY2FsZSIsImFuaW1hdGlvbnMiXSwibWFwcGluZ3MiOiJDQUNBLFNBQVVBLEdBRU4sSUFBSUMsRUFFQUMsT0FBT0MsU0FDUEYsRUFBWUQsRUFBTUcsU0FHRCxtQkFBVkMsUUFBd0JBLE9BQU9DLEtBQ3RDRCxPQUFPLGlCQUFrQixDQUFDLFNBQVUsV0FDaEMsT0FBT0gsR0FBYUQsRUFBTUcsVUFWdEMsQ0FjRyxTQUFTRyxHQUVSLGFBRUEsSUFBSUMsRUErWEosU0FBU0MsRUFBY0MsRUFBS0MsRUFBU0MsRUFBTUMsR0FFdkMsSUFFa0JDLEVBQU9DLEVBQVFDLEVBQVNDLEVBRnRDQyxFQUFRWCxFQUFHWSxFQUFFQyxXQUNiQyxHQUFnQyxJQUF2QkMsS0FBS0MsUUFBUUYsTUFBbUJHLEtBQUtDLE1BQU1I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dCAyLjI3LjIgfCBodHRwOi8vd3d3LmdldHVpa2l0LmNvbSB8IChjKSAyMDE0IFlPT3RoZW1lIHwgTUlUIExpY2Vuc2UgKi9cbihmdW5jdGlvbihhZGRvbikge1xuXG4gICAgdmFyIGNvbXBvbmVudDtcblxuICAgIGlmICh3aW5kb3cuVUlraXQyKSB7XG4gICAgICAgIGNvbXBvbmVudCA9IGFkZG9uKFVJa2l0Mik7XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiBkZWZpbmUgPT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7XG4gICAgICAgIGRlZmluZSgndWlraXQtc2xpZGVzZXQnLCBbJ3Vpa2l0J10sIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXR1cm4gY29tcG9uZW50IHx8IGFkZG9uKFVJa2l0Mik7XG4gICAgICAgIH0pO1xuICAgIH1cblxufSkoZnVuY3Rpb24oVUkpe1xuXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICB2YXIgQW5pbWF0aW9ucztcblxuICAgIFVJLmNvbXBvbmVudCgnc2xpZGVzZXQnLCB7XG5cbiAgICAgICAgZGVmYXVsdHM6IHtcbiAgICAgICAgICAgIGRlZmF1bHQgICAgICAgICAgOiAxLFxuICAgICAgICAgICAgYW5pbWF0aW9uICAgICAgICA6ICdmYWRlJyxcbiAgICAgICAgICAgIGR1cmF0aW9uICAgICAgICAgOiAyMDAsXG4gICAgICAgICAgICBmaWx0ZXIgICAgICAgICAgIDogJycsXG4gICAgICAgICAgICBkZWxheSAgICAgICAgICAgIDogZmFsc2UsXG4gICAgICAgICAgICBjb250cm9scyAgICAgICAgIDogZmFsc2UsXG4gICAgICAgICAgICBhdXRvcGxheSAgICAgICAgIDogZmFsc2UsXG4gICAgICAgICAgICBhdXRvcGxheUludGVydmFsIDogNzAwMCxcbiAgICAgICAgICAgIHBhdXNlT25Ib3ZlciAgICAgOiB0cnVlXG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0czogW10sXG5cbiAgICAgICAgYm9vdDogZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIC8vIGF1dG8gaW5pdFxuICAgICAgICAgICAgVUkucmVhZHkoZnVuY3Rpb24oY29udGV4dCkge1xuXG4gICAgICAgICAgICAgICAgVUkuJCgnW2RhdGEtdWstc2xpZGVzZXRdJywgY29udGV4dCkuZWFjaChmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBlbGUgPSBVSS4kKHRoaXMpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmKCFlbGUuZGF0YSgnc2xpZGVzZXQnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgVUkuc2xpZGVzZXQoZWxlLCBVSS5VdGlscy5vcHRpb25zKGVsZS5hdHRyKCdkYXRhLXVrLXNsaWRlc2V0JykpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIHZhciAkdGhpcyA9IHRoaXM7XG5cbiAgICAgICAgICAgIHRoaXMuYWN0aXZlU2V0ID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLmxpc3QgICAgICA9IHRoaXMuZWxlbWVudC5maW5kKCcudWstc2xpZGVzZXQnKTtcbiAgICAgICAgICAgIHRoaXMubmF2ICAgICAgID0gdGhpcy5lbGVtZW50LmZpbmQoJy51ay1zbGlkZXNldC1uYXYnKTtcbiAgICAgICAgICAgIHRoaXMuY29udHJvbHMgID0gdGhpcy5vcHRpb25zLmNvbnRyb2xzID8gVUkuJCh0aGlzLm9wdGlvbnMuY29udHJvbHMpIDogdGhpcy5lbGVtZW50O1xuXG4gICAgICAgICAgICBVSS4kd2luLm9uKCdyZXNpemUgbG9hZCcsIFVJLlV0aWxzLmRlYm91bmNlKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICR0aGlzLnVwZGF0ZSgpO1xuICAgICAgICAgICAgfSwgMTAwKSk7XG5cbiAgICAgICAgICAgICR0aGlzLmxpc3QuYWRkQ2xhc3MoJ3VrLWdyaWQtd2lkdGgtMS0nKyR0aGlzLm9wdGlvbnMuZGVmYXVsdCk7XG5cbiAgICAgICAgICAgIFsneGxhcmdlJywgJ2xhcmdlJywgJ21lZGl1bScsICdzbWFsbCddLmZvckVhY2goZnVuY3Rpb24oYnApIHtcblxuICAgICAgICAgICAgICAgIGlmICghJHRoaXMub3B0aW9uc1ticF0pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICR0aGlzLmxpc3QuYWRkQ2xhc3MoJ3VrLWdyaWQtd2lkdGgtJyticCsnLTEtJyskdGhpcy5vcHRpb25zW2JwXSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5vbignY2xpY2sudWsuc2xpZGVzZXQnLCAnW2RhdGEtdWstc2xpZGVzZXQtaXRlbV0nLCBmdW5jdGlvbihlKSB7XG5cbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoJHRoaXMuYW5pbWF0aW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgc2V0ID0gVUkuJCh0aGlzKS5hdHRyKCdkYXRhLXVrLXNsaWRlc2V0LWl0ZW0nKTtcblxuICAgICAgICAgICAgICAgIGlmICgkdGhpcy5hY3RpdmVTZXQgPT09IHNldCkgcmV0dXJuO1xuXG4gICAgICAgICAgICAgICAgc3dpdGNoKHNldCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlICduZXh0JzpcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAncHJldmlvdXMnOlxuICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXNbc2V0PT0nbmV4dCcgPyAnbmV4dCc6J3ByZXZpb3VzJ10oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMuc2hvdyhwYXJzZUludChzZXQsIDEwKSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5jb250cm9scy5vbignY2xpY2sudWsuc2xpZGVzZXQnLCAnW2RhdGEtdWstZmlsdGVyXScsIGZ1bmN0aW9uKGUpIHtcblxuICAgICAgICAgICAgICAgIHZhciBlbGUgPSBVSS4kKHRoaXMpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGVsZS5wYXJlbnQoKS5oYXNDbGFzcygndWstc2xpZGVzZXQnKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCR0aGlzLmFuaW1hdGluZyB8fCAkdGhpcy5jdXJyZW50RmlsdGVyID09IGVsZS5hdHRyKCdkYXRhLXVrLWZpbHRlcicpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAkdGhpcy51cGRhdGVGaWx0ZXIoZWxlLmF0dHIoJ2RhdGEtdWstZmlsdGVyJykpO1xuXG4gICAgICAgICAgICAgICAgJHRoaXMuX2hpZGUoKS50aGVuKGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgICAgICAgICAgICAgJHRoaXMudXBkYXRlKHRydWUsIHRydWUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMub24oJ3N3aXBlUmlnaHQgc3dpcGVMZWZ0JywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICR0aGlzW2UudHlwZT09J3N3aXBlTGVmdCcgPyAnbmV4dCcgOiAncHJldmlvdXMnXSgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMudXBkYXRlRmlsdGVyKHRoaXMub3B0aW9ucy5maWx0ZXIpO1xuICAgICAgICAgICAgdGhpcy51cGRhdGUoKTtcblxuICAgICAgICAgICAgdGhpcy5lbGVtZW50Lm9uKHtcbiAgICAgICAgICAgICAgICBtb3VzZWVudGVyOiBmdW5jdGlvbigpIHsgaWYgKCR0aGlzLm9wdGlvbnMucGF1c2VPbkhvdmVyKSAkdGhpcy5ob3ZlcmluZyA9IHRydWU7ICB9LFxuICAgICAgICAgICAgICAgIG1vdXNlbGVhdmU6IGZ1bmN0aW9uKCkgeyAkdGhpcy5ob3ZlcmluZyA9IGZhbHNlOyB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gU2V0IGF1dG9wbGF5XG4gICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmF1dG9wbGF5KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGFydCgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBVSS5kb21PYnNlcnZlKHRoaXMubGlzdCwgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgIGlmICgkdGhpcy5saXN0LmNoaWxkcmVuKCc6dmlzaWJsZTpub3QoLnVrLWFjdGl2ZSknKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgJHRoaXMudXBkYXRlKGZhbHNlLHRydWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIHVwZGF0ZTogZnVuY3Rpb24oYW5pbWF0ZSwgZm9yY2UpIHtcblxuICAgICAgICAgICAgdmFyIHZpc2libGUgPSB0aGlzLnZpc2libGUsIGk7XG5cbiAgICAgICAgICAgIHRoaXMudmlzaWJsZSAgPSB0aGlzLmdldFZpc2libGVPbkN1cnJlbkJyZWFrcG9pbnQoKTtcblxuICAgICAgICAgICAgaWYgKHZpc2libGUgPT0gdGhpcy52aXNpYmxlICYmICFmb3JjZSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5jaGlsZHJlbiA9IHRoaXMubGlzdC5jaGlsZHJlbigpLmhpZGUoKTtcbiAgICAgICAgICAgIHRoaXMuaXRlbXMgICAgPSB0aGlzLmdldEl0ZW1zKCk7XG4gICAgICAgICAgICB0aGlzLnNldHMgICAgID0gYXJyYXlfY2h1bmsodGhpcy5pdGVtcywgdGhpcy52aXNpYmxlKTtcblxuICAgICAgICAgICAgZm9yIChpPTA7aTx0aGlzLnNldHMubGVuZ3RoO2krKykge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0c1tpXS5jc3MoeydkaXNwbGF5JzogJ25vbmUnfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIHVwZGF0ZSBuYXZcbiAgICAgICAgICAgIGlmICh0aGlzLm5hdi5sZW5ndGggJiYgdGhpcy5uYXYuZW1wdHkoKSkge1xuXG4gICAgICAgICAgICAgICAgZm9yIChpPTA7aTx0aGlzLnNldHMubGVuZ3RoO2krKykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm5hdi5hcHBlbmQoJzxsaSBkYXRhLXVrLXNsaWRlc2V0LWl0ZW09XCInK2krJ1wiPjxhPjwvYT48L2xpPicpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoaXMubmF2W3RoaXMubmF2LmNoaWxkcmVuKCkubGVuZ3RoPT0xID8gJ2FkZENsYXNzJzoncmVtb3ZlQ2xhc3MnXSgndWstaW52aXNpYmxlJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuYWN0aXZlU2V0ID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLnNob3coMCwgIWFuaW1hdGUpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHVwZGF0ZUZpbHRlcjogZnVuY3Rpb24oY3VycmVudGZpbHRlcikge1xuXG4gICAgICAgICAgICB2YXIgJHRoaXMgPSB0aGlzLCBmaWx0ZXI7XG5cbiAgICAgICAgICAgIHRoaXMuY3VycmVudEZpbHRlciA9IGN1cnJlbnRmaWx0ZXI7XG5cbiAgICAgICAgICAgIHRoaXMuY29udHJvbHMuZmluZCgnW2RhdGEtdWstZmlsdGVyXScpLmVhY2goZnVuY3Rpb24oKXtcblxuICAgICAgICAgICAgICAgIGZpbHRlciA9IFVJLiQodGhpcyk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIWZpbHRlci5wYXJlbnQoKS5oYXNDbGFzcygndWstc2xpZGVzZXQnKSkge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWx0ZXIuYXR0cignZGF0YS11ay1maWx0ZXInKSA9PSAkdGhpcy5jdXJyZW50RmlsdGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXIuYWRkQ2xhc3MoJ3VrLWFjdGl2ZScpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyLnJlbW92ZUNsYXNzKCd1ay1hY3RpdmUnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGdldFZpc2libGVPbkN1cnJlbkJyZWFrcG9pbnQ6IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICB2YXIgYnJlYWtwb2ludCAgPSBudWxsLFxuICAgICAgICAgICAgICAgIHRtcCAgICAgICAgID0gVUkuJCgnPGRpdiBzdHlsZT1cInBvc2l0aW9uOmFic29sdXRlO2hlaWdodDoxcHg7dG9wOi0xMDAwcHg7d2lkdGg6MTAwcHhcIj48ZGl2PjwvZGl2PjwvZGl2PicpLmFwcGVuZFRvKCdib2R5JyksXG4gICAgICAgICAgICAgICAgdGVzdGRpdiAgICAgPSB0bXAuY2hpbGRyZW4oKS5lcSgwKSxcbiAgICAgICAgICAgICAgICBicmVha3BvaW50cyA9IHRoaXMub3B0aW9ucztcblxuICAgICAgICAgICAgICAgIFsneGxhcmdlJywgJ2xhcmdlJywgJ21lZGl1bScsICdzbWFsbCddLmZvckVhY2goZnVuY3Rpb24oYnApIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIWJyZWFrcG9pbnRzW2JwXSB8fCBicmVha3BvaW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB0bXAuYXR0cignY2xhc3MnLCAndWstZ3JpZC13aWR0aC0nK2JwKyctMS0yJykud2lkdGgoKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAodGVzdGRpdi53aWR0aCgpID09IDUwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVha3BvaW50ID0gYnA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHRtcC5yZW1vdmUoKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnNbYnJlYWtwb2ludF0gfHwgdGhpcy5vcHRpb25zWydkZWZhdWx0J107XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0SXRlbXM6IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICB2YXIgaXRlbXMgPSBbXSwgZmlsdGVyO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50RmlsdGVyKSB7XG5cbiAgICAgICAgICAgICAgICBmaWx0ZXIgPSB0aGlzLmN1cnJlbnRGaWx0ZXIgfHwgW107XG5cbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mKGZpbHRlcikgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlciA9IGZpbHRlci5zcGxpdCgvLC8pLm1hcChmdW5jdGlvbihpdGVtKXsgcmV0dXJuIGl0ZW0udHJpbSgpOyB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0aGlzLmNoaWxkcmVuLmVhY2goZnVuY3Rpb24oaW5kZXgpe1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBlbGUgPSBVSS4kKHRoaXMpLCBmID0gZWxlLmF0dHIoJ2RhdGEtdWstZmlsdGVyJyksIGluZmlsdGVyID0gZmlsdGVyLmxlbmd0aCA/IGZhbHNlIDogdHJ1ZTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoZikge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBmID0gZi5zcGxpdCgvLC8pLm1hcChmdW5jdGlvbihpdGVtKXsgcmV0dXJuIGl0ZW0udHJpbSgpOyB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyLmZvckVhY2goZnVuY3Rpb24oaXRlbSl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGYuaW5kZXhPZihpdGVtKSA+IC0xKSBpbmZpbHRlciA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmKGluZmlsdGVyKSBpdGVtcy5wdXNoKGVsZVswXSk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpdGVtcyA9IFVJLiQoaXRlbXMpO1xuXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGl0ZW1zID0gdGhpcy5saXN0LmNoaWxkcmVuKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBpdGVtcztcbiAgICAgICAgfSxcblxuICAgICAgICBzaG93OiBmdW5jdGlvbihzZXRJbmRleCwgbm9hbmltYXRlLCBkaXIpIHtcblxuICAgICAgICAgICAgdmFyICR0aGlzID0gdGhpcztcblxuICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlU2V0ID09PSBzZXRJbmRleCB8fCB0aGlzLmFuaW1hdGluZykge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZGlyID0gZGlyIHx8IChzZXRJbmRleCA8IHRoaXMuYWN0aXZlU2V0ID8gLTE6MSk7XG5cbiAgICAgICAgICAgIHZhciBjdXJyZW50ICAgPSB0aGlzLnNldHNbdGhpcy5hY3RpdmVTZXRdIHx8IFtdLFxuICAgICAgICAgICAgICAgIG5leHQgICAgICA9IHRoaXMuc2V0c1tzZXRJbmRleF0sXG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uID0gdGhpcy5fZ2V0QW5pbWF0aW9uKCk7XG5cbiAgICAgICAgICAgIGlmIChub2FuaW1hdGUgfHwgIVVJLnN1cHBvcnQuYW5pbWF0aW9uKSB7XG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uID0gQW5pbWF0aW9ucy5ub25lO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLmFuaW1hdGluZyA9IHRydWU7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLm5hdi5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm5hdi5jaGlsZHJlbigpLnJlbW92ZUNsYXNzKCd1ay1hY3RpdmUnKS5lcShzZXRJbmRleCkuYWRkQ2xhc3MoJ3VrLWFjdGl2ZScpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBhbmltYXRpb24uYXBwbHkoJHRoaXMsIFtjdXJyZW50LCBuZXh0LCBkaXJdKS50aGVuKGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgICAgICAgICBVSS5VdGlscy5jaGVja0Rpc3BsYXkobmV4dCwgdHJ1ZSk7XG5cbiAgICAgICAgICAgICAgICAkdGhpcy5jaGlsZHJlbi5oaWRlKCkucmVtb3ZlQ2xhc3MoJ3VrLWFjdGl2ZScpO1xuICAgICAgICAgICAgICAgIG5leHQuYWRkQ2xhc3MoJ3VrLWFjdGl2ZScpLmNzcyh7J2Rpc3BsYXknOiAnJywgJ29wYWNpdHknOicnfSk7XG5cbiAgICAgICAgICAgICAgICAkdGhpcy5hbmltYXRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAkdGhpcy5hY3RpdmVTZXQgPSBzZXRJbmRleDtcblxuICAgICAgICAgICAgICAgIFVJLlV0aWxzLmNoZWNrRGlzcGxheShuZXh0LCB0cnVlKTtcblxuICAgICAgICAgICAgICAgICR0aGlzLnRyaWdnZXIoJ3Nob3cudWsuc2xpZGVzZXQnLCBbbmV4dF0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfSxcblxuICAgICAgICBfZ2V0QW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgdmFyIGFuaW1hdGlvbiA9IEFuaW1hdGlvbnNbdGhpcy5vcHRpb25zLmFuaW1hdGlvbl0gfHwgQW5pbWF0aW9ucy5ub25lO1xuXG4gICAgICAgICAgICBpZiAoIVVJLnN1cHBvcnQuYW5pbWF0aW9uKSB7XG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uID0gQW5pbWF0aW9ucy5ub25lO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gYW5pbWF0aW9uO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9oaWRlOiBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgdmFyICR0aGlzICAgICA9IHRoaXMsXG4gICAgICAgICAgICAgICAgY3VycmVudCAgID0gdGhpcy5zZXRzW3RoaXMuYWN0aXZlU2V0XSB8fCBbXSxcbiAgICAgICAgICAgICAgICBhbmltYXRpb24gPSB0aGlzLl9nZXRBbmltYXRpb24oKTtcblxuICAgICAgICAgICAgdGhpcy5hbmltYXRpbmcgPSB0cnVlO1xuXG4gICAgICAgICAgICByZXR1cm4gYW5pbWF0aW9uLmFwcGx5KCR0aGlzLCBbY3VycmVudCwgW10sIDFdKS50aGVuKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgJHRoaXMuYW5pbWF0aW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBuZXh0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuc2hvdyh0aGlzLnNldHNbdGhpcy5hY3RpdmVTZXQgKyAxXSA/ICh0aGlzLmFjdGl2ZVNldCArIDEpIDogMCwgZmFsc2UsIDEpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHByZXZpb3VzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuc2hvdyh0aGlzLnNldHNbdGhpcy5hY3RpdmVTZXQgLSAxXSA/ICh0aGlzLmFjdGl2ZVNldCAtIDEpIDogKHRoaXMuc2V0cy5sZW5ndGggLSAxKSwgZmFsc2UsIC0xKTtcbiAgICAgICAgfSxcblxuICAgICAgICBzdGFydDogZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIHRoaXMuc3RvcCgpO1xuXG4gICAgICAgICAgICB2YXIgJHRoaXMgPSB0aGlzO1xuXG4gICAgICAgICAgICB0aGlzLmludGVydmFsID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKCEkdGhpcy5ob3ZlcmluZyAmJiAhJHRoaXMuYW5pbWF0aW5nKSAkdGhpcy5uZXh0KCk7XG4gICAgICAgICAgICB9LCB0aGlzLm9wdGlvbnMuYXV0b3BsYXlJbnRlcnZhbCk7XG5cbiAgICAgICAgfSxcblxuICAgICAgICBzdG9wOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmludGVydmFsKSBjbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWwpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBBbmltYXRpb25zID0ge1xuXG4gICAgICAgICdub25lJzogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgZCA9IFVJLiQuRGVmZXJyZWQoKTtcbiAgICAgICAgICAgIGQucmVzb2x2ZSgpO1xuICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZSgpO1xuICAgICAgICB9LFxuXG4gICAgICAgICdmYWRlJzogZnVuY3Rpb24oY3VycmVudCwgbmV4dCkge1xuICAgICAgICAgICAgcmV0dXJuIGNvcmVBbmltYXRpb24uYXBwbHkodGhpcywgWyd1ay1hbmltYXRpb24tZmFkZScsIGN1cnJlbnQsIG5leHRdKTtcbiAgICAgICAgfSxcblxuICAgICAgICAnc2xpZGUtYm90dG9tJzogZnVuY3Rpb24oY3VycmVudCwgbmV4dCkge1xuICAgICAgICAgICAgcmV0dXJuIGNvcmVBbmltYXRpb24uYXBwbHkodGhpcywgWyd1ay1hbmltYXRpb24tc2xpZGUtYm90dG9tJywgY3VycmVudCwgbmV4dF0pO1xuICAgICAgICB9LFxuXG4gICAgICAgICdzbGlkZS10b3AnOiBmdW5jdGlvbihjdXJyZW50LCBuZXh0KSB7XG4gICAgICAgICAgICByZXR1cm4gY29yZUFuaW1hdGlvbi5hcHBseSh0aGlzLCBbJ3VrLWFuaW1hdGlvbi1zbGlkZS10b3AnLCBjdXJyZW50LCBuZXh0XSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgJ3NsaWRlLXZlcnRpY2FsJzogZnVuY3Rpb24oY3VycmVudCwgbmV4dCwgZGlyKSB7XG5cbiAgICAgICAgICAgIHZhciBhbmltID0gWyd1ay1hbmltYXRpb24tc2xpZGUtdG9wJywgJ3VrLWFuaW1hdGlvbi1zbGlkZS1ib3R0b20nXTtcblxuICAgICAgICAgICAgaWYgKGRpciA9PSAtMSkge1xuICAgICAgICAgICAgICAgIGFuaW0ucmV2ZXJzZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gY29yZUFuaW1hdGlvbi5hcHBseSh0aGlzLCBbYW5pbSwgY3VycmVudCwgbmV4dF0pO1xuICAgICAgICB9LFxuXG4gICAgICAgICdzbGlkZS1ob3Jpem9udGFsJzogZnVuY3Rpb24oY3VycmVudCwgbmV4dCwgZGlyKSB7XG5cbiAgICAgICAgICAgIHZhciBhbmltID0gWyd1ay1hbmltYXRpb24tc2xpZGUtcmlnaHQnLCAndWstYW5pbWF0aW9uLXNsaWRlLWxlZnQnXTtcblxuICAgICAgICAgICAgaWYgKGRpciA9PSAtMSkge1xuICAgICAgICAgICAgICAgIGFuaW0ucmV2ZXJzZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gY29yZUFuaW1hdGlvbi5hcHBseSh0aGlzLCBbYW5pbSwgY3VycmVudCwgbmV4dCwgZGlyXSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgJ3NjYWxlJzogZnVuY3Rpb24oY3VycmVudCwgbmV4dCkge1xuICAgICAgICAgICAgcmV0dXJuIGNvcmVBbmltYXRpb24uYXBwbHkodGhpcywgWyd1ay1hbmltYXRpb24tc2NhbGUtdXAnLCBjdXJyZW50LCBuZXh0XSk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgVUkuc2xpZGVzZXQuYW5pbWF0aW9ucyA9IEFuaW1hdGlvbnM7XG5cbiAgICAvLyBoZWxwZXJzXG5cbiAgICBmdW5jdGlvbiBjb3JlQW5pbWF0aW9uKGNscywgY3VycmVudCwgbmV4dCwgZGlyKSB7XG5cbiAgICAgICAgdmFyIGQgICAgID0gVUkuJC5EZWZlcnJlZCgpLFxuICAgICAgICAgICAgZGVsYXkgPSAodGhpcy5vcHRpb25zLmRlbGF5ID09PSBmYWxzZSkgPyBNYXRoLmZsb29yKHRoaXMub3B0aW9ucy5kdXJhdGlvbi8yKSA6IHRoaXMub3B0aW9ucy5kZWxheSxcbiAgICAgICAgICAgICR0aGlzID0gdGhpcywgY2xzSW4sIGNsc091dCwgcmVsZWFzZSwgaTtcblxuICAgICAgICBkaXIgPSBkaXIgfHwgMTtcblxuICAgICAgICB0aGlzLmVsZW1lbnQuY3NzKCdtaW4taGVpZ2h0JywgdGhpcy5lbGVtZW50LmhlaWdodCgpKTtcblxuICAgICAgICBpZiAobmV4dFswXT09PWN1cnJlbnRbMF0pIHtcbiAgICAgICAgICAgIGQucmVzb2x2ZSgpO1xuICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHR5cGVvZihjbHMpID09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICBjbHNJbiAgPSBjbHNbMF07XG4gICAgICAgICAgICBjbHNPdXQgPSBjbHNbMV0gfHwgY2xzWzBdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY2xzSW4gID0gY2xzO1xuICAgICAgICAgICAgY2xzT3V0ID0gY2xzSW47XG4gICAgICAgIH1cblxuICAgICAgICBVSS4kYm9keS5jc3MoJ292ZXJmbG93LXgnLCAnaGlkZGVuJyk7IC8vIHByZXZlbnQgaG9yaXpvbnRhbCBzY3JvbGxiYXIgb24gYW5pbWF0aW9uXG5cbiAgICAgICAgcmVsZWFzZSA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICBpZiAoY3VycmVudCAmJiBjdXJyZW50Lmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGN1cnJlbnQuaGlkZSgpLnJlbW92ZUNsYXNzKGNsc091dCsnIHVrLWFuaW1hdGlvbi1yZXZlcnNlJykuY3NzKHsnb3BhY2l0eSc6JycsICdhbmltYXRpb24tZGVsYXknOiAnJywgJ2FuaW1hdGlvbic6Jyd9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFuZXh0Lmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGQucmVzb2x2ZSgpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZm9yIChpPTA7aTxuZXh0Lmxlbmd0aDtpKyspIHtcbiAgICAgICAgICAgICAgICBuZXh0LmVxKGRpciA9PSAxID8gaToobmV4dC5sZW5ndGggLSBpKS0xKS5jc3MoJ2FuaW1hdGlvbi1kZWxheScsIChpKmRlbGF5KSsnbXMnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIGZpbmlzaCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIG5leHQucmVtb3ZlQ2xhc3MoJycrY2xzSW4rJycpLmNzcyh7b3BhY2l0eTonJywgZGlzcGxheTonJywgJ2FuaW1hdGlvbi1kZWxheSc6JycsICdhbmltYXRpb24nOicnfSk7XG4gICAgICAgICAgICAgICAgZC5yZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgVUkuJGJvZHkuY3NzKCdvdmVyZmxvdy14JywgJycpO1xuICAgICAgICAgICAgICAgICR0aGlzLmVsZW1lbnQuY3NzKCdtaW4taGVpZ2h0JywgJycpO1xuICAgICAgICAgICAgICAgIGZpbmlzaCA9IGZhbHNlO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgbmV4dC5hZGRDbGFzcyhjbHNJbilbZGlyPT0xID8gJ2xhc3QnOidmaXJzdCddKCkub25lKFVJLnN1cHBvcnQuYW5pbWF0aW9uLmVuZCwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBpZihmaW5pc2gpIGZpbmlzaCgpO1xuICAgICAgICAgICAgfSkuZW5kKCkuY3NzKCdkaXNwbGF5JywgJycpO1xuXG4gICAgICAgICAgICAvLyBtYWtlIHN1cmUgZXZlcnl0aGluZyByZXNvbHZlcyByZWFsbHlcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYoZmluaXNoKSBmaW5pc2goKTtcbiAgICAgICAgICAgIH0sICBuZXh0Lmxlbmd0aCAqIGRlbGF5ICogMik7XG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKG5leHQubGVuZ3RoKSB7XG4gICAgICAgICAgICBuZXh0LmNzcygnYW5pbWF0aW9uLWR1cmF0aW9uJywgdGhpcy5vcHRpb25zLmR1cmF0aW9uKydtcycpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGN1cnJlbnQgJiYgY3VycmVudC5sZW5ndGgpIHtcblxuICAgICAgICAgICAgY3VycmVudC5jc3MoJ2FuaW1hdGlvbi1kdXJhdGlvbicsIHRoaXMub3B0aW9ucy5kdXJhdGlvbisnbXMnKVtkaXI9PTEgPyAnbGFzdCc6J2ZpcnN0J10oKS5vbmUoVUkuc3VwcG9ydC5hbmltYXRpb24uZW5kLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICByZWxlYXNlKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZm9yIChpPTA7aTxjdXJyZW50Lmxlbmd0aDtpKyspIHtcblxuICAgICAgICAgICAgICAgIChmdW5jdGlvbiAoaW5kZXgsIGVsZSl7XG5cbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBlbGUuY3NzKCdkaXNwbGF5JywgJ25vbmUnKS5jc3MoJ2Rpc3BsYXknLCAnJykuY3NzKCdvcGFjaXR5JywgMCkub24oVUkuc3VwcG9ydC5hbmltYXRpb24uZW5kLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZS5yZW1vdmVDbGFzcyhjbHNPdXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSkuYWRkQ2xhc3MoY2xzT3V0KycgdWstYW5pbWF0aW9uLXJldmVyc2UnKTtcblxuICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcyksIGkgKiBkZWxheSk7XG5cbiAgICAgICAgICAgICAgICB9KShpLCBjdXJyZW50LmVxKGRpciA9PSAxID8gaTooY3VycmVudC5sZW5ndGggLSBpKS0xKSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlbGVhc2UoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBkLnByb21pc2UoKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBhcnJheV9jaHVuayhpbnB1dCwgc2l6ZSkge1xuXG4gICAgICAgIHZhciB4LCBpID0gMCwgYyA9IC0xLCBsID0gaW5wdXQubGVuZ3RoIHx8IDAsIG4gPSBbXTtcblxuICAgICAgICBpZiAoc2l6ZSA8IDEpIHJldHVybiBudWxsO1xuXG4gICAgICAgIHdoaWxlIChpIDwgbCkge1xuXG4gICAgICAgICAgICB4ID0gaSAlIHNpemU7XG5cbiAgICAgICAgICAgIGlmKHgpIHtcbiAgICAgICAgICAgICAgICBuW2NdW3hdID0gaW5wdXRbaV07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG5bKytjXSA9IFtpbnB1dFtpXV07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGkrKztcbiAgICAgICAgfVxuXG4gICAgICAgIGkgPSAwO1xuICAgICAgICBsID0gbi5sZW5ndGg7XG5cbiAgICAgICAgd2hpbGUgKGkgPCBsKSB7XG4gICAgICAgICAgICBuW2ldID0galF1ZXJ5KG5baV0pO1xuICAgICAgICAgICAgaSsrO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG47XG4gICAgfVxuXG59KTsiXX0=
