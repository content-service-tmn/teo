!function(t){var e;window.UIkit2&&(e=t(UIkit2)),"function"==typeof define&&define.amd&&define("uikit-slider",["uikit"],function(){return e||t(UIkit2)})}(function(r){"use strict";var f,u,e,s,l={};return r.component("slider",{defaults:{center:!1,threshold:10,infinite:!0,autoplay:!1,autoplayInterval:7e3,pauseOnHover:!0,activecls:"uk-active"},boot:function(){r.ready(function(t){setTimeout(function(){r.$("[data-uk-slider]",t).each(function(){var t=r.$(this);t.data("slider")||r.slider(t,r.Utils.options(t.attr("data-uk-slider")))})},0)})},init:function(){var i=this;this.container=this.element.find(".uk-slider"),this.focus=0,r.$win.on("resize load",r.Utils.debounce(function(){i.update(!0)},100)),this.on("click.uk.slider","[data-uk-slider-item]",function(t){t.preventDefault();var e=r.$(this).attr("data-uk-slider-item");if(i.focus!=e)switch(i.stop(),e){case"next":case"previous":i["next"==e?"next":"previous"]();break;default:i.updateFocus(parseInt(e,10))}}),this.container.on({"touchstart mousedown":function(t){t.originalEvent&&t.originalEvent.touches&&(t=t.originalEvent.touches[0]),t.button&&2==t.button||!i.active||(i.stop(),e=r.$(t.target).is("a")?r.$(t.target):r.$(t.target).parents("a:first"),s=!1,e.length&&e.one("click",function(t){s&&t.preventDefault()}),(u=function(t){s=!0,f=i,l={touchx:parseInt(t.pageX,10),dir:1,focus:i.focus,base:i.options.center?"center":"area"},t.originalEvent&&t.originalEvent.touches&&(t=t.originalEvent.touches[0]),f.element.data({"pointer-start":{x:parseInt(t.pageX,10),y:parseInt(t.pageY,10)},"pointer-pos-start":i.pos}),i.container.addClass("uk-drag"),u=!1}).x=parseInt(t.pageX,10),u.threshold=i.options.threshold)},mouseenter:function(){i.options.pauseOnHover&&(i.hovering=!0)},mouseleave:function(){i.hovering=!1}}),this.update(!0),this.on("display.uk.check",function(){i.element.is(":visible")&&i.update(!0)}),this.element.find("a,img").attr("draggable","false"),this.options.autoplay&&this.start(),r.domObserve(this.element,function(t){i.element.children(":not([data-slider-slide])").length&&i.update(!0)})},update:function(t){var e,i,s,n,a=this,o=0,h=0;if(this.items=this.container.children().filter(":visible"),this.vp=this.element[0].getBoundingClientRect().width,this.container.css({"min-width":"","min-height":""}),this.items.each(function(t){e=r.$(this).attr("data-slider-slide",t),n=e.css({left:"",width:""})[0].getBoundingClientRect(),i=n.width,s=e.width(),h=Math.max(h,n.height),e.css({left:o,width:i}).data({idx:t,left:o,width:i,cwidth:s,area:o+i,center:o-(a.vp/2-s/2)}),o+=i}),this.container.css({"min-width":o,"min-height":h}),this.options.infinite&&(o<=2*this.vp||this.items.length<5)&&!this.itemsResized)return this.container.children().each(function(t){a.container.append(a.items.eq(t).clone(!0).attr("id",""))}).each(function(t){a.container.append(a.items.eq(t).clone(!0).attr("id",""))}),this.itemsResized=!0,this.update();this.cw=o,this.pos=0,this.active=o>=this.vp,this.container.css({"-ms-transform":"","-webkit-transform":"",transform:""}),t&&this.updateFocus(this.focus)},updatePos:function(t){this.pos=t,this.container.css({"-ms-transform":"translateX("+t+"px)","-webkit-transform":"translateX("+t+"px)",transform:"translateX("+t+"px)"})},updateFocus:function(e,t){if(this.active){t=t||(e>this.focus?1:-1);var i,s,n=this.items.eq(e);if(this.options.infinite&&this.infinite(e,t),this.options.center)this.updatePos(-1*n.data("center")),this.items.filter("."+this.options.activecls).removeClass(this.options.activecls),n.addClass(this.options.activecls);else if(this.options.infinite)this.updatePos(-1*n.data("left"));else{for(i=0,s=e;s<this.items.length;s++)i+=this.items.eq(s).data("width");if(i>this.vp)this.updatePos(-1*n.data("left"));else if(1==t){for(i=0,s=this.items.length-1;0<=s;s--){if((i+=this.items.eq(s).data("width"))==this.vp){e=s;break}if(i>this.vp){e=s<this.items.length-1?s+1:s;break}}i>this.vp?this.updatePos(-1*(this.container.width()-this.vp)):this.updatePos(-1*this.items.eq(e).data("left"))}}var a=this.items.eq(e).data("left");this.items.removeClass("uk-slide-before uk-slide-after").each(function(t){t!==e&&r.$(this).addClass(r.$(this).data("left")<a?"uk-slide-before":"uk-slide-after")}),this.focus=e,this.trigger("focusitem.uk.slider",[e,this.items.eq(e),this])}},next:function(){var t=this.items[this.focus+1]?this.focus+1:this.options.infinite?0:this.focus;this.updateFocus(t,1)},previous:function(){var t=this.items[this.focus-1]?this.focus-1:this.options.infinite?this.items[this.focus-1]?this.items-1:this.items.length-1:this.focus;this.updateFocus(t,-1)},start:function(){this.stop();var t=this;this.interval=setInterval(function(){t.hovering||t.next()},this.options.autoplayInterval)},stop:function(){this.interval&&clearInterval(this.interval)},infinite:function(t,e){var i,s=this,n=this.items.eq(t),a=t,o=[],h=0;if(1==e){for(i=0;i<this.items.length&&(a!=t&&(h+=this.items.eq(a).data("width"),o.push(this.items.eq(a))),!(h>this.vp));i++)a=a+1==this.items.length?0:a+1;o.length&&o.forEach(function(t){var e=n.data("area");t.css({left:e}).data({left:e,area:e+t.data("width"),center:e-(s.vp/2-t.data("cwidth")/2)}),n=t})}else{for(i=this.items.length-1;-1<i&&(h+=this.items.eq(a).data("width"),a!=t&&o.push(this.items.eq(a)),!(h>this.vp));i--)a=a-1==-1?this.items.length-1:a-1;o.length&&o.forEach(function(t){var e=n.data("left")-t.data("width");t.css({left:e}).data({left:e,area:e+t.data("width"),center:e-(s.vp/2-t.data("cwidth")/2)}),n=t})}}}),r.$doc.on("mousemove.uk.slider touchmove.uk.slider",function(t){if(t.originalEvent&&t.originalEvent.touches&&(t=t.originalEvent.touches[0]),u&&Math.abs(t.pageX-u.x)>u.threshold&&(window.getSelection().toString()?f=u=!1:u(t)),f){var e,i,s,n,a,o,h,r,c,d;if(t.clientX||t.clientY?e=t.clientX:(t.pageX||t.pageY)&&(e=t.pageX-document.body.scrollLeft-document.documentElement.scrollLeft),a=l.focus,i=e-f.element.data("pointer-start").x,s=f.element.data("pointer-pos-start")+i,n=e>f.element.data("pointer-start").x?-1:1,o=f.items.eq(l.focus),1==n)for(h=o.data("left")+Math.abs(i),r=0,c=l.focus;r<f.items.length;r++){if(d=f.items.eq(c),c!=l.focus&&d.data("left")<h&&d.data("area")>h){a=c;break}c=c+1==f.items.length?0:c+1}else for(h=o.data("left")-Math.abs(i),r=0,c=l.focus;r<f.items.length;r++){if(d=f.items.eq(c),c!=l.focus&&d.data("area")<=o.data("left")&&d.data("center")<h){a=c;break}c=c-1==-1?f.items.length-1:c-1}f.options.infinite&&a!=l._focus&&f.infinite(a,n),f.updatePos(s),l.dir=n,l._focus=a,l.touchx=parseInt(t.pageX,10),l.diff=h}}),r.$doc.on("mouseup.uk.slider touchend.uk.slider",function(t){if(f){f.container.removeClass("uk-drag"),f.items.eq(l.focus);var e,i,s,n=!1;if(1==l.dir){for(i=0,s=l.focus;i<f.items.length;i++){if(e=f.items.eq(s),s!=l.focus&&e.data("left")>l.diff){n=s;break}s=s+1==f.items.length?0:s+1}f.options.infinite||n||(n=f.items.length)}else{for(i=0,s=l.focus;i<f.items.length;i++){if(e=f.items.eq(s),s!=l.focus&&e.data("left")<l.diff){n=s;break}s=s-1==-1?f.items.length-1:s-1}f.options.infinite||n||(n=0)}f.updateFocus(!1!==n?n:l._focus)}f=u=!1}),r.slider});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvc2xpZGVyLmpzIl0sIm5hbWVzIjpbImFkZG9uIiwiY29tcG9uZW50Iiwid2luZG93IiwiVUlraXQyIiwiZGVmaW5lIiwiYW1kIiwiVUkiLCJkcmFnZ2luZyIsImRlbGF5SWRsZSIsImFuY2hvciIsImRyYWdnZWQiLCJzdG9yZSIsImRlZmF1bHRzIiwiY2VudGVyIiwidGhyZXNob2xkIiwiaW5maW5pdGUiLCJhdXRvcGxheSIsImF1dG9wbGF5SW50ZXJ2YWwiLCJwYXVzZU9uSG92ZXIiLCJhY3RpdmVjbHMiLCJib290IiwicmVhZHkiLCJjb250ZXh0Iiwic2V0VGltZW91dCIsIiQiLCJlYWNoIiwiZWxlIiwidGhpcyIsImRhdGEiLCJzbGlkZXIiLCJVdGlscyIsIm9wdGlvbnMiLCJhdHRyIiwiaW5pdCIsIiR0aGlzIiwiY29udGFpbmVyIiwiZWxlbWVudCIsImZpbmQiLCJmb2N1cyIsIiR3aW4iLCJvbiIsImRlYm91bmNlIiwidXBkYXRlIiwiZSIsInByZXZlbnREZWZhdWx0IiwiaXRlbSIsInN0b3AiLCJ1cGRhdGVGb2N1cyIsInBhcnNlSW50IiwidG91Y2hzdGFydCBtb3VzZWRvd24iLCJldnQiLCJvcmlnaW5hbEV2ZW50IiwidG91Y2hlcyIsImJ1dHRvbiIsImFjdGl2ZSIsInRhcmdldCIsImlzIiwicGFyZW50cyIsImxlbmd0aCIsIm9uZSIsInRvdWNoeCIsInBhZ2VYIiwiZGlyIiwiYmFzZSIsInBvaW50ZXItc3RhcnQiLCJ4IiwieSIsInBhZ2VZIiwicG9pbnRlci1wb3Mtc3RhcnQiLCJwb3MiLCJhZGRDbGFzcyIsIm1vdXNlZW50ZXIiLCJob3ZlcmluZyIsIm1vdXNlbGVhdmUiLCJzdGFydCIsImRvbU9ic2VydmUiLCJjaGlsZHJlbiIsIndpZHRoIiwiY3dpZHRoIiwic2l6ZSIsIm1heGhlaWdodCIsIml0ZW1zIiwiZmlsdGVyIiwidnAiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJjc3MiLCJtaW4td2lkdGgiLCJtaW4taGVpZ2h0IiwiaWR4IiwibGVmdCIsIk1hdGgiLCJtYXgiLCJoZWlnaHQiLCJhcmVhIiwiaXRlbXNSZXNpemVkIiwiYXBwZW5kIiwiZXEiLCJjbG9uZSIsImN3IiwiLW1zLXRyYW5zZm9ybSIsIi13ZWJraXQtdHJhbnNmb3JtIiwidHJhbnNmb3JtIiwidXBkYXRlUG9zIiwiaSIsInJlbW92ZUNsYXNzIiwidHJpZ2dlciIsIm5leHQiLCJwcmV2aW91cyIsImludGVydmFsIiwic2V0SW50ZXJ2YWwiLCJjbGVhckludGVydmFsIiwiYmFzZWlkeCIsImRpcmVjdGlvbiIsInoiLCJtb3ZlIiwicHVzaCIsImZvckVhY2giLCJpdG0iLCIkZG9jIiwiYWJzIiwiZ2V0U2VsZWN0aW9uIiwidG9TdHJpbmciLCJ4RGlmZiIsImRpZmYiLCJjbGllbnRYIiwiY2xpZW50WSIsImRvY3VtZW50IiwiYm9keSIsInNjcm9sbExlZnQiLCJkb2N1bWVudEVsZW1lbnQiLCJfZm9jdXMiXSwibWFwcGluZ3MiOiJDQUNBLFNBQVVBLEdBRU4sSUFBSUMsRUFFQUMsT0FBT0MsU0FDUEYsRUFBWUQsRUFBTUcsU0FHRCxtQkFBVkMsUUFBd0JBLE9BQU9DLEtBQ3RDRCxPQUFPLGVBQWdCLENBQUMsU0FBVSxXQUM5QixPQUFPSCxHQUFhRCxFQUFNRyxVQVZ0QyxDQWNHLFNBQVNHLEdBRVIsYUFFQSxJQUFJQyxFQUFVQyxFQUFXQyxFQUFRQyxFQUFTQyxFQUFRLEdBbWhCbEQsT0FqaEJBTCxFQUFHTCxVQUFVLFNBQVUsQ0FFbkJXLFNBQVUsQ0FDTkMsUUFBbUIsRUFDbkJDLFVBQW1CLEdBQ25CQyxVQUFtQixFQUNuQkMsVUFBbUIsRUFDbkJDLGlCQUFtQixJQUNuQkMsY0FBbUIsRUFDbkJDLFVBQW1CLGFBR3ZCQyxLQUFPLFdBR0hkLEVBQUdlLE1BQU0sU0FBU0MsR0FFZEMsV0FBVyxXQUVQakIsRUFBR2tCLEVBQUUsbUJBQW9CRixHQUFTRyxLQUFLLFdBRW5DLElBQUlDLEVBQU1wQixFQUFHa0IsRUFBRUcsTUFFVkQsRUFBSUUsS0FBSyxXQUNW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d0IsUUFBUWhCLFVBQWF1QixJQUMvQkEsRUFBUSxHQUloQi9CLEVBQVN3QyxhQUFvQixJQUFSVCxFQUFnQkEsRUFBTTNCLEVBQU11SCxRQUlyRDNILEVBQVdDLEdBQVksSUFHcEJGLEVBQUd1QiIsImZpbGUiOiJjb21wb25lbnRzL3NsaWRlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qISBVSWtpdCAyLjI3LjIgfCBodHRwOi8vd3d3LmdldHVpa2l0LmNvbSB8IChjKSAyMDE0IFlPT3RoZW1lIHwgTUlUIExpY2Vuc2UgKi9cbihmdW5jdGlvbihhZGRvbikge1xuXG4gICAgdmFyIGNvbXBvbmVudDtcblxuICAgIGlmICh3aW5kb3cuVUlraXQyKSB7XG4gICAgICAgIGNvbXBvbmVudCA9IGFkZG9uKFVJa2l0Mik7XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiBkZWZpbmUgPT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7XG4gICAgICAgIGRlZmluZSgndWlraXQtc2xpZGVyJywgWyd1aWtpdCddLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIGNvbXBvbmVudCB8fCBhZGRvbihVSWtpdDIpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbn0pKGZ1bmN0aW9uKFVJKXtcblxuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgdmFyIGRyYWdnaW5nLCBkZWxheUlkbGUsIGFuY2hvciwgZHJhZ2dlZCwgc3RvcmUgPSB7fTtcblxuICAgIFVJLmNvbXBvbmVudCgnc2xpZGVyJywge1xuXG4gICAgICAgIGRlZmF1bHRzOiB7XG4gICAgICAgICAgICBjZW50ZXIgICAgICAgICAgIDogZmFsc2UsXG4gICAgICAgICAgICB0aHJlc2hvbGQgICAgICAgIDogMTAsXG4gICAgICAgICAgICBpbmZpbml0ZSAgICAgICAgIDogdHJ1ZSxcbiAgICAgICAgICAgIGF1dG9wbGF5ICAgICAgICAgOiBmYWxzZSxcbiAgICAgICAgICAgIGF1dG9wbGF5SW50ZXJ2YWwgOiA3MDAwLFxuICAgICAgICAgICAgcGF1c2VPbkhvdmVyICAgICA6IHRydWUsXG4gICAgICAgICAgICBhY3RpdmVjbHMgICAgICAgIDogJ3VrLWFjdGl2ZSdcbiAgICAgICAgfSxcblxuICAgICAgICBib290OiAgZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIC8vIGluaXQgY29kZVxuICAgICAgICAgICAgVUkucmVhZHkoZnVuY3Rpb24oY29udGV4dCkge1xuXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICAgICAgICAgIFVJLiQoJ1tkYXRhLXVrLXNsaWRlcl0nLCBjb250ZXh0KS5lYWNoKGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlbGUgPSBVSS4kKHRoaXMpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWVsZS5kYXRhKCdzbGlkZXInKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFVJLnNsaWRlcihlbGUsIFVJLlV0aWxzLm9wdGlvbnMoZWxlLmF0dHIoJ2RhdGEtdWstc2xpZGVyJykpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICB2YXIgJHRoaXMgPSB0aGlzO1xuXG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lciA9IHRoaXMuZWxlbWVudC5maW5kKCcudWstc2xpZGVyJyk7XG4gICAgICAgICAgICB0aGlzLmZvY3VzICAgICA9IDA7XG5cbiAgICAgICAgICAgIFVJLiR3aW4ub24oJ3Jlc2l6ZSBsb2FkJywgVUkuVXRpbHMuZGVib3VuY2UoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgJHRoaXMudXBkYXRlKHRydWUpO1xuICAgICAgICAgICAgfSwgMTAwKSk7XG5cbiAgICAgICAgICAgIHRoaXMub24oJ2NsaWNrLnVrLnNsaWRlcicsICdbZGF0YS11ay1zbGlkZXItaXRlbV0nLCBmdW5jdGlvbihlKSB7XG5cbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IFVJLiQodGhpcykuYXR0cignZGF0YS11ay1zbGlkZXItaXRlbScpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCR0aGlzLmZvY3VzID09IGl0ZW0pIHJldHVybjtcblxuICAgICAgICAgICAgICAgIC8vIHN0b3AgYXV0b3BsYXlcbiAgICAgICAgICAgICAgICAkdGhpcy5zdG9wKCk7XG5cbiAgICAgICAgICAgICAgICBzd2l0Y2goaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlICduZXh0JzpcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAncHJldmlvdXMnOlxuICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXNbaXRlbT09J25leHQnID8gJ25leHQnOidwcmV2aW91cyddKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLnVwZGF0ZUZvY3VzKHBhcnNlSW50KGl0ZW0sIDEwKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLm9uKHtcblxuICAgICAgICAgICAgICAgICd0b3VjaHN0YXJ0IG1vdXNlZG93bic6IGZ1bmN0aW9uKGV2dCkge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChldnQub3JpZ2luYWxFdmVudCAmJiBldnQub3JpZ2luYWxFdmVudC50b3VjaGVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBldnQgPSBldnQub3JpZ2luYWxFdmVudC50b3VjaGVzWzBdO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gaWdub3JlIHJpZ2h0IGNsaWNrIGJ1dHRvblxuICAgICAgICAgICAgICAgICAgICBpZiAoZXZ0LmJ1dHRvbiAmJiBldnQuYnV0dG9uPT0yIHx8ICEkdGhpcy5hY3RpdmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIHN0b3AgYXV0b3BsYXlcbiAgICAgICAgICAgICAgICAgICAgJHRoaXMuc3RvcCgpO1xuXG4gICAgICAgICAgICAgICAgICAgIGFuY2hvciAgPSBVSS4kKGV2dC50YXJnZXQpLmlzKCdhJykgPyBVSS4kKGV2dC50YXJnZXQpIDogVUkuJChldnQudGFyZ2V0KS5wYXJlbnRzKCdhOmZpcnN0Jyk7XG4gICAgICAgICAgICAgICAgICAgIGRyYWdnZWQgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoYW5jaG9yLmxlbmd0aCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBhbmNob3Iub25lKCdjbGljaycsIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkcmFnZ2VkKSBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGRlbGF5SWRsZSA9IGZ1bmN0aW9uKGUpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZHJhZ2dlZCAgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgZHJhZ2dpbmcgPSAkdGhpcztcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0b3JlICAgID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdWNoeCA6IHBhcnNlSW50KGUucGFnZVgsIDEwKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXIgICAgOiAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvY3VzICA6ICR0aGlzLmZvY3VzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhc2UgICA6ICR0aGlzLm9wdGlvbnMuY2VudGVyID8gJ2NlbnRlcic6J2FyZWEnXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS5vcmlnaW5hbEV2ZW50ICYmIGUub3JpZ2luYWxFdmVudC50b3VjaGVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9IGUub3JpZ2luYWxFdmVudC50b3VjaGVzWzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBkcmFnZ2luZy5lbGVtZW50LmRhdGEoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwb2ludGVyLXN0YXJ0Jzoge3g6IHBhcnNlSW50KGUucGFnZVgsIDEwKSwgeTogcGFyc2VJbnQoZS5wYWdlWSwgMTApfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncG9pbnRlci1wb3Mtc3RhcnQnOiAkdGhpcy5wb3NcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5jb250YWluZXIuYWRkQ2xhc3MoJ3VrLWRyYWcnKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZGVsYXlJZGxlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgZGVsYXlJZGxlLnggICAgICAgICA9IHBhcnNlSW50KGV2dC5wYWdlWCwgMTApO1xuICAgICAgICAgICAgICAgICAgICBkZWxheUlkbGUudGhyZXNob2xkID0gJHRoaXMub3B0aW9ucy50aHJlc2hvbGQ7XG5cbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgbW91c2VlbnRlcjogZnVuY3Rpb24oKSB7IGlmICgkdGhpcy5vcHRpb25zLnBhdXNlT25Ib3ZlcikgJHRoaXMuaG92ZXJpbmcgPSB0cnVlOyAgfSxcbiAgICAgICAgICAgICAgICBtb3VzZWxlYXZlOiBmdW5jdGlvbigpIHsgJHRoaXMuaG92ZXJpbmcgPSBmYWxzZTsgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMudXBkYXRlKHRydWUpO1xuXG4gICAgICAgICAgICB0aGlzLm9uKCdkaXNwbGF5LnVrLmNoZWNrJywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBpZiAoJHRoaXMuZWxlbWVudC5pcyhcIjp2aXNpYmxlXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICR0aGlzLnVwZGF0ZSh0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gcHJldmVudCBkcmFnZ2luZyBsaW5rcyArIGltYWdlc1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LmZpbmQoJ2EsaW1nJykuYXR0cignZHJhZ2dhYmxlJywgJ2ZhbHNlJyk7XG5cbiAgICAgICAgICAgIC8vIFNldCBhdXRvcGxheVxuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5hdXRvcGxheSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhcnQoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgVUkuZG9tT2JzZXJ2ZSh0aGlzLmVsZW1lbnQsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoJHRoaXMuZWxlbWVudC5jaGlsZHJlbignOm5vdChbZGF0YS1zbGlkZXItc2xpZGVdKScpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAkdGhpcy51cGRhdGUodHJ1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfSxcblxuICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uKGZvY3VzKSB7XG5cbiAgICAgICAgICAgIHZhciAkdGhpcyA9IHRoaXMsIHBvcyA9IDAsIG1heGhlaWdodCA9IDAsIGl0ZW0sIHdpZHRoLCBjd2lkdGgsIHNpemU7XG5cbiAgICAgICAgICAgIHRoaXMuaXRlbXMgPSB0aGlzLmNvbnRhaW5lci5jaGlsZHJlbigpLmZpbHRlcignOnZpc2libGUnKTtcbiAgICAgICAgICAgIHRoaXMudnAgICAgPSB0aGlzLmVsZW1lbnRbMF0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGg7XG5cbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmNzcyh7J21pbi13aWR0aCc6ICcnLCAnbWluLWhlaWdodCc6ICcnfSk7XG5cbiAgICAgICAgICAgIHRoaXMuaXRlbXMuZWFjaChmdW5jdGlvbihpZHgpe1xuXG4gICAgICAgICAgICAgICAgaXRlbSAgICAgID0gVUkuJCh0aGlzKS5hdHRyKCdkYXRhLXNsaWRlci1zbGlkZScsIGlkeCk7XG4gICAgICAgICAgICAgICAgc2l6ZSAgICAgID0gaXRlbS5jc3MoeydsZWZ0JzogJycsICd3aWR0aCc6Jyd9KVswXS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgICAgICAgICB3aWR0aCAgICAgPSBzaXplLndpZHRoO1xuICAgICAgICAgICAgICAgIGN3aWR0aCAgICA9IGl0ZW0ud2lkdGgoKTtcbiAgICAgICAgICAgICAgICBtYXhoZWlnaHQgPSBNYXRoLm1heChtYXhoZWlnaHQsIHNpemUuaGVpZ2h0KTtcblxuICAgICAgICAgICAgICAgIGl0ZW0uY3NzKHsnbGVmdCc6IHBvcywgJ3dpZHRoJzp3aWR0aH0pLmRhdGEoeydpZHgnOmlkeCwgJ2xlZnQnOiBwb3MsICd3aWR0aCc6IHdpZHRoLCAnY3dpZHRoJzpjd2lkdGgsICdhcmVhJzogKHBvcyt3aWR0aCksICdjZW50ZXInOihwb3MgLSAoJHRoaXMudnAvMiAtIGN3aWR0aC8yKSl9KTtcblxuICAgICAgICAgICAgICAgIHBvcyArPSB3aWR0aDtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5jc3MoeydtaW4td2lkdGgnOiBwb3MsICdtaW4taGVpZ2h0JzogbWF4aGVpZ2h0fSk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuaW5maW5pdGUgJiYgKHBvcyA8PSAoMip0aGlzLnZwKSB8fCB0aGlzLml0ZW1zLmxlbmd0aCA8IDUpICYmICF0aGlzLml0ZW1zUmVzaXplZCkge1xuXG4gICAgICAgICAgICAgICAgLy8gZmlsbCB3aXRoIGNsb25lZCBpdGVtc1xuICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmNoaWxkcmVuKCkuZWFjaChmdW5jdGlvbihpZHgpe1xuICAgICAgICAgICAgICAgICAgICR0aGlzLmNvbnRhaW5lci5hcHBlbmQoJHRoaXMuaXRlbXMuZXEoaWR4KS5jbG9uZSh0cnVlKS5hdHRyKCdpZCcsICcnKSk7XG4gICAgICAgICAgICAgICAgfSkuZWFjaChmdW5jdGlvbihpZHgpe1xuICAgICAgICAgICAgICAgICAgICR0aGlzLmNvbnRhaW5lci5hcHBlbmQoJHRoaXMuaXRlbXMuZXEoaWR4KS5jbG9uZSh0cnVlKS5hdHRyKCdpZCcsICcnKSk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLml0ZW1zUmVzaXplZCA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy51cGRhdGUoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5jdyAgICAgPSBwb3M7XG4gICAgICAgICAgICB0aGlzLnBvcyAgICA9IDA7XG4gICAgICAgICAgICB0aGlzLmFjdGl2ZSA9IHBvcyA+PSB0aGlzLnZwO1xuXG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5jc3Moe1xuICAgICAgICAgICAgICAgICctbXMtdHJhbnNmb3JtJzogJycsXG4gICAgICAgICAgICAgICAgJy13ZWJraXQtdHJhbnNmb3JtJzogJycsXG4gICAgICAgICAgICAgICAgJ3RyYW5zZm9ybSc6ICcnXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKGZvY3VzKSB0aGlzLnVwZGF0ZUZvY3VzKHRoaXMuZm9jdXMpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHVwZGF0ZVBvczogZnVuY3Rpb24ocG9zKSB7XG4gICAgICAgICAgICB0aGlzLnBvcyA9IHBvcztcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmNzcyh7XG4gICAgICAgICAgICAgICAgJy1tcy10cmFuc2Zvcm0nOiAndHJhbnNsYXRlWCgnK3BvcysncHgpJyxcbiAgICAgICAgICAgICAgICAnLXdlYmtpdC10cmFuc2Zvcm0nOiAndHJhbnNsYXRlWCgnK3BvcysncHgpJyxcbiAgICAgICAgICAgICAgICAndHJhbnNmb3JtJzogJ3RyYW5zbGF0ZVgoJytwb3MrJ3B4KSdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIHVwZGF0ZUZvY3VzOiBmdW5jdGlvbihpZHgsIGRpcikge1xuXG4gICAgICAgICAgICBpZiAoIXRoaXMuYWN0aXZlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBkaXIgPSBkaXIgfHwgKGlkeCA+IHRoaXMuZm9jdXMgPyAxOi0xKTtcblxuICAgICAgICAgICAgdmFyIGl0ZW0gPSB0aGlzLml0ZW1zLmVxKGlkeCksIGFyZWEsIGk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuaW5maW5pdGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmluZmluaXRlKGlkeCwgZGlyKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5jZW50ZXIpIHtcblxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlUG9zKGl0ZW0uZGF0YSgnY2VudGVyJykqLTEpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5pdGVtcy5maWx0ZXIoJy4nK3RoaXMub3B0aW9ucy5hY3RpdmVjbHMpLnJlbW92ZUNsYXNzKHRoaXMub3B0aW9ucy5hY3RpdmVjbHMpO1xuICAgICAgICAgICAgICAgIGl0ZW0uYWRkQ2xhc3ModGhpcy5vcHRpb25zLmFjdGl2ZWNscyk7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmluZmluaXRlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVQb3MoaXRlbS5kYXRhKCdsZWZ0JykqLTEpO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICBhcmVhID0gMDtcblxuICAgICAgICAgICAgICAgICAgICBmb3IgKGk9aWR4O2k8dGhpcy5pdGVtcy5sZW5ndGg7aSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcmVhICs9IHRoaXMuaXRlbXMuZXEoaSkuZGF0YSgnd2lkdGgnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGFyZWEgPiB0aGlzLnZwKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlUG9zKGl0ZW0uZGF0YSgnbGVmdCcpKi0xKTtcblxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGlyID09IDEpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZWEgPSAwO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpPXRoaXMuaXRlbXMubGVuZ3RoLTE7aT49MDtpLS0pIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmVhICs9IHRoaXMuaXRlbXMuZXEoaSkuZGF0YSgnd2lkdGgnKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXJlYSA9PSB0aGlzLnZwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZHggPSBpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXJlYSA+IHRoaXMudnApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkeCA9IChpIDwgdGhpcy5pdGVtcy5sZW5ndGgtMSkgPyBpKzEgOiBpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXJlYSA+IHRoaXMudnApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVQb3MoKHRoaXMuY29udGFpbmVyLndpZHRoKCkgLSB0aGlzLnZwKSAqIC0xKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVBvcyh0aGlzLml0ZW1zLmVxKGlkeCkuZGF0YSgnbGVmdCcpKi0xKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIG1hcmsgZWxlbWVudHNcbiAgICAgICAgICAgIHZhciBsZWZ0ID0gdGhpcy5pdGVtcy5lcShpZHgpLmRhdGEoJ2xlZnQnKTtcblxuICAgICAgICAgICAgdGhpcy5pdGVtcy5yZW1vdmVDbGFzcygndWstc2xpZGUtYmVmb3JlIHVrLXNsaWRlLWFmdGVyJykuZWFjaChmdW5jdGlvbihpKXtcbiAgICAgICAgICAgICAgICBpZiAoaSE9PWlkeCkge1xuICAgICAgICAgICAgICAgICAgICBVSS4kKHRoaXMpLmFkZENsYXNzKFVJLiQodGhpcykuZGF0YSgnbGVmdCcpIDwgbGVmdCA/ICd1ay1zbGlkZS1iZWZvcmUnOid1ay1zbGlkZS1hZnRlcicpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLmZvY3VzID0gaWR4O1xuXG4gICAgICAgICAgICB0aGlzLnRyaWdnZXIoJ2ZvY3VzaXRlbS51ay5zbGlkZXInLCBbaWR4LHRoaXMuaXRlbXMuZXEoaWR4KSx0aGlzXSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgbmV4dDogZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIHZhciBmb2N1cyA9IHRoaXMuaXRlbXNbdGhpcy5mb2N1cyArIDFdID8gKHRoaXMuZm9jdXMgKyAxKSA6ICh0aGlzLm9wdGlvbnMuaW5maW5pdGUgPyAwOnRoaXMuZm9jdXMpO1xuXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUZvY3VzKGZvY3VzLCAxKTtcbiAgICAgICAgfSxcblxuICAgICAgICBwcmV2aW91czogZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIHZhciBmb2N1cyA9IHRoaXMuaXRlbXNbdGhpcy5mb2N1cyAtIDFdID8gKHRoaXMuZm9jdXMgLSAxKSA6ICh0aGlzLm9wdGlvbnMuaW5maW5pdGUgPyAodGhpcy5pdGVtc1t0aGlzLmZvY3VzIC0gMV0gPyB0aGlzLml0ZW1zLTE6dGhpcy5pdGVtcy5sZW5ndGgtMSk6dGhpcy5mb2N1cyk7XG5cbiAgICAgICAgICAgIHRoaXMudXBkYXRlRm9jdXMoZm9jdXMsIC0xKTtcbiAgICAgICAgfSxcblxuICAgICAgICBzdGFydDogZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIHRoaXMuc3RvcCgpO1xuXG4gICAgICAgICAgICB2YXIgJHRoaXMgPSB0aGlzO1xuXG4gICAgICAgICAgICB0aGlzLmludGVydmFsID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKCEkdGhpcy5ob3ZlcmluZykgJHRoaXMubmV4dCgpO1xuICAgICAgICAgICAgfSwgdGhpcy5vcHRpb25zLmF1dG9wbGF5SW50ZXJ2YWwpO1xuXG4gICAgICAgIH0sXG5cbiAgICAgICAgc3RvcDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5pbnRlcnZhbCkgY2xlYXJJbnRlcnZhbCh0aGlzLmludGVydmFsKTtcbiAgICAgICAgfSxcblxuICAgICAgICBpbmZpbml0ZTogZnVuY3Rpb24oYmFzZWlkeCwgZGlyZWN0aW9uKSB7XG5cbiAgICAgICAgICAgIHZhciAkdGhpcyA9IHRoaXMsIGl0ZW0gPSB0aGlzLml0ZW1zLmVxKGJhc2VpZHgpLCBpLCB6ID0gYmFzZWlkeCwgbW92ZSA9IFtdLCBhcmVhID0gMDtcblxuICAgICAgICAgICAgaWYgKGRpcmVjdGlvbiA9PSAxKSB7XG5cblxuICAgICAgICAgICAgICAgIGZvciAoaT0wO2k8dGhpcy5pdGVtcy5sZW5ndGg7aSsrKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHogIT0gYmFzZWlkeCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXJlYSArPSB0aGlzLml0ZW1zLmVxKHopLmRhdGEoJ3dpZHRoJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBtb3ZlLnB1c2godGhpcy5pdGVtcy5lcSh6KSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoYXJlYSA+IHRoaXMudnApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgeiA9IHorMSA9PSB0aGlzLml0ZW1zLmxlbmd0aCA/IDA6eisxO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChtb3ZlLmxlbmd0aCkge1xuXG4gICAgICAgICAgICAgICAgICAgIG1vdmUuZm9yRWFjaChmdW5jdGlvbihpdG0pe1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbGVmdCA9IGl0ZW0uZGF0YSgnYXJlYScpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpdG0uY3NzKHsnbGVmdCc6IGxlZnR9KS5kYXRhKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0ICA6IGxlZnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJlYSAgOiAobGVmdCtpdG0uZGF0YSgnd2lkdGgnKSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2VudGVyOiAobGVmdCAtICgkdGhpcy52cC8yIC0gaXRtLmRhdGEoJ2N3aWR0aCcpLzIpKVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0gPSBpdG07XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgZm9yIChpPXRoaXMuaXRlbXMubGVuZ3RoLTE7aSA+LTEgO2ktLSkge1xuXG4gICAgICAgICAgICAgICAgICAgIGFyZWEgKz0gdGhpcy5pdGVtcy5lcSh6KS5kYXRhKCd3aWR0aCcpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh6ICE9IGJhc2VpZHgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vdmUucHVzaCh0aGlzLml0ZW1zLmVxKHopKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChhcmVhID4gdGhpcy52cCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB6ID0gei0xID09IC0xID8gdGhpcy5pdGVtcy5sZW5ndGgtMTp6LTE7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKG1vdmUubGVuZ3RoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgbW92ZS5mb3JFYWNoKGZ1bmN0aW9uKGl0bSl7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsZWZ0ID0gaXRlbS5kYXRhKCdsZWZ0JykgLSBpdG0uZGF0YSgnd2lkdGgnKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaXRtLmNzcyh7J2xlZnQnOiBsZWZ0fSkuZGF0YSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdCAgOiBsZWZ0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZWEgIDogKGxlZnQraXRtLmRhdGEoJ3dpZHRoJykpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNlbnRlcjogKGxlZnQgLSAoJHRoaXMudnAvMiAtIGl0bS5kYXRhKCdjd2lkdGgnKS8yKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtID0gaXRtO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIGhhbmRsZSBkcmFnZ2luZ1xuICAgIFVJLiRkb2Mub24oJ21vdXNlbW92ZS51ay5zbGlkZXIgdG91Y2htb3ZlLnVrLnNsaWRlcicsIGZ1bmN0aW9uKGUpIHtcblxuICAgICAgICBpZiAoZS5vcmlnaW5hbEV2ZW50ICYmIGUub3JpZ2luYWxFdmVudC50b3VjaGVzKSB7XG4gICAgICAgICAgICBlID0gZS5vcmlnaW5hbEV2ZW50LnRvdWNoZXNbMF07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGVsYXlJZGxlICYmIE1hdGguYWJzKGUucGFnZVggLSBkZWxheUlkbGUueCkgPiBkZWxheUlkbGUudGhyZXNob2xkKSB7XG5cbiAgICAgICAgICAgIGlmICghd2luZG93LmdldFNlbGVjdGlvbigpLnRvU3RyaW5nKCkpIHtcbiAgICAgICAgICAgICAgICBkZWxheUlkbGUoZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGRyYWdnaW5nID0gZGVsYXlJZGxlID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWRyYWdnaW5nKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgeCwgeERpZmYsIHBvcywgZGlyLCBmb2N1cywgaXRlbSwgbmV4dCwgZGlmZiwgaSwgeiwgaXRtO1xuXG4gICAgICAgIGlmIChlLmNsaWVudFggfHwgZS5jbGllbnRZKSB7XG4gICAgICAgICAgICB4ID0gZS5jbGllbnRYO1xuICAgICAgICB9IGVsc2UgaWYgKGUucGFnZVggfHwgZS5wYWdlWSkge1xuICAgICAgICAgICAgeCA9IGUucGFnZVggLSBkb2N1bWVudC5ib2R5LnNjcm9sbExlZnQgLSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsTGVmdDtcbiAgICAgICAgfVxuXG4gICAgICAgIGZvY3VzID0gc3RvcmUuZm9jdXM7XG4gICAgICAgIHhEaWZmID0geCAtIGRyYWdnaW5nLmVsZW1lbnQuZGF0YSgncG9pbnRlci1zdGFydCcpLng7XG4gICAgICAgIHBvcyAgID0gZHJhZ2dpbmcuZWxlbWVudC5kYXRhKCdwb2ludGVyLXBvcy1zdGFydCcpICsgeERpZmY7XG4gICAgICAgIGRpciAgID0geCA+IGRyYWdnaW5nLmVsZW1lbnQuZGF0YSgncG9pbnRlci1zdGFydCcpLnggPyAtMToxO1xuICAgICAgICBpdGVtICA9IGRyYWdnaW5nLml0ZW1zLmVxKHN0b3JlLmZvY3VzKTtcblxuICAgICAgICBpZiAoZGlyID09IDEpIHtcblxuICAgICAgICAgICAgZGlmZiA9IGl0ZW0uZGF0YSgnbGVmdCcpICsgTWF0aC5hYnMoeERpZmYpO1xuXG4gICAgICAgICAgICBmb3IgKGk9MCx6PXN0b3JlLmZvY3VzO2k8ZHJhZ2dpbmcuaXRlbXMubGVuZ3RoO2krKykge1xuXG4gICAgICAgICAgICAgICAgaXRtID0gZHJhZ2dpbmcuaXRlbXMuZXEoeik7XG5cbiAgICAgICAgICAgICAgICBpZiAoeiAhPSBzdG9yZS5mb2N1cyAmJiBpdG0uZGF0YSgnbGVmdCcpIDwgZGlmZiAmJiBpdG0uZGF0YSgnYXJlYScpID4gZGlmZikge1xuICAgICAgICAgICAgICAgICAgICBmb2N1cyA9IHo7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHogPSB6KzEgPT0gZHJhZ2dpbmcuaXRlbXMubGVuZ3RoID8gMDp6KzE7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgZGlmZiA9IGl0ZW0uZGF0YSgnbGVmdCcpIC0gTWF0aC5hYnMoeERpZmYpO1xuXG4gICAgICAgICAgICBmb3IgKGk9MCx6PXN0b3JlLmZvY3VzO2k8ZHJhZ2dpbmcuaXRlbXMubGVuZ3RoO2krKykge1xuXG4gICAgICAgICAgICAgICAgaXRtID0gZHJhZ2dpbmcuaXRlbXMuZXEoeik7XG5cbiAgICAgICAgICAgICAgICBpZiAoeiAhPSBzdG9yZS5mb2N1cyAmJiBpdG0uZGF0YSgnYXJlYScpIDw9IGl0ZW0uZGF0YSgnbGVmdCcpICYmIGl0bS5kYXRhKCdjZW50ZXInKSA8IGRpZmYpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9jdXMgPSB6O1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB6ID0gei0xID09IC0xID8gZHJhZ2dpbmcuaXRlbXMubGVuZ3RoLTE6ei0xO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRyYWdnaW5nLm9wdGlvbnMuaW5maW5pdGUgJiYgZm9jdXMhPXN0b3JlLl9mb2N1cykge1xuICAgICAgICAgICAgZHJhZ2dpbmcuaW5maW5pdGUoZm9jdXMsIGRpcik7XG4gICAgICAgIH1cblxuICAgICAgICBkcmFnZ2luZy51cGRhdGVQb3MocG9zKTtcblxuICAgICAgICBzdG9yZS5kaXIgICAgID0gZGlyO1xuICAgICAgICBzdG9yZS5fZm9jdXMgID0gZm9jdXM7XG4gICAgICAgIHN0b3JlLnRvdWNoeCAgPSBwYXJzZUludChlLnBhZ2VYLCAxMCk7XG4gICAgICAgIHN0b3JlLmRpZmYgICAgPSBkaWZmO1xuICAgIH0pO1xuXG4gICAgVUkuJGRvYy5vbignbW91c2V1cC51ay5zbGlkZXIgdG91Y2hlbmQudWsuc2xpZGVyJywgZnVuY3Rpb24oZSkge1xuXG4gICAgICAgIGlmIChkcmFnZ2luZykge1xuXG4gICAgICAgICAgICBkcmFnZ2luZy5jb250YWluZXIucmVtb3ZlQ2xhc3MoJ3VrLWRyYWcnKTtcblxuICAgICAgICAgICAgLy8gVE9ETyBpcyB0aGlzIG5lZWRlZD9cbiAgICAgICAgICAgIGRyYWdnaW5nLml0ZW1zLmVxKHN0b3JlLmZvY3VzKTtcblxuICAgICAgICAgICAgdmFyIGl0bSwgZm9jdXMgPSBmYWxzZSwgaSwgejtcblxuICAgICAgICAgICAgaWYgKHN0b3JlLmRpciA9PSAxKSB7XG5cbiAgICAgICAgICAgICAgICBmb3IgKGk9MCx6PXN0b3JlLmZvY3VzO2k8ZHJhZ2dpbmcuaXRlbXMubGVuZ3RoO2krKykge1xuXG4gICAgICAgICAgICAgICAgICAgIGl0bSA9IGRyYWdnaW5nLml0ZW1zLmVxKHopO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh6ICE9IHN0b3JlLmZvY3VzICYmIGl0bS5kYXRhKCdsZWZ0JykgPiBzdG9yZS5kaWZmKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb2N1cyA9IHo7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHogPSB6KzEgPT0gZHJhZ2dpbmcuaXRlbXMubGVuZ3RoID8gMDp6KzE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICghZHJhZ2dpbmcub3B0aW9ucy5pbmZpbml0ZSAmJiAhZm9jdXMpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9jdXMgPSBkcmFnZ2luZy5pdGVtcy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgZm9yIChpPTAsej1zdG9yZS5mb2N1cztpPGRyYWdnaW5nLml0ZW1zLmxlbmd0aDtpKyspIHtcblxuICAgICAgICAgICAgICAgICAgICBpdG0gPSBkcmFnZ2luZy5pdGVtcy5lcSh6KTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoeiAhPSBzdG9yZS5mb2N1cyAmJiBpdG0uZGF0YSgnbGVmdCcpIDwgc3RvcmUuZGlmZikge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9jdXMgPSB6O1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB6ID0gei0xID09IC0xID8gZHJhZ2dpbmcuaXRlbXMubGVuZ3RoLTE6ei0xO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIWRyYWdnaW5nLm9wdGlvbnMuaW5maW5pdGUgJiYgIWZvY3VzKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvY3VzID0gMFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZHJhZ2dpbmcudXBkYXRlRm9jdXMoZm9jdXMhPT1mYWxzZSA/IGZvY3VzOnN0b3JlLl9mb2N1cyk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGRyYWdnaW5nID0gZGVsYXlJZGxlID0gZmFsc2U7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gVUkuc2xpZGVyO1xufSk7Il19
