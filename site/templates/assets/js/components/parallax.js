!function(e){var t;window.UIkit2&&(t=e(UIkit2)),"function"==typeof define&&define.amd&&define("uikit-parallax",["uikit"],function(){return t||e(UIkit2)})}(function(F){"use strict";var t=[],S=!1,i=0,n=window.innerHeight,e=function(){i=F.$win.scrollTop(),window.requestAnimationFrame(function(){for(var e=0;e<t.length;e++)t[e].process()})};F.component("parallax",{defaults:{velocity:.5,target:!1,viewport:!1,media:!1},boot:function(){S=function(){var e,t=document.createElement("div"),a={WebkitTransform:"-webkit-transform",MSTransform:"-ms-transform",MozTransform:"-moz-transform",Transform:"transform"};for(var r in document.body.insertBefore(t,null),a)void 0!==t.style[r]&&(t.style[r]="translate3d(1px,1px,1px)",e=window.getComputedStyle(t).getPropertyValue(a[r]));return document.body.removeChild(t),void 0!==e&&0<e.length&&"none"!==e}(),F.$doc.on("scrolling.uk.document",e),F.$win.on("load resize orientationchange",F.Utils.debounce(function(){n=window.innerHeight,e()},50)),F.ready(function(e){F.$("[data-uk-parallax]",e).each(function(){var e=F.$(this);e.data("parallax")||F.parallax(e,F.Utils.options(e.attr("data-uk-parallax")))})})},init:function(){this.base=this.options.target?F.$(this.options.target):this.element,this.props={},this.velocity=this.options.velocity||1;var s=["target","velocity","viewport","plugins","media"];Object.keys(this.options).forEach(function(e){if(-1===s.indexOf(e)){var t,a,r,i,n=String(this.options[e]).split(",");e.match(/color/i)?(t=n[1]?n[0]:this._getStartValue(e),a=n[1]?n[1]:n[0],t||(t="rgba(255,255,255,0)")):(i=(t=parseFloat(n[1]?n[0]:this._getStartValue(e)))<(a=parseFloat(n[1]?n[1]:n[0]))?a-t:t-a,r=t<a?1:-1),this.props[e]={start:t,end:a,dir:r,diff:i}}}.bind(this)),t.push(this)},process:function(){if(this.options.media)switch(typeof this.options.media){case"number":if(window.innerWidth<this.options.media)return!1;break;case"string":if(window.matchMedia&&!window.matchMedia(this.options.media).matches)return!1}var e=this.percentageInViewport();!1!==this.options.viewport&&(e=0===this.options.viewport?1:e/this.options.viewport),this.update(e)},percentageInViewport:function(){var e,t,a=this.base.offset().top,r=this.base.outerHeight();return i+n<a?t=0:a+r<i?t=1:a+r<n?t=(i<n?i:i-n)/(a+r):(e=i+n-a,t=Math.round(e/((n+r)/100))/100),t},update:function(v){var w,y,x={transform:"",filter:""},I=v*(1-(this.velocity-this.velocity*v));I<0&&(I=0),1<I&&(I=1),void 0!==this._percent&&this._percent==I||(Object.keys(this.props).forEach(function(e){var r,i,n,t,s,o,a,c,l,p,f,d,h,u,b,g,m,k;switch(w=this.props[e],0===v?y=w.start:1===v?y=w.end:void 0!==w.diff&&(y=w.start+w.diff*I*w.dir),"bg"!=e&&"bgp"!=e||this._bgcover||(this._bgcover=(r=this,i=e,n=w,f=new Image,s=r.element.css({backgroundSize:"cover",backgroundRepeat:"no-repeat"}),t=s.css("background-image").replace(/^url\(/g,"").replace(/\)$/g,"").replace(/("|')/g,""),a=function(){var e=s.innerWidth(),t=s.innerHeight(),a="bg"==i?n.diff:n.diff/100*t;if(t+=a,(e+=Math.ceil(a*c))-a<o.w&&t<o.h)return r.element.css({backgroundSize:"auto"});e/c<t?(l=Math.ceil(t*c),(p=t)>window.innerHeight&&(l*=1.2,p*=1.2)):(l=e,p=Math.ceil(e/c)),s.css({backgroundSize:l+"px "+p+"px"}).data("bgsize",{w:l,h:p})},f.onerror=function(){},f.onload=function(){o={w:f.width,h:f.height},c=f.width/f.height,F.$win.on("load resize orientationchange",F.Utils.debounce(function(){a()},50)),a()},f.src=t,!0)),e){case"x":x.transform+=S?" translate3d("+y+"px, 0, 0)":" translateX("+y+"px)";break;case"xp":x.transform+=S?" translate3d("+y+"%, 0, 0)":" translateX("+y+"%)";break;case"y":x.transform+=S?" translate3d(0, "+y+"px, 0)":" translateY("+y+"px)";break;case"yp":x.transform+=S?" translate3d(0, "+y+"%, 0)":" translateY("+y+"%)";break;case"rotate":x.transform+=" rotate("+y+"deg)";break;case"scale":x.transform+=" scale("+y+")";break;case"bg":x["background-position"]="50% "+y+"px";break;case"bgp":x["background-position"]="50% "+y+"%";break;case"color":case"background-color":case"border-color":x[e]=(d=w.start,h=w.end,u=I,d=z(d),h=z(h),b=d,g=h,m=u=u||0,k="rgba("+parseInt(b[0]+m*(g[0]-b[0]),10)+","+parseInt(b[1]+m*(g[1]-b[1]),10)+","+parseInt(b[2]+m*(g[2]-b[2]),10)+","+(b&&g?parseFloat(b[3]+m*(g[3]-b[3])):1),k+=")");break;case"blur":x.filter+=" blur("+y+"px)";break;case"hue":x.filter+=" hue-rotate("+y+"deg)";break;case"grayscale":x.filter+=" grayscale("+y+"%)";break;case"invert":x.filter+=" invert("+y+"%)";break;case"fopacity":x.filter+=" opacity("+y+"%)";break;case"saturate":x.filter+=" saturate("+y+"%)";break;case"sepia":x.filter+=" sepia("+y+"%)";break;default:x[e]=y}}.bind(this)),x.filter&&(x["-webkit-filter"]=x.filter),this.element.css(x),this._percent=I)},_getStartValue:function(e){var t=0;switch(e){case"scale":t=1;break;default:t=this.element.css(e)}return t||0}});var a={black:[0,0,0,1],blue:[0,0,255,1],brown:[165,42,42,1],cyan:[0,255,255,1],fuchsia:[255,0,255,1],gold:[255,215,0,1],green:[0,128,0,1],indigo:[75,0,130,1],khaki:[240,230,140,1],lime:[0,255,0,1],magenta:[255,0,255,1],maroon:[128,0,0,1],navy:[0,0,128,1],olive:[128,128,0,1],orange:[255,165,0,1],pink:[255,192,203,1],purple:[128,0,128,1],violet:[128,0,128,1],red:[255,0,0,1],silver:[192,192,192,1],white:[255,255,255,1],yellow:[255,255,0,1],transparent:[255,255,255,0]};function z(e){var t;return(t=/#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})/.exec(e))?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),1]:(t=/#([0-9a-fA-F])([0-9a-fA-F])([0-9a-fA-F])/.exec(e))?[17*parseInt(t[1],16),17*parseInt(t[2],16),17*parseInt(t[3],16),1]:(t=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(e))?[parseInt(t[1]),parseInt(t[2]),parseInt(t[3]),1]:(t=/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9\.]*)\s*\)/.exec(e))?[parseInt(t[1],10),parseInt(t[2],10),parseInt(t[3],10),parseFloat(t[4])]:a[e]||[255,255,255,0]}return F.parallax});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvcGFyYWxsYXguanMiXSwibmFtZXMiOlsiYWRkb24iLCJjb21wb25lbnQiLCJ3aW5kb3ciLCJVSWtpdDIiLCJkZWZpbmUiLCJhbWQiLCJVSSIsInBhcmFsbGF4ZXMiLCJzdXBwb3J0czNkIiwic2Nyb2xsdG9wIiwid2giLCJpbm5lckhlaWdodCIsImNoZWNrUGFyYWxsYXhlcyIsIiR3aW4iLCJzY3JvbGxUb3AiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJpIiwibGVuZ3RoIiwicHJvY2VzcyIsImRlZmF1bHRzIiwidmVsb2NpdHkiLCJ0YXJnZXQiLCJ2aWV3cG9ydCIsIm1lZGlhIiwiYm9vdCIsImhhczNkIiwiZWwiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJ0cmFuc2Zvcm1zIiwiV2Via2l0VHJhbnNmb3JtIiwiTVNUcmFuc2Zvcm0iLCJNb3pUcmFuc2Zvcm0iLCJUcmFuc2Zvcm0iLCJ0IiwiYm9keSIsImluc2VydEJlZm9yZSIsInVuZGVmaW5lZCIsInN0eWxlIiwiZ2V0Q29tcHV0ZWRTdHlsZSIsImdldFByb3BlcnR5VmFsdWUiLCJyZW1vdmVDaGlsZCIsIiRkb2MiLCJvbiIsIlV0aWxzIiwiZGVib3VuY2UiLCJyZWFkeSIsImNvbnRleHQiLCIkIiwiZWFjaCIsInBhcmFsbGF4IiwidGhpcyIsImRhdGEiLCJvcHRpb25zIiwiYXR0ciIsImluaXQiLCJiYXNlIiwiZWxlbWVudCIsInByb3BzIiwicmVzZXJ2ZWQiLCJPYmplY3QiLCJrZXlzIiwiZm9yRWFjaCIsInByb3AiLCJpbmRleE9mIiwic3RhcnQiLCJlbmQiLCJkaXIiLCJkaWZmIiwic3RhcnRlbmQiLCJTdHJpbmciLCJzcGxpdCIsIm1hdGNoIiwiX2dldFN0YXJ0VmFsdWUiLCJwYXJzZUZsb2F0IiwiYmluZCIsInB1c2giLCJpbm5lcldpZHRoIiwibWF0Y2hNZWRpYSIsIm1hdGNoZXMiLCJwZXJjZW50IiwicGVyY2VudGFnZUluVmlld3BvcnQiLCJ1cGRhdGUiLCJkaXN0YW5jZSIsInRvcCIsIm9mZnNldCIsImhlaWdodCIsIm91dGVySGVpZ2h0IiwiTWF0aCIsInJvdW5kIiwib3B0cyIsInZhbCIsImNzcyIsInRyYW5zZm9ybSIsImZpbHRlciIsImNvbXBlcmNlbnQiLCJfcGVyY2VudCIsIm9iaiIsInVybCIsInNpemUiLCJjaGVjayIsInJhdGlvIiwid2lkdGgiLCJpbWciLCJwb3MiLCJiZWdpbiIsImNvbG9yIiwiX2JnY292ZXIiLCJJbWFnZSIsImJhY2tncm91bmRTaXplIiwiYmFja2dyb3VuZFJlcGVhdCIsInJlcGxhY2UiLCJ3IiwiaCIsImV4dHJhIiwiY2VpbCIsIm9uZXJyb3IiLCJvbmxvYWQiLCJzcmMiLCJwYXJzZUNvbG9yIiwicGFyc2VJbnQiLCJ2YWx1ZSIsImNvbG9ycyIsImJsYWNrIiwiYmx1ZSIsImJyb3duIiwiY3lhbiIsImZ1Y2hzaWEiLCJnb2xkIiwiZ3JlZW4iLCJpbmRpZ28iLCJraGFraSIsImxpbWUiLCJtYWdlbnRhIiwibWFyb29uIiwibmF2eSIsIm9saXZlIiwib3JhbmdlIiwicGluayIsInB1cnBsZSIsInZpb2xldCIsInJlZCIsInNpbHZlciIsIndoaXRlIiwieWVsbG93IiwidHJhbnNwYXJlbnQiLCJleGVjIl0sIm1hcHBpbmdzIjoiQ0FDQSxTQUFVQSxHQUVOLElBQUlDLEVBRUFDLE9BQU9DLFNBQ1BGLEVBQVlELEVBQU1HLFNBR0QsbUJBQVZDLFFBQXdCQSxPQUFPQyxLQUN0Q0QsT0FBTyxpQkFBa0IsQ0FBQyxTQUFVLFdBQ2hDLE9BQU9ILEdBQWFELEVBQU1HLFVBVnRDLENBY0csU0FBU0csR0FFUixhQUVBLElBQUlDLEVBQWtCLEdBQ2xCQyxHQUFrQixFQUNsQkMsRUFBa0IsRUFDbEJDLEVBQWtCUixPQUFPUyxZQUN6QkMsRUFBa0IsV0FFZEgsRUFBWUgsRUFBR08sS0FBS0MsWUFFcEJaLE9BQU9hLHNCQUFzQixXQUN6QixJQUFLLElBQUlDLEVBQUUsRUFBR0EsRUFBSVQsRUFBV1UsT0FBUUQsSUFDakNULEVBQVdTLEdBQUdF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QUNjLFNBQVNoRCxFQUFNLEdBQUksSUFBS2dELFNBQVNoRCxFQUFNLEdBQUksSUFBS2dELFNBQVNoRCxFQUFNLEdBQUksSUFBSUUsV0FBV0YsRUFBTSxLQUl6RmtELEVBQU9oQixJQUFVLENBQUMsSUFBSSxJQUFJLElBQUksR0FLbkQsT0FBT3BHLEVBQUc0QyIsImZpbGUiOiJjb21wb25lbnRzL3BhcmFsbGF4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyohIFVJa2l0IDIuMjcuMiB8IGh0dHA6Ly93d3cuZ2V0dWlraXQuY29tIHwgKGMpIDIwMTQgWU9PdGhlbWUgfCBNSVQgTGljZW5zZSAqL1xyXG4oZnVuY3Rpb24oYWRkb24pIHtcclxuXHJcbiAgICB2YXIgY29tcG9uZW50O1xyXG5cclxuICAgIGlmICh3aW5kb3cuVUlraXQyKSB7XHJcbiAgICAgICAgY29tcG9uZW50ID0gYWRkb24oVUlraXQyKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodHlwZW9mIGRlZmluZSA9PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHtcclxuICAgICAgICBkZWZpbmUoJ3Vpa2l0LXBhcmFsbGF4JywgWyd1aWtpdCddLCBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICByZXR1cm4gY29tcG9uZW50IHx8IGFkZG9uKFVJa2l0Mik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG59KShmdW5jdGlvbihVSSl7XHJcblxyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG4gICAgdmFyIHBhcmFsbGF4ZXMgICAgICA9IFtdLFxyXG4gICAgICAgIHN1cHBvcnRzM2QgICAgICA9IGZhbHNlLFxyXG4gICAgICAgIHNjcm9sbHRvcCAgICAgICA9IDAsXHJcbiAgICAgICAgd2ggICAgICAgICAgICAgID0gd2luZG93LmlubmVySGVpZ2h0LFxyXG4gICAgICAgIGNoZWNrUGFyYWxsYXhlcyA9IGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICAgICAgc2Nyb2xsdG9wID0gVUkuJHdpbi5zY3JvbGxUb3AoKTtcclxuXHJcbiAgICAgICAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGk9MDsgaSA8IHBhcmFsbGF4ZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBwYXJhbGxheGVzW2ldLnByb2Nlc3MoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcblxyXG4gICAgVUkuY29tcG9uZW50KCdwYXJhbGxheCcsIHtcclxuXHJcbiAgICAgICAgZGVmYXVsdHM6IHtcclxuICAgICAgICAgICAgdmVsb2NpdHkgOiAwLjUsXHJcbiAgICAgICAgICAgIHRhcmdldCAgIDogZmFsc2UsXHJcbiAgICAgICAgICAgIHZpZXdwb3J0IDogZmFsc2UsXHJcbiAgICAgICAgICAgIG1lZGlhICAgIDogZmFsc2VcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBib290OiBmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgICAgIHN1cHBvcnRzM2QgPSAoZnVuY3Rpb24oKXtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSxcclxuICAgICAgICAgICAgICAgICAgICBoYXMzZCxcclxuICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm1zID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAnV2Via2l0VHJhbnNmb3JtJzonLXdlYmtpdC10cmFuc2Zvcm0nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAnTVNUcmFuc2Zvcm0nOictbXMtdHJhbnNmb3JtJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ01velRyYW5zZm9ybSc6Jy1tb3otdHJhbnNmb3JtJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ1RyYW5zZm9ybSc6J3RyYW5zZm9ybSdcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIEFkZCBpdCB0byB0aGUgYm9keSB0byBnZXQgdGhlIGNvbXB1dGVkIHN0eWxlLlxyXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5pbnNlcnRCZWZvcmUoZWwsIG51bGwpO1xyXG5cclxuICAgICAgICAgICAgICAgIGZvciAodmFyIHQgaW4gdHJhbnNmb3Jtcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChlbC5zdHlsZVt0XSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsLnN0eWxlW3RdID0gJ3RyYW5zbGF0ZTNkKDFweCwxcHgsMXB4KSc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhczNkID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoZWwpLmdldFByb3BlcnR5VmFsdWUodHJhbnNmb3Jtc1t0XSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoZWwpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiAoaGFzM2QgIT09IHVuZGVmaW5lZCAmJiBoYXMzZC5sZW5ndGggPiAwICYmIGhhczNkICE9PSBcIm5vbmVcIik7XHJcbiAgICAgICAgICAgIH0pKCk7XHJcblxyXG4gICAgICAgICAgICAvLyBsaXN0ZW4gdG8gc2Nyb2xsIGFuZCByZXNpemVcclxuICAgICAgICAgICAgVUkuJGRvYy5vbignc2Nyb2xsaW5nLnVrLmRvY3VtZW50JywgY2hlY2tQYXJhbGxheGVzKTtcclxuICAgICAgICAgICAgVUkuJHdpbi5vbignbG9hZCByZXNpemUgb3JpZW50YXRpb25jaGFuZ2UnLCBVSS5VdGlscy5kZWJvdW5jZShmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgd2ggPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICBjaGVja1BhcmFsbGF4ZXMoKTtcclxuICAgICAgICAgICAgfSwgNTApKTtcclxuXHJcbiAgICAgICAgICAgIC8vIGluaXQgY29kZVxyXG4gICAgICAgICAgICBVSS5yZWFkeShmdW5jdGlvbihjb250ZXh0KSB7XHJcblxyXG4gICAgICAgICAgICAgICAgVUkuJCgnW2RhdGEtdWstcGFyYWxsYXhdJywgY29udGV4dCkuZWFjaChmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmFsbGF4ID0gVUkuJCh0aGlzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFwYXJhbGxheC5kYXRhKCdwYXJhbGxheCcpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFVJLnBhcmFsbGF4KHBhcmFsbGF4LCBVSS5VdGlscy5vcHRpb25zKHBhcmFsbGF4LmF0dHIoJ2RhdGEtdWstcGFyYWxsYXgnKSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBpbml0OiBmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuYmFzZSAgICAgPSB0aGlzLm9wdGlvbnMudGFyZ2V0ID8gVUkuJCh0aGlzLm9wdGlvbnMudGFyZ2V0KSA6IHRoaXMuZWxlbWVudDtcclxuICAgICAgICAgICAgdGhpcy5wcm9wcyAgICA9IHt9O1xyXG4gICAgICAgICAgICB0aGlzLnZlbG9jaXR5ID0gKHRoaXMub3B0aW9ucy52ZWxvY2l0eSB8fCAxKTtcclxuXHJcbiAgICAgICAgICAgIHZhciByZXNlcnZlZCAgPSBbJ3RhcmdldCcsJ3ZlbG9jaXR5Jywndmlld3BvcnQnLCdwbHVnaW5zJywnbWVkaWEnXTtcclxuXHJcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKHRoaXMub3B0aW9ucykuZm9yRWFjaChmdW5jdGlvbihwcm9wKXtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAocmVzZXJ2ZWQuaW5kZXhPZihwcm9wKSAhPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHN0YXJ0LCBlbmQsIGRpciwgZGlmZiwgc3RhcnRlbmQgPSBTdHJpbmcodGhpcy5vcHRpb25zW3Byb3BdKS5zcGxpdCgnLCcpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChwcm9wLm1hdGNoKC9jb2xvci9pKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0ID0gc3RhcnRlbmRbMV0gPyBzdGFydGVuZFswXSA6IHRoaXMuX2dldFN0YXJ0VmFsdWUocHJvcCksXHJcbiAgICAgICAgICAgICAgICAgICAgZW5kICAgPSBzdGFydGVuZFsxXSA/IHN0YXJ0ZW5kWzFdIDogc3RhcnRlbmRbMF07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghc3RhcnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQgPSAncmdiYSgyNTUsMjU1LDI1NSwwKSc7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RhcnQgPSBwYXJzZUZsb2F0KHN0YXJ0ZW5kWzFdID8gc3RhcnRlbmRbMF0gOiB0aGlzLl9nZXRTdGFydFZhbHVlKHByb3ApKSxcclxuICAgICAgICAgICAgICAgICAgICBlbmQgICA9IHBhcnNlRmxvYXQoc3RhcnRlbmRbMV0gPyBzdGFydGVuZFsxXSA6IHN0YXJ0ZW5kWzBdKTtcclxuICAgICAgICAgICAgICAgICAgICBkaWZmICA9IChzdGFydCA8IGVuZCA/IChlbmQtc3RhcnQpOihzdGFydC1lbmQpKTtcclxuICAgICAgICAgICAgICAgICAgICBkaXIgICA9IChzdGFydCA8IGVuZCA/IDE6LTEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMucHJvcHNbcHJvcF0gPSB7IHN0YXJ0OiBzdGFydCwgZW5kOiBlbmQsIGRpcjogZGlyLCBkaWZmOiBkaWZmIH07XHJcblxyXG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xyXG5cclxuICAgICAgICAgICAgcGFyYWxsYXhlcy5wdXNoKHRoaXMpO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIHByb2Nlc3M6IGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5tZWRpYSkge1xyXG5cclxuICAgICAgICAgICAgICAgIHN3aXRjaCh0eXBlb2YodGhpcy5vcHRpb25zLm1lZGlhKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuaW5uZXJXaWR0aCA8IHRoaXMub3B0aW9ucy5tZWRpYSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cubWF0Y2hNZWRpYSAmJiAhd2luZG93Lm1hdGNoTWVkaWEodGhpcy5vcHRpb25zLm1lZGlhKS5tYXRjaGVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZhciBwZXJjZW50ID0gdGhpcy5wZXJjZW50YWdlSW5WaWV3cG9ydCgpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy52aWV3cG9ydCAhPT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgICAgIHBlcmNlbnQgPSAodGhpcy5vcHRpb25zLnZpZXdwb3J0ID09PSAwKSA/IDEgOiBwZXJjZW50IC8gdGhpcy5vcHRpb25zLnZpZXdwb3J0O1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZShwZXJjZW50KTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBwZXJjZW50YWdlSW5WaWV3cG9ydDogZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgdG9wICAgICA9IHRoaXMuYmFzZS5vZmZzZXQoKS50b3AsXHJcbiAgICAgICAgICAgICAgICBoZWlnaHQgID0gdGhpcy5iYXNlLm91dGVySGVpZ2h0KCksXHJcbiAgICAgICAgICAgICAgICBkaXN0YW5jZSwgcGVyY2VudGFnZSwgcGVyY2VudDtcclxuXHJcbiAgICAgICAgICAgIGlmICh0b3AgPiAoc2Nyb2xsdG9wICsgd2gpKSB7XHJcbiAgICAgICAgICAgICAgICBwZXJjZW50ID0gMDtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICgodG9wICsgaGVpZ2h0KSA8IHNjcm9sbHRvcCkge1xyXG4gICAgICAgICAgICAgICAgcGVyY2VudCA9IDE7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCh0b3AgKyBoZWlnaHQpIDwgd2gpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcGVyY2VudCA9IChzY3JvbGx0b3AgPCB3aCA/IHNjcm9sbHRvcCA6IHNjcm9sbHRvcCAtIHdoKSAvICh0b3AraGVpZ2h0KTtcclxuXHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBkaXN0YW5jZSAgID0gKHNjcm9sbHRvcCArIHdoKSAtIHRvcDtcclxuICAgICAgICAgICAgICAgICAgICBwZXJjZW50YWdlID0gTWF0aC5yb3VuZChkaXN0YW5jZSAvICgod2ggKyBoZWlnaHQpIC8gMTAwKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcGVyY2VudCAgICA9IHBlcmNlbnRhZ2UvMTAwO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcGVyY2VudDtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uKHBlcmNlbnQpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciAkdGhpcyAgICAgID0gdGhpcyxcclxuICAgICAgICAgICAgICAgIGNzcyAgICAgICAgPSB7dHJhbnNmb3JtOicnLCBmaWx0ZXI6Jyd9LFxyXG4gICAgICAgICAgICAgICAgY29tcGVyY2VudCA9IHBlcmNlbnQgKiAoMSAtICh0aGlzLnZlbG9jaXR5IC0gKHRoaXMudmVsb2NpdHkgKiBwZXJjZW50KSkpLFxyXG4gICAgICAgICAgICAgICAgb3B0cywgdmFsO1xyXG5cclxuICAgICAgICAgICAgaWYgKGNvbXBlcmNlbnQgPCAwKSBjb21wZXJjZW50ID0gMDtcclxuICAgICAgICAgICAgaWYgKGNvbXBlcmNlbnQgPiAxKSBjb21wZXJjZW50ID0gMTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9wZXJjZW50ICE9PSB1bmRlZmluZWQgJiYgdGhpcy5fcGVyY2VudCA9PSBjb21wZXJjZW50KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKHRoaXMucHJvcHMpLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xyXG5cclxuICAgICAgICAgICAgICAgIG9wdHMgPSB0aGlzLnByb3BzW3Byb3BdO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChwZXJjZW50ID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFsID0gb3B0cy5zdGFydDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZihwZXJjZW50ID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFsID0gb3B0cy5lbmQ7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYob3B0cy5kaWZmICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YWwgPSBvcHRzLnN0YXJ0ICsgKG9wdHMuZGlmZiAqIGNvbXBlcmNlbnQgKiBvcHRzLmRpcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKChwcm9wID09ICdiZycgfHwgcHJvcCA9PSAnYmdwJykgJiYgIXRoaXMuX2JnY292ZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9iZ2NvdmVyID0gaW5pdEJnSW1hZ2VQYXJhbGxheCh0aGlzLCBwcm9wLCBvcHRzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBzd2l0Y2gocHJvcCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyB0cmFuc2Zvcm1zXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAneCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNzcy50cmFuc2Zvcm0gKz0gc3VwcG9ydHMzZCA/ICcgdHJhbnNsYXRlM2QoJyt2YWwrJ3B4LCAwLCAwKSc6JyB0cmFuc2xhdGVYKCcrdmFsKydweCknO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICd4cCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNzcy50cmFuc2Zvcm0gKz0gc3VwcG9ydHMzZCA/ICcgdHJhbnNsYXRlM2QoJyt2YWwrJyUsIDAsIDApJzonIHRyYW5zbGF0ZVgoJyt2YWwrJyUpJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAneSc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNzcy50cmFuc2Zvcm0gKz0gc3VwcG9ydHMzZCA/ICcgdHJhbnNsYXRlM2QoMCwgJyt2YWwrJ3B4LCAwKSc6JyB0cmFuc2xhdGVZKCcrdmFsKydweCknO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICd5cCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNzcy50cmFuc2Zvcm0gKz0gc3VwcG9ydHMzZCA/ICcgdHJhbnNsYXRlM2QoMCwgJyt2YWwrJyUsIDApJzonIHRyYW5zbGF0ZVkoJyt2YWwrJyUpJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAncm90YXRlJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3NzLnRyYW5zZm9ybSArPSAnIHJvdGF0ZSgnK3ZhbCsnZGVnKSc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3NjYWxlJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3NzLnRyYW5zZm9ybSArPSAnIHNjYWxlKCcrdmFsKycpJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIGJnIGltYWdlXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYmcnOlxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZG9uJ3QgbW92ZSBpZiBpbWFnZSBoZWlnaHQgaXMgdG9vIHNtYWxsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmICgkdGhpcy5lbGVtZW50LmRhdGEoJ2Jnc2l6ZScpICYmICgkdGhpcy5lbGVtZW50LmRhdGEoJ2Jnc2l6ZScpLmggKyB2YWwgLSB3aW5kb3cuaW5uZXJIZWlnaHQpIDwgMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNzc1snYmFja2dyb3VuZC1wb3NpdGlvbiddID0gJzUwJSAnK3ZhbCsncHgnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdiZ3AnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjc3NbJ2JhY2tncm91bmQtcG9zaXRpb24nXSA9ICc1MCUgJyt2YWwrJyUnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gY29sb3JcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdjb2xvcic6XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYmFja2dyb3VuZC1jb2xvcic6XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYm9yZGVyLWNvbG9yJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3NzW3Byb3BdID0gY2FsY0NvbG9yKG9wdHMuc3RhcnQsIG9wdHMuZW5kLCBjb21wZXJjZW50KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIENTUyBGaWx0ZXJcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdibHVyJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3NzLmZpbHRlciArPSAnIGJsdXIoJyt2YWwrJ3B4KSc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2h1ZSc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNzcy5maWx0ZXIgKz0gJyBodWUtcm90YXRlKCcrdmFsKydkZWcpJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnZ3JheXNjYWxlJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3NzLmZpbHRlciArPSAnIGdyYXlzY2FsZSgnK3ZhbCsnJSknO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdpbnZlcnQnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjc3MuZmlsdGVyICs9ICcgaW52ZXJ0KCcrdmFsKyclKSc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2ZvcGFjaXR5JzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3NzLmZpbHRlciArPSAnIG9wYWNpdHkoJyt2YWwrJyUpJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnc2F0dXJhdGUnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjc3MuZmlsdGVyICs9ICcgc2F0dXJhdGUoJyt2YWwrJyUpJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnc2VwaWEnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjc3MuZmlsdGVyICs9ICcgc2VwaWEoJyt2YWwrJyUpJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNzc1twcm9wXSA9IHZhbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGNzcy5maWx0ZXIpIHtcclxuICAgICAgICAgICAgICAgIGNzc1snLXdlYmtpdC1maWx0ZXInXSA9IGNzcy5maWx0ZXI7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5jc3MoY3NzKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuX3BlcmNlbnQgPSBjb21wZXJjZW50O1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIF9nZXRTdGFydFZhbHVlOiBmdW5jdGlvbihwcm9wKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgdmFsdWUgPSAwO1xyXG5cclxuICAgICAgICAgICAgc3dpdGNoKHByb3ApIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ3NjYWxlJzpcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdGhpcy5lbGVtZW50LmNzcyhwcm9wKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuICh2YWx1ZSB8fCAwKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfSk7XHJcblxyXG5cclxuICAgIC8vIGhlbHBlclxyXG5cclxuICAgIGZ1bmN0aW9uIGluaXRCZ0ltYWdlUGFyYWxsYXgob2JqLCBwcm9wLCBvcHRzKSB7XHJcblxyXG4gICAgICAgIHZhciBpbWcgPSBuZXcgSW1hZ2UoKSwgdXJsLCBlbGVtZW50LCBzaXplLCBjaGVjaywgcmF0aW8sIHdpZHRoLCBoZWlnaHQ7XHJcblxyXG4gICAgICAgIGVsZW1lbnQgPSBvYmouZWxlbWVudC5jc3Moe2JhY2tncm91bmRTaXplOiAnY292ZXInLCAgYmFja2dyb3VuZFJlcGVhdDogJ25vLXJlcGVhdCd9KTtcclxuICAgICAgICB1cmwgICAgID0gZWxlbWVudC5jc3MoJ2JhY2tncm91bmQtaW1hZ2UnKS5yZXBsYWNlKC9edXJsXFwoL2csICcnKS5yZXBsYWNlKC9cXCkkL2csICcnKS5yZXBsYWNlKC8oXCJ8JykvZywgJycpO1xyXG4gICAgICAgIGNoZWNrICAgPSBmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciB3ID0gZWxlbWVudC5pbm5lcldpZHRoKCksIGggPSBlbGVtZW50LmlubmVySGVpZ2h0KCksIGV4dHJhID0gKHByb3A9PSdiZycpID8gb3B0cy5kaWZmIDogKG9wdHMuZGlmZi8xMDApICogaDtcclxuXHJcbiAgICAgICAgICAgIGggKz0gZXh0cmE7XHJcbiAgICAgICAgICAgIHcgKz0gTWF0aC5jZWlsKGV4dHJhICogcmF0aW8pO1xyXG5cclxuICAgICAgICAgICAgaWYgKHctZXh0cmEgPCBzaXplLncgJiYgaCA8IHNpemUuaCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9iai5lbGVtZW50LmNzcyh7YmFja2dyb3VuZFNpemU6ICdhdXRvJ30pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBpZiBlbGVtZW50IGhlaWdodCA8IHBhcmVudCBoZWlnaHQgKGdhcCB1bmRlcm5lYXRoKVxyXG4gICAgICAgICAgICBpZiAoKHcgLyByYXRpbykgPCBoKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgd2lkdGggID0gTWF0aC5jZWlsKGggKiByYXRpbyk7XHJcbiAgICAgICAgICAgICAgICBoZWlnaHQgPSBoO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChoID4gd2luZG93LmlubmVySGVpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgd2lkdGggID0gd2lkdGggKiAxLjI7XHJcbiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0ID0gaGVpZ2h0ICogMS4yO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gZWxlbWVudCB3aWR0aCA8IHBhcmVudCB3aWR0aCAoZ2FwIHRvIHJpZ2h0KVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgICAgIHdpZHRoICA9IHc7XHJcbiAgICAgICAgICAgICAgICBoZWlnaHQgPSBNYXRoLmNlaWwodyAvIHJhdGlvKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZWxlbWVudC5jc3Moe2JhY2tncm91bmRTaXplOiAod2lkdGgrJ3B4ICcraGVpZ2h0KydweCcpfSkuZGF0YSgnYmdzaXplJywge3c6d2lkdGgsaDpoZWlnaHR9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBpbWcub25lcnJvciA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIC8vIGltYWdlIHVybCBkb2Vzbid0IGV4aXN0XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgaW1nLm9ubG9hZCA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIHNpemUgID0ge3c6aW1nLndpZHRoLCBoOmltZy5oZWlnaHR9O1xyXG4gICAgICAgICAgICByYXRpbyA9IGltZy53aWR0aCAvIGltZy5oZWlnaHQ7XHJcblxyXG4gICAgICAgICAgICBVSS4kd2luLm9uKCdsb2FkIHJlc2l6ZSBvcmllbnRhdGlvbmNoYW5nZScsIFVJLlV0aWxzLmRlYm91bmNlKGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICBjaGVjaygpO1xyXG4gICAgICAgICAgICB9LCA1MCkpO1xyXG5cclxuICAgICAgICAgICAgY2hlY2soKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBpbWcuc3JjID0gdXJsO1xyXG5cclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgLy8gU29tZSBuYW1lZCBjb2xvcnMgdG8gd29yayB3aXRoLCBhZGRlZCBieSBCcmFkbGV5IEF5ZXJzXHJcbiAgICAvLyBGcm9tIEludGVyZmFjZSBieSBTdGVmYW4gUGV0cmVcclxuICAgIC8vIGh0dHA6Ly9pbnRlcmZhY2UuZXllY29uLnJvL1xyXG4gICAgdmFyIGNvbG9ycyA9IHtcclxuICAgICAgICAnYmxhY2snOiBbMCwwLDAsMV0sXHJcbiAgICAgICAgJ2JsdWUnOiBbMCwwLDI1NSwxXSxcclxuICAgICAgICAnYnJvd24nOiBbMTY1LDQyLDQyLDFdLFxyXG4gICAgICAgICdjeWFuJzogWzAsMjU1LDI1NSwxXSxcclxuICAgICAgICAnZnVjaHNpYSc6IFsyNTUsMCwyNTUsMV0sXHJcbiAgICAgICAgJ2dvbGQnOiBbMjU1LDIxNSwwLDFdLFxyXG4gICAgICAgICdncmVlbic6IFswLDEyOCwwLDFdLFxyXG4gICAgICAgICdpbmRpZ28nOiBbNzUsMCwxMzAsMV0sXHJcbiAgICAgICAgJ2toYWtpJzogWzI0MCwyMzAsMTQwLDFdLFxyXG4gICAgICAgICdsaW1lJzogWzAsMjU1LDAsMV0sXHJcbiAgICAgICAgJ21hZ2VudGEnOiBbMjU1LDAsMjU1LDFdLFxyXG4gICAgICAgICdtYXJvb24nOiBbMTI4LDAsMCwxXSxcclxuICAgICAgICAnbmF2eSc6IFswLDAsMTI4LDFdLFxyXG4gICAgICAgICdvbGl2ZSc6IFsxMjgsMTI4LDAsMV0sXHJcbiAgICAgICAgJ29yYW5nZSc6IFsyNTUsMTY1LDAsMV0sXHJcbiAgICAgICAgJ3BpbmsnOiBbMjU1LDE5MiwyMDMsMV0sXHJcbiAgICAgICAgJ3B1cnBsZSc6IFsxMjgsMCwxMjgsMV0sXHJcbiAgICAgICAgJ3Zpb2xldCc6IFsxMjgsMCwxMjgsMV0sXHJcbiAgICAgICAgJ3JlZCc6IFsyNTUsMCwwLDFdLFxyXG4gICAgICAgICdzaWx2ZXInOiBbMTkyLDE5MiwxOTIsMV0sXHJcbiAgICAgICAgJ3doaXRlJzogWzI1NSwyNTUsMjU1LDFdLFxyXG4gICAgICAgICd5ZWxsb3cnOiBbMjU1LDI1NSwwLDFdLFxyXG4gICAgICAgICd0cmFuc3BhcmVudCc6IFsyNTUsMjU1LDI1NSwwXVxyXG4gICAgfTtcclxuXHJcbiAgICBmdW5jdGlvbiBjYWxjQ29sb3Ioc3RhcnQsIGVuZCwgcG9zKSB7XHJcblxyXG4gICAgICAgIHN0YXJ0ID0gcGFyc2VDb2xvcihzdGFydCk7XHJcbiAgICAgICAgZW5kICAgPSBwYXJzZUNvbG9yKGVuZCk7XHJcbiAgICAgICAgcG9zICAgPSBwb3MgfHwgMDtcclxuXHJcbiAgICAgICAgcmV0dXJuIGNhbGN1bGF0ZUNvbG9yKHN0YXJ0LCBlbmQsIHBvcyk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIVxyXG4gICAgICogQHByZXNlcnZlIENvbG9yIGFuaW1hdGlvbiAxLjYuMFxyXG4gICAgICogaHR0cDovL3d3dy5iaXRzdG9ybS5vcmcvanF1ZXJ5L2NvbG9yLWFuaW1hdGlvbi9cclxuICAgICAqIENvcHlyaWdodCAyMDExLCAyMDEzIEVkd2luIE1hcnRpbiA8ZWR3aW5AYml0c3Rvcm0ub3JnPlxyXG4gICAgICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBhbmQgR1BMIGxpY2Vuc2VzLlxyXG4gICAgICovXHJcblxyXG4gICAgLy8gQ2FsY3VsYXRlIGFuIGluLWJldHdlZW4gY29sb3IuIFJldHVybnMgXCIjYWFiYmNjXCItbGlrZSBzdHJpbmcuXHJcbiAgICBmdW5jdGlvbiBjYWxjdWxhdGVDb2xvcihiZWdpbiwgZW5kLCBwb3MpIHtcclxuICAgICAgICB2YXIgY29sb3IgPSAncmdiYSgnXHJcbiAgICAgICAgICAgICAgICArIHBhcnNlSW50KChiZWdpblswXSArIHBvcyAqIChlbmRbMF0gLSBiZWdpblswXSkpLCAxMCkgKyAnLCdcclxuICAgICAgICAgICAgICAgICsgcGFyc2VJbnQoKGJlZ2luWzFdICsgcG9zICogKGVuZFsxXSAtIGJlZ2luWzFdKSksIDEwKSArICcsJ1xyXG4gICAgICAgICAgICAgICAgKyBwYXJzZUludCgoYmVnaW5bMl0gKyBwb3MgKiAoZW5kWzJdIC0gYmVnaW5bMl0pKSwgMTApICsgJywnXHJcbiAgICAgICAgICAgICAgICArIChiZWdpbiAmJiBlbmQgPyBwYXJzZUZsb2F0KGJlZ2luWzNdICsgcG9zICogKGVuZFszXSAtIGJlZ2luWzNdKSkgOiAxKTtcclxuXHJcbiAgICAgICAgY29sb3IgKz0gJyknO1xyXG4gICAgICAgIHJldHVybiBjb2xvcjtcclxuICAgIH1cclxuXHJcbiAgICAvLyBQYXJzZSBhbiBDU1Mtc3ludGF4IGNvbG9yLiBPdXRwdXRzIGFuIGFycmF5IFtyLCBnLCBiXVxyXG4gICAgZnVuY3Rpb24gcGFyc2VDb2xvcihjb2xvcikge1xyXG5cclxuICAgICAgICB2YXIgbWF0Y2gsIHF1YWRydXBsZXQ7XHJcblxyXG4gICAgICAgIC8vIE1hdGNoICNhYWJiY2NcclxuICAgICAgICBpZiAobWF0Y2ggPSAvIyhbMC05YS1mQS1GXXsyfSkoWzAtOWEtZkEtRl17Mn0pKFswLTlhLWZBLUZdezJ9KS8uZXhlYyhjb2xvcikpIHtcclxuICAgICAgICAgICAgcXVhZHJ1cGxldCA9IFtwYXJzZUludChtYXRjaFsxXSwgMTYpLCBwYXJzZUludChtYXRjaFsyXSwgMTYpLCBwYXJzZUludChtYXRjaFszXSwgMTYpLCAxXTtcclxuXHJcbiAgICAgICAgICAgIC8vIE1hdGNoICNhYmNcclxuICAgICAgICB9IGVsc2UgaWYgKG1hdGNoID0gLyMoWzAtOWEtZkEtRl0pKFswLTlhLWZBLUZdKShbMC05YS1mQS1GXSkvLmV4ZWMoY29sb3IpKSB7XHJcbiAgICAgICAgICAgIHF1YWRydXBsZXQgPSBbcGFyc2VJbnQobWF0Y2hbMV0sIDE2KSAqIDE3LCBwYXJzZUludChtYXRjaFsyXSwgMTYpICogMTcsIHBhcnNlSW50KG1hdGNoWzNdLCAxNikgKiAxNywgMV07XHJcblxyXG4gICAgICAgICAgICAvLyBNYXRjaCByZ2IobiwgbiwgbilcclxuICAgICAgICB9IGVsc2UgaWYgKG1hdGNoID0gL3JnYlxcKFxccyooWzAtOV17MSwzfSlcXHMqLFxccyooWzAtOV17MSwzfSlcXHMqLFxccyooWzAtOV17MSwzfSlcXHMqXFwpLy5leGVjKGNvbG9yKSkge1xyXG4gICAgICAgICAgICBxdWFkcnVwbGV0ID0gW3BhcnNlSW50KG1hdGNoWzFdKSwgcGFyc2VJbnQobWF0Y2hbMl0pLCBwYXJzZUludChtYXRjaFszXSksIDFdO1xyXG5cclxuICAgICAgICB9IGVsc2UgaWYgKG1hdGNoID0gL3JnYmFcXChcXHMqKFswLTldezEsM30pXFxzKixcXHMqKFswLTldezEsM30pXFxzKixcXHMqKFswLTldezEsM30pXFxzKixcXHMqKFswLTlcXC5dKilcXHMqXFwpLy5leGVjKGNvbG9yKSkge1xyXG4gICAgICAgICAgICBxdWFkcnVwbGV0ID0gW3BhcnNlSW50KG1hdGNoWzFdLCAxMCksIHBhcnNlSW50KG1hdGNoWzJdLCAxMCksIHBhcnNlSW50KG1hdGNoWzNdLCAxMCkscGFyc2VGbG9hdChtYXRjaFs0XSldO1xyXG5cclxuICAgICAgICAgICAgLy8gTm8gYnJvd3NlciByZXR1cm5zIHJnYihuJSwgbiUsIG4lKSwgc28gbGl0dGxlIHJlYXNvbiB0byBzdXBwb3J0IHRoaXMgZm9ybWF0LlxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHF1YWRydXBsZXQgPSBjb2xvcnNbY29sb3JdIHx8IFsyNTUsMjU1LDI1NSwwXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHF1YWRydXBsZXQ7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIFVJLnBhcmFsbGF4O1xyXG59KTsiXX0=
