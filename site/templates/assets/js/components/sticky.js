!function(t){var i;window.UIkit2&&(i=t(UIkit2)),"function"==typeof define&&define.amd&&define("uikit-sticky",["uikit"],function(){return i||t(UIkit2)})}(function(d){"use strict";var u=d.$win,f=d.$doc,g=[],n=1;function e(t){var i=arguments.length?arguments:g;if(i.length&&!(u.scrollTop()<0))for(var e,s,n,o,r=u.scrollTop(),a=f.height(),h=a-u.height(),p=h<r?h-r:0,c=0;c<i.length;c++)if((o=i[c]).element.is(":visible")&&!o.animate){if(o.check()){if(e=o.top<0?0:(e=a-(n=o.element.outerHeight())-o.top-o.options.bottom-r-p)<0?e+o.top:o.top,o.boundary&&o.boundary.length){var l=o.boundary.offset().top;s=o.boundtoparent?a-(l+o.boundary.outerHeight())+parseInt(o.boundary.css("padding-bottom")):a-l,e=r+n>a-s-(o.top<0?0:o.top)?a-s-(r+n):e}if(o.currentTop!=e){if(o.element.css({position:"fixed",top:e,width:o.getWidthFrom.length?o.getWidthFrom.width():o.element.width()}),!o.init&&(o.element.addClass(o.options.clsinit),location.hash&&0<r&&o.options.target)){var m=d.$(location.hash);m.length&&setTimeout(function(o,a){return function(){a.element.width();var t=o.offset(),i=t.top+o.outerHeight(),e=a.element.offset(),s=a.element.outerHeight(),n=e.top+s;e.top<i&&t.top<n&&(r=t.top-s-a.options.target,window.scrollTo(0,r))}}(m,o),0)}o.element.addClass(o.options.clsactive).removeClass(o.options.clsinactive),o.element.trigger("active.uk.sticky"),o.element.css("margin",""),o.options.animation&&o.init&&!d.Utils.isInView(o.wrapper)&&o.element.addClass(o.options.animation),o.currentTop=e}}else null!==o.currentTop&&o.reset();o.init=!0}}return d.component("sticky",{defaults:{top:0,bottom:0,animation:"",clsinit:"uk-sticky-init",clsactive:"uk-active",clsinactive:"",getWidthFrom:"",showup:!1,boundary:!1,media:!1,target:!1,disabled:!1},boot:function(){d.$doc.on("scrolling.uk.document",function(t,i){i&&i.dir&&(n=i.dir.y,e())}),d.$win.on("resize orientationchange",d.Utils.debounce(function(){if(g.length){for(var t=0;t<g.length;t++)g[t].reset(!0),g[t].self.computeWrapper();e()}},100)),d.ready(function(t){setTimeout(function(){d.$("[data-uk-sticky]",t).each(function(){var t=d.$(this);t.data("sticky")||d.sticky(t,d.Utils.options(t.attr("data-uk-sticky")))}),e()},0)})},init:function(){var t,i=this.options.boundary;this.wrapper=this.element.wrap('<div class="uk-sticky-placeholder"></div>').parent(),this.computeWrapper(),this.wrapper.css({"margin-top":this.element.css("margin-top"),"margin-bottom":this.element.css("margin-bottom"),"margin-left":this.element.css("margin-left"),"margin-right":this.element.css("margin-right")}),this.element.css("margin",0),i&&(!0===i||"!"===i[0]?(i=!0===i?this.wrapper.parent():this.wrapper.closest(i.substr(1)),t=!0):"string"==typeof i&&(i=d.$(i))),this.sticky={self:this,options:this.options,element:this.element,currentTop:null,wrapper:this.wrapper,init:!1,getWidthFrom:d.$(this.options.getWidthFrom||this.wrapper),boundary:i,boundtoparent:t,top:0,calcTop:function(){var t=this.options.top;if(this.options.top&&"string"==typeof this.options.top)if(this.options.top.match(/^(-|)(\d+)vh$/))t=window.innerHeight*parseInt(this.options.top,10)/100;else{var i=d.$(this.options.top).first();i.length&&i.is(":visible")&&(t=-1*(i.offset().top+i.outerHeight()-this.wrapper.offset().top))}this.top=t},reset:function(t){this.calcTop();var i=function(){this.element.css({position:"",top:"",width:"",left:"",margin:"0"}),this.element.removeClass([this.options.animation,"uk-animation-reverse",this.options.clsactive].join(" ")),this.element.addClass(this.options.clsinactive),this.element.trigger("inactive.uk.sticky"),this.currentTop=null,this.animate=!1}.bind(this);!t&&this.options.animation&&d.support.animation&&!d.Utils.isInView(this.wrapper)?(this.animate=!0,this.element.removeClass(this.options.animation).one(d.support.animation.end,function(){i()}).width(),this.element.addClass(this.options.animation+" uk-animation-reverse")):i()},check:function(){if(this.options.disabled)return!1;if(this.options.media)switch(typeof this.options.media){case"number":if(window.innerWidth<this.options.media)return!1;break;case"string":if(window.matchMedia&&!window.matchMedia(this.options.media).matches)return!1}var t=u.scrollTop(),i=f.height()-window.innerHeight,e=i<t?i-t:0,s=this.wrapper.offset().top-this.top-e<=t;return s&&this.options.showup&&(1==n&&(s=!1),-1==n&&!this.element.hasClass(this.options.clsactive)&&d.Utils.isInView(this.wrapper)&&(s=!1)),s}},this.sticky.calcTop(),g.push(this.sticky)},update:function(){e(this.sticky)},enable:function(){this.options.disabled=!1,this.update()},disable:function(t){this.options.disabled=!0,this.sticky.reset(t)},computeWrapper:function(){this.wrapper.css({height:-1==["absolute","fixed"].indexOf(this.element.css("position"))?this.element.outerHeight():"",float:"none"!=this.element.css("float")?this.element.css("float"):""}),"fixed"==this.element.css("position")&&this.element.css({width:this.sticky.getWidthFrom.length?this.sticky.getWidthFrom.width():this.element.width()})}}),d.sticky});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvc3RpY2t5LmpzIl0sIm5hbWVzIjpbImFkZG9uIiwiY29tcG9uZW50Iiwid2luZG93IiwiVUlraXQyIiwiZGVmaW5lIiwiYW1kIiwiVUkiLCIkd2luIiwiJGRvYyIsInN0aWNrZWQiLCJkaXJlY3Rpb24iLCJjaGVja3Njcm9sbHBvc2l0aW9uIiwic3RpY2tpZXMiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJzY3JvbGxUb3AiLCJuZXdUb3AiLCJjb250YWluZXJCb3R0b20iLCJzdGlja3lIZWlnaHQiLCJzdGlja3kiLCJkb2N1bWVudEhlaWdodCIsImhlaWdodCIsImR3aCIsImV4dHJhIiwiaSIsImVsZW1lbnQiLCJpcyIsImFuaW1hdGUiLCJjaGVjayIsInRvcCIsIm91dGVySGVpZ2h0Iiwib3B0aW9ucyIsImJvdHRvbSIsImJvdW5kYXJ5IiwiYlRvcCIsIm9mZnNldCIsImJvdW5kdG9wYXJlbnQiLCJwYXJzZUludCIsImNzcyIsImN1cnJlbnRUb3AiLCJwb3NpdGlvbiIsIndpZHRoIiwiZ2V0V2lkdGhGcm9tIiwiaW5pdCIsImFkZENsYXNzIiwiY2xzaW5pdCIsImxvY2F0aW9uIiwiaGFzaCIsInRhcmdldCIsIiR0YXJnZXQiLCIkIiwic2V0VGltZW91dCIsIm1heG9mZnNldCIsInN0aWNreU9mZnNldCIsInN0aWNreU1heE9mZnNldCIsInNjcm9sbFRvIiwiY2xzYWN0aXZlIiwicmVtb3ZlQ2xhc3MiLCJjbHNpbmFjdGl2ZSIsInRyaWdnZXIiLCJhbmltYXRpb24iLCJVdGlscyIsImlzSW5WaWV3Iiwid3JhcHBlciIsInJlc2V0IiwiZGVmYXVsdHMiLCJzaG93dXAiLCJtZWRpYSIsImRpc2FibGVkIiwiYm9vdCIsIm9uIiwiZSIsImRhdGEiLCJkaXIiLCJ5IiwiZGVib3VuY2UiLCJzZWxmIiwiY29tcHV0ZVdyYXBwZXIiLCJyZWFkeSIsImNvbnRleHQiLCJlYWNoIiwiJGVsZSIsInRoaXMiLCJhdHRyIiwid3JhcCIsInBhcmVudCIsIm1hcmdpbi10b3AiLCJtYXJnaW4tYm90dG9tIiwibWFyZ2luLWxlZnQiLCJtYXJnaW4tcmlnaHQiLCJjbG9zZXN0Iiwic3Vic3RyIiwiY2FsY1RvcCIsIm1hdGNoIiwiaW5uZXJIZWlnaHQiLCJ0b3BFbGVtZW50IiwiZmlyc3QiLCJmb3JjZSIsImZpbmFsaXplIiwibGVmdCIsIm1hcmdpbiIsImpvaW4iLCJiaW5kIiwic3VwcG9ydCIsIm9uZSIsImVuZCIsImlubmVyV2lkdGgiLCJtYXRjaE1lZGlhIiwibWF0Y2hlcyIsImFjdGl2ZSIsImhhc0NsYXNzIiwicHVzaCIsInVwZGF0ZSIsImVuYWJsZSIsImRpc2FibGUiLCJpbmRleE9mIiwiZmxvYXQiXSwibWFwcGluZ3MiOiJDQUNBLFNBQVVBLEdBRU4sSUFBSUMsRUFFQUMsT0FBT0MsU0FDUEYsRUFBWUQsRUFBTUcsU0FHRCxtQkFBVkMsUUFBd0JBLE9BQU9DLEtBQ3RDRCxPQUFPLGVBQWdCLENBQUMsU0FBVSxXQUM5QixPQUFPSCxHQUFhRCxFQUFNRyxVQVZ0QyxDQWNHLFNBQVNHLEdBRVIsYUFFQSxJQUFJQyxFQUFlRCxFQUFHQyxLQUNsQkMsRUFBZUYsRUFBR0UsS0FDbEJDLEVBQWUsR0FDZkMsRUFBZSxFQXdPbkIsU0FBU0MsRUFBb0JELEdBRXpCLElBQUlFLEVBQVdDLFVBQVVDLE9BQVNELFVBQVlKLEVBRTlDLEdBQUtHLEVBQVNFLFVBQVVQLEVBQUtRLFlBQWMsR0FTM0MsSUFQQSxJQUtJQyxFQUFRQyxFQUFpQkMsRUFBY0MsRUFMdkNKLEVBQWtCUixFQUFLUSxZQUN2QkssRUFBa0JaLEVBQUthLFNBRXZCQyxFQUFrQkYsRUFEQWIsRUFBS2MsU0FFdkJFLEVBQStCRCxFQUFaUCxFQUFtQk8sRUFBTVAsRUFBWSxFQUduRFMsRUFBSSxFQUFHQSxFQUFJWixFQUFTRSxPQUFRVSxJQUlqQyxJQUZBTCxFQUFTUCxFQUFTWSxJQUVOQyxRQUFRQyxHQUFHLGNBQWVQLEVBQU9RLFFBQTdDLENBSUEsR0FBS1IsRUFBT1MsUUFNTCxDQVVILEdBUElaLEVBREFH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R3RCcEIsZUFBZ0IsV0FFWkssS0FBS25CLFFBQVF6QixJQUFJLENBQ2JqQixRQUFpRixHQUEvRCxDQUFDLFdBQVcsU0FBUzhGLFFBQVFqQyxLQUFLekQsUUFBUWEsSUFBSSxhQUFxQjRDLEtBQUt6RCxRQUFRSyxjQUFnQixHQUNsSHNGLE1BQStDLFFBQTdCbEMsS0FBS3pELFFBQVFhLElBQUksU0FBcUI0QyxLQUFLekQsUUFBUWEsSUFBSSxTQUFXLEtBR3BELFNBQWhDNEMsS0FBS3pELFFBQVFhLElBQUksYUFDakI0QyxLQUFLekQsUUFBUWEsSUFBSSxDQUNiRyxNQUFPeUMsS0FBSy9ELE9BQU91QixhQUFhNUIsT0FBU29FLEtBQUsvRCxPQUFPdUIsYUFBYUQsUUFBVXlDLEtBQUt6RCxRQUFRZ0IsYUFrSGxHbkMsRUFBR2EiLCJmaWxlIjoiY29tcG9uZW50cy9zdGlja3kuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiEgVUlraXQgMi4yNy4yIHwgaHR0cDovL3d3dy5nZXR1aWtpdC5jb20gfCAoYykgMjAxNCBZT090aGVtZSB8IE1JVCBMaWNlbnNlICovXHJcbihmdW5jdGlvbihhZGRvbikge1xyXG5cclxuICAgIHZhciBjb21wb25lbnQ7XHJcblxyXG4gICAgaWYgKHdpbmRvdy5VSWtpdDIpIHtcclxuICAgICAgICBjb21wb25lbnQgPSBhZGRvbihVSWtpdDIpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0eXBlb2YgZGVmaW5lID09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xyXG4gICAgICAgIGRlZmluZSgndWlraXQtc3RpY2t5JywgWyd1aWtpdCddLCBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICByZXR1cm4gY29tcG9uZW50IHx8IGFkZG9uKFVJa2l0Mik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG59KShmdW5jdGlvbihVSSl7XHJcblxyXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG4gICAgdmFyICR3aW4gICAgICAgICA9IFVJLiR3aW4sXHJcbiAgICAgICAgJGRvYyAgICAgICAgID0gVUkuJGRvYyxcclxuICAgICAgICBzdGlja2VkICAgICAgPSBbXSxcclxuICAgICAgICBkaXJlY3Rpb24gICAgPSAxO1xyXG5cclxuICAgIFVJLmNvbXBvbmVudCgnc3RpY2t5Jywge1xyXG5cclxuICAgICAgICBkZWZhdWx0czoge1xyXG4gICAgICAgICAgICB0b3AgICAgICAgICAgOiAwLFxyXG4gICAgICAgICAgICBib3R0b20gICAgICAgOiAwLFxyXG4gICAgICAgICAgICBhbmltYXRpb24gICAgOiAnJyxcclxuICAgICAgICAgICAgY2xzaW5pdCAgICAgIDogJ3VrLXN0aWNreS1pbml0JyxcclxuICAgICAgICAgICAgY2xzYWN0aXZlICAgIDogJ3VrLWFjdGl2ZScsXHJcbiAgICAgICAgICAgIGNsc2luYWN0aXZlICA6ICcnLFxyXG4gICAgICAgICAgICBnZXRXaWR0aEZyb20gOiAnJyxcclxuICAgICAgICAgICAgc2hvd3VwICAgICAgIDogZmFsc2UsXHJcbiAgICAgICAgICAgIGJvdW5kYXJ5ICAgICA6IGZhbHNlLFxyXG4gICAgICAgICAgICBtZWRpYSAgICAgICAgOiBmYWxzZSxcclxuICAgICAgICAgICAgdGFyZ2V0ICAgICAgIDogZmFsc2UsXHJcbiAgICAgICAgICAgIGRpc2FibGVkICAgICA6IGZhbHNlXHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgYm9vdDogZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgICAgICAvLyBzaG91bGQgYmUgbW9yZSBlZmZpY2llbnQgdGhhbiB1c2luZyAkd2luLnNjcm9sbChjaGVja3Njcm9sbHBvc2l0aW9uKTpcclxuICAgICAgICAgICAgVUkuJGRvYy5vbignc2Nyb2xsaW5nLnVrLmRvY3VtZW50JywgZnVuY3Rpb24oZSwgZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFkYXRhIHx8ICFkYXRhLmRpcikgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgZGlyZWN0aW9uID0gZGF0YS5kaXIueTtcclxuICAgICAgICAgICAgICAgIGNoZWNrc2Nyb2xscG9zaXRpb24oKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBVSS4kd2luLm9uKCdyZXNpemUgb3JpZW50YXRpb25jaGFuZ2UnLCBVSS5VdGlscy5kZWJvdW5jZShmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIXN0aWNrZWQubGVuZ3RoKSByZXR1cm47XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdGlja2VkLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RpY2tlZFtpXS5yZXNldCh0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICBzdGlja2VkW2ldLnNlbGYuY29tcHV0ZVdyYXBwZXIoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjaGVja3Njcm9sbHBvc2l0aW9uKCk7XHJcbiAgICAgICAgICAgIH0sIDEwMCkpO1xyXG5cclxuICAgICAgICAgICAgLy8gaW5pdCBjb2RlXHJcbiAgICAgICAgICAgIFVJLnJlYWR5KGZ1bmN0aW9uKGNvbnRleHQpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIFVJLiQoJ1tkYXRhLXVrLXN0aWNreV0nLCBjb250ZXh0KS5lYWNoKGZ1bmN0aW9uKCl7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgJGVsZSA9IFVJLiQodGhpcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoISRlbGUuZGF0YSgnc3RpY2t5JykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFVJLnN0aWNreSgkZWxlLCBVSS5VdGlscy5vcHRpb25zKCRlbGUuYXR0cignZGF0YS11ay1zdGlja3knKSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNoZWNrc2Nyb2xscG9zaXRpb24oKTtcclxuICAgICAgICAgICAgICAgIH0sIDApO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBpbml0OiBmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciBib3VuZGFyeSA9IHRoaXMub3B0aW9ucy5ib3VuZGFyeSwgYm91bmR0b3BhcmVudDtcclxuXHJcbiAgICAgICAgICAgIHRoaXMud3JhcHBlciA9IHRoaXMuZWxlbWVudC53cmFwKCc8ZGl2IGNsYXNzPVwidWstc3RpY2t5LXBsYWNlaG9sZGVyXCI+PC9kaXY+JykucGFyZW50KCk7XHJcbiAgICAgICAgICAgIHRoaXMuY29tcHV0ZVdyYXBwZXIoKTtcclxuICAgICAgICAgICAgdGhpcy53cmFwcGVyLmNzcyh7XHJcbiAgICAgICAgICAgICAgICAnbWFyZ2luLXRvcCcgICAgOiB0aGlzLmVsZW1lbnQuY3NzKCdtYXJnaW4tdG9wJyksXHJcbiAgICAgICAgICAgICAgICAnbWFyZ2luLWJvdHRvbScgOiB0aGlzLmVsZW1lbnQuY3NzKCdtYXJnaW4tYm90dG9tJyksXHJcbiAgICAgICAgICAgICAgICAnbWFyZ2luLWxlZnQnICAgOiB0aGlzLmVsZW1lbnQuY3NzKCdtYXJnaW4tbGVmdCcpLFxyXG4gICAgICAgICAgICAgICAgJ21hcmdpbi1yaWdodCcgIDogdGhpcy5lbGVtZW50LmNzcygnbWFyZ2luLXJpZ2h0JylcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgdGhpcy5lbGVtZW50LmNzcygnbWFyZ2luJywgMCk7XHJcblxyXG4gICAgICAgICAgICBpZiAoYm91bmRhcnkpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoYm91bmRhcnkgPT09IHRydWUgfHwgYm91bmRhcnlbMF0gPT09ICchJykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBib3VuZGFyeSAgICAgID0gYm91bmRhcnkgPT09IHRydWUgPyB0aGlzLndyYXBwZXIucGFyZW50KCkgOiB0aGlzLndyYXBwZXIuY2xvc2VzdChib3VuZGFyeS5zdWJzdHIoMSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJvdW5kdG9wYXJlbnQgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGJvdW5kYXJ5ID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYm91bmRhcnkgPSBVSS4kKGJvdW5kYXJ5KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5zdGlja3kgPSB7XHJcbiAgICAgICAgICAgICAgICBzZWxmICAgICAgICAgIDogdGhpcyxcclxuICAgICAgICAgICAgICAgIG9wdGlvbnMgICAgICAgOiB0aGlzLm9wdGlvbnMsXHJcbiAgICAgICAgICAgICAgICBlbGVtZW50ICAgICAgIDogdGhpcy5lbGVtZW50LFxyXG4gICAgICAgICAgICAgICAgY3VycmVudFRvcCAgICA6IG51bGwsXHJcbiAgICAgICAgICAgICAgICB3cmFwcGVyICAgICAgIDogdGhpcy53cmFwcGVyLFxyXG4gICAgICAgICAgICAgICAgaW5pdCAgICAgICAgICA6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgZ2V0V2lkdGhGcm9tICA6IFVJLiQodGhpcy5vcHRpb25zLmdldFdpZHRoRnJvbSB8fCB0aGlzLndyYXBwZXIpLFxyXG4gICAgICAgICAgICAgICAgYm91bmRhcnkgICAgICA6IGJvdW5kYXJ5LFxyXG4gICAgICAgICAgICAgICAgYm91bmR0b3BhcmVudCA6IGJvdW5kdG9wYXJlbnQsXHJcbiAgICAgICAgICAgICAgICB0b3AgICAgICAgICAgIDogMCxcclxuICAgICAgICAgICAgICAgIGNhbGNUb3AgICAgICAgOiBmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRvcCA9IHRoaXMub3B0aW9ucy50b3A7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIGR5bmFtaWMgdG9wIHBhcmFtZXRlclxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMudG9wICYmIHR5cGVvZih0aGlzLm9wdGlvbnMudG9wKSA9PSAnc3RyaW5nJykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZS5nLiA1MHZoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMudG9wLm1hdGNoKC9eKC18KShcXGQrKXZoJC8pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3AgPSB3aW5kb3cuaW5uZXJIZWlnaHQgKiBwYXJzZUludCh0aGlzLm9wdGlvbnMudG9wLCAxMCkvMTAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBlLmcuICNlbGVtZW50SWQsIG9yIC5jbGFzcy0xLGNsYXNzLTIsLmNsYXNzLTMgKGZpcnN0IGZvdW5kIGlzIHVzZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRvcEVsZW1lbnQgPSBVSS4kKHRoaXMub3B0aW9ucy50b3ApLmZpcnN0KCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRvcEVsZW1lbnQubGVuZ3RoICYmIHRvcEVsZW1lbnQuaXMoJzp2aXNpYmxlJykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3AgPSAtMSAqICgodG9wRWxlbWVudC5vZmZzZXQoKS50b3AgKyB0b3BFbGVtZW50Lm91dGVySGVpZ2h0KCkpIC0gdGhpcy53cmFwcGVyLm9mZnNldCgpLnRvcCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRvcCA9IHRvcDtcclxuICAgICAgICAgICAgICAgIH0sXHJcblxyXG4gICAgICAgICAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uKGZvcmNlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2FsY1RvcCgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgZmluYWxpemUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LmNzcyh7cG9zaXRpb246JycsIHRvcDonJywgd2lkdGg6JycsIGxlZnQ6JycsIG1hcmdpbjonMCd9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKFt0aGlzLm9wdGlvbnMuYW5pbWF0aW9uLCAndWstYW5pbWF0aW9uLXJldmVyc2UnLCB0aGlzLm9wdGlvbnMuY2xzYWN0aXZlXS5qb2luKCcgJykpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQuYWRkQ2xhc3ModGhpcy5vcHRpb25zLmNsc2luYWN0aXZlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LnRyaWdnZXIoJ2luYWN0aXZlLnVrLnN0aWNreScpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50VG9wID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hbmltYXRlICAgID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKTtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghZm9yY2UgJiYgdGhpcy5vcHRpb25zLmFuaW1hdGlvbiAmJiBVSS5zdXBwb3J0LmFuaW1hdGlvbiAmJiAhVUkuVXRpbHMuaXNJblZpZXcodGhpcy53cmFwcGVyKSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hbmltYXRlID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcyh0aGlzLm9wdGlvbnMuYW5pbWF0aW9uKS5vbmUoVUkuc3VwcG9ydC5hbmltYXRpb24uZW5kLCBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluYWxpemUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSkud2lkdGgoKTsgLy8gZm9yY2UgcmVkcmF3XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQuYWRkQ2xhc3ModGhpcy5vcHRpb25zLmFuaW1hdGlvbisnICcrJ3VrLWFuaW1hdGlvbi1yZXZlcnNlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmluYWxpemUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LFxyXG5cclxuICAgICAgICAgICAgICAgIGNoZWNrOiBmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5kaXNhYmxlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLm1lZGlhKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2godHlwZW9mKHRoaXMub3B0aW9ucy5tZWRpYSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5pbm5lcldpZHRoIDwgdGhpcy5vcHRpb25zLm1lZGlhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cubWF0Y2hNZWRpYSAmJiAhd2luZG93Lm1hdGNoTWVkaWEodGhpcy5vcHRpb25zLm1lZGlhKS5tYXRjaGVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzY3JvbGxUb3AgICAgICA9ICR3aW4uc2Nyb2xsVG9wKCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50SGVpZ2h0ID0gJGRvYy5oZWlnaHQoKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZHdoICAgICAgICAgICAgPSBkb2N1bWVudEhlaWdodCAtIHdpbmRvdy5pbm5lckhlaWdodCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXh0cmEgICAgICAgICAgPSAoc2Nyb2xsVG9wID4gZHdoKSA/IGR3aCAtIHNjcm9sbFRvcCA6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRUb3AgICAgID0gdGhpcy53cmFwcGVyLm9mZnNldCgpLnRvcCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXRzZSAgICAgICAgICAgPSBlbGVtZW50VG9wIC0gdGhpcy50b3AgLSBleHRyYSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlICAgICAgICAgPSAoc2Nyb2xsVG9wICA+PSBldHNlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGl2ZSAmJiB0aGlzLm9wdGlvbnMuc2hvd3VwKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBzZXQgaW5hY3RpdiBpZiBzY3JvbGxpbmcgZG93blxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGlyZWN0aW9uID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBzZXQgaW5hY3RpdmUgd2hlbiB3cmFwcGVyIGlzIHN0aWxsIGluIHZpZXdcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRpcmVjdGlvbiA9PSAtMSAmJiAhdGhpcy5lbGVtZW50Lmhhc0NsYXNzKHRoaXMub3B0aW9ucy5jbHNhY3RpdmUpICYmIFVJLlV0aWxzLmlzSW5WaWV3KHRoaXMud3JhcHBlcikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWN0aXZlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgdGhpcy5zdGlja3kuY2FsY1RvcCgpO1xyXG5cclxuICAgICAgICAgICAgc3RpY2tlZC5wdXNoKHRoaXMuc3RpY2t5KTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBjaGVja3Njcm9sbHBvc2l0aW9uKHRoaXMuc3RpY2t5KTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBlbmFibGU6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMuZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGUoKTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBkaXNhYmxlOiBmdW5jdGlvbihmb3JjZSkge1xyXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMuZGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICB0aGlzLnN0aWNreS5yZXNldChmb3JjZSk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgY29tcHV0ZVdyYXBwZXI6IGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICAgICAgdGhpcy53cmFwcGVyLmNzcyh7XHJcbiAgICAgICAgICAgICAgICAnaGVpZ2h0JyAgICAgICAgOiBbJ2Fic29sdXRlJywnZml4ZWQnXS5pbmRleE9mKHRoaXMuZWxlbWVudC5jc3MoJ3Bvc2l0aW9uJykpID09IC0xID8gdGhpcy5lbGVtZW50Lm91dGVySGVpZ2h0KCkgOiAnJyxcclxuICAgICAgICAgICAgICAgICdmbG9hdCcgICAgICAgICA6IHRoaXMuZWxlbWVudC5jc3MoJ2Zsb2F0JykgIT0gJ25vbmUnID8gdGhpcy5lbGVtZW50LmNzcygnZmxvYXQnKSA6ICcnXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuZWxlbWVudC5jc3MoJ3Bvc2l0aW9uJykgPT0gJ2ZpeGVkJykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LmNzcyh7XHJcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHRoaXMuc3RpY2t5LmdldFdpZHRoRnJvbS5sZW5ndGggPyB0aGlzLnN0aWNreS5nZXRXaWR0aEZyb20ud2lkdGgoKSA6IHRoaXMuZWxlbWVudC53aWR0aCgpXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIGZ1bmN0aW9uIGNoZWNrc2Nyb2xscG9zaXRpb24oZGlyZWN0aW9uKSB7XHJcblxyXG4gICAgICAgIHZhciBzdGlja2llcyA9IGFyZ3VtZW50cy5sZW5ndGggPyBhcmd1bWVudHMgOiBzdGlja2VkO1xyXG5cclxuICAgICAgICBpZiAoIXN0aWNraWVzLmxlbmd0aCB8fCAkd2luLnNjcm9sbFRvcCgpIDwgMCkgcmV0dXJuO1xyXG5cclxuICAgICAgICB2YXIgc2Nyb2xsVG9wICAgICAgID0gJHdpbi5zY3JvbGxUb3AoKSxcclxuICAgICAgICAgICAgZG9jdW1lbnRIZWlnaHQgID0gJGRvYy5oZWlnaHQoKSxcclxuICAgICAgICAgICAgd2luZG93SGVpZ2h0ICAgID0gJHdpbi5oZWlnaHQoKSxcclxuICAgICAgICAgICAgZHdoICAgICAgICAgICAgID0gZG9jdW1lbnRIZWlnaHQgLSB3aW5kb3dIZWlnaHQsXHJcbiAgICAgICAgICAgIGV4dHJhICAgICAgICAgICA9IChzY3JvbGxUb3AgPiBkd2gpID8gZHdoIC0gc2Nyb2xsVG9wIDogMCxcclxuICAgICAgICAgICAgbmV3VG9wLCBjb250YWluZXJCb3R0b20sIHN0aWNreUhlaWdodCwgc3RpY2t5O1xyXG5cclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0aWNraWVzLmxlbmd0aDsgaSsrKSB7XHJcblxyXG4gICAgICAgICAgICBzdGlja3kgPSBzdGlja2llc1tpXTtcclxuXHJcbiAgICAgICAgICAgIGlmICghc3RpY2t5LmVsZW1lbnQuaXMoJzp2aXNpYmxlJykgfHwgc3RpY2t5LmFuaW1hdGUpIHtcclxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoIXN0aWNreS5jaGVjaygpKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHN0aWNreS5jdXJyZW50VG9wICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RpY2t5LnJlc2V0KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChzdGlja3kudG9wIDwgMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5ld1RvcCA9IDA7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0aWNreUhlaWdodCA9IHN0aWNreS5lbGVtZW50Lm91dGVySGVpZ2h0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3VG9wID0gZG9jdW1lbnRIZWlnaHQgLSBzdGlja3lIZWlnaHQgLSBzdGlja3kudG9wIC0gc3RpY2t5Lm9wdGlvbnMuYm90dG9tIC0gc2Nyb2xsVG9wIC0gZXh0cmE7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3VG9wID0gbmV3VG9wIDwgMCA/IG5ld1RvcCArIHN0aWNreS50b3AgOiBzdGlja3kudG9wO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChzdGlja3kuYm91bmRhcnkgJiYgc3RpY2t5LmJvdW5kYXJ5Lmxlbmd0aCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgYlRvcCA9IHN0aWNreS5ib3VuZGFyeS5vZmZzZXQoKS50b3A7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGlja3kuYm91bmR0b3BhcmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250YWluZXJCb3R0b20gPSBkb2N1bWVudEhlaWdodCAtIChiVG9wICsgc3RpY2t5LmJvdW5kYXJ5Lm91dGVySGVpZ2h0KCkpICsgcGFyc2VJbnQoc3RpY2t5LmJvdW5kYXJ5LmNzcygncGFkZGluZy1ib3R0b20nKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyQm90dG9tID0gZG9jdW1lbnRIZWlnaHQgLSBiVG9wO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgbmV3VG9wID0gKHNjcm9sbFRvcCArIHN0aWNreUhlaWdodCkgPiAoZG9jdW1lbnRIZWlnaHQgLSBjb250YWluZXJCb3R0b20gLSAoc3RpY2t5LnRvcCA8IDAgPyAwIDogc3RpY2t5LnRvcCkpID8gKGRvY3VtZW50SGVpZ2h0IC0gY29udGFpbmVyQm90dG9tKSAtIChzY3JvbGxUb3AgKyBzdGlja3lIZWlnaHQpIDogbmV3VG9wO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoc3RpY2t5LmN1cnJlbnRUb3AgIT0gbmV3VG9wKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHN0aWNreS5lbGVtZW50LmNzcyh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uIDogJ2ZpeGVkJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG9wICAgICAgOiBuZXdUb3AsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoICAgIDogc3RpY2t5LmdldFdpZHRoRnJvbS5sZW5ndGggPyBzdGlja3kuZ2V0V2lkdGhGcm9tLndpZHRoKCkgOiBzdGlja3kuZWxlbWVudC53aWR0aCgpXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghc3RpY2t5LmluaXQpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0aWNreS5lbGVtZW50LmFkZENsYXNzKHN0aWNreS5vcHRpb25zLmNsc2luaXQpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvY2F0aW9uLmhhc2ggJiYgc2Nyb2xsVG9wID4gMCAmJiBzdGlja3kub3B0aW9ucy50YXJnZXQpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgJHRhcmdldCA9IFVJLiQobG9jYXRpb24uaGFzaCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR0YXJnZXQubGVuZ3RoKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKGZ1bmN0aW9uKCR0YXJnZXQsIHN0aWNreSl7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RpY2t5LmVsZW1lbnQud2lkdGgoKTsgLy8gZm9yY2UgcmVkcmF3XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9mZnNldCAgICAgICA9ICR0YXJnZXQub2Zmc2V0KCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4b2Zmc2V0ICAgID0gb2Zmc2V0LnRvcCArICR0YXJnZXQub3V0ZXJIZWlnaHQoKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGlja3lPZmZzZXQgPSBzdGlja3kuZWxlbWVudC5vZmZzZXQoKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGlja3lIZWlnaHQgPSBzdGlja3kuZWxlbWVudC5vdXRlckhlaWdodCgpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0aWNreU1heE9mZnNldCA9IHN0aWNreU9mZnNldC50b3AgKyBzdGlja3lIZWlnaHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0aWNreU9mZnNldC50b3AgPCBtYXhvZmZzZXQgJiYgb2Zmc2V0LnRvcCA8IHN0aWNreU1heE9mZnNldCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjcm9sbFRvcCA9IG9mZnNldC50b3AgLSBzdGlja3lIZWlnaHQgLSBzdGlja3kub3B0aW9ucy50YXJnZXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsIHNjcm9sbFRvcCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKCR0YXJnZXQsIHN0aWNreSksIDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBzdGlja3kuZWxlbWVudC5hZGRDbGFzcyhzdGlja3kub3B0aW9ucy5jbHNhY3RpdmUpLnJlbW92ZUNsYXNzKHN0aWNreS5vcHRpb25zLmNsc2luYWN0aXZlKTtcclxuICAgICAgICAgICAgICAgICAgICBzdGlja3kuZWxlbWVudC50cmlnZ2VyKCdhY3RpdmUudWsuc3RpY2t5Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RpY2t5LmVsZW1lbnQuY3NzKCdtYXJnaW4nLCAnJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGlja3kub3B0aW9ucy5hbmltYXRpb24gJiYgc3RpY2t5LmluaXQgJiYgIVVJLlV0aWxzLmlzSW5WaWV3KHN0aWNreS53cmFwcGVyKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGlja3kuZWxlbWVudC5hZGRDbGFzcyhzdGlja3kub3B0aW9ucy5hbmltYXRpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc3RpY2t5LmN1cnJlbnRUb3AgPSBuZXdUb3A7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHN0aWNreS5pbml0ID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIFVJLnN0aWNreTtcclxufSk7Il19
