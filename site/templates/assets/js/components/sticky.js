!function(t){var i;window.UIkit2&&(i=t(UIkit2)),"function"==typeof define&&define.amd&&define("uikit-sticky",["uikit"],function(){return i||t(UIkit2)})}(function(d){"use strict";var u=d.$win,f=d.$doc,g=[],n=1;function e(t){var i=arguments.length?arguments:g;if(i.length&&!(u.scrollTop()<0))for(var e,s,n,o,r=u.scrollTop(),a=f.height(),h=a-u.height(),p=h<r?h-r:0,c=0;c<i.length;c++)if((o=i[c]).element.is(":visible")&&!o.animate){if(o.check()){if(e=o.top<0?0:(e=a-(n=o.element.outerHeight())-o.top-o.options.bottom-r-p)<0?e+o.top:o.top,o.boundary&&o.boundary.length){var l=o.boundary.offset().top;s=o.boundtoparent?a-(l+o.boundary.outerHeight())+parseInt(o.boundary.css("padding-bottom")):a-l,e=r+n>a-s-(o.top<0?0:o.top)?a-s-(r+n):e}if(o.currentTop!=e){if(o.element.css({position:"fixed",top:e,width:o.getWidthFrom.length?o.getWidthFrom.width():o.element.width()}),!o.init&&(o.element.addClass(o.options.clsinit),location.hash&&0<r&&o.options.target)){var m=d.$(location.hash);m.length&&setTimeout(function(o,a){return function(){a.element.width();var t=o.offset(),i=t.top+o.outerHeight(),e=a.element.offset(),s=a.element.outerHeight(),n=e.top+s;e.top<i&&t.top<n&&(r=t.top-s-a.options.target,window.scrollTo(0,r))}}(m,o),0)}o.element.addClass(o.options.clsactive).removeClass(o.options.clsinactive),o.element.trigger("active.uk.sticky"),o.element.css("margin",""),o.options.animation&&o.init&&!d.Utils.isInView(o.wrapper)&&o.element.addClass(o.options.animation),o.currentTop=e}}else null!==o.currentTop&&o.reset();o.init=!0}}return d.component("sticky",{defaults:{top:0,bottom:0,animation:"",clsinit:"uk-sticky-init",clsactive:"uk-active",clsinactive:"",getWidthFrom:"",showup:!1,boundary:!1,media:!1,target:!1,disabled:!1},boot:function(){d.$doc.on("scrolling.uk.document",function(t,i){i&&i.dir&&(n=i.dir.y,e())}),d.$win.on("resize orientationchange",d.Utils.debounce(function(){if(g.length){for(var t=0;t<g.length;t++)g[t].reset(!0),g[t].self.computeWrapper();e()}},100)),d.ready(function(t){setTimeout(function(){d.$("[data-uk-sticky]",t).each(function(){var t=d.$(this);t.data("sticky")||d.sticky(t,d.Utils.options(t.attr("data-uk-sticky")))}),e()},0)})},init:function(){var t,i=this.options.boundary;this.wrapper=this.element.wrap('<div class="uk-sticky-placeholder"></div>').parent(),this.computeWrapper(),this.wrapper.css({"margin-top":this.element.css("margin-top"),"margin-bottom":this.element.css("margin-bottom"),"margin-left":this.element.css("margin-left"),"margin-right":this.element.css("margin-right")}),this.element.css("margin",0),i&&(!0===i||"!"===i[0]?(i=!0===i?this.wrapper.parent():this.wrapper.closest(i.substr(1)),t=!0):"string"==typeof i&&(i=d.$(i))),this.sticky={self:this,options:this.options,element:this.element,currentTop:null,wrapper:this.wrapper,init:!1,getWidthFrom:d.$(this.options.getWidthFrom||this.wrapper),boundary:i,boundtoparent:t,top:0,calcTop:function(){var t=this.options.top;if(this.options.top&&"string"==typeof this.options.top)if(this.options.top.match(/^(-|)(\d+)vh$/))t=window.innerHeight*parseInt(this.options.top,10)/100;else{var i=d.$(this.options.top).first();i.length&&i.is(":visible")&&(t=-1*(i.offset().top+i.outerHeight()-this.wrapper.offset().top))}this.top=t},reset:function(t){this.calcTop();var i=function(){this.element.css({position:"",top:"",width:"",left:"",margin:"0"}),this.element.removeClass([this.options.animation,"uk-animation-reverse",this.options.clsactive].join(" ")),this.element.addClass(this.options.clsinactive),this.element.trigger("inactive.uk.sticky"),this.currentTop=null,this.animate=!1}.bind(this);!t&&this.options.animation&&d.support.animation&&!d.Utils.isInView(this.wrapper)?(this.animate=!0,this.element.removeClass(this.options.animation).one(d.support.animation.end,function(){i()}).width(),this.element.addClass(this.options.animation+" uk-animation-reverse")):i()},check:function(){if(this.options.disabled)return!1;if(this.options.media)switch(typeof this.options.media){case"number":if(window.innerWidth<this.options.media)return!1;break;case"string":if(window.matchMedia&&!window.matchMedia(this.options.media).matches)return!1}var t=u.scrollTop(),i=f.height()-window.innerHeight,e=i<t?i-t:0,s=this.wrapper.offset().top-this.top-e<=t;return s&&this.options.showup&&(1==n&&(s=!1),-1==n&&!this.element.hasClass(this.options.clsactive)&&d.Utils.isInView(this.wrapper)&&(s=!1)),s}},this.sticky.calcTop(),g.push(this.sticky)},update:function(){e(this.sticky)},enable:function(){this.options.disabled=!1,this.update()},disable:function(t){this.options.disabled=!0,this.sticky.reset(t)},computeWrapper:function(){this.wrapper.css({height:-1==["absolute","fixed"].indexOf(this.element.css("position"))?this.element.outerHeight():"",float:"none"!=this.element.css("float")?this.element.css("float"):""}),"fixed"==this.element.css("position")&&this.element.css({width:this.sticky.getWidthFrom.length?this.sticky.getWidthFrom.width():this.element.width()})}}),d.sticky});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvc3RpY2t5LmpzIl0sIm5hbWVzIjpbImFkZG9uIiwiY29tcG9uZW50Iiwid2luZG93IiwiVUlraXQyIiwiZGVmaW5lIiwiYW1kIiwiVUkiLCIkd2luIiwiJGRvYyIsInN0aWNrZWQiLCJkaXJlY3Rpb24iLCJjaGVja3Njcm9sbHBvc2l0aW9uIiwic3RpY2tpZXMiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJzY3JvbGxUb3AiLCJuZXdUb3AiLCJjb250YWluZXJCb3R0b20iLCJzdGlja3lIZWlnaHQiLCJzdGlja3kiLCJkb2N1bWVudEhlaWdodCIsImhlaWdodCIsImR3aCIsImV4dHJhIiwiaSIsImVsZW1lbnQiLCJpcyIsImFuaW1hdGUiLCJjaGVjayIsInRvcCIsIm91dGVySGVpZ2h0Iiwib3B0aW9ucyIsImJvdHRvbSIsImJvdW5kYXJ5IiwiYlRvcCIsIm9mZnNldCIsImJvdW5kdG9wYXJlbnQiLCJwYXJzZUludCIsImNzcyIsImN1cnJlbnRUb3AiLCJwb3NpdGlvbiIsIndpZHRoIiwiZ2V0V2lkdGhGcm9tIiwiaW5pdCIsImFkZENsYXNzIiwiY2xzaW5pdCIsImxvY2F0aW9uIiwiaGFzaCIsInRhcmdldCIsIiR0YXJnZXQiLCIkIiwic2V0VGltZW91dCIsIm1heG9mZnNldCIsInN0aWNreU9mZnNldCIsInN0aWNreU1heE9mZnNldCIsInNjcm9sbFRvIiwiY2xzYWN0aXZlIiwicmVtb3ZlQ2xhc3MiLCJjbHNpbmFjdGl2ZSIsInRyaWdnZXIiLCJhbmltYXRpb24iLCJVdGlscyIsImlzSW5WaWV3Iiwid3JhcHBlciIsInJlc2V0IiwiZGVmYXVsdHMiLCJzaG93dXAiLCJtZWRpYSIsImRpc2FibGVkIiwiYm9vdCIsIm9uIiwiZSIsImRhdGEiLCJkaXIiLCJ5IiwiZGVib3VuY2UiLCJzZWxmIiwiY29tcHV0ZVdyYXBwZXIiLCJyZWFkeSIsImNvbnRleHQiLCJlYWNoIiwiJGVsZSIsInRoaXMiLCJhdHRyIiwid3JhcCIsInBhcmVudCIsIm1hcmdpbi10b3AiLCJtYXJnaW4tYm90dG9tIiwibWFyZ2luLWxlZnQiLCJtYXJnaW4tcmlnaHQiLCJjbG9zZXN0Iiwic3Vic3RyIiwiY2FsY1RvcCIsIm1hdGNoIiwiaW5uZXJIZWlnaHQiLCJ0b3BFbGVtZW50IiwiZmlyc3QiLCJmb3JjZSIsImZpbmFsaXplIiwibGVmdCIsIm1hcmdpbiIsImpvaW4iLCJiaW5kIiwic3VwcG9ydCIsIm9uZSIsImVuZCIsImlubmVyV2lkdGgiLCJtYXRjaE1lZGlhIiwibWF0Y2hlcyIsImFjdGl2ZSIsImhhc0NsYXNzIiwicHVzaCIsInVwZGF0ZSIsImVuYWJsZSIsImRpc2FibGUiLCJpbmRleE9mIiwiZmxvYXQiXSwibWFwcGluZ3MiOiJDQUNBLFNBQVVBLEdBRU4sSUFBSUMsRUFFQUMsT0FBT0MsU0FDUEYsRUFBWUQsRUFBTUcsU0FHRCxtQkFBVkMsUUFBd0JBLE9BQU9DLEtBQ3RDRCxPQUFPLGVBQWdCLENBQUMsU0FBVSxXQUM5QixPQUFPSCxHQUFhRCxFQUFNRyxVQVZ0QyxDQWNHLFNBQVNHLEdBRVIsYUFFQSxJQUFJQyxFQUFlRCxFQUFHQyxLQUNsQkMsRUFBZUYsRUFBR0UsS0FDbEJDLEVBQWUsR0FDZkMsRUFBZSxFQXdPbkIsU0FBU0MsRUFBb0JELEdBRXpCLElBQUlFLEVBQVdDLFVBQVVDLE9BQVNELFVBQVlKLEVBRTlDLEdBQUtHLEVBQVNFLFVBQVVQLEVBQUtRLFlBQWMsR0FTM0MsSUFQQSxJQUtJQyxFQUFRQyxFQUFpQkMsRUFBY0MsRUFMdkNKLEVBQWtCUixFQUFLUSxZQUN2QkssRUFBa0JaLEVBQUthLFNBRXZCQyxFQUFrQkYsRUFEQWIsRUFBS2MsU0FFdkJFLEVBQStCRCxFQUFaUCxFQUFtQk8sRUFBTVAsRUFBWSxFQUduRFMsRUFBSSxFQUFHQSxFQUFJWixFQUFTRSxPQUFRVSxJQUlqQyxJQUZBTCxFQUFTUCxFQUFTWSxJQUVOQyxRQUFRQyxHQUFHLGNBQWVQLEVBQU9RLFFBQTdDLENBSUEsR0FBS1IsRUFBT1MsUUFNTCxDQVVILEdBUElaLEVBREFH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R3RCcEIsZUFBZ0IsV0FFWkssS0FBS25CLFFBQVF6QixJQUFJLENBQ2JqQixRQUFpRixHQUEvRCxDQUFDLFdBQVcsU0FBUzhGLFFBQVFqQyxLQUFLekQsUUFBUWEsSUFBSSxhQUFxQjRDLEtBQUt6RCxRQUFRSyxjQUFnQixHQUNsSHNGLE1BQStDLFFBQTdCbEMsS0FBS3pELFFBQVFhLElBQUksU0FBcUI0QyxLQUFLekQsUUFBUWEsSUFBSSxTQUFXLEtBR3BELFNBQWhDNEMsS0FBS3pELFFBQVFhLElBQUksYUFDakI0QyxLQUFLekQsUUFBUWEsSUFBSSxDQUNiRyxNQUFPeUMsS0FBSy9ELE9BQU91QixhQUFhNUIsT0FBU29FLEtBQUsvRCxPQUFPdUIsYUFBYUQsUUFBVXlDLEtBQUt6RCxRQUFRZ0IsYUFrSGxHbkMsRUFBR2EiLCJmaWxlIjoiY29tcG9uZW50cy9zdGlja3kuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiEgVUlraXQgMi4yNy4yIHwgaHR0cDovL3d3dy5nZXR1aWtpdC5jb20gfCAoYykgMjAxNCBZT090aGVtZSB8IE1JVCBMaWNlbnNlICovXG4oZnVuY3Rpb24oYWRkb24pIHtcblxuICAgIHZhciBjb21wb25lbnQ7XG5cbiAgICBpZiAod2luZG93LlVJa2l0Mikge1xuICAgICAgICBjb21wb25lbnQgPSBhZGRvbihVSWtpdDIpO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgZGVmaW5lID09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xuICAgICAgICBkZWZpbmUoJ3Vpa2l0LXN0aWNreScsIFsndWlraXQnXSwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiBjb21wb25lbnQgfHwgYWRkb24oVUlraXQyKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG59KShmdW5jdGlvbihVSSl7XG5cbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIHZhciAkd2luICAgICAgICAgPSBVSS4kd2luLFxuICAgICAgICAkZG9jICAgICAgICAgPSBVSS4kZG9jLFxuICAgICAgICBzdGlja2VkICAgICAgPSBbXSxcbiAgICAgICAgZGlyZWN0aW9uICAgID0gMTtcblxuICAgIFVJLmNvbXBvbmVudCgnc3RpY2t5Jywge1xuXG4gICAgICAgIGRlZmF1bHRzOiB7XG4gICAgICAgICAgICB0b3AgICAgICAgICAgOiAwLFxuICAgICAgICAgICAgYm90dG9tICAgICAgIDogMCxcbiAgICAgICAgICAgIGFuaW1hdGlvbiAgICA6ICcnLFxuICAgICAgICAgICAgY2xzaW5pdCAgICAgIDogJ3VrLXN0aWNreS1pbml0JyxcbiAgICAgICAgICAgIGNsc2FjdGl2ZSAgICA6ICd1ay1hY3RpdmUnLFxuICAgICAgICAgICAgY2xzaW5hY3RpdmUgIDogJycsXG4gICAgICAgICAgICBnZXRXaWR0aEZyb20gOiAnJyxcbiAgICAgICAgICAgIHNob3d1cCAgICAgICA6IGZhbHNlLFxuICAgICAgICAgICAgYm91bmRhcnkgICAgIDogZmFsc2UsXG4gICAgICAgICAgICBtZWRpYSAgICAgICAgOiBmYWxzZSxcbiAgICAgICAgICAgIHRhcmdldCAgICAgICA6IGZhbHNlLFxuICAgICAgICAgICAgZGlzYWJsZWQgICAgIDogZmFsc2VcbiAgICAgICAgfSxcblxuICAgICAgICBib290OiBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgLy8gc2hvdWxkIGJlIG1vcmUgZWZmaWNpZW50IHRoYW4gdXNpbmcgJHdpbi5zY3JvbGwoY2hlY2tzY3JvbGxwb3NpdGlvbik6XG4gICAgICAgICAgICBVSS4kZG9jLm9uKCdzY3JvbGxpbmcudWsuZG9jdW1lbnQnLCBmdW5jdGlvbihlLCBkYXRhKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFkYXRhIHx8ICFkYXRhLmRpcikgcmV0dXJuO1xuICAgICAgICAgICAgICAgIGRpcmVjdGlvbiA9IGRhdGEuZGlyLnk7XG4gICAgICAgICAgICAgICAgY2hlY2tzY3JvbGxwb3NpdGlvbigpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIFVJLiR3aW4ub24oJ3Jlc2l6ZSBvcmllbnRhdGlvbmNoYW5nZScsIFVJLlV0aWxzLmRlYm91bmNlKGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgaWYgKCFzdGlja2VkLmxlbmd0aCkgcmV0dXJuO1xuXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdGlja2VkLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHN0aWNrZWRbaV0ucmVzZXQodHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIHN0aWNrZWRbaV0uc2VsZi5jb21wdXRlV3JhcHBlcigpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNoZWNrc2Nyb2xscG9zaXRpb24oKTtcbiAgICAgICAgICAgIH0sIDEwMCkpO1xuXG4gICAgICAgICAgICAvLyBpbml0IGNvZGVcbiAgICAgICAgICAgIFVJLnJlYWR5KGZ1bmN0aW9uKGNvbnRleHQpIHtcblxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcblxuICAgICAgICAgICAgICAgICAgICBVSS4kKCdbZGF0YS11ay1zdGlja3ldJywgY29udGV4dCkuZWFjaChmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgJGVsZSA9IFVJLiQodGhpcyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghJGVsZS5kYXRhKCdzdGlja3knKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFVJLnN0aWNreSgkZWxlLCBVSS5VdGlscy5vcHRpb25zKCRlbGUuYXR0cignZGF0YS11ay1zdGlja3knKSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBjaGVja3Njcm9sbHBvc2l0aW9uKCk7XG4gICAgICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBpbml0OiBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgdmFyIGJvdW5kYXJ5ID0gdGhpcy5vcHRpb25zLmJvdW5kYXJ5LCBib3VuZHRvcGFyZW50O1xuXG4gICAgICAgICAgICB0aGlzLndyYXBwZXIgPSB0aGlzLmVsZW1lbnQud3JhcCgnPGRpdiBjbGFzcz1cInVrLXN0aWNreS1wbGFjZWhvbGRlclwiPjwvZGl2PicpLnBhcmVudCgpO1xuICAgICAgICAgICAgdGhpcy5jb21wdXRlV3JhcHBlcigpO1xuICAgICAgICAgICAgdGhpcy53cmFwcGVyLmNzcyh7XG4gICAgICAgICAgICAgICAgJ21hcmdpbi10b3AnICAgIDogdGhpcy5lbGVtZW50LmNzcygnbWFyZ2luLXRvcCcpLFxuICAgICAgICAgICAgICAgICdtYXJnaW4tYm90dG9tJyA6IHRoaXMuZWxlbWVudC5jc3MoJ21hcmdpbi1ib3R0b20nKSxcbiAgICAgICAgICAgICAgICAnbWFyZ2luLWxlZnQnICAgOiB0aGlzLmVsZW1lbnQuY3NzKCdtYXJnaW4tbGVmdCcpLFxuICAgICAgICAgICAgICAgICdtYXJnaW4tcmlnaHQnICA6IHRoaXMuZWxlbWVudC5jc3MoJ21hcmdpbi1yaWdodCcpXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgdGhpcy5lbGVtZW50LmNzcygnbWFyZ2luJywgMCk7XG5cbiAgICAgICAgICAgIGlmIChib3VuZGFyeSkge1xuXG4gICAgICAgICAgICAgICAgaWYgKGJvdW5kYXJ5ID09PSB0cnVlIHx8IGJvdW5kYXJ5WzBdID09PSAnIScpIHtcblxuICAgICAgICAgICAgICAgICAgICBib3VuZGFyeSAgICAgID0gYm91bmRhcnkgPT09IHRydWUgPyB0aGlzLndyYXBwZXIucGFyZW50KCkgOiB0aGlzLndyYXBwZXIuY2xvc2VzdChib3VuZGFyeS5zdWJzdHIoMSkpO1xuICAgICAgICAgICAgICAgICAgICBib3VuZHRvcGFyZW50ID0gdHJ1ZTtcblxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGJvdW5kYXJ5ID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICAgICAgICAgIGJvdW5kYXJ5ID0gVUkuJChib3VuZGFyeSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnN0aWNreSA9IHtcbiAgICAgICAgICAgICAgICBzZWxmICAgICAgICAgIDogdGhpcyxcbiAgICAgICAgICAgICAgICBvcHRpb25zICAgICAgIDogdGhpcy5vcHRpb25zLFxuICAgICAgICAgICAgICAgIGVsZW1lbnQgICAgICAgOiB0aGlzLmVsZW1lbnQsXG4gICAgICAgICAgICAgICAgY3VycmVudFRvcCAgICA6IG51bGwsXG4gICAgICAgICAgICAgICAgd3JhcHBlciAgICAgICA6IHRoaXMud3JhcHBlcixcbiAgICAgICAgICAgICAgICBpbml0ICAgICAgICAgIDogZmFsc2UsXG4gICAgICAgICAgICAgICAgZ2V0V2lkdGhGcm9tICA6IFVJLiQodGhpcy5vcHRpb25zLmdldFdpZHRoRnJvbSB8fCB0aGlzLndyYXBwZXIpLFxuICAgICAgICAgICAgICAgIGJvdW5kYXJ5ICAgICAgOiBib3VuZGFyeSxcbiAgICAgICAgICAgICAgICBib3VuZHRvcGFyZW50IDogYm91bmR0b3BhcmVudCxcbiAgICAgICAgICAgICAgICB0b3AgICAgICAgICAgIDogMCxcbiAgICAgICAgICAgICAgICBjYWxjVG9wICAgICAgIDogZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHRvcCA9IHRoaXMub3B0aW9ucy50b3A7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gZHluYW1pYyB0b3AgcGFyYW1ldGVyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMudG9wICYmIHR5cGVvZih0aGlzLm9wdGlvbnMudG9wKSA9PSAnc3RyaW5nJykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBlLmcuIDUwdmhcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMudG9wLm1hdGNoKC9eKC18KShcXGQrKXZoJC8pKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wID0gd2luZG93LmlubmVySGVpZ2h0ICogcGFyc2VJbnQodGhpcy5vcHRpb25zLnRvcCwgMTApLzEwMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGUuZy4gI2VsZW1lbnRJZCwgb3IgLmNsYXNzLTEsY2xhc3MtMiwuY2xhc3MtMyAoZmlyc3QgZm91bmQgaXMgdXNlZClcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG9wRWxlbWVudCA9IFVJLiQodGhpcy5vcHRpb25zLnRvcCkuZmlyc3QoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b3BFbGVtZW50Lmxlbmd0aCAmJiB0b3BFbGVtZW50LmlzKCc6dmlzaWJsZScpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcCA9IC0xICogKCh0b3BFbGVtZW50Lm9mZnNldCgpLnRvcCArIHRvcEVsZW1lbnQub3V0ZXJIZWlnaHQoKSkgLSB0aGlzLndyYXBwZXIub2Zmc2V0KCkudG9wKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudG9wID0gdG9wO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICByZXNldDogZnVuY3Rpb24oZm9yY2UpIHtcblxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNhbGNUb3AoKTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgZmluYWxpemUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5jc3Moe3Bvc2l0aW9uOicnLCB0b3A6JycsIHdpZHRoOicnLCBsZWZ0OicnLCBtYXJnaW46JzAnfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoW3RoaXMub3B0aW9ucy5hbmltYXRpb24sICd1ay1hbmltYXRpb24tcmV2ZXJzZScsIHRoaXMub3B0aW9ucy5jbHNhY3RpdmVdLmpvaW4oJyAnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQuYWRkQ2xhc3ModGhpcy5vcHRpb25zLmNsc2luYWN0aXZlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC50cmlnZ2VyKCdpbmFjdGl2ZS51ay5zdGlja3knKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50VG9wID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYW5pbWF0ZSAgICA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKTtcblxuXG4gICAgICAgICAgICAgICAgICAgIGlmICghZm9yY2UgJiYgdGhpcy5vcHRpb25zLmFuaW1hdGlvbiAmJiBVSS5zdXBwb3J0LmFuaW1hdGlvbiAmJiAhVUkuVXRpbHMuaXNJblZpZXcodGhpcy53cmFwcGVyKSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFuaW1hdGUgPSB0cnVlO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3ModGhpcy5vcHRpb25zLmFuaW1hdGlvbikub25lKFVJLnN1cHBvcnQuYW5pbWF0aW9uLmVuZCwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbGl6ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSkud2lkdGgoKTsgLy8gZm9yY2UgcmVkcmF3XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5hZGRDbGFzcyh0aGlzLm9wdGlvbnMuYW5pbWF0aW9uKycgJysndWstYW5pbWF0aW9uLXJldmVyc2UnKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsaXplKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgY2hlY2s6IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZGlzYWJsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMubWVkaWEpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoKHR5cGVvZih0aGlzLm9wdGlvbnMubWVkaWEpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5pbm5lcldpZHRoIDwgdGhpcy5vcHRpb25zLm1lZGlhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5tYXRjaE1lZGlhICYmICF3aW5kb3cubWF0Y2hNZWRpYSh0aGlzLm9wdGlvbnMubWVkaWEpLm1hdGNoZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHZhciBzY3JvbGxUb3AgICAgICA9ICR3aW4uc2Nyb2xsVG9wKCksXG4gICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudEhlaWdodCA9ICRkb2MuaGVpZ2h0KCksXG4gICAgICAgICAgICAgICAgICAgICAgICBkd2ggICAgICAgICAgICA9IGRvY3VtZW50SGVpZ2h0IC0gd2luZG93LmlubmVySGVpZ2h0LFxuICAgICAgICAgICAgICAgICAgICAgICAgZXh0cmEgICAgICAgICAgPSAoc2Nyb2xsVG9wID4gZHdoKSA/IGR3aCAtIHNjcm9sbFRvcCA6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50VG9wICAgICA9IHRoaXMud3JhcHBlci5vZmZzZXQoKS50b3AsXG4gICAgICAgICAgICAgICAgICAgICAgICBldHNlICAgICAgICAgICA9IGVsZW1lbnRUb3AgLSB0aGlzLnRvcCAtIGV4dHJhLFxuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlICAgICAgICAgPSAoc2Nyb2xsVG9wICA+PSBldHNlKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoYWN0aXZlICYmIHRoaXMub3B0aW9ucy5zaG93dXApIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2V0IGluYWN0aXYgaWYgc2Nyb2xsaW5nIGRvd25cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkaXJlY3Rpb24gPT0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBzZXQgaW5hY3RpdmUgd2hlbiB3cmFwcGVyIGlzIHN0aWxsIGluIHZpZXdcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkaXJlY3Rpb24gPT0gLTEgJiYgIXRoaXMuZWxlbWVudC5oYXNDbGFzcyh0aGlzLm9wdGlvbnMuY2xzYWN0aXZlKSAmJiBVSS5VdGlscy5pc0luVmlldyh0aGlzLndyYXBwZXIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWN0aXZlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHRoaXMuc3RpY2t5LmNhbGNUb3AoKTtcblxuICAgICAgICAgICAgc3RpY2tlZC5wdXNoKHRoaXMuc3RpY2t5KTtcbiAgICAgICAgfSxcblxuICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY2hlY2tzY3JvbGxwb3NpdGlvbih0aGlzLnN0aWNreSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZW5hYmxlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy51cGRhdGUoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBkaXNhYmxlOiBmdW5jdGlvbihmb3JjZSkge1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuc3RpY2t5LnJlc2V0KGZvcmNlKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjb21wdXRlV3JhcHBlcjogZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIHRoaXMud3JhcHBlci5jc3Moe1xuICAgICAgICAgICAgICAgICdoZWlnaHQnICAgICAgICA6IFsnYWJzb2x1dGUnLCdmaXhlZCddLmluZGV4T2YodGhpcy5lbGVtZW50LmNzcygncG9zaXRpb24nKSkgPT0gLTEgPyB0aGlzLmVsZW1lbnQub3V0ZXJIZWlnaHQoKSA6ICcnLFxuICAgICAgICAgICAgICAgICdmbG9hdCcgICAgICAgICA6IHRoaXMuZWxlbWVudC5jc3MoJ2Zsb2F0JykgIT0gJ25vbmUnID8gdGhpcy5lbGVtZW50LmNzcygnZmxvYXQnKSA6ICcnXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuZWxlbWVudC5jc3MoJ3Bvc2l0aW9uJykgPT0gJ2ZpeGVkJykge1xuICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5jc3Moe1xuICAgICAgICAgICAgICAgICAgICB3aWR0aDogdGhpcy5zdGlja3kuZ2V0V2lkdGhGcm9tLmxlbmd0aCA/IHRoaXMuc3RpY2t5LmdldFdpZHRoRnJvbS53aWR0aCgpIDogdGhpcy5lbGVtZW50LndpZHRoKClcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgZnVuY3Rpb24gY2hlY2tzY3JvbGxwb3NpdGlvbihkaXJlY3Rpb24pIHtcblxuICAgICAgICB2YXIgc3RpY2tpZXMgPSBhcmd1bWVudHMubGVuZ3RoID8gYXJndW1lbnRzIDogc3RpY2tlZDtcblxuICAgICAgICBpZiAoIXN0aWNraWVzLmxlbmd0aCB8fCAkd2luLnNjcm9sbFRvcCgpIDwgMCkgcmV0dXJuO1xuXG4gICAgICAgIHZhciBzY3JvbGxUb3AgICAgICAgPSAkd2luLnNjcm9sbFRvcCgpLFxuICAgICAgICAgICAgZG9jdW1lbnRIZWlnaHQgID0gJGRvYy5oZWlnaHQoKSxcbiAgICAgICAgICAgIHdpbmRvd0hlaWdodCAgICA9ICR3aW4uaGVpZ2h0KCksXG4gICAgICAgICAgICBkd2ggICAgICAgICAgICAgPSBkb2N1bWVudEhlaWdodCAtIHdpbmRvd0hlaWdodCxcbiAgICAgICAgICAgIGV4dHJhICAgICAgICAgICA9IChzY3JvbGxUb3AgPiBkd2gpID8gZHdoIC0gc2Nyb2xsVG9wIDogMCxcbiAgICAgICAgICAgIG5ld1RvcCwgY29udGFpbmVyQm90dG9tLCBzdGlja3lIZWlnaHQsIHN0aWNreTtcblxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0aWNraWVzLmxlbmd0aDsgaSsrKSB7XG5cbiAgICAgICAgICAgIHN0aWNreSA9IHN0aWNraWVzW2ldO1xuXG4gICAgICAgICAgICBpZiAoIXN0aWNreS5lbGVtZW50LmlzKCc6dmlzaWJsZScpIHx8IHN0aWNreS5hbmltYXRlKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghc3RpY2t5LmNoZWNrKCkpIHtcblxuICAgICAgICAgICAgICAgIGlmIChzdGlja3kuY3VycmVudFRvcCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBzdGlja3kucmVzZXQoKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoc3RpY2t5LnRvcCA8IDApIHtcbiAgICAgICAgICAgICAgICAgICAgbmV3VG9wID0gMDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzdGlja3lIZWlnaHQgPSBzdGlja3kuZWxlbWVudC5vdXRlckhlaWdodCgpO1xuICAgICAgICAgICAgICAgICAgICBuZXdUb3AgPSBkb2N1bWVudEhlaWdodCAtIHN0aWNreUhlaWdodCAtIHN0aWNreS50b3AgLSBzdGlja3kub3B0aW9ucy5ib3R0b20gLSBzY3JvbGxUb3AgLSBleHRyYTtcbiAgICAgICAgICAgICAgICAgICAgbmV3VG9wID0gbmV3VG9wIDwgMCA/IG5ld1RvcCArIHN0aWNreS50b3AgOiBzdGlja3kudG9wO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChzdGlja3kuYm91bmRhcnkgJiYgc3RpY2t5LmJvdW5kYXJ5Lmxlbmd0aCkge1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBiVG9wID0gc3RpY2t5LmJvdW5kYXJ5Lm9mZnNldCgpLnRvcDtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoc3RpY2t5LmJvdW5kdG9wYXJlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lckJvdHRvbSA9IGRvY3VtZW50SGVpZ2h0IC0gKGJUb3AgKyBzdGlja3kuYm91bmRhcnkub3V0ZXJIZWlnaHQoKSkgKyBwYXJzZUludChzdGlja3kuYm91bmRhcnkuY3NzKCdwYWRkaW5nLWJvdHRvbScpKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lckJvdHRvbSA9IGRvY3VtZW50SGVpZ2h0IC0gYlRvcDtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIG5ld1RvcCA9IChzY3JvbGxUb3AgKyBzdGlja3lIZWlnaHQpID4gKGRvY3VtZW50SGVpZ2h0IC0gY29udGFpbmVyQm90dG9tIC0gKHN0aWNreS50b3AgPCAwID8gMCA6IHN0aWNreS50b3ApKSA/IChkb2N1bWVudEhlaWdodCAtIGNvbnRhaW5lckJvdHRvbSkgLSAoc2Nyb2xsVG9wICsgc3RpY2t5SGVpZ2h0KSA6IG5ld1RvcDtcbiAgICAgICAgICAgICAgICB9XG5cblxuICAgICAgICAgICAgICAgIGlmIChzdGlja3kuY3VycmVudFRvcCAhPSBuZXdUb3ApIHtcblxuICAgICAgICAgICAgICAgICAgICBzdGlja3kuZWxlbWVudC5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb24gOiAnZml4ZWQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgdG9wICAgICAgOiBuZXdUb3AsXG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aCAgICA6IHN0aWNreS5nZXRXaWR0aEZyb20ubGVuZ3RoID8gc3RpY2t5LmdldFdpZHRoRnJvbS53aWR0aCgpIDogc3RpY2t5LmVsZW1lbnQud2lkdGgoKVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIXN0aWNreS5pbml0KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHN0aWNreS5lbGVtZW50LmFkZENsYXNzKHN0aWNreS5vcHRpb25zLmNsc2luaXQpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobG9jYXRpb24uaGFzaCAmJiBzY3JvbGxUb3AgPiAwICYmIHN0aWNreS5vcHRpb25zLnRhcmdldCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyICR0YXJnZXQgPSBVSS4kKGxvY2F0aW9uLmhhc2gpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR0YXJnZXQubGVuZ3RoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoZnVuY3Rpb24oJHRhcmdldCwgc3RpY2t5KXtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RpY2t5LmVsZW1lbnQud2lkdGgoKTsgLy8gZm9yY2UgcmVkcmF3XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgb2Zmc2V0ICAgICAgID0gJHRhcmdldC5vZmZzZXQoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4b2Zmc2V0ICAgID0gb2Zmc2V0LnRvcCArICR0YXJnZXQub3V0ZXJIZWlnaHQoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RpY2t5T2Zmc2V0ID0gc3RpY2t5LmVsZW1lbnQub2Zmc2V0KCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0aWNreUhlaWdodCA9IHN0aWNreS5lbGVtZW50Lm91dGVySGVpZ2h0KCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0aWNreU1heE9mZnNldCA9IHN0aWNreU9mZnNldC50b3AgKyBzdGlja3lIZWlnaHQ7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RpY2t5T2Zmc2V0LnRvcCA8IG1heG9mZnNldCAmJiBvZmZzZXQudG9wIDwgc3RpY2t5TWF4T2Zmc2V0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjcm9sbFRvcCA9IG9mZnNldC50b3AgLSBzdGlja3lIZWlnaHQgLSBzdGlja3kub3B0aW9ucy50YXJnZXQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zY3JvbGxUbygwLCBzY3JvbGxUb3ApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkoJHRhcmdldCwgc3RpY2t5KSwgMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgc3RpY2t5LmVsZW1lbnQuYWRkQ2xhc3Moc3RpY2t5Lm9wdGlvbnMuY2xzYWN0aXZlKS5yZW1vdmVDbGFzcyhzdGlja3kub3B0aW9ucy5jbHNpbmFjdGl2ZSk7XG4gICAgICAgICAgICAgICAgICAgIHN0aWNreS5lbGVtZW50LnRyaWdnZXIoJ2FjdGl2ZS51ay5zdGlja3knKTtcbiAgICAgICAgICAgICAgICAgICAgc3RpY2t5LmVsZW1lbnQuY3NzKCdtYXJnaW4nLCAnJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHN0aWNreS5vcHRpb25zLmFuaW1hdGlvbiAmJiBzdGlja3kuaW5pdCAmJiAhVUkuVXRpbHMuaXNJblZpZXcoc3RpY2t5LndyYXBwZXIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGlja3kuZWxlbWVudC5hZGRDbGFzcyhzdGlja3kub3B0aW9ucy5hbmltYXRpb24pO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgc3RpY2t5LmN1cnJlbnRUb3AgPSBuZXdUb3A7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzdGlja3kuaW5pdCA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gVUkuc3RpY2t5O1xufSk7Il19
