!function(t){var e;window.UIkit2&&(e=t(UIkit2)),"function"==typeof define&&define.amd&&define("uikit-slider",["uikit"],function(){return e||t(UIkit2)})}(function(r){"use strict";var f,u,e,s,l={};return r.component("slider",{defaults:{center:!1,threshold:10,infinite:!0,autoplay:!1,autoplayInterval:7e3,pauseOnHover:!0,activecls:"uk-active"},boot:function(){r.ready(function(t){setTimeout(function(){r.$("[data-uk-slider]",t).each(function(){var t=r.$(this);t.data("slider")||r.slider(t,r.Utils.options(t.attr("data-uk-slider")))})},0)})},init:function(){var i=this;this.container=this.element.find(".uk-slider"),this.focus=0,r.$win.on("resize load",r.Utils.debounce(function(){i.update(!0)},100)),this.on("click.uk.slider","[data-uk-slider-item]",function(t){t.preventDefault();var e=r.$(this).attr("data-uk-slider-item");if(i.focus!=e)switch(i.stop(),e){case"next":case"previous":i["next"==e?"next":"previous"]();break;default:i.updateFocus(parseInt(e,10))}}),this.container.on({"touchstart mousedown":function(t){t.originalEvent&&t.originalEvent.touches&&(t=t.originalEvent.touches[0]),t.button&&2==t.button||!i.active||(i.stop(),e=r.$(t.target).is("a")?r.$(t.target):r.$(t.target).parents("a:first"),s=!1,e.length&&e.one("click",function(t){s&&t.preventDefault()}),(u=function(t){s=!0,f=i,l={touchx:parseInt(t.pageX,10),dir:1,focus:i.focus,base:i.options.center?"center":"area"},t.originalEvent&&t.originalEvent.touches&&(t=t.originalEvent.touches[0]),f.element.data({"pointer-start":{x:parseInt(t.pageX,10),y:parseInt(t.pageY,10)},"pointer-pos-start":i.pos}),i.container.addClass("uk-drag"),u=!1}).x=parseInt(t.pageX,10),u.threshold=i.options.threshold)},mouseenter:function(){i.options.pauseOnHover&&(i.hovering=!0)},mouseleave:function(){i.hovering=!1}}),this.update(!0),this.on("display.uk.check",function(){i.element.is(":visible")&&i.update(!0)}),this.element.find("a,img").attr("draggable","false"),this.options.autoplay&&this.start(),r.domObserve(this.element,function(t){i.element.children(":not([data-slider-slide])").length&&i.update(!0)})},update:function(t){var e,i,s,n,a=this,o=0,h=0;if(this.items=this.container.children().filter(":visible"),this.vp=this.element[0].getBoundingClientRect().width,this.container.css({"min-width":"","min-height":""}),this.items.each(function(t){e=r.$(this).attr("data-slider-slide",t),n=e.css({left:"",width:""})[0].getBoundingClientRect(),i=n.width,s=e.width(),h=Math.max(h,n.height),e.css({left:o,width:i}).data({idx:t,left:o,width:i,cwidth:s,area:o+i,center:o-(a.vp/2-s/2)}),o+=i}),this.container.css({"min-width":o,"min-height":h}),this.options.infinite&&(o<=2*this.vp||this.items.length<5)&&!this.itemsResized)return this.container.children().each(function(t){a.container.append(a.items.eq(t).clone(!0).attr("id",""))}).each(function(t){a.container.append(a.items.eq(t).clone(!0).attr("id",""))}),this.itemsResized=!0,this.update();this.cw=o,this.pos=0,this.active=o>=this.vp,this.container.css({"-ms-transform":"","-webkit-transform":"",transform:""}),t&&this.updateFocus(this.focus)},updatePos:function(t){this.pos=t,this.container.css({"-ms-transform":"translateX("+t+"px)","-webkit-transform":"translateX("+t+"px)",transform:"translateX("+t+"px)"})},updateFocus:function(e,t){if(this.active){t=t||(e>this.focus?1:-1);var i,s,n=this.items.eq(e);if(this.options.infinite&&this.infinite(e,t),this.options.center)this.updatePos(-1*n.data("center")),this.items.filter("."+this.options.activecls).removeClass(this.options.activecls),n.addClass(this.options.activecls);else if(this.options.infinite)this.updatePos(-1*n.data("left"));else{for(i=0,s=e;s<this.items.length;s++)i+=this.items.eq(s).data("width");if(i>this.vp)this.updatePos(-1*n.data("left"));else if(1==t){for(i=0,s=this.items.length-1;0<=s;s--){if((i+=this.items.eq(s).data("width"))==this.vp){e=s;break}if(i>this.vp){e=s<this.items.length-1?s+1:s;break}}i>this.vp?this.updatePos(-1*(this.container.width()-this.vp)):this.updatePos(-1*this.items.eq(e).data("left"))}}var a=this.items.eq(e).data("left");this.items.removeClass("uk-slide-before uk-slide-after").each(function(t){t!==e&&r.$(this).addClass(r.$(this).data("left")<a?"uk-slide-before":"uk-slide-after")}),this.focus=e,this.trigger("focusitem.uk.slider",[e,this.items.eq(e),this])}},next:function(){var t=this.items[this.focus+1]?this.focus+1:this.options.infinite?0:this.focus;this.updateFocus(t,1)},previous:function(){var t=this.items[this.focus-1]?this.focus-1:this.options.infinite?this.items[this.focus-1]?this.items-1:this.items.length-1:this.focus;this.updateFocus(t,-1)},start:function(){this.stop();var t=this;this.interval=setInterval(function(){t.hovering||t.next()},this.options.autoplayInterval)},stop:function(){this.interval&&clearInterval(this.interval)},infinite:function(t,e){var i,s=this,n=this.items.eq(t),a=t,o=[],h=0;if(1==e){for(i=0;i<this.items.length&&(a!=t&&(h+=this.items.eq(a).data("width"),o.push(this.items.eq(a))),!(h>this.vp));i++)a=a+1==this.items.length?0:a+1;o.length&&o.forEach(function(t){var e=n.data("area");t.css({left:e}).data({left:e,area:e+t.data("width"),center:e-(s.vp/2-t.data("cwidth")/2)}),n=t})}else{for(i=this.items.length-1;-1<i&&(h+=this.items.eq(a).data("width"),a!=t&&o.push(this.items.eq(a)),!(h>this.vp));i--)a=a-1==-1?this.items.length-1:a-1;o.length&&o.forEach(function(t){var e=n.data("left")-t.data("width");t.css({left:e}).data({left:e,area:e+t.data("width"),center:e-(s.vp/2-t.data("cwidth")/2)}),n=t})}}}),r.$doc.on("mousemove.uk.slider touchmove.uk.slider",function(t){if(t.originalEvent&&t.originalEvent.touches&&(t=t.originalEvent.touches[0]),u&&Math.abs(t.pageX-u.x)>u.threshold&&(window.getSelection().toString()?f=u=!1:u(t)),f){var e,i,s,n,a,o,h,r,c,d;if(t.clientX||t.clientY?e=t.clientX:(t.pageX||t.pageY)&&(e=t.pageX-document.body.scrollLeft-document.documentElement.scrollLeft),a=l.focus,i=e-f.element.data("pointer-start").x,s=f.element.data("pointer-pos-start")+i,n=e>f.element.data("pointer-start").x?-1:1,o=f.items.eq(l.focus),1==n)for(h=o.data("left")+Math.abs(i),r=0,c=l.focus;r<f.items.length;r++){if(d=f.items.eq(c),c!=l.focus&&d.data("left")<h&&d.data("area")>h){a=c;break}c=c+1==f.items.length?0:c+1}else for(h=o.data("left")-Math.abs(i),r=0,c=l.focus;r<f.items.length;r++){if(d=f.items.eq(c),c!=l.focus&&d.data("area")<=o.data("left")&&d.data("center")<h){a=c;break}c=c-1==-1?f.items.length-1:c-1}f.options.infinite&&a!=l._focus&&f.infinite(a,n),f.updatePos(s),l.dir=n,l._focus=a,l.touchx=parseInt(t.pageX,10),l.diff=h}}),r.$doc.on("mouseup.uk.slider touchend.uk.slider",function(t){if(f){f.container.removeClass("uk-drag"),f.items.eq(l.focus);var e,i,s,n=!1;if(1==l.dir){for(i=0,s=l.focus;i<f.items.length;i++){if(e=f.items.eq(s),s!=l.focus&&e.data("left")>l.diff){n=s;break}s=s+1==f.items.length?0:s+1}f.options.infinite||n||(n=f.items.length)}else{for(i=0,s=l.focus;i<f.items.length;i++){if(e=f.items.eq(s),s!=l.focus&&e.data("left")<l.diff){n=s;break}s=s-1==-1?f.items.length-1:s-1}f.options.infinite||n||(n=0)}f.updateFocus(!1!==n?n:l._focus)}f=u=!1}),r.slider});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvc2xpZGVyLmpzIl0sIm5hbWVzIjpbImFkZG9uIiwiY29tcG9uZW50Iiwid2luZG93IiwiVUlraXQyIiwiZGVmaW5lIiwiYW1kIiwiVUkiLCJkcmFnZ2luZyIsImRlbGF5SWRsZSIsImFuY2hvciIsImRyYWdnZWQiLCJzdG9yZSIsImRlZmF1bHRzIiwiY2VudGVyIiwidGhyZXNob2xkIiwiaW5maW5pdGUiLCJhdXRvcGxheSIsImF1dG9wbGF5SW50ZXJ2YWwiLCJwYXVzZU9uSG92ZXIiLCJhY3RpdmVjbHMiLCJib290IiwicmVhZHkiLCJjb250ZXh0Iiwic2V0VGltZW91dCIsIiQiLCJlYWNoIiwiZWxlIiwidGhpcyIsImRhdGEiLCJzbGlkZXIiLCJVdGlscyIsIm9wdGlvbnMiLCJhdHRyIiwiaW5pdCIsIiR0aGlzIiwiY29udGFpbmVyIiwiZWxlbWVudCIsImZpbmQiLCJmb2N1cyIsIiR3aW4iLCJvbiIsImRlYm91bmNlIiwidXBkYXRlIiwiZSIsInByZXZlbnREZWZhdWx0IiwiaXRlbSIsInN0b3AiLCJ1cGRhdGVGb2N1cyIsInBhcnNlSW50IiwidG91Y2hzdGFydCBtb3VzZWRvd24iLCJldnQiLCJvcmlnaW5hbEV2ZW50IiwidG91Y2hlcyIsImJ1dHRvbiIsImFjdGl2ZSIsInRhcmdldCIsImlzIiwicGFyZW50cyIsImxlbmd0aCIsIm9uZSIsInRvdWNoeCIsInBhZ2VYIiwiZGlyIiwiYmFzZSIsInBvaW50ZXItc3RhcnQiLCJ4IiwieSIsInBhZ2VZIiwicG9pbnRlci1wb3Mtc3RhcnQiLCJwb3MiLCJhZGRDbGFzcyIsIm1vdXNlZW50ZXIiLCJob3ZlcmluZyIsIm1vdXNlbGVhdmUiLCJzdGFydCIsImRvbU9ic2VydmUiLCJjaGlsZHJlbiIsIndpZHRoIiwiY3dpZHRoIiwic2l6ZSIsIm1heGhlaWdodCIsIml0ZW1zIiwiZmlsdGVyIiwidnAiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJjc3MiLCJtaW4td2lkdGgiLCJtaW4taGVpZ2h0IiwiaWR4IiwibGVmdCIsIk1hdGgiLCJtYXgiLCJoZWlnaHQiLCJhcmVhIiwiaXRlbXNSZXNpemVkIiwiYXBwZW5kIiwiZXEiLCJjbG9uZSIsImN3IiwiLW1zLXRyYW5zZm9ybSIsIi13ZWJraXQtdHJhbnNmb3JtIiwidHJhbnNmb3JtIiwidXBkYXRlUG9zIiwiaSIsInJlbW92ZUNsYXNzIiwidHJpZ2dlciIsIm5leHQiLCJwcmV2aW91cyIsImludGVydmFsIiwic2V0SW50ZXJ2YWwiLCJjbGVhckludGVydmFsIiwiYmFzZWlkeCIsImRpcmVjdGlvbiIsInoiLCJtb3ZlIiwicHVzaCIsImZvckVhY2giLCJpdG0iLCIkZG9jIiwiYWJzIiwiZ2V0U2VsZWN0aW9uIiwidG9TdHJpbmciLCJ4RGlmZiIsImRpZmYiLCJjbGllbnRYIiwiY2xpZW50WSIsImRvY3VtZW50IiwiYm9keSIsInNjcm9sbExlZnQiLCJkb2N1bWVudEVsZW1lbnQiLCJfZm9jdXMiXSwibWFwcGluZ3MiOiJDQUNBLFNBQVVBLEdBRU4sSUFBSUMsRUFFQUMsT0FBT0MsU0FDUEYsRUFBWUQsRUFBTUcsU0FHRCxtQkFBVkMsUUFBd0JBLE9BQU9DLEtBQ3RDRCxPQUFPLGVBQWdCLENBQUMsU0FBVSxXQUM5QixPQUFPSCxHQUFhRCxFQUFNRyxVQVZ0QyxDQWNHLFNBQVNHLEdBRVIsYUFFQSxJQUFJQyxFQUFVQyxFQUFXQyxFQUFRQyxFQUFTQyxFQUFRLEdBbWhCbEQsT0FqaEJBTCxFQUFHTCxVQUFVLFNBQVUsQ0FFbkJXLFNBQVUsQ0FDTkMsUUFBbUIsRUFDbkJDLFVBQW1CLEdBQ25CQyxVQUFtQixFQUNuQkMsVUFBbUIsRUFDbkJDLGlCQUFtQixJQUNuQkMsY0FBbUIsRUFDbkJDLFVBQW1CLGFBR3ZCQyxLQUFPLFdBR0hkLEVBQUdlLE1BQU0sU0FBU0MsR0FFZEMsV0FBVyxXQUVQakIsRUFBR2tCLEVBQUUsbUJBQW9CRixHQUFTRyxLQUFLLFdBRW5DLElBQUlDLEVBQU1wQixFQUFHa0IsRUFBRUcsTUFFVkQsRUFBSUUsS0FBSyxXQUNWdEIsRUFBR3VCLE9BQU9ILEVBQUtwQixFQUFHd0IsTUFBTUMsUUFBUUwsRUFBSU0sS0FBSyx1QkFJbEQsTUFJWEMsS0FBTSxXQUVGLElBQUlDLEVBQVFQLEtBRVpBLEtBQUtRLFVBQVlSLEtBQUtTLFFBQVFDLEtBQUssY0FDbkNWLEtBQUtXLE1BQVksRUFFakJoQyxFQUFHaUMsS0FBS0MsR0FBRyxjQUFlbEMsRUFBR3dCLE1BQU1XLFNBQVMsV0FDeENQLEVBQU1RLFFBQU8sSUFDZCxNQUVIZixLQUFLYSxHQUFHLGtCQUFtQix3QkFBeUIsU0FBU0csR0FFekRBLEVBQUVDLGlCQUVGLElBQUlDLEVBQU92QyxFQUFHa0IsRUFBRUcsTUFBTUssS0FBSyx1QkFFM0IsR0FBSUUsRUFBTUksT0FBU08sRUFLbkIsT0FGQVgsRUFBTVksT0FFQ0QsR0FDSCxJQUFLLE9BQ0wsSUFBSyxXQUNEWCxFQUFZLFFBQU5XLEVBQWUsT0FBTyxjQUM1QixNQUNKLFFBQ0lYLEVBQU1hLFlBQVlDLFNBQVNILEVBQU0sUUFJN0NsQixLQUFLUSxVQUFVSyxHQUFHLENBRWRTLHVCQUF3QixTQUFTQyxHQUV6QkEsRUFBSUMsZUFBaUJELEVBQUlDLGNBQWNDLFVBQ3ZDRixFQUFNQSxFQUFJQyxjQUFjQyxRQUFRLElBSWhDRixFQUFJRyxRQUFzQixHQUFaSCxFQUFJRyxTQUFjbkIsRUFBTW9CLFNBSzFDcEIsRUFBTVksT0FFTnJDLEVBQVVILEVBQUdrQixFQUFFMEIsRUFBSUssUUFBUUMsR0FBRyxLQUFPbEQsRUFBR2tCLEVBQUUwQixFQUFJSyxRQUFVakQsRUFBR2tCLEVBQUUwQixFQUFJSyxRQUFRRSxRQUFRLFdBQ2pGL0MsR0FBVSxFQUVORCxFQUFPaUQsUUFFUGpELEVBQU9rRCxJQUFJLFFBQVMsU0FBU2hCLEdBQ3JCakMsR0FBU2lDLEVBQUVDLG9CQUl2QnBDLEVBQVksU0FBU21DLEdBRWpCakMsR0FBVyxFQUNYSCxFQUFXMkIsRUFDWHZCLEVBQVcsQ0FDUGlELE9BQVNaLFNBQVNMLEVBQUVrQixNQUFPLElBQzNCQyxJQUFTLEVBQ1R4QixNQUFTSixFQUFNSSxNQUNmeUIsS0FBUzdCLEVBQU1ILFFBQVFsQixPQUFTLFNBQVMsUUFHekM4QixFQUFFUSxlQUFpQlIsRUFBRVEsY0FBY0MsVUFDbkNULEVBQUlBLEVBQUVRLGNBQWNDLFFBQVEsSUFHaEM3QyxFQUFTNkIsUUFBUVIsS0FBSyxDQUNsQm9DLGdCQUFpQixDQUFDQyxFQUFHakIsU0FBU0wsRUFBRWtCLE1BQU8sSUFBS0ssRUFBR2xCLFNBQVNMLEVBQUV3QixNQUFPLEtBQ2pFQyxvQkFBcUJsQyxFQUFNbUMsTUFHL0JuQyxFQUFNQyxVQUFVbUMsU0FBUyxXQUV6QjlELEdBQVksSUFHTnlELEVBQVlqQixTQUFTRSxFQUFJVyxNQUFPLElBQzFDckQsRUFBVU0sVUFBWW9CLEVBQU1ILFFBQVFqQixZQUl4Q3lELFdBQVksV0FBaUJyQyxFQUFNSCxRQUFRYixlQUFjZ0IsRUFBTXNDLFVBQVcsSUFDMUVDLFdBQVksV0FBYXZDLEVBQU1zQyxVQUFXLEtBRzlDN0MsS0FBS2UsUUFBTyxHQUVaZixLQUFLYSxHQUFHLG1CQUFvQixXQUNwQk4sRUFBTUUsUUFBUW9CLEdBQUcsYUFDakJ0QixFQUFNUSxRQUFPLEtBS3JCZixLQUFLUyxRQUFRQyxLQUFLLFNBQVNMLEtBQUssWUFBYSxTQUd6Q0wsS0FBS0ksUUFBUWYsVUFDYlcsS0FBSytDLFFBR1RwRSxFQUFHcUUsV0FBV2hELEtBQUtTLFFBQVMsU0FBU08sR0FDN0JULEVBQU1FLFFBQVF3QyxTQUFTLDZCQUE2QmxCLFFBQ3BEeEIsRUFBTVEsUUFBTyxNQU16QkEsT0FBUSxTQUFTSixHQUViLElBQTBDTyxFQUFNZ0MsRUFBT0MsRUFBUUMsRUFBM0Q3QyxFQUFRUCxLQUFNMEMsRUFBTSxFQUFHVyxFQUFZLEVBc0J2QyxHQXBCQXJELEtBQUtzRCxNQUFRdEQsS0FBS1EsVUFBVXlDLFdBQVdNLE9BQU8sWUFDOUN2RCxLQUFLd0QsR0FBUXhELEtBQUtTLFFBQVEsR0FBR2dELHdCQUF3QlAsTUFFckRsRCxLQUFLUSxVQUFVa0QsSUFBSSxDQUFDQyxZQUFhLEdBQUlDLGFBQWMsS0FFbkQ1RCxLQUFLc0QsTUFBTXhELEtBQUssU0FBUytELEdBRXJCM0MsRUFBWXZDLEVBQUdrQixFQUFFRyxNQUFNSyxLQUFLLG9CQUFxQndELEdBQ2pEVCxFQUFZbEMsRUFBS3dDLElBQUksQ0FBQ0ksS0FBUSxHQUFJWixNQUFRLEtBQUssR0FBR08sd0JBQ2xEUCxFQUFZRSxFQUFLRixNQUNqQkMsRUFBWWpDLEVBQUtnQyxRQUNqQkcsRUFBWVUsS0FBS0MsSUFBSVgsRUFBV0QsRUFBS2EsUUFFckMvQyxFQUFLd0MsSUFBSSxDQUFDSSxLQUFRcEIsRUFBS1EsTUFBUUEsSUFBUWpELEtBQUssQ0FBQzRELElBQU1BLEVBQUtDLEtBQVFwQixFQUFLUSxNQUFTQSxFQUFPQyxPQUFTQSxFQUFRZSxLQUFTeEIsRUFBSVEsRUFBUWhFLE9BQVV3RCxHQUFPbkMsRUFBTWlELEdBQUcsRUFBSUwsRUFBTyxLQUVoS1QsR0FBT1EsSUFHWGxELEtBQUtRLFVBQVVrRCxJQUFJLENBQUNDLFlBQWFqQixFQUFLa0IsYUFBY1AsSUFFaERyRCxLQUFLSSxRQUFRaEIsV0FBYXNELEdBQVEsRUFBRTFDLEtBQUt3RCxJQUFPeEQsS0FBS3NELE1BQU12QixPQUFTLEtBQU8vQixLQUFLbUUsYUFXaEYsT0FSQW5FLEtBQUtRLFVBQVV5QyxXQUFXbkQsS0FBSyxTQUFTK0QsR0FDckN0RCxFQUFNQyxVQUFVNEQsT0FBTzdELEVBQU0rQyxNQUFNZSxHQUFHUixHQUFLUyxPQUFNLEdBQU1qRSxLQUFLLEtBQU0sT0FDbEVQLEtBQUssU0FBUytELEdBQ2R0RCxFQUFNQyxVQUFVNEQsT0FBTzdELEVBQU0rQyxNQUFNZSxHQUFHUixHQUFLUyxPQUFNLEdBQU1qRSxLQUFLLEtBQU0sT0FHckVMLEtBQUttRSxjQUFlLEVBRWJuRSxLQUFLZSxTQUdoQmYsS0FBS3VFLEdBQVM3QixFQUNkMUMsS0FBSzBDLElBQVMsRUFDZDFDLEtBQUsyQixPQUFTZSxHQUFPMUMsS0FBS3dELEdBRTFCeEQsS0FBS1EsVUFBVWtELElBQUksQ0FDZmMsZ0JBQWlCLEdBQ2pCQyxvQkFBcUIsR0FDckJDLFVBQWEsS0FHYi9ELEdBQU9YLEtBQUtvQixZQUFZcEIsS0FBS1csUUFHckNnRSxVQUFXLFNBQVNqQyxHQUNoQjFDLEtBQUswQyxJQUFNQSxFQUNYMUMsS0FBS1EsVUFBVWtELElBQUksQ0FDZmMsZ0JBQWlCLGNBQWM5QixFQUFJLE1BQ25DK0Isb0JBQXFCLGNBQWMvQixFQUFJLE1BQ3ZDZ0MsVUFBYSxjQUFjaEMsRUFBSSxTQUl2Q3RCLFlBQWEsU0FBU3lDLEVBQUsxQixHQUV2QixHQUFLbkMsS0FBSzJCLE9BQVYsQ0FJQVEsRUFBTUEsSUFBUTBCLEVBQU03RCxLQUFLVyxNQUFRLEdBQUcsR0FFcEMsSUFBK0J1RCxFQUFNVSxFQUFqQzFELEVBQU9sQixLQUFLc0QsTUFBTWUsR0FBR1IsR0FNekIsR0FKSTdELEtBQUtJLFFBQVFoQixVQUNiWSxLQUFLWixTQUFTeUUsRUFBSzFCLEdBR25CbkMsS0FBS0ksUUFBUWxCLE9BRWJjLEtBQUsyRSxXQUErQixFQUFyQnpELEVBQUtqQixLQUFLLFdBRXpCRCxLQUFLc0QsTUFBTUMsT0FBTyxJQUFJdkQsS0FBS0ksUUFBUVosV0FBV3FGLFlBQVk3RSxLQUFLSSxRQUFRWixXQUN2RTBCLEVBQUt5QixTQUFTM0MsS0FBS0ksUUFBUVosZ0JBSTNCLEdBQUlRLEtBQUtJLFFBQVFoQixTQUViWSxLQUFLMkUsV0FBNkIsRUFBbkJ6RCxFQUFLakIsS0FBSyxhQUV0QixDQUlILElBRkFpRSxFQUFPLEVBRUZVLEVBQUVmLEVBQUllLEVBQUU1RSxLQUFLc0QsTUFBTXZCLE9BQU82QyxJQUMzQlYsR0FBUWxFLEtBQUtzRCxNQUFNZSxHQUFHTyxHQUFHM0UsS0FBSyxTQUlsQyxHQUFJaUUsRUFBT2xFLEtBQUt3RCxHQUVaeEQsS0FBSzJFLFdBQTZCLEVBQW5CekQsRUFBS2pCLEtBQUssY0FJekIsR0FBVyxHQUFQa0MsRUFBVSxDQUlWLElBRkErQixFQUFPLEVBRUZVLEVBQUU1RSxLQUFLc0QsTUFBTXZCLE9BQU8sRUFBSyxHQUFINkMsRUFBS0EsSUFBSyxDQUlqQyxJQUZBVixHQUFRbEUsS0FBS3NELE1BQU1lLEdBQUdPLEdBQUczRSxLQUFLLFdBRWxCRCxLQUFLd0QsR0FBSSxDQUNqQkssRUFBTWUsRUFDTixNQUdKLEdBQUlWLEVBQU9sRSxLQUFLd0QsR0FBSSxDQUNoQkssRUFBT2UsRUFBSTVFLEtBQUtzRCxNQUFNdkIsT0FBTyxFQUFLNkMsRUFBRSxFQUFJQSxFQUN4QyxPQUlKVixFQUFPbEUsS0FBS3dELEdBQ1p4RCxLQUFLMkUsV0FBZ0QsR0FBckMzRSxLQUFLUSxVQUFVMEMsUUFBVWxELEtBQUt3RCxLQUU5Q3hELEtBQUsyRSxXQUEyQyxFQUFqQzNFLEtBQUtzRCxNQUFNZSxHQUFHUixHQUFLNUQsS0FBSyxVQVEzRCxJQUFJNkQsRUFBTzlELEtBQUtzRCxNQUFNZSxHQUFHUixHQUFLNUQsS0FBSyxRQUVuQ0QsS0FBS3NELE1BQU11QixZQUFZLGtDQUFrQy9FLEtBQUssU0FBUzhFLEdBQy9EQSxJQUFJZixHQUNKbEYsRUFBR2tCLEVBQUVHLE1BQU0yQyxTQUFTaEUsRUFBR2tCLEVBQUVHLE1BQU1DLEtBQUssUUFBVTZELEVBQU8sa0JBQWtCLG9CQUkvRTlELEtBQUtXLE1BQVFrRCxFQUViN0QsS0FBSzhFLFFBQVEsc0JBQXVCLENBQUNqQixFQUFJN0QsS0FBS3NELE1BQU1lLEdBQUdSLEdBQUs3RCxTQUdoRStFLEtBQU0sV0FFRixJQUFJcEUsRUFBUVgsS0FBS3NELE1BQU10RCxLQUFLVyxNQUFRLEdBQU1YLEtBQUtXLE1BQVEsRUFBTVgsS0FBS0ksUUFBUWhCLFNBQVcsRUFBRVksS0FBS1csTUFFNUZYLEtBQUtvQixZQUFZVCxFQUFPLElBRzVCcUUsU0FBVSxXQUVOLElBQUlyRSxFQUFRWCxLQUFLc0QsTUFBTXRELEtBQUtXLE1BQVEsR0FBTVgsS0FBS1csTUFBUSxFQUFNWCxLQUFLSSxRQUFRaEIsU0FBWVksS0FBS3NELE1BQU10RCxLQUFLVyxNQUFRLEdBQUtYLEtBQUtzRCxNQUFNLEVBQUV0RCxLQUFLc0QsTUFBTXZCLE9BQU8sRUFBRy9CLEtBQUtXLE1BRTFKWCxLQUFLb0IsWUFBWVQsR0FBUSxJQUc3Qm9DLE1BQU8sV0FFSC9DLEtBQUttQixPQUVMLElBQUlaLEVBQVFQLEtBRVpBLEtBQUtpRixTQUFXQyxZQUFZLFdBQ25CM0UsRUFBTXNDLFVBQVV0QyxFQUFNd0UsUUFDNUIvRSxLQUFLSSxRQUFRZCxtQkFJcEI2QixLQUFNLFdBQ0VuQixLQUFLaUYsVUFBVUUsY0FBY25GLEtBQUtpRixXQUcxQzdGLFNBQVUsU0FBU2dHLEVBQVNDLEdBRXhCLElBQWlEVCxFQUE3Q3JFLEVBQVFQLEtBQU1rQixFQUFPbEIsS0FBS3NELE1BQU1lLEdBQUdlLEdBQWFFLEVBQUlGLEVBQVNHLEVBQU8sR0FBSXJCLEVBQU8sRUFFbkYsR0FBaUIsR0FBYm1CLEVBQWdCLENBR2hCLElBQUtULEVBQUUsRUFBRUEsRUFBRTVFLEtBQUtzRCxNQUFNdkIsU0FFZHVELEdBQUtGLElBQ0xsQixHQUFRbEUsS0FBS3NELE1BQU1lLEdBQUdpQixHQUFHckYsS0FBSyxTQUM5QnNGLEVBQUtDLEtBQUt4RixLQUFLc0QsTUFBTWUsR0FBR2lCLE9BR3hCcEIsRUFBT2xFLEtBQUt3RCxLQVBTb0IsSUFXekJVLEVBQUlBLEVBQUUsR0FBS3RGLEtBQUtzRCxNQUFNdkIsT0FBUyxFQUFFdUQsRUFBRSxFQUduQ0MsRUFBS3hELFFBRUx3RCxFQUFLRSxRQUFRLFNBQVNDLEdBRWxCLElBQUk1QixFQUFPNUMsRUFBS2pCLEtBQUssUUFFckJ5RixFQUFJaEMsSUFBSSxDQUFDSSxLQUFRQSxJQUFPN0QsS0FBSyxDQUN6QjZELEtBQVFBLEVBQ1JJLEtBQVNKLEVBQUs0QixFQUFJekYsS0FBSyxTQUN2QmYsT0FBUzRFLEdBQVF2RCxFQUFNaUQsR0FBRyxFQUFJa0MsRUFBSXpGLEtBQUssVUFBVSxLQUdyRGlCLEVBQU93RSxRQUtaLENBRUgsSUFBS2QsRUFBRTVFLEtBQUtzRCxNQUFNdkIsT0FBTyxHQUFNLEVBQUo2QyxJQUV2QlYsR0FBUWxFLEtBQUtzRCxNQUFNZSxHQUFHaUIsR0FBR3JGLEtBQUssU0FFMUJxRixHQUFLRixHQUNMRyxFQUFLQyxLQUFLeEYsS0FBS3NELE1BQU1lLEdBQUdpQixNQUd4QnBCLEVBQU9sRSxLQUFLd0QsS0FSY29CLElBWTlCVSxFQUFJQSxFQUFFLElBQU0sRUFBSXRGLEtBQUtzRCxNQUFNdkIsT0FBTyxFQUFFdUQsRUFBRSxFQUd0Q0MsRUFBS3hELFFBRUx3RCxFQUFLRSxRQUFRLFNBQVNDLEdBRWxCLElBQUk1QixFQUFPNUMsRUFBS2pCLEtBQUssUUFBVXlGLEVBQUl6RixLQUFLLFNBRXhDeUYsRUFBSWhDLElBQUksQ0FBQ0ksS0FBUUEsSUFBTzdELEtBQUssQ0FDekI2RCxLQUFRQSxFQUNSSSxLQUFTSixFQUFLNEIsRUFBSXpGLEtBQUssU0FDdkJmLE9BQVM0RSxHQUFRdkQsRUFBTWlELEdBQUcsRUFBSWtDLEVBQUl6RixLQUFLLFVBQVUsS0FHckRpQixFQUFPd0UsUUFRM0IvRyxFQUFHZ0gsS0FBSzlFLEdBQUcsMENBQTJDLFNBQVNHLEdBZTNELEdBYklBLEVBQUVRLGVBQWlCUixFQUFFUSxjQUFjQyxVQUNuQ1QsRUFBSUEsRUFBRVEsY0FBY0MsUUFBUSxJQUc1QjVDLEdBQWFrRixLQUFLNkIsSUFBSTVFLEVBQUVrQixNQUFRckQsRUFBVXlELEdBQUt6RCxFQUFVTSxZQUVwRFosT0FBT3NILGVBQWVDLFdBR3ZCbEgsRUFBV0MsR0FBWSxFQUZ2QkEsRUFBVW1DLElBTWJwQyxFQUFMLENBSUEsSUFBSTBELEVBQUd5RCxFQUFPckQsRUFBS1AsRUFBS3hCLEVBQU9PLEVBQVk4RSxFQUFNcEIsRUFBR1UsRUFBR0ksRUFjdkQsR0FaSTFFLEVBQUVpRixTQUFXakYsRUFBRWtGLFFBQ2Y1RCxFQUFJdEIsRUFBRWlGLFNBQ0NqRixFQUFFa0IsT0FBU2xCLEVBQUV3QixTQUNwQkYsRUFBSXRCLEVBQUVrQixNQUFRaUUsU0FBU0MsS0FBS0MsV0FBYUYsU0FBU0csZ0JBQWdCRCxZQUd0RTFGLEVBQVEzQixFQUFNMkIsTUFDZG9GLEVBQVF6RCxFQUFJMUQsRUFBUzZCLFFBQVFSLEtBQUssaUJBQWlCcUMsRUFDbkRJLEVBQVE5RCxFQUFTNkIsUUFBUVIsS0FBSyxxQkFBdUI4RixFQUNyRDVELEVBQVFHLEVBQUkxRCxFQUFTNkIsUUFBUVIsS0FBSyxpQkFBaUJxQyxHQUFLLEVBQUUsRUFDMURwQixFQUFRdEMsRUFBUzBFLE1BQU1lLEdBQUdyRixFQUFNMkIsT0FFckIsR0FBUHdCLEVBSUEsSUFGQTZELEVBQU85RSxFQUFLakIsS0FBSyxRQUFVOEQsS0FBSzZCLElBQUlHLEdBRS9CbkIsRUFBRSxFQUFFVSxFQUFFdEcsRUFBTTJCLE1BQU1pRSxFQUFFaEcsRUFBUzBFLE1BQU12QixPQUFPNkMsSUFBSyxDQUloRCxHQUZBYyxFQUFNOUcsRUFBUzBFLE1BQU1lLEdBQUdpQixHQUVwQkEsR0FBS3RHLEVBQU0yQixPQUFTK0UsRUFBSXpGLEtBQUssUUFBVStGLEdBQVFOLEVBQUl6RixLQUFLLFFBQVUrRixFQUFNLENBQ3hFckYsRUFBUTJFLEVBQ1IsTUFHSkEsRUFBSUEsRUFBRSxHQUFLMUcsRUFBUzBFLE1BQU12QixPQUFTLEVBQUV1RCxFQUFFLE9BTzNDLElBRkFVLEVBQU85RSxFQUFLakIsS0FBSyxRQUFVOEQsS0FBSzZCLElBQUlHLEdBRS9CbkIsRUFBRSxFQUFFVSxFQUFFdEcsRUFBTTJCLE1BQU1pRSxFQUFFaEcsRUFBUzBFLE1BQU12QixPQUFPNkMsSUFBSyxDQUloRCxHQUZBYyxFQUFNOUcsRUFBUzBFLE1BQU1lLEdBQUdpQixHQUVwQkEsR0FBS3RHLEVBQU0yQixPQUFTK0UsRUFBSXpGLEtBQUssU0FBV2lCLEVBQUtqQixLQUFLLFNBQVd5RixFQUFJekYsS0FBSyxVQUFZK0YsRUFBTSxDQUN4RnJGLEVBQVEyRSxFQUNSLE1BR0pBLEVBQUlBLEVBQUUsSUFBTSxFQUFJMUcsRUFBUzBFLE1BQU12QixPQUFPLEVBQUV1RCxFQUFFLEVBSTlDMUcsRUFBU3dCLFFBQVFoQixVQUFZdUIsR0FBTzNCLEVBQU11SCxRQUMxQzNILEVBQVNRLFNBQVN1QixFQUFPd0IsR0FHN0J2RCxFQUFTK0YsVUFBVWpDLEdBRW5CMUQsRUFBTW1ELElBQVVBLEVBQ2hCbkQsRUFBTXVILE9BQVU1RixFQUNoQjNCLEVBQU1pRCxPQUFVWixTQUFTTCxFQUFFa0IsTUFBTyxJQUNsQ2xELEVBQU1nSCxLQUFVQSxLQUdwQnJILEVBQUdnSCxLQUFLOUUsR0FBRyx1Q0FBd0MsU0FBU0csR0FFeEQsR0FBSXBDLEVBQVUsQ0FFVkEsRUFBUzRCLFVBQVVxRSxZQUFZLFdBRy9CakcsRUFBUzBFLE1BQU1lLEdBQUdyRixFQUFNMkIsT0FFeEIsSUFBSStFLEVBQW9CZCxFQUFHVSxFQUFsQjNFLEdBQVEsRUFFakIsR0FBaUIsR0FBYjNCLEVBQU1tRCxJQUFVLENBRWhCLElBQUt5QyxFQUFFLEVBQUVVLEVBQUV0RyxFQUFNMkIsTUFBTWlFLEVBQUVoRyxFQUFTMEUsTUFBTXZCLE9BQU82QyxJQUFLLENBSWhELEdBRkFjLEVBQU05RyxFQUFTMEUsTUFBTWUsR0FBR2lCLEdBRXBCQSxHQUFLdEcsRUFBTTJCLE9BQVMrRSxFQUFJekYsS0FBSyxRQUFVakIsRUFBTWdILEtBQU0sQ0FDbkRyRixFQUFRMkUsRUFDUixNQUdKQSxFQUFJQSxFQUFFLEdBQUsxRyxFQUFTMEUsTUFBTXZCLE9BQVMsRUFBRXVELEVBQUUsRUFFdEMxRyxFQUFTd0IsUUFBUWhCLFVBQWF1QixJQUMvQkEsRUFBUS9CLEVBQVMwRSxNQUFNdkIsWUFHeEIsQ0FFSCxJQUFLNkMsRUFBRSxFQUFFVSxFQUFFdEcsRUFBTTJCLE1BQU1pRSxFQUFFaEcsRUFBUzBFLE1BQU12QixPQUFPNkMsSUFBSyxDQUloRCxHQUZBYyxFQUFNOUcsRUFBUzBFLE1BQU1lLEdBQUdpQixHQUVwQkEsR0FBS3RHLEVBQU0yQixPQUFTK0UsRUFBSXpGLEtBQUssUUFBVWpCLEVBQU1nSCxLQUFNLENBQ25EckYsRUFBUTJFLEVBQ1IsTUFHSkEsRUFBSUEsRUFBRSxJQUFNLEVBQUkxRyxFQUFTMEUsTUFBTXZCLE9BQU8sRUFBRXVELEVBQUUsRUFFekMxRyxFQUFTd0IsUUFBUWhCLFVBQWF1QixJQUMvQkEsRUFBUSxHQUloQi9CLEVBQVN3QyxhQUFvQixJQUFSVCxFQUFnQkEsRUFBTTNCLEVBQU11SCxRQUlyRDNILEVBQVdDLEdBQVksSUFHcEJGLEVBQUd1QiIsImZpbGUiOiJjb21wb25lbnRzL3NsaWRlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qISBVSWtpdCAyLjI3LjIgfCBodHRwOi8vd3d3LmdldHVpa2l0LmNvbSB8IChjKSAyMDE0IFlPT3RoZW1lIHwgTUlUIExpY2Vuc2UgKi9cclxuKGZ1bmN0aW9uKGFkZG9uKSB7XHJcblxyXG4gICAgdmFyIGNvbXBvbmVudDtcclxuXHJcbiAgICBpZiAod2luZG93LlVJa2l0Mikge1xyXG4gICAgICAgIGNvbXBvbmVudCA9IGFkZG9uKFVJa2l0Mik7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHR5cGVvZiBkZWZpbmUgPT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7XHJcbiAgICAgICAgZGVmaW5lKCd1aWtpdC1zbGlkZXInLCBbJ3Vpa2l0J10sIGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIHJldHVybiBjb21wb25lbnQgfHwgYWRkb24oVUlraXQyKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbn0pKGZ1bmN0aW9uKFVJKXtcclxuXHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuXHJcbiAgICB2YXIgZHJhZ2dpbmcsIGRlbGF5SWRsZSwgYW5jaG9yLCBkcmFnZ2VkLCBzdG9yZSA9IHt9O1xyXG5cclxuICAgIFVJLmNvbXBvbmVudCgnc2xpZGVyJywge1xyXG5cclxuICAgICAgICBkZWZhdWx0czoge1xyXG4gICAgICAgICAgICBjZW50ZXIgICAgICAgICAgIDogZmFsc2UsXHJcbiAgICAgICAgICAgIHRocmVzaG9sZCAgICAgICAgOiAxMCxcclxuICAgICAgICAgICAgaW5maW5pdGUgICAgICAgICA6IHRydWUsXHJcbiAgICAgICAgICAgIGF1dG9wbGF5ICAgICAgICAgOiBmYWxzZSxcclxuICAgICAgICAgICAgYXV0b3BsYXlJbnRlcnZhbCA6IDcwMDAsXHJcbiAgICAgICAgICAgIHBhdXNlT25Ib3ZlciAgICAgOiB0cnVlLFxyXG4gICAgICAgICAgICBhY3RpdmVjbHMgICAgICAgIDogJ3VrLWFjdGl2ZSdcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBib290OiAgZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgICAgICAvLyBpbml0IGNvZGVcclxuICAgICAgICAgICAgVUkucmVhZHkoZnVuY3Rpb24oY29udGV4dCkge1xyXG5cclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgVUkuJCgnW2RhdGEtdWstc2xpZGVyXScsIGNvbnRleHQpLmVhY2goZnVuY3Rpb24oKXtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlbGUgPSBVSS4kKHRoaXMpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFlbGUuZGF0YSgnc2xpZGVyJykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFVJLnNsaWRlcihlbGUsIFVJLlV0aWxzLm9wdGlvbnMoZWxlLmF0dHIoJ2RhdGEtdWstc2xpZGVyJykpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIH0sIDApO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBpbml0OiBmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciAkdGhpcyA9IHRoaXM7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lciA9IHRoaXMuZWxlbWVudC5maW5kKCcudWstc2xpZGVyJyk7XHJcbiAgICAgICAgICAgIHRoaXMuZm9jdXMgICAgID0gMDtcclxuXHJcbiAgICAgICAgICAgIFVJLiR3aW4ub24oJ3Jlc2l6ZSBsb2FkJywgVUkuVXRpbHMuZGVib3VuY2UoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAkdGhpcy51cGRhdGUodHJ1ZSk7XHJcbiAgICAgICAgICAgIH0sIDEwMCkpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5vbignY2xpY2sudWsuc2xpZGVyJywgJ1tkYXRhLXVrLXNsaWRlci1pdGVtXScsIGZ1bmN0aW9uKGUpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBVSS4kKHRoaXMpLmF0dHIoJ2RhdGEtdWstc2xpZGVyLWl0ZW0nKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoJHRoaXMuZm9jdXMgPT0gaXRlbSkgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIHN0b3AgYXV0b3BsYXlcclxuICAgICAgICAgICAgICAgICR0aGlzLnN0b3AoKTtcclxuXHJcbiAgICAgICAgICAgICAgICBzd2l0Y2goaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ25leHQnOlxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3ByZXZpb3VzJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXNbaXRlbT09J25leHQnID8gJ25leHQnOidwcmV2aW91cyddKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLnVwZGF0ZUZvY3VzKHBhcnNlSW50KGl0ZW0sIDEwKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5jb250YWluZXIub24oe1xyXG5cclxuICAgICAgICAgICAgICAgICd0b3VjaHN0YXJ0IG1vdXNlZG93bic6IGZ1bmN0aW9uKGV2dCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoZXZ0Lm9yaWdpbmFsRXZlbnQgJiYgZXZ0Lm9yaWdpbmFsRXZlbnQudG91Y2hlcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBldnQgPSBldnQub3JpZ2luYWxFdmVudC50b3VjaGVzWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gaWdub3JlIHJpZ2h0IGNsaWNrIGJ1dHRvblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChldnQuYnV0dG9uICYmIGV2dC5idXR0b249PTIgfHwgISR0aGlzLmFjdGl2ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBzdG9wIGF1dG9wbGF5XHJcbiAgICAgICAgICAgICAgICAgICAgJHRoaXMuc3RvcCgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBhbmNob3IgID0gVUkuJChldnQudGFyZ2V0KS5pcygnYScpID8gVUkuJChldnQudGFyZ2V0KSA6IFVJLiQoZXZ0LnRhcmdldCkucGFyZW50cygnYTpmaXJzdCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIGRyYWdnZWQgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFuY2hvci5sZW5ndGgpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuY2hvci5vbmUoJ2NsaWNrJywgZnVuY3Rpb24oZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZHJhZ2dlZCkgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGRlbGF5SWRsZSA9IGZ1bmN0aW9uKGUpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyYWdnZWQgID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZHJhZ2dpbmcgPSAkdGhpcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3RvcmUgICAgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3VjaHggOiBwYXJzZUludChlLnBhZ2VYLCAxMCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXIgICAgOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9jdXMgIDogJHRoaXMuZm9jdXMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYXNlICAgOiAkdGhpcy5vcHRpb25zLmNlbnRlciA/ICdjZW50ZXInOidhcmVhJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUub3JpZ2luYWxFdmVudCAmJiBlLm9yaWdpbmFsRXZlbnQudG91Y2hlcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9IGUub3JpZ2luYWxFdmVudC50b3VjaGVzWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkcmFnZ2luZy5lbGVtZW50LmRhdGEoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3BvaW50ZXItc3RhcnQnOiB7eDogcGFyc2VJbnQoZS5wYWdlWCwgMTApLCB5OiBwYXJzZUludChlLnBhZ2VZLCAxMCl9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3BvaW50ZXItcG9zLXN0YXJ0JzogJHRoaXMucG9zXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMuY29udGFpbmVyLmFkZENsYXNzKCd1ay1kcmFnJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxheUlkbGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBkZWxheUlkbGUueCAgICAgICAgID0gcGFyc2VJbnQoZXZ0LnBhZ2VYLCAxMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVsYXlJZGxlLnRocmVzaG9sZCA9ICR0aGlzLm9wdGlvbnMudGhyZXNob2xkO1xyXG5cclxuICAgICAgICAgICAgICAgIH0sXHJcblxyXG4gICAgICAgICAgICAgICAgbW91c2VlbnRlcjogZnVuY3Rpb24oKSB7IGlmICgkdGhpcy5vcHRpb25zLnBhdXNlT25Ib3ZlcikgJHRoaXMuaG92ZXJpbmcgPSB0cnVlOyAgfSxcclxuICAgICAgICAgICAgICAgIG1vdXNlbGVhdmU6IGZ1bmN0aW9uKCkgeyAkdGhpcy5ob3ZlcmluZyA9IGZhbHNlOyB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy51cGRhdGUodHJ1ZSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLm9uKCdkaXNwbGF5LnVrLmNoZWNrJywgZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgIGlmICgkdGhpcy5lbGVtZW50LmlzKFwiOnZpc2libGVcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAkdGhpcy51cGRhdGUodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgLy8gcHJldmVudCBkcmFnZ2luZyBsaW5rcyArIGltYWdlc1xyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuZmluZCgnYSxpbWcnKS5hdHRyKCdkcmFnZ2FibGUnLCAnZmFsc2UnKTtcclxuXHJcbiAgICAgICAgICAgIC8vIFNldCBhdXRvcGxheVxyXG4gICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmF1dG9wbGF5KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0KCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIFVJLmRvbU9ic2VydmUodGhpcy5lbGVtZW50LCBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoJHRoaXMuZWxlbWVudC5jaGlsZHJlbignOm5vdChbZGF0YS1zbGlkZXItc2xpZGVdKScpLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICR0aGlzLnVwZGF0ZSh0cnVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIHVwZGF0ZTogZnVuY3Rpb24oZm9jdXMpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciAkdGhpcyA9IHRoaXMsIHBvcyA9IDAsIG1heGhlaWdodCA9IDAsIGl0ZW0sIHdpZHRoLCBjd2lkdGgsIHNpemU7XHJcblxyXG4gICAgICAgICAgICB0aGlzLml0ZW1zID0gdGhpcy5jb250YWluZXIuY2hpbGRyZW4oKS5maWx0ZXIoJzp2aXNpYmxlJyk7XHJcbiAgICAgICAgICAgIHRoaXMudnAgICAgPSB0aGlzLmVsZW1lbnRbMF0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGg7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5jc3MoeydtaW4td2lkdGgnOiAnJywgJ21pbi1oZWlnaHQnOiAnJ30pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5pdGVtcy5lYWNoKGZ1bmN0aW9uKGlkeCl7XHJcblxyXG4gICAgICAgICAgICAgICAgaXRlbSAgICAgID0gVUkuJCh0aGlzKS5hdHRyKCdkYXRhLXNsaWRlci1zbGlkZScsIGlkeCk7XHJcbiAgICAgICAgICAgICAgICBzaXplICAgICAgPSBpdGVtLmNzcyh7J2xlZnQnOiAnJywgJ3dpZHRoJzonJ30pWzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICAgICAgICAgICAgd2lkdGggICAgID0gc2l6ZS53aWR0aDtcclxuICAgICAgICAgICAgICAgIGN3aWR0aCAgICA9IGl0ZW0ud2lkdGgoKTtcclxuICAgICAgICAgICAgICAgIG1heGhlaWdodCA9IE1hdGgubWF4KG1heGhlaWdodCwgc2l6ZS5oZWlnaHQpO1xyXG5cclxuICAgICAgICAgICAgICAgIGl0ZW0uY3NzKHsnbGVmdCc6IHBvcywgJ3dpZHRoJzp3aWR0aH0pLmRhdGEoeydpZHgnOmlkeCwgJ2xlZnQnOiBwb3MsICd3aWR0aCc6IHdpZHRoLCAnY3dpZHRoJzpjd2lkdGgsICdhcmVhJzogKHBvcyt3aWR0aCksICdjZW50ZXInOihwb3MgLSAoJHRoaXMudnAvMiAtIGN3aWR0aC8yKSl9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBwb3MgKz0gd2lkdGg7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5jb250YWluZXIuY3NzKHsnbWluLXdpZHRoJzogcG9zLCAnbWluLWhlaWdodCc6IG1heGhlaWdodH0pO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5pbmZpbml0ZSAmJiAocG9zIDw9ICgyKnRoaXMudnApIHx8IHRoaXMuaXRlbXMubGVuZ3RoIDwgNSkgJiYgIXRoaXMuaXRlbXNSZXNpemVkKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gZmlsbCB3aXRoIGNsb25lZCBpdGVtc1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXIuY2hpbGRyZW4oKS5lYWNoKGZ1bmN0aW9uKGlkeCl7XHJcbiAgICAgICAgICAgICAgICAgICAkdGhpcy5jb250YWluZXIuYXBwZW5kKCR0aGlzLml0ZW1zLmVxKGlkeCkuY2xvbmUodHJ1ZSkuYXR0cignaWQnLCAnJykpO1xyXG4gICAgICAgICAgICAgICAgfSkuZWFjaChmdW5jdGlvbihpZHgpe1xyXG4gICAgICAgICAgICAgICAgICAgJHRoaXMuY29udGFpbmVyLmFwcGVuZCgkdGhpcy5pdGVtcy5lcShpZHgpLmNsb25lKHRydWUpLmF0dHIoJ2lkJywgJycpKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuaXRlbXNSZXNpemVkID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy51cGRhdGUoKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5jdyAgICAgPSBwb3M7XHJcbiAgICAgICAgICAgIHRoaXMucG9zICAgID0gMDtcclxuICAgICAgICAgICAgdGhpcy5hY3RpdmUgPSBwb3MgPj0gdGhpcy52cDtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmNzcyh7XHJcbiAgICAgICAgICAgICAgICAnLW1zLXRyYW5zZm9ybSc6ICcnLFxyXG4gICAgICAgICAgICAgICAgJy13ZWJraXQtdHJhbnNmb3JtJzogJycsXHJcbiAgICAgICAgICAgICAgICAndHJhbnNmb3JtJzogJydcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBpZiAoZm9jdXMpIHRoaXMudXBkYXRlRm9jdXModGhpcy5mb2N1cyk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgdXBkYXRlUG9zOiBmdW5jdGlvbihwb3MpIHtcclxuICAgICAgICAgICAgdGhpcy5wb3MgPSBwb3M7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmNzcyh7XHJcbiAgICAgICAgICAgICAgICAnLW1zLXRyYW5zZm9ybSc6ICd0cmFuc2xhdGVYKCcrcG9zKydweCknLFxyXG4gICAgICAgICAgICAgICAgJy13ZWJraXQtdHJhbnNmb3JtJzogJ3RyYW5zbGF0ZVgoJytwb3MrJ3B4KScsXHJcbiAgICAgICAgICAgICAgICAndHJhbnNmb3JtJzogJ3RyYW5zbGF0ZVgoJytwb3MrJ3B4KSdcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgdXBkYXRlRm9jdXM6IGZ1bmN0aW9uKGlkeCwgZGlyKSB7XHJcblxyXG4gICAgICAgICAgICBpZiAoIXRoaXMuYWN0aXZlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGRpciA9IGRpciB8fCAoaWR4ID4gdGhpcy5mb2N1cyA/IDE6LTEpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGl0ZW0gPSB0aGlzLml0ZW1zLmVxKGlkeCksIGFyZWEsIGk7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmluZmluaXRlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmluZmluaXRlKGlkeCwgZGlyKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5jZW50ZXIpIHtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVBvcyhpdGVtLmRhdGEoJ2NlbnRlcicpKi0xKTtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLml0ZW1zLmZpbHRlcignLicrdGhpcy5vcHRpb25zLmFjdGl2ZWNscykucmVtb3ZlQ2xhc3ModGhpcy5vcHRpb25zLmFjdGl2ZWNscyk7XHJcbiAgICAgICAgICAgICAgICBpdGVtLmFkZENsYXNzKHRoaXMub3B0aW9ucy5hY3RpdmVjbHMpO1xyXG5cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmluZmluaXRlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlUG9zKGl0ZW0uZGF0YSgnbGVmdCcpKi0xKTtcclxuXHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBhcmVhID0gMDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZm9yIChpPWlkeDtpPHRoaXMuaXRlbXMubGVuZ3RoO2krKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcmVhICs9IHRoaXMuaXRlbXMuZXEoaSkuZGF0YSgnd2lkdGgnKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoYXJlYSA+IHRoaXMudnApIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlUG9zKGl0ZW0uZGF0YSgnbGVmdCcpKi0xKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkaXIgPT0gMSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZWEgPSAwO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaT10aGlzLml0ZW1zLmxlbmd0aC0xO2k+PTA7aS0tKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZWEgKz0gdGhpcy5pdGVtcy5lcShpKS5kYXRhKCd3aWR0aCcpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXJlYSA9PSB0aGlzLnZwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkeCA9IGk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFyZWEgPiB0aGlzLnZwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkeCA9IChpIDwgdGhpcy5pdGVtcy5sZW5ndGgtMSkgPyBpKzEgOiBpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFyZWEgPiB0aGlzLnZwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVQb3MoKHRoaXMuY29udGFpbmVyLndpZHRoKCkgLSB0aGlzLnZwKSAqIC0xKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVQb3ModGhpcy5pdGVtcy5lcShpZHgpLmRhdGEoJ2xlZnQnKSotMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIG1hcmsgZWxlbWVudHNcclxuICAgICAgICAgICAgdmFyIGxlZnQgPSB0aGlzLml0ZW1zLmVxKGlkeCkuZGF0YSgnbGVmdCcpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5pdGVtcy5yZW1vdmVDbGFzcygndWstc2xpZGUtYmVmb3JlIHVrLXNsaWRlLWFmdGVyJykuZWFjaChmdW5jdGlvbihpKXtcclxuICAgICAgICAgICAgICAgIGlmIChpIT09aWR4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgVUkuJCh0aGlzKS5hZGRDbGFzcyhVSS4kKHRoaXMpLmRhdGEoJ2xlZnQnKSA8IGxlZnQgPyAndWstc2xpZGUtYmVmb3JlJzondWstc2xpZGUtYWZ0ZXInKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmZvY3VzID0gaWR4O1xyXG5cclxuICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCdmb2N1c2l0ZW0udWsuc2xpZGVyJywgW2lkeCx0aGlzLml0ZW1zLmVxKGlkeCksdGhpc10pO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIG5leHQ6IGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICAgICAgdmFyIGZvY3VzID0gdGhpcy5pdGVtc1t0aGlzLmZvY3VzICsgMV0gPyAodGhpcy5mb2N1cyArIDEpIDogKHRoaXMub3B0aW9ucy5pbmZpbml0ZSA/IDA6dGhpcy5mb2N1cyk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUZvY3VzKGZvY3VzLCAxKTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBwcmV2aW91czogZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgZm9jdXMgPSB0aGlzLml0ZW1zW3RoaXMuZm9jdXMgLSAxXSA/ICh0aGlzLmZvY3VzIC0gMSkgOiAodGhpcy5vcHRpb25zLmluZmluaXRlID8gKHRoaXMuaXRlbXNbdGhpcy5mb2N1cyAtIDFdID8gdGhpcy5pdGVtcy0xOnRoaXMuaXRlbXMubGVuZ3RoLTEpOnRoaXMuZm9jdXMpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy51cGRhdGVGb2N1cyhmb2N1cywgLTEpO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIHN0YXJ0OiBmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuc3RvcCgpO1xyXG5cclxuICAgICAgICAgICAgdmFyICR0aGlzID0gdGhpcztcclxuXHJcbiAgICAgICAgICAgIHRoaXMuaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIGlmICghJHRoaXMuaG92ZXJpbmcpICR0aGlzLm5leHQoKTtcclxuICAgICAgICAgICAgfSwgdGhpcy5vcHRpb25zLmF1dG9wbGF5SW50ZXJ2YWwpO1xyXG5cclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBzdG9wOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuaW50ZXJ2YWwpIGNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbCk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgaW5maW5pdGU6IGZ1bmN0aW9uKGJhc2VpZHgsIGRpcmVjdGlvbikge1xyXG5cclxuICAgICAgICAgICAgdmFyICR0aGlzID0gdGhpcywgaXRlbSA9IHRoaXMuaXRlbXMuZXEoYmFzZWlkeCksIGksIHogPSBiYXNlaWR4LCBtb3ZlID0gW10sIGFyZWEgPSAwO1xyXG5cclxuICAgICAgICAgICAgaWYgKGRpcmVjdGlvbiA9PSAxKSB7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIGZvciAoaT0wO2k8dGhpcy5pdGVtcy5sZW5ndGg7aSsrKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh6ICE9IGJhc2VpZHgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJlYSArPSB0aGlzLml0ZW1zLmVxKHopLmRhdGEoJ3dpZHRoJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vdmUucHVzaCh0aGlzLml0ZW1zLmVxKHopKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhcmVhID4gdGhpcy52cCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHogPSB6KzEgPT0gdGhpcy5pdGVtcy5sZW5ndGggPyAwOnorMTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAobW92ZS5sZW5ndGgpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgbW92ZS5mb3JFYWNoKGZ1bmN0aW9uKGl0bSl7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbGVmdCA9IGl0ZW0uZGF0YSgnYXJlYScpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaXRtLmNzcyh7J2xlZnQnOiBsZWZ0fSkuZGF0YSh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0ICA6IGxlZnQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmVhICA6IChsZWZ0K2l0bS5kYXRhKCd3aWR0aCcpKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNlbnRlcjogKGxlZnQgLSAoJHRoaXMudnAvMiAtIGl0bS5kYXRhKCdjd2lkdGgnKS8yKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtID0gaXRtO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yIChpPXRoaXMuaXRlbXMubGVuZ3RoLTE7aSA+LTEgO2ktLSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBhcmVhICs9IHRoaXMuaXRlbXMuZXEoeikuZGF0YSgnd2lkdGgnKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHogIT0gYmFzZWlkeCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtb3ZlLnB1c2godGhpcy5pdGVtcy5lcSh6KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoYXJlYSA+IHRoaXMudnApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICB6ID0gei0xID09IC0xID8gdGhpcy5pdGVtcy5sZW5ndGgtMTp6LTE7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKG1vdmUubGVuZ3RoKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIG1vdmUuZm9yRWFjaChmdW5jdGlvbihpdG0pe1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxlZnQgPSBpdGVtLmRhdGEoJ2xlZnQnKSAtIGl0bS5kYXRhKCd3aWR0aCcpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaXRtLmNzcyh7J2xlZnQnOiBsZWZ0fSkuZGF0YSh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0ICA6IGxlZnQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmVhICA6IChsZWZ0K2l0bS5kYXRhKCd3aWR0aCcpKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNlbnRlcjogKGxlZnQgLSAoJHRoaXMudnAvMiAtIGl0bS5kYXRhKCdjd2lkdGgnKS8yKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtID0gaXRtO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gaGFuZGxlIGRyYWdnaW5nXHJcbiAgICBVSS4kZG9jLm9uKCdtb3VzZW1vdmUudWsuc2xpZGVyIHRvdWNobW92ZS51ay5zbGlkZXInLCBmdW5jdGlvbihlKSB7XHJcblxyXG4gICAgICAgIGlmIChlLm9yaWdpbmFsRXZlbnQgJiYgZS5vcmlnaW5hbEV2ZW50LnRvdWNoZXMpIHtcclxuICAgICAgICAgICAgZSA9IGUub3JpZ2luYWxFdmVudC50b3VjaGVzWzBdO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGRlbGF5SWRsZSAmJiBNYXRoLmFicyhlLnBhZ2VYIC0gZGVsYXlJZGxlLngpID4gZGVsYXlJZGxlLnRocmVzaG9sZCkge1xyXG5cclxuICAgICAgICAgICAgaWYgKCF3aW5kb3cuZ2V0U2VsZWN0aW9uKCkudG9TdHJpbmcoKSkge1xyXG4gICAgICAgICAgICAgICAgZGVsYXlJZGxlKGUpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZHJhZ2dpbmcgPSBkZWxheUlkbGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCFkcmFnZ2luZykge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgeCwgeERpZmYsIHBvcywgZGlyLCBmb2N1cywgaXRlbSwgbmV4dCwgZGlmZiwgaSwgeiwgaXRtO1xyXG5cclxuICAgICAgICBpZiAoZS5jbGllbnRYIHx8IGUuY2xpZW50WSkge1xyXG4gICAgICAgICAgICB4ID0gZS5jbGllbnRYO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoZS5wYWdlWCB8fCBlLnBhZ2VZKSB7XHJcbiAgICAgICAgICAgIHggPSBlLnBhZ2VYIC0gZG9jdW1lbnQuYm9keS5zY3JvbGxMZWZ0IC0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbExlZnQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmb2N1cyA9IHN0b3JlLmZvY3VzO1xyXG4gICAgICAgIHhEaWZmID0geCAtIGRyYWdnaW5nLmVsZW1lbnQuZGF0YSgncG9pbnRlci1zdGFydCcpLng7XHJcbiAgICAgICAgcG9zICAgPSBkcmFnZ2luZy5lbGVtZW50LmRhdGEoJ3BvaW50ZXItcG9zLXN0YXJ0JykgKyB4RGlmZjtcclxuICAgICAgICBkaXIgICA9IHggPiBkcmFnZ2luZy5lbGVtZW50LmRhdGEoJ3BvaW50ZXItc3RhcnQnKS54ID8gLTE6MTtcclxuICAgICAgICBpdGVtICA9IGRyYWdnaW5nLml0ZW1zLmVxKHN0b3JlLmZvY3VzKTtcclxuXHJcbiAgICAgICAgaWYgKGRpciA9PSAxKSB7XHJcblxyXG4gICAgICAgICAgICBkaWZmID0gaXRlbS5kYXRhKCdsZWZ0JykgKyBNYXRoLmFicyh4RGlmZik7XHJcblxyXG4gICAgICAgICAgICBmb3IgKGk9MCx6PXN0b3JlLmZvY3VzO2k8ZHJhZ2dpbmcuaXRlbXMubGVuZ3RoO2krKykge1xyXG5cclxuICAgICAgICAgICAgICAgIGl0bSA9IGRyYWdnaW5nLml0ZW1zLmVxKHopO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh6ICE9IHN0b3JlLmZvY3VzICYmIGl0bS5kYXRhKCdsZWZ0JykgPCBkaWZmICYmIGl0bS5kYXRhKCdhcmVhJykgPiBkaWZmKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9jdXMgPSB6O1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHogPSB6KzEgPT0gZHJhZ2dpbmcuaXRlbXMubGVuZ3RoID8gMDp6KzE7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfSBlbHNlIHtcclxuXHJcbiAgICAgICAgICAgIGRpZmYgPSBpdGVtLmRhdGEoJ2xlZnQnKSAtIE1hdGguYWJzKHhEaWZmKTtcclxuXHJcbiAgICAgICAgICAgIGZvciAoaT0wLHo9c3RvcmUuZm9jdXM7aTxkcmFnZ2luZy5pdGVtcy5sZW5ndGg7aSsrKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgaXRtID0gZHJhZ2dpbmcuaXRlbXMuZXEoeik7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHogIT0gc3RvcmUuZm9jdXMgJiYgaXRtLmRhdGEoJ2FyZWEnKSA8PSBpdGVtLmRhdGEoJ2xlZnQnKSAmJiBpdG0uZGF0YSgnY2VudGVyJykgPCBkaWZmKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9jdXMgPSB6O1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHogPSB6LTEgPT0gLTEgPyBkcmFnZ2luZy5pdGVtcy5sZW5ndGgtMTp6LTE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChkcmFnZ2luZy5vcHRpb25zLmluZmluaXRlICYmIGZvY3VzIT1zdG9yZS5fZm9jdXMpIHtcclxuICAgICAgICAgICAgZHJhZ2dpbmcuaW5maW5pdGUoZm9jdXMsIGRpcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBkcmFnZ2luZy51cGRhdGVQb3MocG9zKTtcclxuXHJcbiAgICAgICAgc3RvcmUuZGlyICAgICA9IGRpcjtcclxuICAgICAgICBzdG9yZS5fZm9jdXMgID0gZm9jdXM7XHJcbiAgICAgICAgc3RvcmUudG91Y2h4ICA9IHBhcnNlSW50KGUucGFnZVgsIDEwKTtcclxuICAgICAgICBzdG9yZS5kaWZmICAgID0gZGlmZjtcclxuICAgIH0pO1xyXG5cclxuICAgIFVJLiRkb2Mub24oJ21vdXNldXAudWsuc2xpZGVyIHRvdWNoZW5kLnVrLnNsaWRlcicsIGZ1bmN0aW9uKGUpIHtcclxuXHJcbiAgICAgICAgaWYgKGRyYWdnaW5nKSB7XHJcblxyXG4gICAgICAgICAgICBkcmFnZ2luZy5jb250YWluZXIucmVtb3ZlQ2xhc3MoJ3VrLWRyYWcnKTtcclxuXHJcbiAgICAgICAgICAgIC8vIFRPRE8gaXMgdGhpcyBuZWVkZWQ/XHJcbiAgICAgICAgICAgIGRyYWdnaW5nLml0ZW1zLmVxKHN0b3JlLmZvY3VzKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBpdG0sIGZvY3VzID0gZmFsc2UsIGksIHo7XHJcblxyXG4gICAgICAgICAgICBpZiAoc3RvcmUuZGlyID09IDEpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBmb3IgKGk9MCx6PXN0b3JlLmZvY3VzO2k8ZHJhZ2dpbmcuaXRlbXMubGVuZ3RoO2krKykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpdG0gPSBkcmFnZ2luZy5pdGVtcy5lcSh6KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHogIT0gc3RvcmUuZm9jdXMgJiYgaXRtLmRhdGEoJ2xlZnQnKSA+IHN0b3JlLmRpZmYpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9jdXMgPSB6O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHogPSB6KzEgPT0gZHJhZ2dpbmcuaXRlbXMubGVuZ3RoID8gMDp6KzE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoIWRyYWdnaW5nLm9wdGlvbnMuaW5maW5pdGUgJiYgIWZvY3VzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9jdXMgPSBkcmFnZ2luZy5pdGVtcy5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgICAgIGZvciAoaT0wLHo9c3RvcmUuZm9jdXM7aTxkcmFnZ2luZy5pdGVtcy5sZW5ndGg7aSsrKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGl0bSA9IGRyYWdnaW5nLml0ZW1zLmVxKHopO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoeiAhPSBzdG9yZS5mb2N1cyAmJiBpdG0uZGF0YSgnbGVmdCcpIDwgc3RvcmUuZGlmZikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb2N1cyA9IHo7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgeiA9IHotMSA9PSAtMSA/IGRyYWdnaW5nLml0ZW1zLmxlbmd0aC0xOnotMTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICghZHJhZ2dpbmcub3B0aW9ucy5pbmZpbml0ZSAmJiAhZm9jdXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBmb2N1cyA9IDBcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZHJhZ2dpbmcudXBkYXRlRm9jdXMoZm9jdXMhPT1mYWxzZSA/IGZvY3VzOnN0b3JlLl9mb2N1cyk7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZHJhZ2dpbmcgPSBkZWxheUlkbGUgPSBmYWxzZTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBVSS5zbGlkZXI7XHJcbn0pOyJdfQ==
