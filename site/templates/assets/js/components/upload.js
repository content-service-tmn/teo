!function(e){var t;window.UIkit2&&(t=e(UIkit2)),"function"==typeof define&&define.amd&&define("uikit-upload",["uikit"],function(){return t||e(UIkit2)})}(function(d){"use strict";var e,t;function f(n,o){if(!d.support.ajaxupload)return this;if(o=d.$.extend({},f.defaults,o),n.length){if("*.*"!==o.allow)for(var e,t=0;e=n[t];t++)if(!p(o.allow,e.name))return void("string"==typeof o.notallowed?alert(o.notallowed):o.notallowed(e,o));var a=o.complete;if(o.single){var r=n.length,i=0,l=!0;o.beforeAll(n),o.complete=function(e,t){i+=1,a(e,t),o.filelimit&&i>=o.filelimit&&(l=!1),l&&i<r?s([n[i]],o):o.allcomplete(e,t)},s([n[0]],o)}else o.complete=function(e,t){a(e,t),o.allcomplete(e,t)},s(n,o)}function s(e,n){var t=new FormData,o=new XMLHttpRequest;if(!1!==n.before(n,e)){for(var a,r=0;a=e[r];r++)t.append(n.param,a);for(var i in n.params)t.append(i,n.params[i]);for(var l in o.upload.addEventListener("progress",function(e){var t=e.loaded/e.total*100;n.progress(t,e)},!1),o.addEventListener("loadstart",function(e){n.loadstart(e)},!1),o.addEventListener("load",function(e){n.load(e)},!1),o.addEventListener("loadend",function(e){n.loadend(e)},!1),o.addEventListener("error",function(e){n.error(e)},!1),o.addEventListener("abort",function(e){n.abort(e)},!1),o.open(n.method,n.action,!0),"json"==n.type&&o.setRequestHeader("Accept","application/json"),n.headers)o.setRequestHeader(l,n.headers[l]);o.onreadystatechange=function(){if(n.readystatechange(o),4==o.readyState){var t=o.responseText;if("json"==n.type)try{t=d.$.parseJSON(t)}catch(e){t=!1}n.complete(t,o)}},n.beforeSend(o),o.send(t)}}}function p(e,t){var n="^"+e.replace(/\//g,"\\/").replace(/\*\*/g,"(\\/[^\\/]+)*").replace(/\*/g,"[^\\/]+").replace(/((?!\\))\?/g,"$1.")+"$";return n="^"+n+"$",null!==t.match(new RegExp(n,"i"))}return d.component("uploadSelect",{init:function(){var t=this;this.on("change",function(){f(t.element[0].files,t.options);var e=t.element.clone(!0).data("uploadSelect",t);t.element.replaceWith(e),t.element=e})}}),d.component("uploadDrop",{defaults:{dragoverClass:"uk-dragover"},init:function(){var t=this,n=!1;this.on("drop",function(e){e.originalEvent.dataTransfer&&e.originalEvent.dataTransfer.files&&(e.stopPropagation(),e.preventDefault(),t.element.removeClass(t.options.dragoverClass),t.element.trigger("dropped.uk.upload",[e.originalEvent.dataTransfer.files]),f(e.originalEvent.dataTransfer.files,t.options))}).on("dragenter",function(e){e.stopPropagation(),e.preventDefault()}).on("dragover",function(e){e.stopPropagation(),e.preventDefault(),n||(t.element.addClass(t.options.dragoverClass),n=!0)}).on("dragleave",function(e){e.stopPropagation(),e.preventDefault(),t.element.removeClass(t.options.dragoverClass),n=!1})}}),d.support.ajaxupload=((t=document.createElement("INPUT")).type="file","files"in t&&!!((e=new XMLHttpRequest)&&"upload"in e&&"onprogress"in e.upload)&&!!window.FormData),f.defaults={action:"",single:!0,method:"POST",param:"files[]",params:{},allow:"*.*",type:"text",filelimit:!1,headers:{},before:function(e){},beforeSend:function(e){},beforeAll:function(){},loadstart:function(){},load:function(){},loadend:function(){},error:function(){},abort:function(){},progress:function(){},complete:function(){},allcomplete:function(){},readystatechange:function(){},notallowed:function(e,t){alert("Only the following file types are allowed: "+t.allow)}},d.Utils.xhrupload=f});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvdXBsb2FkLmpzIl0sIm5hbWVzIjpbImFkZG9uIiwiY29tcG9uZW50Iiwid2luZG93IiwiVUlraXQyIiwiZGVmaW5lIiwiYW1kIiwiVUkiLCJ4aHIiLCJmaSIsInhocnVwbG9hZCIsImZpbGVzIiwic2V0dGluZ3MiLCJzdXBwb3J0IiwiYWpheHVwbG9hZCIsInRoaXMiLCIkIiwiZXh0ZW5kIiwiZGVmYXVsdHMiLCJsZW5ndGgiLCJhbGxvdyIsImZpbGUiLCJpIiwibWF0Y2hOYW1lIiwibmFtZSIsImFsZXJ0Iiwibm90YWxsb3dlZCIsImNvbXBsZXRlIiwic2luZ2xlIiwiY291bnQiLCJ1cGxvYWRlZCIsImJlZm9yZUFsbCIsInJlc3BvbnNlIiwiZmlsZWxpbWl0IiwidXBsb2FkIiwiYWxsY29tcGxldGUiLCJmb3JtRGF0YSIsIkZvcm1EYXRhIiwiWE1MSHR0cFJlcXVlc3QiLCJiZWZvcmUiLCJmIiwiYXBwZW5kIiwicGFyYW0iLCJwIiwicGFyYW1zIiwiaCIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwicGVyY2VudCIsImxvYWRlZCIsInRvdGFsIiwicHJvZ3Jlc3MiLCJsb2Fkc3RhcnQiLCJsb2FkIiwibG9hZGVuZCIsImVycm9yIiwiYWJvcnQiLCJvcGVuIiwibWV0aG9kIiwiYWN0aW9uIiwidHlwZSIsInNldFJlcXVlc3RIZWFkZXIiLCJoZWFkZXJzIiwib25yZWFkeXN0YXRlY2hhbmdlIiwicmVhZHlzdGF0ZWNoYW5nZSIsInJlYWR5U3RhdGUiLCJyZXNwb25zZVRleHQiLCJwYXJzZUpTT04iLCJiZWZvcmVTZW5kIiwic2VuZCIsInBhdHRlcm4iLCJwYXRoIiwicGFyc2VkUGF0dGVybiIsInJlcGxhY2UiLCJtYXRjaCIsIlJlZ0V4cCIsImluaXQiLCIkdGhpcyIsIm9uIiwiZWxlbWVudCIsIm9wdGlvbnMiLCJ0d2luIiwiY2xvbmUiLCJkYXRhIiwicmVwbGFjZVdpdGgiLCJkcmFnb3ZlckNsYXNzIiwiaGFzZHJhZ0NscyIsIm9yaWdpbmFsRXZlbnQiLCJkYXRhVHJhbnNmZXIiLCJzdG9wUHJvcGFnYXRpb24iLCJwcmV2ZW50RGVmYXVsdCIsInJlbW92ZUNsYXNzIiwidHJpZ2dlciIsImFkZENsYXNzIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwibyIsIlV0aWxzIl0sIm1hcHBpbmdzIjoiQ0FDQSxTQUFVQSxHQUVOLElBQUlDLEVBRUFDLE9BQU9DLFNBQ1BGLEVBQVlELEVBQU1HLFNBR0QsbUJBQVZDLFFBQXdCQSxPQUFPQyxLQUN0Q0QsT0FBTyxlQUFnQixDQUFDLFNBQVUsV0FDOUIsT0FBT0gsR0FBYUQsRUFBTUcsVUFWdEMsQ0FjRyxTQUFTRyxHQUVSLGFBNkR3QixJQU9aQyxFQUpBQyxFQWVaLFNBQVNDLEVBQVVDLEVBQU9DLEdBRXRCLElBQUtMLEVBQUdNLFFBQVFDLFdBQ1osT0FBT0MsS0FLWCxHQUZBSCxFQUFXTCxFQUFHUyxFQUFFQyxPQUFPLEdBQUlQLEVBQVVRLFNBQVVOLEdBRTFDRCxFQUFNUSxPQUFYLENBSUEsR0FBdUIsUUFBbkJQLEVBQVNRLE1BRVQsSUFBSSxJQUFRQyxFQUFKQyxFQUFFLEVBQU9ELEVBQUtWLEVBQU1XLEdBQUdBLElBRTNCLElBQUlDLEVBQVVYLEVBQVNRLE1BQU9DLEVBQUtHLE1BTy9CLFlBTGtDLGlCQUF4QlosRUFBbUIsV0FDMUJhLE1BQU1iLEVBQVNjLFlBRWZkLEVBQVNjLFdBQVdMLEVBQU1ULElBT3pDLElBQUllLEVBQVdmLEVBQVNlLFNBRXhCLEdBQUlmLEVBQVNnQixPQUFPLENBRWhCLElBQUlDLEVBQVdsQixFQUFNUSxPQUNqQlcsRUFBVyxFQUNYVixHQUFXLEVBRVhSLEVBQVNtQixVQUFVcEIsR0FFbkJDLEVBQVNlLFNBQVcsU0FBU0ssRUFBVXhCLEdBRW5Dc0IsR0FBc0IsRUFFdEJILEVBQVNLLEVBQVV4QixHQUVmSSxFQUFTcUIsV0FBYUgsR0FBWWxCLEVBQVNxQixZQUMzQ2IsR0FBUSxHQUdSQSxHQUFTVSxFQUFTRCxFQUNsQkssRUFBTyxDQUFDdkIsRUFBTW1CLElBQVlsQixHQUUxQkEsRUFBU3VCLFlBQVlILEVBQVV4QixJQUl2QzBCLEVBQU8sQ0FBQ3ZCLEVBQU0sSUFBS0MsUUFJdkJBLEVBQVNlLFNBQVcsU0FBU0ssRUFBVXhCLEdBQ25DbUIsRUFBU0ssRUFBVXhCLEdBQ25CSSxFQUFTdUIsWUFBWUgsRUFBVXhCLElBR25DMEIsRUFBT3ZCLEVBQU9DLEdBR2xCLFNBQVNzQixFQUFPdkIsRUFBT0MsR0FHbkIsSUFBSXdCLEVBQVcsSUFBSUMsU0FBWTdCLEVBQU0sSUFBSThCLGVBRXpDLElBQXVDLElBQW5DMUIsRUFBUzJCLE9BQU8zQixFQUFVRCxHQUE5QixDQUVBLElBQUssSUFBVzZCLEVBQVBsQixFQUFJLEVBQU1rQixFQUFJN0IsRUFBTVcsR0FBSUEsSUFBT2MsRUFBU0ssT0FBTzdCLEVBQVM4QixNQUFPRixHQUN4RSxJQUFLLElBQUlHLEtBQUsvQixFQUFTZ0MsT0FBVVIsRUFBU0ssT0FBT0UsRUFBRy9CLEVBQVNnQyxPQUFPRCxJQW9CcEUsSUFBSyxJQUFJRSxLQWpCVHJDLEVBQUkwQixPQUFPWSxpQkFBaUIsV0FBWSxTQUFTQyxHQUM3QyxJQUFJQyxFQUFXRCxFQUFFRSxPQUFTRixFQUFFRyxNQUFPLElBQ25DdEMsRUFBU3VDLFNBQVNILEVBQVNELEtBQzVCLEdBRUh2QyxFQUFJc0MsaUJBQWlCLFlBQWEsU0FBU0MsR0FBSW5DLEVBQVN3QyxVQUFVTCxLQUFPLEdBQ3pFdkMsRUFBSXNDLGlCQUFpQixPQUFhLFNBQVNDLEdBQUluQyxFQUFTeUMsS0FBS04sS0FBWSxHQUN6RXZDLEVBQUlzQyxpQkFBaUIsVUFBYSxTQUFTQyxHQUFJbkMsRUFBUzBDLFFBQVFQLEtBQVMsR0FDekV2QyxFQUFJc0MsaUJBQWlCLFFBQWEsU0FBU0MsR0FBSW5DLEVBQVMyQyxNQUFNUixLQUFXLEdBQ3pFdkMsRUFBSXNDLGlCQUFpQixRQUFhLFNBQVNDLEdBQUluQyxFQUFTNEMsTUFBTVQsS0FBVyxHQUV6RXZDLEVBQUlpRCxLQUFLN0MsRUFBUzhDLE9BQVE5QyxFQUFTK0MsUUFBUSxHQUV4QixRQUFmL0MsRUFBU2dELE1BQ1RwRCxFQUFJcUQsaUJBQWlCLFNBQVUsb0JBR3JCakQsRUFBU2tELFFBQ25CdEQsRUFBSXFELGlCQUFpQmhCLEVBQUdqQyxFQUFTa0QsUUFBUWpCLElBRzdDckMsRUFBSXVELG1CQUFxQixXQUlyQixHQUZBbkQsRUFBU29ELGlCQUFpQnhELEdBRU4sR0FBaEJBLEVBQUl5RCxXQUFjLENBRWxCLElBQUlqQyxFQUFXeEIsRUFBSTBELGFBRW5CLEdBQW1CLFFBQWZ0RCxFQUFTZ0QsS0FDVCxJQUNJNUIsRUFBV3pCLEVBQUdTLEVBQUVtRCxVQUFVbkMsR0FDNUIsTUFBTWUsR0FDSmYsR0FBVyxFQUluQnBCLEVBQVNlLFNBQVNLLEVBQVV4QixLQUdwQ0ksRUFBU3dELFdBQVc1RCxHQUNwQkEsRUFBSTZELEtBQUtqQyxLQStCakIsU0FBU2IsRUFBVStDLEVBQVNDLEdBRXhCLElBQUlDLEVBQWdCLElBQU1GLEVBQVFHLFFBQVEsTUFBTyxPQUM3Q0EsUUFBUSxRQUFTLGlCQUNqQkEsUUFBUSxNQUFPLFdBQ2ZBLFFBQVEsY0FBZSxPQUFTLElBSXBDLE9BRkFELEVBQWdCLElBQU1BLEVBQWdCLElBRWlCLE9BQS9DRCxFQUFLRyxNQUFNLElBQUlDLE9BQU9ILEVBQWUsTUFLakQsT0FqUEFqRSxFQUFHTCxVQUFVLGVBQWdCLENBRXpCMEUsS0FBTSxXQUVGLElBQUlDLEVBQVE5RCxLQUVaQSxLQUFLK0QsR0FBRyxTQUFVLFdBQ2RwRSxFQUFVbUUsRUFBTUUsUUFBUSxHQUFHcEUsTUFBT2tFLEVBQU1HLFNBQ3hDLElBQUlDLEVBQU9KLEVBQU1FLFFBQVFHLE9BQU0sR0FBTUMsS0FBSyxlQUFnQk4sR0FDMURBLEVBQU1FLFFBQVFLLFlBQVlILEdBQzFCSixFQUFNRSxRQUFVRSxPQUs1QjFFLEVBQUdMLFVBQVUsYUFBYyxDQUV2QmdCLFNBQVUsQ0FDTm1FLGNBQWlCLGVBR3JCVCxLQUFNLFdBRUYsSUFBSUMsRUFBUTlELEtBQU11RSxHQUFhLEVBRS9CdkUsS0FBSytELEdBQUcsT0FBUSxTQUFTL0IsR0FFakJBLEVBQUV3QyxjQUFjQyxjQUFnQnpDLEVBQUV3QyxjQUFjQyxhQUFhN0UsUUFFN0RvQyxFQUFFMEMsa0JBQ0YxQyxFQUFFMkMsaUJBRUZiLEVBQU1FLFFBQVFZLFlBQVlkLEVBQU1HLFFBQVFLLGVBQ3hDUixFQUFNRSxRQUFRYSxRQUFRLG9CQUFxQixDQUFDN0MsRUFBRXdDLGNBQWNDLGFBQWE3RSxRQUV6RUQsRUFBVXFDLEVBQUV3QyxjQUFjQyxhQUFhN0UsTUFBT2tFLEVBQU1HLFlBR3pERixHQUFHLFlBQWEsU0FBUy9CLEdBQ3hCQSxFQUFFMEMsa0JBQ0YxQyxFQUFFMkMsbUJBQ0haLEdBQUcsV0FBWSxTQUFTL0IsR0FDdkJBLEVBQUUwQyxrQkFDRjFDLEVBQUUyQyxpQkFFR0osSUFDRFQsRUFBTUUsUUFBUWMsU0FBU2hCLEVBQU1HLFFBQVFLLGVBQ3JDQyxHQUFhLEtBRWxCUixHQUFHLFlBQWEsU0FBUy9CLEdBQ3hCQSxFQUFFMEMsa0JBQ0YxQyxFQUFFMkMsaUJBQ0ZiLEVBQU1FLFFBQVFZLFlBQVlkLEVBQU1HLFFBQVFLLGVBQ3hDQyxHQUFhLE9BTXpCL0UsRUFBR00sUUFBUUMsYUFHQ0wsRUFBS3FGLFNBQVNDLGNBQWMsVUFBYW5DLEtBQU8sT0FBZSxVQUFXbkQsT0FJMUVELEVBQU0sSUFBSThCLGlCQUFxQyxXQUFZOUIsR0FBUyxlQUFnQkEsRUFBSTBCLFdBSWxGL0IsT0FBT2tDLFVBa0l6QjNCLEVBQVVRLFNBQVcsQ0FDakJ5QyxPQUFRLEdBQ1IvQixRQUFRLEVBQ1I4QixPQUFRLE9BQ1JoQixNQUFRLFVBQ1JFLE9BQVEsR0FDUnhCLE1BQVEsTUFDUndDLEtBQVEsT0FDUjNCLFdBQVcsRUFDWDZCLFFBQVMsR0FHVHZCLE9BQWtCLFNBQVN5RCxLQUMzQjVCLFdBQWtCLFNBQVM1RCxLQUMzQnVCLFVBQWtCLGFBQ2xCcUIsVUFBa0IsYUFDbEJDLEtBQWtCLGFBQ2xCQyxRQUFrQixhQUNsQkMsTUFBa0IsYUFDbEJDLE1BQWtCLGFBQ2xCTCxTQUFrQixhQUNsQnhCLFNBQWtCLGFBQ2xCUSxZQUFrQixhQUNsQjZCLGlCQUFrQixhQUNsQnRDLFdBQWtCLFNBQVNMLEVBQU1ULEdBQVdhLE1BQU0sOENBQThDYixFQUFTUSxTQWU3R2IsRUFBRzBGLE1BQU12RixVQUFZQSIsImZpbGUiOiJjb21wb25lbnRzL3VwbG9hZC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qISBVSWtpdCAyLjI3LjIgfCBodHRwOi8vd3d3LmdldHVpa2l0LmNvbSB8IChjKSAyMDE0IFlPT3RoZW1lIHwgTUlUIExpY2Vuc2UgKi9cclxuKGZ1bmN0aW9uKGFkZG9uKSB7XHJcblxyXG4gICAgdmFyIGNvbXBvbmVudDtcclxuXHJcbiAgICBpZiAod2luZG93LlVJa2l0Mikge1xyXG4gICAgICAgIGNvbXBvbmVudCA9IGFkZG9uKFVJa2l0Mik7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHR5cGVvZiBkZWZpbmUgPT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7XHJcbiAgICAgICAgZGVmaW5lKCd1aWtpdC11cGxvYWQnLCBbJ3Vpa2l0J10sIGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIHJldHVybiBjb21wb25lbnQgfHwgYWRkb24oVUlraXQyKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbn0pKGZ1bmN0aW9uKFVJKXtcclxuXHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuXHJcbiAgICBVSS5jb21wb25lbnQoJ3VwbG9hZFNlbGVjdCcsIHtcclxuXHJcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgJHRoaXMgPSB0aGlzO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5vbignY2hhbmdlJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICB4aHJ1cGxvYWQoJHRoaXMuZWxlbWVudFswXS5maWxlcywgJHRoaXMub3B0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgdHdpbiA9ICR0aGlzLmVsZW1lbnQuY2xvbmUodHJ1ZSkuZGF0YSgndXBsb2FkU2VsZWN0JywgJHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgJHRoaXMuZWxlbWVudC5yZXBsYWNlV2l0aCh0d2luKTtcclxuICAgICAgICAgICAgICAgICR0aGlzLmVsZW1lbnQgPSB0d2luO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBVSS5jb21wb25lbnQoJ3VwbG9hZERyb3AnLCB7XHJcblxyXG4gICAgICAgIGRlZmF1bHRzOiB7XHJcbiAgICAgICAgICAgICdkcmFnb3ZlckNsYXNzJzogJ3VrLWRyYWdvdmVyJ1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICAgICAgdmFyICR0aGlzID0gdGhpcywgaGFzZHJhZ0NscyA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5vbignZHJvcCcsIGZ1bmN0aW9uKGUpe1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChlLm9yaWdpbmFsRXZlbnQuZGF0YVRyYW5zZmVyICYmIGUub3JpZ2luYWxFdmVudC5kYXRhVHJhbnNmZXIuZmlsZXMpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICR0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoJHRoaXMub3B0aW9ucy5kcmFnb3ZlckNsYXNzKTtcclxuICAgICAgICAgICAgICAgICAgICAkdGhpcy5lbGVtZW50LnRyaWdnZXIoJ2Ryb3BwZWQudWsudXBsb2FkJywgW2Uub3JpZ2luYWxFdmVudC5kYXRhVHJhbnNmZXIuZmlsZXNdKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgeGhydXBsb2FkKGUub3JpZ2luYWxFdmVudC5kYXRhVHJhbnNmZXIuZmlsZXMsICR0aGlzLm9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfSkub24oJ2RyYWdlbnRlcicsIGZ1bmN0aW9uKGUpe1xyXG4gICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgfSkub24oJ2RyYWdvdmVyJywgZnVuY3Rpb24oZSl7XHJcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICghaGFzZHJhZ0Nscykge1xyXG4gICAgICAgICAgICAgICAgICAgICR0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoJHRoaXMub3B0aW9ucy5kcmFnb3ZlckNsYXNzKTtcclxuICAgICAgICAgICAgICAgICAgICBoYXNkcmFnQ2xzID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSkub24oJ2RyYWdsZWF2ZScsIGZ1bmN0aW9uKGUpe1xyXG4gICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgICR0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoJHRoaXMub3B0aW9ucy5kcmFnb3ZlckNsYXNzKTtcclxuICAgICAgICAgICAgICAgIGhhc2RyYWdDbHMgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG5cclxuICAgIFVJLnN1cHBvcnQuYWpheHVwbG9hZCA9IChmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc3VwcG9ydEZpbGVBUEkoKSB7XHJcbiAgICAgICAgICAgIHZhciBmaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ0lOUFVUJyk7IGZpLnR5cGUgPSAnZmlsZSc7IHJldHVybiAnZmlsZXMnIGluIGZpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc3VwcG9ydEFqYXhVcGxvYWRQcm9ncmVzc0V2ZW50cygpIHtcclxuICAgICAgICAgICAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOyByZXR1cm4gISEgKHhociAmJiAoJ3VwbG9hZCcgaW4geGhyKSAmJiAoJ29ucHJvZ3Jlc3MnIGluIHhoci51cGxvYWQpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHN1cHBvcnRGb3JtRGF0YSgpIHtcclxuICAgICAgICAgICAgcmV0dXJuICEhIHdpbmRvdy5Gb3JtRGF0YTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBzdXBwb3J0RmlsZUFQSSgpICYmIHN1cHBvcnRBamF4VXBsb2FkUHJvZ3Jlc3NFdmVudHMoKSAmJiBzdXBwb3J0Rm9ybURhdGEoKTtcclxuICAgIH0pKCk7XHJcblxyXG5cclxuICAgIGZ1bmN0aW9uIHhocnVwbG9hZChmaWxlcywgc2V0dGluZ3MpIHtcclxuXHJcbiAgICAgICAgaWYgKCFVSS5zdXBwb3J0LmFqYXh1cGxvYWQpe1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHNldHRpbmdzID0gVUkuJC5leHRlbmQoe30sIHhocnVwbG9hZC5kZWZhdWx0cywgc2V0dGluZ3MpO1xyXG5cclxuICAgICAgICBpZiAoIWZpbGVzLmxlbmd0aCl7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChzZXR0aW5ncy5hbGxvdyAhPT0gJyouKicpIHtcclxuXHJcbiAgICAgICAgICAgIGZvcih2YXIgaT0wLGZpbGU7ZmlsZT1maWxlc1tpXTtpKyspIHtcclxuXHJcbiAgICAgICAgICAgICAgICBpZighbWF0Y2hOYW1lKHNldHRpbmdzLmFsbG93LCBmaWxlLm5hbWUpKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmKHR5cGVvZihzZXR0aW5ncy5ub3RhbGxvd2VkKSA9PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KHNldHRpbmdzLm5vdGFsbG93ZWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3Mubm90YWxsb3dlZChmaWxlLCBzZXR0aW5ncyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGNvbXBsZXRlID0gc2V0dGluZ3MuY29tcGxldGU7XHJcblxyXG4gICAgICAgIGlmIChzZXR0aW5ncy5zaW5nbGUpe1xyXG5cclxuICAgICAgICAgICAgdmFyIGNvdW50ICAgID0gZmlsZXMubGVuZ3RoLFxyXG4gICAgICAgICAgICAgICAgdXBsb2FkZWQgPSAwLFxyXG4gICAgICAgICAgICAgICAgYWxsb3cgICAgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgIHNldHRpbmdzLmJlZm9yZUFsbChmaWxlcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgc2V0dGluZ3MuY29tcGxldGUgPSBmdW5jdGlvbihyZXNwb25zZSwgeGhyKXtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdXBsb2FkZWQgPSB1cGxvYWRlZCArIDE7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlKHJlc3BvbnNlLCB4aHIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2V0dGluZ3MuZmlsZWxpbWl0ICYmIHVwbG9hZGVkID49IHNldHRpbmdzLmZpbGVsaW1pdCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsbG93ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoYWxsb3cgJiYgdXBsb2FkZWQ8Y291bnQpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWQoW2ZpbGVzW3VwbG9hZGVkXV0sIHNldHRpbmdzKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5hbGxjb21wbGV0ZShyZXNwb25zZSwgeGhyKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHVwbG9hZChbZmlsZXNbMF1dLCBzZXR0aW5ncyk7XHJcblxyXG4gICAgICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAgICAgICBzZXR0aW5ncy5jb21wbGV0ZSA9IGZ1bmN0aW9uKHJlc3BvbnNlLCB4aHIpe1xyXG4gICAgICAgICAgICAgICAgY29tcGxldGUocmVzcG9uc2UsIHhocik7XHJcbiAgICAgICAgICAgICAgICBzZXR0aW5ncy5hbGxjb21wbGV0ZShyZXNwb25zZSwgeGhyKTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHVwbG9hZChmaWxlcywgc2V0dGluZ3MpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdXBsb2FkKGZpbGVzLCBzZXR0aW5ncyl7XHJcblxyXG4gICAgICAgICAgICAvLyB1cGxvYWQgYWxsIGF0IG9uY2VcclxuICAgICAgICAgICAgdmFyIGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCksIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHNldHRpbmdzLmJlZm9yZShzZXR0aW5ncywgZmlsZXMpPT09ZmFsc2UpIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBmOyBmID0gZmlsZXNbaV07IGkrKykgeyBmb3JtRGF0YS5hcHBlbmQoc2V0dGluZ3MucGFyYW0sIGYpOyB9XHJcbiAgICAgICAgICAgIGZvciAodmFyIHAgaW4gc2V0dGluZ3MucGFyYW1zKSB7IGZvcm1EYXRhLmFwcGVuZChwLCBzZXR0aW5ncy5wYXJhbXNbcF0pOyB9XHJcblxyXG4gICAgICAgICAgICAvLyBBZGQgYW55IGV2ZW50IGhhbmRsZXJzIGhlcmUuLi5cclxuICAgICAgICAgICAgeGhyLnVwbG9hZC5hZGRFdmVudExpc3RlbmVyKCdwcm9ncmVzcycsIGZ1bmN0aW9uKGUpe1xyXG4gICAgICAgICAgICAgICAgdmFyIHBlcmNlbnQgPSAoZS5sb2FkZWQgLyBlLnRvdGFsKSoxMDA7XHJcbiAgICAgICAgICAgICAgICBzZXR0aW5ncy5wcm9ncmVzcyhwZXJjZW50LCBlKTtcclxuICAgICAgICAgICAgfSwgZmFsc2UpO1xyXG5cclxuICAgICAgICAgICAgeGhyLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWRzdGFydCcsIGZ1bmN0aW9uKGUpeyBzZXR0aW5ncy5sb2Fkc3RhcnQoZSk7IH0sIGZhbHNlKTtcclxuICAgICAgICAgICAgeGhyLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCAgICAgIGZ1bmN0aW9uKGUpeyBzZXR0aW5ncy5sb2FkKGUpOyAgICAgIH0sIGZhbHNlKTtcclxuICAgICAgICAgICAgeGhyLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWRlbmQnLCAgIGZ1bmN0aW9uKGUpeyBzZXR0aW5ncy5sb2FkZW5kKGUpOyAgIH0sIGZhbHNlKTtcclxuICAgICAgICAgICAgeGhyLmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgICAgIGZ1bmN0aW9uKGUpeyBzZXR0aW5ncy5lcnJvcihlKTsgICAgIH0sIGZhbHNlKTtcclxuICAgICAgICAgICAgeGhyLmFkZEV2ZW50TGlzdGVuZXIoJ2Fib3J0JywgICAgIGZ1bmN0aW9uKGUpeyBzZXR0aW5ncy5hYm9ydChlKTsgICAgIH0sIGZhbHNlKTtcclxuXHJcbiAgICAgICAgICAgIHhoci5vcGVuKHNldHRpbmdzLm1ldGhvZCwgc2V0dGluZ3MuYWN0aW9uLCB0cnVlKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChzZXR0aW5ncy50eXBlPT0nanNvbicpIHtcclxuICAgICAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCdBY2NlcHQnLCAnYXBwbGljYXRpb24vanNvbicpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmb3IgKHZhciBoIGluIHNldHRpbmdzLmhlYWRlcnMpIHtcclxuICAgICAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKGgsIHNldHRpbmdzLmhlYWRlcnNbaF0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgc2V0dGluZ3MucmVhZHlzdGF0ZWNoYW5nZSh4aHIpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh4aHIucmVhZHlTdGF0ZT09NCl7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IHhoci5yZXNwb25zZVRleHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzZXR0aW5ncy50eXBlPT0nanNvbicpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gVUkuJC5wYXJzZUpTT04ocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLmNvbXBsZXRlKHJlc3BvbnNlLCB4aHIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBzZXR0aW5ncy5iZWZvcmVTZW5kKHhocik7XHJcbiAgICAgICAgICAgIHhoci5zZW5kKGZvcm1EYXRhKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgeGhydXBsb2FkLmRlZmF1bHRzID0ge1xyXG4gICAgICAgIGFjdGlvbjogJycsXHJcbiAgICAgICAgc2luZ2xlOiB0cnVlLFxyXG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgIHBhcmFtIDogJ2ZpbGVzW10nLFxyXG4gICAgICAgIHBhcmFtczoge30sXHJcbiAgICAgICAgYWxsb3cgOiAnKi4qJyxcclxuICAgICAgICB0eXBlICA6ICd0ZXh0JyxcclxuICAgICAgICBmaWxlbGltaXQ6IGZhbHNlLFxyXG4gICAgICAgIGhlYWRlcnM6IHt9LFxyXG5cclxuICAgICAgICAvLyBldmVudHNcclxuICAgICAgICBiZWZvcmUgICAgICAgICAgOiBmdW5jdGlvbihvKXt9LFxyXG4gICAgICAgIGJlZm9yZVNlbmQgICAgICA6IGZ1bmN0aW9uKHhocil7fSxcclxuICAgICAgICBiZWZvcmVBbGwgICAgICAgOiBmdW5jdGlvbigpe30sXHJcbiAgICAgICAgbG9hZHN0YXJ0ICAgICAgIDogZnVuY3Rpb24oKXt9LFxyXG4gICAgICAgIGxvYWQgICAgICAgICAgICA6IGZ1bmN0aW9uKCl7fSxcclxuICAgICAgICBsb2FkZW5kICAgICAgICAgOiBmdW5jdGlvbigpe30sXHJcbiAgICAgICAgZXJyb3IgICAgICAgICAgIDogZnVuY3Rpb24oKXt9LFxyXG4gICAgICAgIGFib3J0ICAgICAgICAgICA6IGZ1bmN0aW9uKCl7fSxcclxuICAgICAgICBwcm9ncmVzcyAgICAgICAgOiBmdW5jdGlvbigpe30sXHJcbiAgICAgICAgY29tcGxldGUgICAgICAgIDogZnVuY3Rpb24oKXt9LFxyXG4gICAgICAgIGFsbGNvbXBsZXRlICAgICA6IGZ1bmN0aW9uKCl7fSxcclxuICAgICAgICByZWFkeXN0YXRlY2hhbmdlOiBmdW5jdGlvbigpe30sXHJcbiAgICAgICAgbm90YWxsb3dlZCAgICAgIDogZnVuY3Rpb24oZmlsZSwgc2V0dGluZ3MpeyBhbGVydCgnT25seSB0aGUgZm9sbG93aW5nIGZpbGUgdHlwZXMgYXJlIGFsbG93ZWQ6ICcrc2V0dGluZ3MuYWxsb3cpOyB9XHJcbiAgICB9O1xyXG5cclxuICAgIGZ1bmN0aW9uIG1hdGNoTmFtZShwYXR0ZXJuLCBwYXRoKSB7XHJcblxyXG4gICAgICAgIHZhciBwYXJzZWRQYXR0ZXJuID0gJ14nICsgcGF0dGVybi5yZXBsYWNlKC9cXC8vZywgJ1xcXFwvJykuXHJcbiAgICAgICAgICAgIHJlcGxhY2UoL1xcKlxcKi9nLCAnKFxcXFwvW15cXFxcL10rKSonKS5cclxuICAgICAgICAgICAgcmVwbGFjZSgvXFwqL2csICdbXlxcXFwvXSsnKS5cclxuICAgICAgICAgICAgcmVwbGFjZSgvKCg/IVxcXFwpKVxcPy9nLCAnJDEuJykgKyAnJCc7XHJcblxyXG4gICAgICAgIHBhcnNlZFBhdHRlcm4gPSAnXicgKyBwYXJzZWRQYXR0ZXJuICsgJyQnO1xyXG5cclxuICAgICAgICByZXR1cm4gKHBhdGgubWF0Y2gobmV3IFJlZ0V4cChwYXJzZWRQYXR0ZXJuLCAnaScpKSAhPT0gbnVsbCk7XHJcbiAgICB9XHJcblxyXG4gICAgVUkuVXRpbHMueGhydXBsb2FkID0geGhydXBsb2FkO1xyXG5cclxuICAgIHJldHVybiB4aHJ1cGxvYWQ7XHJcbn0pOyJdfQ==
